(()=>{var DA=Object.create;var Vh=Object.defineProperty;var FA=Object.getOwnPropertyDescriptor;var OA=Object.getOwnPropertyNames;var NA=Object.getPrototypeOf,BA=Object.prototype.hasOwnProperty;var rr=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),zm=(n,e)=>{for(var t in e)Vh(n,t,{get:e[t],enumerable:!0})},kA=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of OA(e))!BA.call(n,s)&&s!==t&&Vh(n,s,{get:()=>e[s],enumerable:!(i=FA(e,s))||i.enumerable});return n};var we=(n,e,t)=>(t=n!=null?DA(NA(n)):{},kA(e||!n||!n.__esModule?Vh(t,"default",{value:n,enumerable:!0}):t,n));var We=rr((OD,Vm)=>{Vm.exports=globalThis.msagl});var Wm=rr((ND,jm)=>{"use strict";function GA(n,e){function t(){this.constructor=n}t.prototype=e.prototype,n.prototype=new t}function Ei(n,e,t,i){this.message=n,this.expected=e,this.found=t,this.location=i,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ei)}GA(Ei,Error);Ei.buildMessage=function(n,e){var t={literal:function(c){return'"'+s(c.text)+'"'},class:function(c){var f="",h;for(h=0;h<c.parts.length;h++)f+=c.parts[h]instanceof Array?o(c.parts[h][0])+"-"+o(c.parts[h][1]):o(c.parts[h]);return"["+(c.inverted?"^":"")+f+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};function i(c){return c.charCodeAt(0).toString(16).toUpperCase()}function s(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+i(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+i(f)})}function o(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+i(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+i(f)})}function a(c){return t[c.type](c)}function u(c){var f=new Array(c.length),h,d;for(h=0;h<c.length;h++)f[h]=a(c[h]);if(f.sort(),f.length>0){for(h=1,d=1;h<f.length;h++)f[h-1]!==f[h]&&(f[d]=f[h],d++);f.length=d}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function l(c){return c?'"'+s(c)+'"':"end of input"}return"Expected "+u(n)+" but "+l(e)+" found."};function UA(n,e){e=e!==void 0?e:{};var t={},i={start:wm},s=wm,o="strict",a=se("strict",!0),u="graph",l=se("graph",!0),c="digraph",f=se("digraph",!0),h="{",d=se("{",!1),x="}",E=se("}",!1),w=function(p,A,R,I){I===null&&(I=[]);var N={type:A.toLowerCase(),children:I};return p&&(N.strict=!0),R&&(N.id=R),N},S=";",M=se(";",!1),D=function(p,A){return A},C=function(p,A){return[p].concat(A)},L="=",B=se("=",!1),j=function(p,A){return{type:"attr_stmt",target:"graph",attr_list:[{type:"attr",id:p,eq:A}]}},J="node",te=se("node",!0),Z="edge",q=se("edge",!0),H=function(p,A){return{type:"attr_stmt",target:p,attr_list:A}},ie="[",ee=se("[",!1),fe="]",mt=se("]",!1),Hr=function(p,A){return(p||[]).concat(A||[])},An=function(p,A){return A},Xr=",",wt=se(",",!1),gh=function(p,A,R){return[{type:"attr",id:p,eq:A}].concat(R||[])},li=function(p,A,R){var I=[p];return I=I.concat(A.map(function(N){return N.id})),{type:"edge_stmt",edge_list:I,attr_list:R||[]}},bl="->",jo=se("->",!1),Al="--",mh=se("--",!1),Qe=function(p,A,R){return[{type:"edgeRHS",edgeop:p,id:A}].concat(R||[])},qr=function(p,A){return{type:"node_stmt",node_id:p,attr_list:A||[]}},De=function(p,A){return A?{type:"node_id",id:p,port:A}:{type:"node_id",id:p}},st=Pr("port"),vn=":",Yr=se(":",!1),ci=function(p,A){return A},fi=function(p,A){return{type:"port",id:p,compass_pt:A||null}},hi=function(p){return{type:"port",compass_pt:p||null}},zt="subgraph",Zr=se("subgraph",!0),vl=function(p){return p?{type:"subgraph",id:p}:{type:"subgraph"}},Tl=function(p,A){return p=p||{type:"subgraph"},p.children=A||[],p},As="n",xt=se("n",!1),wl="ne",xh=se("ne",!1),yh="e",Eh=se("e",!1),Sl="se",Pl=se("se",!1),Cl="s",Ml=se("s",!1),Wo="sw",vs=se("sw",!1),Ho="w",_h=se("w",!1),Il="nw",bh=se("nw",!1),Ah=Pr("UNICODE_STRING"),vh=function(p,A){return p+A.join("")},Ts=function(p,A){return p+A},Th="$",wh=se("$",!1),Ll="_",Rl=se("_",!1),Xo=Pr("NUMBER"),Sh="-",Ph=se("-",!1),Dl=".",qo=se(".",!1),Tn=/^[0-9]/,wn=Mt([["0","9"]],!1,!1),Ch=function(p){return parseFloat(Am())},ws=function(p){return{type:"id",value:p.slice(1,p.length-1),html:!0}},Yo="<",Zo=se("<",!1),Ss=">",di=se(">",!1),Mh=function(p){return"<"+p.join("")+">"},St=aA(),Sn=function(p){return p},Fl=function(p){return p.join("")},Ps='"',Cs=se('"',!1),Ko=function(p){return p.join("")},$o=function(){return Am()},Vt="\\",Tr=se("\\",!1),pi=function(p){return p[1]==='"'?'"':p[0]+p[1]},gi=function(){return""},Jo=/^[\n\r\u2028\u2029]/,Ih=Mt([`
`,"\r","\u2028","\u2029"],!1,!1),Lh=Pr("end of line"),Ms=`
`,yt=se(`
`,!1),Kr=`\r
`,wr=se(`\r
`,!1),er="\r",mi=se("\r",!1),jt="\u2028",tr=se("\u2028",!1),Ol="\u2029",Nl=se("\u2029",!1),Is=/^[^"\\\0-\x1F\x7F]/,Pt=Mt(['"',"\\",["\0",""],"\x7F"],!0,!1),xi='\\"',Qo=se('\\"',!1),ea=function(){return'"'},ta=function(){return"\\"},ra=Pr("COMMENT"),Ls=Pr("BLOCK_COMMENT"),Wt="/*",Rh=se("/*",!1),$r="*/",yi=se("*/",!1),na=function(p){return p},Dh=function(p){return p.join("")},Fh=Pr("C_COMMENT"),_="//",v=se("//",!1),P=/^[\n]/,F=Mt([`
`],!1,!1),z=function(p){return p.join("")},X=Pr("MACRO_COMMENT"),ue="#",Ve=se("#",!1),je=Pr("WHITESPACE"),Ke=/^[\n\r]/,Ct=Mt([`
`,"\r"],!1,!1),_m=/^[ \t]/,bm=Mt([" ","	"],!1,!1),qb=/^[a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137-\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148-\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C-\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA-\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9-\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC-\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF-\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F-\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0-\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB-\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE-\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0561-\u0587\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6-\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FC7\u1FD0-\u1FD3\u1FD6-\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6-\u1FF7\u210A\u210E-\u210F\u2113\u212F\u2134\u2139\u213C-\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65-\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73-\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3-\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7FA\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]/,Yb=Mt([["a","z"],"\xB5",["\xDF","\xF6"],["\xF8","\xFF"],"\u0101","\u0103","\u0105","\u0107","\u0109","\u010B","\u010D","\u010F","\u0111","\u0113","\u0115","\u0117","\u0119","\u011B","\u011D","\u011F","\u0121","\u0123","\u0125","\u0127","\u0129","\u012B","\u012D","\u012F","\u0131","\u0133","\u0135",["\u0137","\u0138"],"\u013A","\u013C","\u013E","\u0140","\u0142","\u0144","\u0146",["\u0148","\u0149"],"\u014B","\u014D","\u014F","\u0151","\u0153","\u0155","\u0157","\u0159","\u015B","\u015D","\u015F","\u0161","\u0163","\u0165","\u0167","\u0169","\u016B","\u016D","\u016F","\u0171","\u0173","\u0175","\u0177","\u017A","\u017C",["\u017E","\u0180"],"\u0183","\u0185","\u0188",["\u018C","\u018D"],"\u0192","\u0195",["\u0199","\u019B"],"\u019E","\u01A1","\u01A3","\u01A5","\u01A8",["\u01AA","\u01AB"],"\u01AD","\u01B0","\u01B4","\u01B6",["\u01B9","\u01BA"],["\u01BD","\u01BF"],"\u01C6","\u01C9","\u01CC","\u01CE","\u01D0","\u01D2","\u01D4","\u01D6","\u01D8","\u01DA",["\u01DC","\u01DD"],"\u01DF","\u01E1","\u01E3","\u01E5","\u01E7","\u01E9","\u01EB","\u01ED",["\u01EF","\u01F0"],"\u01F3","\u01F5","\u01F9","\u01FB","\u01FD","\u01FF","\u0201","\u0203","\u0205","\u0207","\u0209","\u020B","\u020D","\u020F","\u0211","\u0213","\u0215","\u0217","\u0219","\u021B","\u021D","\u021F","\u0221","\u0223","\u0225","\u0227","\u0229","\u022B","\u022D","\u022F","\u0231",["\u0233","\u0239"],"\u023C",["\u023F","\u0240"],"\u0242","\u0247","\u0249","\u024B","\u024D",["\u024F","\u0293"],["\u0295","\u02AF"],"\u0371","\u0373","\u0377",["\u037B","\u037D"],"\u0390",["\u03AC","\u03CE"],["\u03D0","\u03D1"],["\u03D5","\u03D7"],"\u03D9","\u03DB","\u03DD","\u03DF","\u03E1","\u03E3","\u03E5","\u03E7","\u03E9","\u03EB","\u03ED",["\u03EF","\u03F3"],"\u03F5","\u03F8",["\u03FB","\u03FC"],["\u0430","\u045F"],"\u0461","\u0463","\u0465","\u0467","\u0469","\u046B","\u046D","\u046F","\u0471","\u0473","\u0475","\u0477","\u0479","\u047B","\u047D","\u047F","\u0481","\u048B","\u048D","\u048F","\u0491","\u0493","\u0495","\u0497","\u0499","\u049B","\u049D","\u049F","\u04A1","\u04A3","\u04A5","\u04A7","\u04A9","\u04AB","\u04AD","\u04AF","\u04B1","\u04B3","\u04B5","\u04B7","\u04B9","\u04BB","\u04BD","\u04BF","\u04C2","\u04C4","\u04C6","\u04C8","\u04CA","\u04CC",["\u04CE","\u04CF"],"\u04D1","\u04D3","\u04D5","\u04D7","\u04D9","\u04DB","\u04DD","\u04DF","\u04E1","\u04E3","\u04E5","\u04E7","\u04E9","\u04EB","\u04ED","\u04EF","\u04F1","\u04F3","\u04F5","\u04F7","\u04F9","\u04FB","\u04FD","\u04FF","\u0501","\u0503","\u0505","\u0507","\u0509","\u050B","\u050D","\u050F","\u0511","\u0513","\u0515","\u0517","\u0519","\u051B","\u051D","\u051F","\u0521","\u0523","\u0525","\u0527",["\u0561","\u0587"],["\u1D00","\u1D2B"],["\u1D6B","\u1D77"],["\u1D79","\u1D9A"],"\u1E01","\u1E03","\u1E05","\u1E07","\u1E09","\u1E0B","\u1E0D","\u1E0F","\u1E11","\u1E13","\u1E15","\u1E17","\u1E19","\u1E1B","\u1E1D","\u1E1F","\u1E21","\u1E23","\u1E25","\u1E27","\u1E29","\u1E2B","\u1E2D","\u1E2F","\u1E31","\u1E33","\u1E35","\u1E37","\u1E39","\u1E3B","\u1E3D","\u1E3F","\u1E41","\u1E43","\u1E45","\u1E47","\u1E49","\u1E4B","\u1E4D","\u1E4F","\u1E51","\u1E53","\u1E55","\u1E57","\u1E59","\u1E5B","\u1E5D","\u1E5F","\u1E61","\u1E63","\u1E65","\u1E67","\u1E69","\u1E6B","\u1E6D","\u1E6F","\u1E71","\u1E73","\u1E75","\u1E77","\u1E79","\u1E7B","\u1E7D","\u1E7F","\u1E81","\u1E83","\u1E85","\u1E87","\u1E89","\u1E8B","\u1E8D","\u1E8F","\u1E91","\u1E93",["\u1E95","\u1E9D"],"\u1E9F","\u1EA1","\u1EA3","\u1EA5","\u1EA7","\u1EA9","\u1EAB","\u1EAD","\u1EAF","\u1EB1","\u1EB3","\u1EB5","\u1EB7","\u1EB9","\u1EBB","\u1EBD","\u1EBF","\u1EC1","\u1EC3","\u1EC5","\u1EC7","\u1EC9","\u1ECB","\u1ECD","\u1ECF","\u1ED1","\u1ED3","\u1ED5","\u1ED7","\u1ED9","\u1EDB","\u1EDD","\u1EDF","\u1EE1","\u1EE3","\u1EE5","\u1EE7","\u1EE9","\u1EEB","\u1EED","\u1EEF","\u1EF1","\u1EF3","\u1EF5","\u1EF7","\u1EF9","\u1EFB","\u1EFD",["\u1EFF","\u1F07"],["\u1F10","\u1F15"],["\u1F20","\u1F27"],["\u1F30","\u1F37"],["\u1F40","\u1F45"],["\u1F50","\u1F57"],["\u1F60","\u1F67"],["\u1F70","\u1F7D"],["\u1F80","\u1F87"],["\u1F90","\u1F97"],["\u1FA0","\u1FA7"],["\u1FB0","\u1FB4"],["\u1FB6","\u1FB7"],"\u1FBE",["\u1FC2","\u1FC4"],["\u1FC6","\u1FC7"],["\u1FD0","\u1FD3"],["\u1FD6","\u1FD7"],["\u1FE0","\u1FE7"],["\u1FF2","\u1FF4"],["\u1FF6","\u1FF7"],"\u210A",["\u210E","\u210F"],"\u2113","\u212F","\u2134","\u2139",["\u213C","\u213D"],["\u2146","\u2149"],"\u214E","\u2184",["\u2C30","\u2C5E"],"\u2C61",["\u2C65","\u2C66"],"\u2C68","\u2C6A","\u2C6C","\u2C71",["\u2C73","\u2C74"],["\u2C76","\u2C7B"],"\u2C81","\u2C83","\u2C85","\u2C87","\u2C89","\u2C8B","\u2C8D","\u2C8F","\u2C91","\u2C93","\u2C95","\u2C97","\u2C99","\u2C9B","\u2C9D","\u2C9F","\u2CA1","\u2CA3","\u2CA5","\u2CA7","\u2CA9","\u2CAB","\u2CAD","\u2CAF","\u2CB1","\u2CB3","\u2CB5","\u2CB7","\u2CB9","\u2CBB","\u2CBD","\u2CBF","\u2CC1","\u2CC3","\u2CC5","\u2CC7","\u2CC9","\u2CCB","\u2CCD","\u2CCF","\u2CD1","\u2CD3","\u2CD5","\u2CD7","\u2CD9","\u2CDB","\u2CDD","\u2CDF","\u2CE1",["\u2CE3","\u2CE4"],"\u2CEC","\u2CEE","\u2CF3",["\u2D00","\u2D25"],"\u2D27","\u2D2D","\uA641","\uA643","\uA645","\uA647","\uA649","\uA64B","\uA64D","\uA64F","\uA651","\uA653","\uA655","\uA657","\uA659","\uA65B","\uA65D","\uA65F","\uA661","\uA663","\uA665","\uA667","\uA669","\uA66B","\uA66D","\uA681","\uA683","\uA685","\uA687","\uA689","\uA68B","\uA68D","\uA68F","\uA691","\uA693","\uA695","\uA697","\uA723","\uA725","\uA727","\uA729","\uA72B","\uA72D",["\uA72F","\uA731"],"\uA733","\uA735","\uA737","\uA739","\uA73B","\uA73D","\uA73F","\uA741","\uA743","\uA745","\uA747","\uA749","\uA74B","\uA74D","\uA74F","\uA751","\uA753","\uA755","\uA757","\uA759","\uA75B","\uA75D","\uA75F","\uA761","\uA763","\uA765","\uA767","\uA769","\uA76B","\uA76D","\uA76F",["\uA771","\uA778"],"\uA77A","\uA77C","\uA77F","\uA781","\uA783","\uA785","\uA787","\uA78C","\uA78E","\uA791","\uA793","\uA7A1","\uA7A3","\uA7A5","\uA7A7","\uA7A9","\uA7FA",["\uFB00","\uFB06"],["\uFB13","\uFB17"],["\uFF41","\uFF5A"]],!1,!1),Zb=/^[\u02B0-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0374\u037A\u0559\u0640\u06E5-\u06E6\u07F4-\u07F5\u07FA\u081A\u0824\u0828\u0971\u0E46\u0EC6\u10FC\u17D7\u1843\u1AA7\u1C78-\u1C7D\u1D2C-\u1D6A\u1D78\u1D9B-\u1DBF\u2071\u207F\u2090-\u209C\u2C7C-\u2C7D\u2D6F\u2E2F\u3005\u3031-\u3035\u303B\u309D-\u309E\u30FC-\u30FE\uA015\uA4F8-\uA4FD\uA60C\uA67F\uA717-\uA71F\uA770\uA788\uA7F8-\uA7F9\uA9CF\uAA70\uAADD\uAAF3-\uAAF4\uFF70\uFF9E-\uFF9F]/,Kb=Mt([["\u02B0","\u02C1"],["\u02C6","\u02D1"],["\u02E0","\u02E4"],"\u02EC","\u02EE","\u0374","\u037A","\u0559","\u0640",["\u06E5","\u06E6"],["\u07F4","\u07F5"],"\u07FA","\u081A","\u0824","\u0828","\u0971","\u0E46","\u0EC6","\u10FC","\u17D7","\u1843","\u1AA7",["\u1C78","\u1C7D"],["\u1D2C","\u1D6A"],"\u1D78",["\u1D9B","\u1DBF"],"\u2071","\u207F",["\u2090","\u209C"],["\u2C7C","\u2C7D"],"\u2D6F","\u2E2F","\u3005",["\u3031","\u3035"],"\u303B",["\u309D","\u309E"],["\u30FC","\u30FE"],"\uA015",["\uA4F8","\uA4FD"],"\uA60C","\uA67F",["\uA717","\uA71F"],"\uA770","\uA788",["\uA7F8","\uA7F9"],"\uA9CF","\uAA70","\uAADD",["\uAAF3","\uAAF4"],"\uFF70",["\uFF9E","\uFF9F"]],!1,!1),$b=/^[\xAA\xBA\u01BB\u01C0-\u01C3\u0294\u05D0-\u05EA\u05F0-\u05F2\u0620-\u063F\u0641-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u0800-\u0815\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0972-\u0977\u0979-\u097F\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58-\u0C59\u0C60-\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E45\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10D0-\u10FA\u10FD-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17DC\u1820-\u1842\u1844-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C77\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u2135-\u2138\u2D30-\u2D67\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3006\u303C\u3041-\u3096\u309F\u30A1-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA014\uA016-\uA48C\uA4D0-\uA4F7\uA500-\uA60B\uA610-\uA61F\uA62A-\uA62B\uA66E\uA6A0-\uA6E5\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA6F\uAA71-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADC\uAAE0-\uAAEA\uAAF2\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF66-\uFF6F\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,Jb=Mt(["\xAA","\xBA","\u01BB",["\u01C0","\u01C3"],"\u0294",["\u05D0","\u05EA"],["\u05F0","\u05F2"],["\u0620","\u063F"],["\u0641","\u064A"],["\u066E","\u066F"],["\u0671","\u06D3"],"\u06D5",["\u06EE","\u06EF"],["\u06FA","\u06FC"],"\u06FF","\u0710",["\u0712","\u072F"],["\u074D","\u07A5"],"\u07B1",["\u07CA","\u07EA"],["\u0800","\u0815"],["\u0840","\u0858"],"\u08A0",["\u08A2","\u08AC"],["\u0904","\u0939"],"\u093D","\u0950",["\u0958","\u0961"],["\u0972","\u0977"],["\u0979","\u097F"],["\u0985","\u098C"],["\u098F","\u0990"],["\u0993","\u09A8"],["\u09AA","\u09B0"],"\u09B2",["\u09B6","\u09B9"],"\u09BD","\u09CE",["\u09DC","\u09DD"],["\u09DF","\u09E1"],["\u09F0","\u09F1"],["\u0A05","\u0A0A"],["\u0A0F","\u0A10"],["\u0A13","\u0A28"],["\u0A2A","\u0A30"],["\u0A32","\u0A33"],["\u0A35","\u0A36"],["\u0A38","\u0A39"],["\u0A59","\u0A5C"],"\u0A5E",["\u0A72","\u0A74"],["\u0A85","\u0A8D"],["\u0A8F","\u0A91"],["\u0A93","\u0AA8"],["\u0AAA","\u0AB0"],["\u0AB2","\u0AB3"],["\u0AB5","\u0AB9"],"\u0ABD","\u0AD0",["\u0AE0","\u0AE1"],["\u0B05","\u0B0C"],["\u0B0F","\u0B10"],["\u0B13","\u0B28"],["\u0B2A","\u0B30"],["\u0B32","\u0B33"],["\u0B35","\u0B39"],"\u0B3D",["\u0B5C","\u0B5D"],["\u0B5F","\u0B61"],"\u0B71","\u0B83",["\u0B85","\u0B8A"],["\u0B8E","\u0B90"],["\u0B92","\u0B95"],["\u0B99","\u0B9A"],"\u0B9C",["\u0B9E","\u0B9F"],["\u0BA3","\u0BA4"],["\u0BA8","\u0BAA"],["\u0BAE","\u0BB9"],"\u0BD0",["\u0C05","\u0C0C"],["\u0C0E","\u0C10"],["\u0C12","\u0C28"],["\u0C2A","\u0C33"],["\u0C35","\u0C39"],"\u0C3D",["\u0C58","\u0C59"],["\u0C60","\u0C61"],["\u0C85","\u0C8C"],["\u0C8E","\u0C90"],["\u0C92","\u0CA8"],["\u0CAA","\u0CB3"],["\u0CB5","\u0CB9"],"\u0CBD","\u0CDE",["\u0CE0","\u0CE1"],["\u0CF1","\u0CF2"],["\u0D05","\u0D0C"],["\u0D0E","\u0D10"],["\u0D12","\u0D3A"],"\u0D3D","\u0D4E",["\u0D60","\u0D61"],["\u0D7A","\u0D7F"],["\u0D85","\u0D96"],["\u0D9A","\u0DB1"],["\u0DB3","\u0DBB"],"\u0DBD",["\u0DC0","\u0DC6"],["\u0E01","\u0E30"],["\u0E32","\u0E33"],["\u0E40","\u0E45"],["\u0E81","\u0E82"],"\u0E84",["\u0E87","\u0E88"],"\u0E8A","\u0E8D",["\u0E94","\u0E97"],["\u0E99","\u0E9F"],["\u0EA1","\u0EA3"],"\u0EA5","\u0EA7",["\u0EAA","\u0EAB"],["\u0EAD","\u0EB0"],["\u0EB2","\u0EB3"],"\u0EBD",["\u0EC0","\u0EC4"],["\u0EDC","\u0EDF"],"\u0F00",["\u0F40","\u0F47"],["\u0F49","\u0F6C"],["\u0F88","\u0F8C"],["\u1000","\u102A"],"\u103F",["\u1050","\u1055"],["\u105A","\u105D"],"\u1061",["\u1065","\u1066"],["\u106E","\u1070"],["\u1075","\u1081"],"\u108E",["\u10D0","\u10FA"],["\u10FD","\u1248"],["\u124A","\u124D"],["\u1250","\u1256"],"\u1258",["\u125A","\u125D"],["\u1260","\u1288"],["\u128A","\u128D"],["\u1290","\u12B0"],["\u12B2","\u12B5"],["\u12B8","\u12BE"],"\u12C0",["\u12C2","\u12C5"],["\u12C8","\u12D6"],["\u12D8","\u1310"],["\u1312","\u1315"],["\u1318","\u135A"],["\u1380","\u138F"],["\u13A0","\u13F4"],["\u1401","\u166C"],["\u166F","\u167F"],["\u1681","\u169A"],["\u16A0","\u16EA"],["\u1700","\u170C"],["\u170E","\u1711"],["\u1720","\u1731"],["\u1740","\u1751"],["\u1760","\u176C"],["\u176E","\u1770"],["\u1780","\u17B3"],"\u17DC",["\u1820","\u1842"],["\u1844","\u1877"],["\u1880","\u18A8"],"\u18AA",["\u18B0","\u18F5"],["\u1900","\u191C"],["\u1950","\u196D"],["\u1970","\u1974"],["\u1980","\u19AB"],["\u19C1","\u19C7"],["\u1A00","\u1A16"],["\u1A20","\u1A54"],["\u1B05","\u1B33"],["\u1B45","\u1B4B"],["\u1B83","\u1BA0"],["\u1BAE","\u1BAF"],["\u1BBA","\u1BE5"],["\u1C00","\u1C23"],["\u1C4D","\u1C4F"],["\u1C5A","\u1C77"],["\u1CE9","\u1CEC"],["\u1CEE","\u1CF1"],["\u1CF5","\u1CF6"],["\u2135","\u2138"],["\u2D30","\u2D67"],["\u2D80","\u2D96"],["\u2DA0","\u2DA6"],["\u2DA8","\u2DAE"],["\u2DB0","\u2DB6"],["\u2DB8","\u2DBE"],["\u2DC0","\u2DC6"],["\u2DC8","\u2DCE"],["\u2DD0","\u2DD6"],["\u2DD8","\u2DDE"],"\u3006","\u303C",["\u3041","\u3096"],"\u309F",["\u30A1","\u30FA"],"\u30FF",["\u3105","\u312D"],["\u3131","\u318E"],["\u31A0","\u31BA"],["\u31F0","\u31FF"],["\u3400","\u4DB5"],["\u4E00","\u9FCC"],["\uA000","\uA014"],["\uA016","\uA48C"],["\uA4D0","\uA4F7"],["\uA500","\uA60B"],["\uA610","\uA61F"],["\uA62A","\uA62B"],"\uA66E",["\uA6A0","\uA6E5"],["\uA7FB","\uA801"],["\uA803","\uA805"],["\uA807","\uA80A"],["\uA80C","\uA822"],["\uA840","\uA873"],["\uA882","\uA8B3"],["\uA8F2","\uA8F7"],"\uA8FB",["\uA90A","\uA925"],["\uA930","\uA946"],["\uA960","\uA97C"],["\uA984","\uA9B2"],["\uAA00","\uAA28"],["\uAA40","\uAA42"],["\uAA44","\uAA4B"],["\uAA60","\uAA6F"],["\uAA71","\uAA76"],"\uAA7A",["\uAA80","\uAAAF"],"\uAAB1",["\uAAB5","\uAAB6"],["\uAAB9","\uAABD"],"\uAAC0","\uAAC2",["\uAADB","\uAADC"],["\uAAE0","\uAAEA"],"\uAAF2",["\uAB01","\uAB06"],["\uAB09","\uAB0E"],["\uAB11","\uAB16"],["\uAB20","\uAB26"],["\uAB28","\uAB2E"],["\uABC0","\uABE2"],["\uAC00","\uD7A3"],["\uD7B0","\uD7C6"],["\uD7CB","\uD7FB"],["\uF900","\uFA6D"],["\uFA70","\uFAD9"],"\uFB1D",["\uFB1F","\uFB28"],["\uFB2A","\uFB36"],["\uFB38","\uFB3C"],"\uFB3E",["\uFB40","\uFB41"],["\uFB43","\uFB44"],["\uFB46","\uFBB1"],["\uFBD3","\uFD3D"],["\uFD50","\uFD8F"],["\uFD92","\uFDC7"],["\uFDF0","\uFDFB"],["\uFE70","\uFE74"],["\uFE76","\uFEFC"],["\uFF66","\uFF6F"],["\uFF71","\uFF9D"],["\uFFA0","\uFFBE"],["\uFFC2","\uFFC7"],["\uFFCA","\uFFCF"],["\uFFD2","\uFFD7"],["\uFFDA","\uFFDC"]],!1,!1),Qb=/^[\u01C5\u01C8\u01CB\u01F2\u1F88-\u1F8F\u1F98-\u1F9F\u1FA8-\u1FAF\u1FBC\u1FCC\u1FFC]/,eA=Mt(["\u01C5","\u01C8","\u01CB","\u01F2",["\u1F88","\u1F8F"],["\u1F98","\u1F9F"],["\u1FA8","\u1FAF"],"\u1FBC","\u1FCC","\u1FFC"],!1,!1),tA=/^[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178-\u0179\u017B\u017D\u0181-\u0182\u0184\u0186-\u0187\u0189-\u018B\u018E-\u0191\u0193-\u0194\u0196-\u0198\u019C-\u019D\u019F-\u01A0\u01A2\u01A4\u01A6-\u01A7\u01A9\u01AC\u01AE-\u01AF\u01B1-\u01B3\u01B5\u01B7-\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A-\u023B\u023D-\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u0386\u0388-\u038A\u038C\u038E-\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9-\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0-\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E-\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D-\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA\uFF21-\uFF3A]/,rA=Mt([["A","Z"],["\xC0","\xD6"],["\xD8","\xDE"],"\u0100","\u0102","\u0104","\u0106","\u0108","\u010A","\u010C","\u010E","\u0110","\u0112","\u0114","\u0116","\u0118","\u011A","\u011C","\u011E","\u0120","\u0122","\u0124","\u0126","\u0128","\u012A","\u012C","\u012E","\u0130","\u0132","\u0134","\u0136","\u0139","\u013B","\u013D","\u013F","\u0141","\u0143","\u0145","\u0147","\u014A","\u014C","\u014E","\u0150","\u0152","\u0154","\u0156","\u0158","\u015A","\u015C","\u015E","\u0160","\u0162","\u0164","\u0166","\u0168","\u016A","\u016C","\u016E","\u0170","\u0172","\u0174","\u0176",["\u0178","\u0179"],"\u017B","\u017D",["\u0181","\u0182"],"\u0184",["\u0186","\u0187"],["\u0189","\u018B"],["\u018E","\u0191"],["\u0193","\u0194"],["\u0196","\u0198"],["\u019C","\u019D"],["\u019F","\u01A0"],"\u01A2","\u01A4",["\u01A6","\u01A7"],"\u01A9","\u01AC",["\u01AE","\u01AF"],["\u01B1","\u01B3"],"\u01B5",["\u01B7","\u01B8"],"\u01BC","\u01C4","\u01C7","\u01CA","\u01CD","\u01CF","\u01D1","\u01D3","\u01D5","\u01D7","\u01D9","\u01DB","\u01DE","\u01E0","\u01E2","\u01E4","\u01E6","\u01E8","\u01EA","\u01EC","\u01EE","\u01F1","\u01F4",["\u01F6","\u01F8"],"\u01FA","\u01FC","\u01FE","\u0200","\u0202","\u0204","\u0206","\u0208","\u020A","\u020C","\u020E","\u0210","\u0212","\u0214","\u0216","\u0218","\u021A","\u021C","\u021E","\u0220","\u0222","\u0224","\u0226","\u0228","\u022A","\u022C","\u022E","\u0230","\u0232",["\u023A","\u023B"],["\u023D","\u023E"],"\u0241",["\u0243","\u0246"],"\u0248","\u024A","\u024C","\u024E","\u0370","\u0372","\u0376","\u0386",["\u0388","\u038A"],"\u038C",["\u038E","\u038F"],["\u0391","\u03A1"],["\u03A3","\u03AB"],"\u03CF",["\u03D2","\u03D4"],"\u03D8","\u03DA","\u03DC","\u03DE","\u03E0","\u03E2","\u03E4","\u03E6","\u03E8","\u03EA","\u03EC","\u03EE","\u03F4","\u03F7",["\u03F9","\u03FA"],["\u03FD","\u042F"],"\u0460","\u0462","\u0464","\u0466","\u0468","\u046A","\u046C","\u046E","\u0470","\u0472","\u0474","\u0476","\u0478","\u047A","\u047C","\u047E","\u0480","\u048A","\u048C","\u048E","\u0490","\u0492","\u0494","\u0496","\u0498","\u049A","\u049C","\u049E","\u04A0","\u04A2","\u04A4","\u04A6","\u04A8","\u04AA","\u04AC","\u04AE","\u04B0","\u04B2","\u04B4","\u04B6","\u04B8","\u04BA","\u04BC","\u04BE",["\u04C0","\u04C1"],"\u04C3","\u04C5","\u04C7","\u04C9","\u04CB","\u04CD","\u04D0","\u04D2","\u04D4","\u04D6","\u04D8","\u04DA","\u04DC","\u04DE","\u04E0","\u04E2","\u04E4","\u04E6","\u04E8","\u04EA","\u04EC","\u04EE","\u04F0","\u04F2","\u04F4","\u04F6","\u04F8","\u04FA","\u04FC","\u04FE","\u0500","\u0502","\u0504","\u0506","\u0508","\u050A","\u050C","\u050E","\u0510","\u0512","\u0514","\u0516","\u0518","\u051A","\u051C","\u051E","\u0520","\u0522","\u0524","\u0526",["\u0531","\u0556"],["\u10A0","\u10C5"],"\u10C7","\u10CD","\u1E00","\u1E02","\u1E04","\u1E06","\u1E08","\u1E0A","\u1E0C","\u1E0E","\u1E10","\u1E12","\u1E14","\u1E16","\u1E18","\u1E1A","\u1E1C","\u1E1E","\u1E20","\u1E22","\u1E24","\u1E26","\u1E28","\u1E2A","\u1E2C","\u1E2E","\u1E30","\u1E32","\u1E34","\u1E36","\u1E38","\u1E3A","\u1E3C","\u1E3E","\u1E40","\u1E42","\u1E44","\u1E46","\u1E48","\u1E4A","\u1E4C","\u1E4E","\u1E50","\u1E52","\u1E54","\u1E56","\u1E58","\u1E5A","\u1E5C","\u1E5E","\u1E60","\u1E62","\u1E64","\u1E66","\u1E68","\u1E6A","\u1E6C","\u1E6E","\u1E70","\u1E72","\u1E74","\u1E76","\u1E78","\u1E7A","\u1E7C","\u1E7E","\u1E80","\u1E82","\u1E84","\u1E86","\u1E88","\u1E8A","\u1E8C","\u1E8E","\u1E90","\u1E92","\u1E94","\u1E9E","\u1EA0","\u1EA2","\u1EA4","\u1EA6","\u1EA8","\u1EAA","\u1EAC","\u1EAE","\u1EB0","\u1EB2","\u1EB4","\u1EB6","\u1EB8","\u1EBA","\u1EBC","\u1EBE","\u1EC0","\u1EC2","\u1EC4","\u1EC6","\u1EC8","\u1ECA","\u1ECC","\u1ECE","\u1ED0","\u1ED2","\u1ED4","\u1ED6","\u1ED8","\u1EDA","\u1EDC","\u1EDE","\u1EE0","\u1EE2","\u1EE4","\u1EE6","\u1EE8","\u1EEA","\u1EEC","\u1EEE","\u1EF0","\u1EF2","\u1EF4","\u1EF6","\u1EF8","\u1EFA","\u1EFC","\u1EFE",["\u1F08","\u1F0F"],["\u1F18","\u1F1D"],["\u1F28","\u1F2F"],["\u1F38","\u1F3F"],["\u1F48","\u1F4D"],"\u1F59","\u1F5B","\u1F5D","\u1F5F",["\u1F68","\u1F6F"],["\u1FB8","\u1FBB"],["\u1FC8","\u1FCB"],["\u1FD8","\u1FDB"],["\u1FE8","\u1FEC"],["\u1FF8","\u1FFB"],"\u2102","\u2107",["\u210B","\u210D"],["\u2110","\u2112"],"\u2115",["\u2119","\u211D"],"\u2124","\u2126","\u2128",["\u212A","\u212D"],["\u2130","\u2133"],["\u213E","\u213F"],"\u2145","\u2183",["\u2C00","\u2C2E"],"\u2C60",["\u2C62","\u2C64"],"\u2C67","\u2C69","\u2C6B",["\u2C6D","\u2C70"],"\u2C72","\u2C75",["\u2C7E","\u2C80"],"\u2C82","\u2C84","\u2C86","\u2C88","\u2C8A","\u2C8C","\u2C8E","\u2C90","\u2C92","\u2C94","\u2C96","\u2C98","\u2C9A","\u2C9C","\u2C9E","\u2CA0","\u2CA2","\u2CA4","\u2CA6","\u2CA8","\u2CAA","\u2CAC","\u2CAE","\u2CB0","\u2CB2","\u2CB4","\u2CB6","\u2CB8","\u2CBA","\u2CBC","\u2CBE","\u2CC0","\u2CC2","\u2CC4","\u2CC6","\u2CC8","\u2CCA","\u2CCC","\u2CCE","\u2CD0","\u2CD2","\u2CD4","\u2CD6","\u2CD8","\u2CDA","\u2CDC","\u2CDE","\u2CE0","\u2CE2","\u2CEB","\u2CED","\u2CF2","\uA640","\uA642","\uA644","\uA646","\uA648","\uA64A","\uA64C","\uA64E","\uA650","\uA652","\uA654","\uA656","\uA658","\uA65A","\uA65C","\uA65E","\uA660","\uA662","\uA664","\uA666","\uA668","\uA66A","\uA66C","\uA680","\uA682","\uA684","\uA686","\uA688","\uA68A","\uA68C","\uA68E","\uA690","\uA692","\uA694","\uA696","\uA722","\uA724","\uA726","\uA728","\uA72A","\uA72C","\uA72E","\uA732","\uA734","\uA736","\uA738","\uA73A","\uA73C","\uA73E","\uA740","\uA742","\uA744","\uA746","\uA748","\uA74A","\uA74C","\uA74E","\uA750","\uA752","\uA754","\uA756","\uA758","\uA75A","\uA75C","\uA75E","\uA760","\uA762","\uA764","\uA766","\uA768","\uA76A","\uA76C","\uA76E","\uA779","\uA77B",["\uA77D","\uA77E"],"\uA780","\uA782","\uA784","\uA786","\uA78B","\uA78D","\uA790","\uA792","\uA7A0","\uA7A2","\uA7A4","\uA7A6","\uA7A8","\uA7AA",["\uFF21","\uFF3A"]],!1,!1),nA=/^[\u16EE-\u16F0\u2160-\u2182\u2185-\u2188\u3007\u3021-\u3029\u3038-\u303A\uA6E6-\uA6EF]/,iA=Mt([["\u16EE","\u16F0"],["\u2160","\u2182"],["\u2185","\u2188"],"\u3007",["\u3021","\u3029"],["\u3038","\u303A"],["\uA6E6","\uA6EF"]],!1,!1),sA=/^[0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]/,oA=Mt([["0","9"],["\u0660","\u0669"],["\u06F0","\u06F9"],["\u07C0","\u07C9"],["\u0966","\u096F"],["\u09E6","\u09EF"],["\u0A66","\u0A6F"],["\u0AE6","\u0AEF"],["\u0B66","\u0B6F"],["\u0BE6","\u0BEF"],["\u0C66","\u0C6F"],["\u0CE6","\u0CEF"],["\u0D66","\u0D6F"],["\u0E50","\u0E59"],["\u0ED0","\u0ED9"],["\u0F20","\u0F29"],["\u1040","\u1049"],["\u1090","\u1099"],["\u17E0","\u17E9"],["\u1810","\u1819"],["\u1946","\u194F"],["\u19D0","\u19D9"],["\u1A80","\u1A89"],["\u1A90","\u1A99"],["\u1B50","\u1B59"],["\u1BB0","\u1BB9"],["\u1C40","\u1C49"],["\u1C50","\u1C59"],["\uA620","\uA629"],["\uA8D0","\uA8D9"],["\uA900","\uA909"],["\uA9D0","\uA9D9"],["\uAA50","\uAA59"],["\uABF0","\uABF9"],["\uFF10","\uFF19"]],!1,!1),y=0,ne=0,Bl=[{line:1,column:1}],Sr=0,Oh=[],O=0,kl;if("startRule"in e){if(!(e.startRule in i))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');s=i[e.startRule]}function Am(){return n.substring(ne,y)}function ID(){return ia(ne,y)}function LD(p,A){throw A=A!==void 0?A:ia(ne,y),Tm([Pr(p)],n.substring(ne,y),A)}function RD(p,A){throw A=A!==void 0?A:ia(ne,y),lA(p,A)}function se(p,A){return{type:"literal",text:p,ignoreCase:A}}function Mt(p,A,R){return{type:"class",parts:p,inverted:A,ignoreCase:R}}function aA(){return{type:"any"}}function uA(){return{type:"end"}}function Pr(p){return{type:"other",description:p}}function vm(p){var A=Bl[p],R;if(A)return A;for(R=p-1;!Bl[R];)R--;for(A=Bl[R],A={line:A.line,column:A.column};R<p;)n.charCodeAt(R)===10?(A.line++,A.column=1):A.column++,R++;return Bl[p]=A,A}function ia(p,A){var R=vm(p),I=vm(A);return{start:{offset:p,line:R.line,column:R.column},end:{offset:A,line:I.line,column:I.column}}}function k(p){y<Sr||(y>Sr&&(Sr=y,Oh=[]),Oh.push(p))}function lA(p,A){return new Ei(p,null,null,A)}function Tm(p,A,R){return new Ei(Ei.buildMessage(p,A),p,A,R)}function wm(){var p,A;if(p=[],A=Sm(),A!==t)for(;A!==t;)p.push(A),A=Sm();else p=t;return p}function Sm(){var p,A,R,I,N,G,K,Ce,Me,Mr,It,zh,Um;return p=y,A=ye(),A!==t?(n.substr(y,6).toLowerCase()===o?(R=n.substr(y,6),y+=6):(R=t,O===0&&k(a)),R===t&&(R=null),R!==t?(I=ye(),I!==t?(n.substr(y,5).toLowerCase()===u?(N=n.substr(y,5),y+=5):(N=t,O===0&&k(l)),N===t&&(n.substr(y,7).toLowerCase()===c?(N=n.substr(y,7),y+=7):(N=t,O===0&&k(f))),N!==t?(G=ye(),G!==t?(K=Cr(),K===t&&(K=null),K!==t?(Ce=ye(),Ce!==t?(n.charCodeAt(y)===123?(Me=h,y++):(Me=t,O===0&&k(d)),Me!==t?(Mr=Pm(),Mr===t&&(Mr=null),Mr!==t?(It=ye(),It!==t?(n.charCodeAt(y)===125?(zh=x,y++):(zh=t,O===0&&k(E)),zh!==t?(Um=ye(),Um!==t?(ne=p,A=w(R,N,K,Mr),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p}function Pm(){var p,A,R,I,N,G,K,Ce,Me,Mr,It;if(p=y,A=ye(),A!==t)if(R=Nh(),R!==t)if(I=ye(),I!==t)if(n.charCodeAt(y)===59?(N=S,y++):(N=t,O===0&&k(M)),N===t&&(N=null),N!==t){for(G=[],K=y,Ce=ye(),Ce!==t?(Me=Nh(),Me!==t?(Mr=ye(),Mr!==t?(n.charCodeAt(y)===59?(It=S,y++):(It=t,O===0&&k(M)),It===t&&(It=null),It!==t?(ne=K,Ce=D(R,Me),K=Ce):(y=K,K=t)):(y=K,K=t)):(y=K,K=t)):(y=K,K=t);K!==t;)G.push(K),K=y,Ce=ye(),Ce!==t?(Me=Nh(),Me!==t?(Mr=ye(),Mr!==t?(n.charCodeAt(y)===59?(It=S,y++):(It=t,O===0&&k(M)),It===t&&(It=null),It!==t?(ne=K,Ce=D(R,Me),K=Ce):(y=K,K=t)):(y=K,K=t)):(y=K,K=t)):(y=K,K=t);G!==t?(ne=p,A=C(R,G),p=A):(y=p,p=t)}else y=p,p=t;else y=p,p=t;else y=p,p=t;else y=p,p=t;return p}function Nh(){var p,A,R,I,N,G;return p=y,A=Cr(),A!==t?(R=ye(),R!==t?(n.charCodeAt(y)===61?(I=L,y++):(I=t,O===0&&k(B)),I!==t?(N=ye(),N!==t?(G=Cr(),G!==t?(ne=p,A=j(A,G),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p===t&&(p=cA(),p===t&&(p=fA(),p===t&&(p=kh(),p===t&&(p=hA(),p===t&&(p=y,A=Cr(),A!==t?(n.charCodeAt(y)===61?(R=L,y++):(R=t,O===0&&k(B)),R!==t?(I=Cr(),I!==t?(A=[A,R,I],p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)))))),p}function cA(){var p,A,R;return p=y,n.substr(y,5).toLowerCase()===u?(A=n.substr(y,5),y+=5):(A=t,O===0&&k(l)),A===t&&(n.substr(y,4).toLowerCase()===J?(A=n.substr(y,4),y+=4):(A=t,O===0&&k(te)),A===t&&(n.substr(y,4).toLowerCase()===Z?(A=n.substr(y,4),y+=4):(A=t,O===0&&k(q)))),A!==t?(R=Gl(),R!==t?(ne=p,A=H(A,R),p=A):(y=p,p=t)):(y=p,p=t),p}function Gl(){var p,A,R,I,N,G,K,Ce,Me;return p=y,A=ye(),A!==t?(n.charCodeAt(y)===91?(R=ie,y++):(R=t,O===0&&k(ee)),R!==t?(I=ye(),I!==t?(N=Cm(),N===t&&(N=null),N!==t?(G=ye(),G!==t?(n.charCodeAt(y)===93?(K=fe,y++):(K=t,O===0&&k(mt)),K!==t?(Ce=ye(),Ce!==t?(Me=Gl(),Me===t&&(Me=null),Me!==t?(ne=p,A=Hr(N,Me),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p}function Cm(){var p,A,R,I,N,G,K,Ce;return p=y,A=ye(),A!==t?(R=Cr(),R!==t?(I=y,N=ye(),N!==t?(n.charCodeAt(y)===61?(G=L,y++):(G=t,O===0&&k(B)),G!==t?(K=ye(),K!==t?(Ce=Cr(),Ce!==t?(ne=I,N=An(R,Ce),I=N):(y=I,I=t)):(y=I,I=t)):(y=I,I=t)):(y=I,I=t),I===t&&(I=null),I!==t?(N=ye(),N!==t?(n.charCodeAt(y)===44?(G=Xr,y++):(G=t,O===0&&k(wt)),G===t&&(n.charCodeAt(y)===59?(G=S,y++):(G=t,O===0&&k(M))),G===t&&(G=null),G!==t?(K=Cm(),K===t&&(K=null),K!==t?(ne=p,A=gh(R,I,K),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p}function fA(){var p,A,R,I;return p=y,A=kh(),A===t&&(A=Bh()),A!==t?(R=Mm(),R!==t?(I=Gl(),I===t&&(I=null),I!==t?(ne=p,A=li(A,R,I),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p}function Mm(){var p,A,R,I,N,G,K;return p=y,A=ye(),A!==t?(n.substr(y,2)===bl?(R=bl,y+=2):(R=t,O===0&&k(jo)),R===t&&(n.substr(y,2)===Al?(R=Al,y+=2):(R=t,O===0&&k(mh))),R!==t?(I=ye(),I!==t?(N=kh(),N===t&&(N=Bh()),N!==t?(G=ye(),G!==t?(K=Mm(),K===t&&(K=null),K!==t?(ne=p,A=Qe(R,N,K),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p}function hA(){var p,A,R;return p=y,A=Bh(),A!==t?(R=Gl(),R===t&&(R=null),R!==t?(ne=p,A=qr(A,R),p=A):(y=p,p=t)):(y=p,p=t),p}function Bh(){var p,A,R;return p=y,A=Cr(),A!==t?(R=dA(),R===t&&(R=null),R!==t?(ne=p,A=De(A,R),p=A):(y=p,p=t)):(y=p,p=t),p}function dA(){var p,A,R,I,N,G;return O++,p=y,n.charCodeAt(y)===58?(A=vn,y++):(A=t,O===0&&k(Yr)),A!==t?(R=Cr(),R!==t?(I=y,n.charCodeAt(y)===58?(N=vn,y++):(N=t,O===0&&k(Yr)),N!==t?(G=Im(),G!==t?(ne=I,N=ci(R,G),I=N):(y=I,I=t)):(y=I,I=t),I===t&&(I=null),I!==t?(ne=p,A=fi(R,I),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p===t&&(p=y,n.charCodeAt(y)===58?(A=vn,y++):(A=t,O===0&&k(Yr)),A!==t?(R=Im(),R!==t?(ne=p,A=hi(R),p=A):(y=p,p=t)):(y=p,p=t)),O--,p===t&&(A=t,O===0&&k(st)),p}function kh(){var p,A,R,I,N,G;return p=y,A=y,n.substr(y,8).toLowerCase()===zt?(R=n.substr(y,8),y+=8):(R=t,O===0&&k(Zr)),R!==t?(I=ye(),I!==t?(N=Cr(),N===t&&(N=null),N!==t?(G=ye(),G!==t?(ne=A,R=vl(N),A=R):(y=A,A=t)):(y=A,A=t)):(y=A,A=t)):(y=A,A=t),A===t&&(A=null),A!==t?(n.charCodeAt(y)===123?(R=h,y++):(R=t,O===0&&k(d)),R!==t?(I=Pm(),I===t&&(I=null),I!==t?(N=ye(),N!==t?(n.charCodeAt(y)===125?(G=x,y++):(G=t,O===0&&k(E)),G!==t?(ne=p,A=Tl(A,I),p=A):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t)):(y=p,p=t),p}function Im(){var p;return n.charCodeAt(y)===110?(p=As,y++):(p=t,O===0&&k(xt)),p===t&&(n.substr(y,2)===wl?(p=wl,y+=2):(p=t,O===0&&k(xh)),p===t&&(n.charCodeAt(y)===101?(p=yh,y++):(p=t,O===0&&k(Eh)),p===t&&(n.substr(y,2)===Sl?(p=Sl,y+=2):(p=t,O===0&&k(Pl)),p===t&&(n.charCodeAt(y)===115?(p=Cl,y++):(p=t,O===0&&k(Ml)),p===t&&(n.substr(y,2)===Wo?(p=Wo,y+=2):(p=t,O===0&&k(vs)),p===t&&(n.charCodeAt(y)===119?(p=Ho,y++):(p=t,O===0&&k(_h)),p===t&&(n.substr(y,2)===Il?(p=Il,y+=2):(p=t,O===0&&k(bh))))))))),p}function Cr(){var p;return p=Lm(),p===t&&(p=pA(),p===t&&(p=Fm(),p===t&&(p=mA(),p===t&&(p=gA())))),p}function Lm(){var p,A,R,I;if(O++,p=y,A=Rm(),A!==t){for(R=[],I=Dm();I!==t;)R.push(I),I=Dm();R!==t?(ne=p,A=vh(A,R),p=A):(y=p,p=t)}else y=p,p=t;return O--,p===t&&(A=t,O===0&&k(Ah)),p}function pA(){var p,A,R;return p=y,A=Fm(),A!==t?(R=Lm(),R!==t?(ne=p,A=Ts(A,R),p=A):(y=p,p=t)):(y=p,p=t),p}function Rm(){var p;return p=wA(),p===t&&(n.charCodeAt(y)===36?(p=Th,y++):(p=t,O===0&&k(wh)),p===t&&(n.charCodeAt(y)===95?(p=Ll,y++):(p=t,O===0&&k(Rl)))),p}function Dm(){var p;return p=Rm(),p===t&&(p=RA()),p}function Fm(){var p,A,R,I,N,G,K,Ce,Me;if(O++,p=y,A=y,n.charCodeAt(y)===45?(R=Sh,y++):(R=t,O===0&&k(Ph)),R===t&&(R=null),R!==t){if(I=y,n.charCodeAt(y)===46?(N=Dl,y++):(N=t,O===0&&k(qo)),N!==t){if(G=[],Tn.test(n.charAt(y))?(K=n.charAt(y),y++):(K=t,O===0&&k(wn)),K!==t)for(;K!==t;)G.push(K),Tn.test(n.charAt(y))?(K=n.charAt(y),y++):(K=t,O===0&&k(wn));else G=t;G!==t?(N=[N,G],I=N):(y=I,I=t)}else y=I,I=t;if(I===t){if(I=y,N=[],Tn.test(n.charAt(y))?(G=n.charAt(y),y++):(G=t,O===0&&k(wn)),G!==t)for(;G!==t;)N.push(G),Tn.test(n.charAt(y))?(G=n.charAt(y),y++):(G=t,O===0&&k(wn));else N=t;if(N!==t){if(G=y,n.charCodeAt(y)===46?(K=Dl,y++):(K=t,O===0&&k(qo)),K!==t){for(Ce=[],Tn.test(n.charAt(y))?(Me=n.charAt(y),y++):(Me=t,O===0&&k(wn));Me!==t;)Ce.push(Me),Tn.test(n.charAt(y))?(Me=n.charAt(y),y++):(Me=t,O===0&&k(wn));Ce!==t?(K=[K,Ce],G=K):(y=G,G=t)}else y=G,G=t;G===t&&(G=null),G!==t?(N=[N,G],I=N):(y=I,I=t)}else y=I,I=t}I!==t?(R=[R,I],A=R):(y=A,A=t)}else y=A,A=t;return A!==t&&(ne=p,A=Ch(A)),p=A,O--,p===t&&(A=t,O===0&&k(Xo)),p}function gA(){var p,A;return p=y,A=Gh(),A!==t&&(ne=p,A=ws(A)),p=A,p}function Gh(){var p,A,R,I;if(p=y,n.charCodeAt(y)===60?(A=Yo,y++):(A=t,O===0&&k(Zo)),A!==t){for(R=[],I=Om(),I===t&&(I=Gh());I!==t;)R.push(I),I=Om(),I===t&&(I=Gh());R!==t?(n.charCodeAt(y)===62?(I=Ss,y++):(I=t,O===0&&k(di)),I!==t?(ne=p,A=Mh(R),p=A):(y=p,p=t)):(y=p,p=t)}else y=p,p=t;return p}function Om(){var p,A,R,I,N;if(p=y,A=[],R=y,I=y,O++,n.charCodeAt(y)===62?(N=Ss,y++):(N=t,O===0&&k(di)),N===t&&(n.charCodeAt(y)===60?(N=Yo,y++):(N=t,O===0&&k(Zo))),O--,N===t?I=void 0:(y=I,I=t),I!==t?(n.length>y?(N=n.charAt(y),y++):(N=t,O===0&&k(St)),N!==t?(ne=R,I=Sn(N),R=I):(y=R,R=t)):(y=R,R=t),R!==t)for(;R!==t;)A.push(R),R=y,I=y,O++,n.charCodeAt(y)===62?(N=Ss,y++):(N=t,O===0&&k(di)),N===t&&(n.charCodeAt(y)===60?(N=Yo,y++):(N=t,O===0&&k(Zo))),O--,N===t?I=void 0:(y=I,I=t),I!==t?(n.length>y?(N=n.charAt(y),y++):(N=t,O===0&&k(St)),N!==t?(ne=R,I=Sn(N),R=I):(y=R,R=t)):(y=R,R=t);else A=t;return A!==t&&(ne=p,A=Fl(A)),p=A,p}function mA(){var p,A,R,I;if(p=y,n.charCodeAt(y)===34?(A=Ps,y++):(A=t,O===0&&k(Cs)),A!==t){for(R=[],I=Nm();I!==t;)R.push(I),I=Nm();R!==t?(n.charCodeAt(y)===34?(I=Ps,y++):(I=t,O===0&&k(Cs)),I!==t?(ne=p,A=Ko(R),p=A):(y=p,p=t)):(y=p,p=t)}else y=p,p=t;return p}function Nm(){var p,A,R;return p=xA(),p===t&&(p=y,A=y,O++,n.charCodeAt(y)===34?(R=Ps,y++):(R=t,O===0&&k(Cs)),R===t&&(R=EA()),O--,R===t?A=void 0:(y=A,A=t),A!==t?(R=bA(),R!==t?(ne=p,A=$o(),p=A):(y=p,p=t)):(y=p,p=t),p===t&&(p=yA())),p}function xA(){var p,A,R,I;return p=y,A=y,n.charCodeAt(y)===92?(R=Vt,y++):(R=t,O===0&&k(Tr)),R!==t?(n.length>y?(I=n.charAt(y),y++):(I=t,O===0&&k(St)),I!==t?(R=[R,I],A=R):(y=A,A=t)):(y=A,A=t),A!==t&&(ne=p,A=pi(A)),p=A,p}function yA(){var p,A,R;return p=y,n.charCodeAt(y)===92?(A=Vt,y++):(A=t,O===0&&k(Tr)),A!==t?(R=_A(),R!==t?(ne=p,A=gi(),p=A):(y=p,p=t)):(y=p,p=t),p}function EA(){var p;return Jo.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(Ih)),p}function _A(){var p,A;return O++,n.charCodeAt(y)===10?(p=Ms,y++):(p=t,O===0&&k(yt)),p===t&&(n.substr(y,2)===Kr?(p=Kr,y+=2):(p=t,O===0&&k(wr)),p===t&&(n.charCodeAt(y)===13?(p=er,y++):(p=t,O===0&&k(mi)),p===t&&(n.charCodeAt(y)===8232?(p=jt,y++):(p=t,O===0&&k(tr)),p===t&&(n.charCodeAt(y)===8233?(p=Ol,y++):(p=t,O===0&&k(Nl)))))),O--,p===t&&(A=t,O===0&&k(Lh)),p}function bA(){var p;return n.length>y?(p=n.charAt(y),y++):(p=t,O===0&&k(St)),p}function DD(){var p,A,R;if(p=y,A=[],R=Bm(),R!==t)for(;R!==t;)A.push(R),R=Bm();else A=t;return A!==t&&(ne=p,A=Ko(A)),p=A,p}function Bm(){var p,A,R;return Is.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(Pt)),p===t&&(p=y,n.substr(y,2)===xi?(A=xi,y+=2):(A=t,O===0&&k(Qo)),A!==t&&(ne=p,A=ea()),p=A,p===t&&(p=y,n.charCodeAt(y)===92?(A=Vt,y++):(A=t,O===0&&k(Tr)),A!==t?(R=Uh(),R!==t?(ne=p,A=gi(),p=A):(y=p,p=t)):(y=p,p=t),p===t&&(p=y,n.charCodeAt(y)===92?(A=Vt,y++):(A=t,O===0&&k(Tr)),A!==t&&(ne=p,A=ta()),p=A))),p}function km(){var p,A;return O++,p=AA(),p===t&&(p=vA(),p===t&&(p=TA())),O--,p===t&&(A=t,O===0&&k(ra)),p}function AA(){var p,A,R,I,N,G;if(O++,p=y,n.substr(y,2)===Wt?(A=Wt,y+=2):(A=t,O===0&&k(Rh)),A!==t){for(R=[],I=y,N=y,O++,n.substr(y,2)===$r?(G=$r,y+=2):(G=t,O===0&&k(yi)),O--,G===t?N=void 0:(y=N,N=t),N!==t?(n.length>y?(G=n.charAt(y),y++):(G=t,O===0&&k(St)),G!==t?(ne=I,N=na(G),I=N):(y=I,I=t)):(y=I,I=t);I!==t;)R.push(I),I=y,N=y,O++,n.substr(y,2)===$r?(G=$r,y+=2):(G=t,O===0&&k(yi)),O--,G===t?N=void 0:(y=N,N=t),N!==t?(n.length>y?(G=n.charAt(y),y++):(G=t,O===0&&k(St)),G!==t?(ne=I,N=na(G),I=N):(y=I,I=t)):(y=I,I=t);R!==t?(n.substr(y,2)===$r?(I=$r,y+=2):(I=t,O===0&&k(yi)),I!==t?(ne=p,A=Dh(R),p=A):(y=p,p=t)):(y=p,p=t)}else y=p,p=t;return O--,p===t&&(A=t,O===0&&k(Ls)),p}function vA(){var p,A,R,I,N,G;if(O++,p=y,n.substr(y,2)===_?(A=_,y+=2):(A=t,O===0&&k(v)),A!==t){for(R=[],I=y,N=y,O++,P.test(n.charAt(y))?(G=n.charAt(y),y++):(G=t,O===0&&k(F)),O--,G===t?N=void 0:(y=N,N=t),N!==t?(n.length>y?(G=n.charAt(y),y++):(G=t,O===0&&k(St)),G!==t?(ne=I,N=Sn(G),I=N):(y=I,I=t)):(y=I,I=t);I!==t;)R.push(I),I=y,N=y,O++,P.test(n.charAt(y))?(G=n.charAt(y),y++):(G=t,O===0&&k(F)),O--,G===t?N=void 0:(y=N,N=t),N!==t?(n.length>y?(G=n.charAt(y),y++):(G=t,O===0&&k(St)),G!==t?(ne=I,N=Sn(G),I=N):(y=I,I=t)):(y=I,I=t);R!==t?(P.test(n.charAt(y))?(I=n.charAt(y),y++):(I=t,O===0&&k(F)),I===t&&(I=null),I!==t?(ne=p,A=z(R),p=A):(y=p,p=t)):(y=p,p=t)}else y=p,p=t;return O--,p===t&&(A=t,O===0&&k(Fh)),p}function TA(){var p,A,R,I,N,G;if(O++,p=y,n.charCodeAt(y)===35?(A=ue,y++):(A=t,O===0&&k(Ve)),A!==t){for(R=[],I=y,N=y,O++,P.test(n.charAt(y))?(G=n.charAt(y),y++):(G=t,O===0&&k(F)),O--,G===t?N=void 0:(y=N,N=t),N!==t?(n.length>y?(G=n.charAt(y),y++):(G=t,O===0&&k(St)),G!==t?(ne=I,N=Sn(G),I=N):(y=I,I=t)):(y=I,I=t);I!==t;)R.push(I),I=y,N=y,O++,P.test(n.charAt(y))?(G=n.charAt(y),y++):(G=t,O===0&&k(F)),O--,G===t?N=void 0:(y=N,N=t),N!==t?(n.length>y?(G=n.charAt(y),y++):(G=t,O===0&&k(St)),G!==t?(ne=I,N=Sn(G),I=N):(y=I,I=t)):(y=I,I=t);R!==t?(P.test(n.charAt(y))?(I=n.charAt(y),y++):(I=t,O===0&&k(F)),I===t&&(I=null),I!==t?(ne=p,A=z(R),p=A):(y=p,p=t)):(y=p,p=t)}else y=p,p=t;return O--,p===t&&(A=t,O===0&&k(X)),p}function ye(){var p,A;for(O++,p=[],A=Gm(),A===t&&(A=km());A!==t;)p.push(A),A=Gm(),A===t&&(A=km());return O--,p===t&&(A=t,O===0&&k(je)),p}function Uh(){var p,A;if(p=[],Ke.test(n.charAt(y))?(A=n.charAt(y),y++):(A=t,O===0&&k(Ct)),A!==t)for(;A!==t;)p.push(A),Ke.test(n.charAt(y))?(A=n.charAt(y),y++):(A=t,O===0&&k(Ct));else p=t;return p}function Gm(){var p,A;if(p=[],_m.test(n.charAt(y))?(A=n.charAt(y),y++):(A=t,O===0&&k(bm)),A===t&&(A=Uh()),A!==t)for(;A!==t;)p.push(A),_m.test(n.charAt(y))?(A=n.charAt(y),y++):(A=t,O===0&&k(bm)),A===t&&(A=Uh());else p=t;return p}function wA(){var p;return p=IA(),p===t&&(p=SA(),p===t&&(p=MA(),p===t&&(p=PA(),p===t&&(p=CA(),p===t&&(p=LA()))))),p}function SA(){var p;return qb.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(Yb)),p}function PA(){var p;return Zb.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(Kb)),p}function CA(){var p;return $b.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(Jb)),p}function MA(){var p;return Qb.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(eA)),p}function IA(){var p;return tA.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(rA)),p}function LA(){var p;return nA.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(iA)),p}function RA(){var p;return sA.test(n.charAt(y))?(p=n.charAt(y),y++):(p=t,O===0&&k(oA)),p}if(kl=s(),kl!==t&&y===n.length)return kl;throw kl!==t&&y<n.length&&k(uA()),Tm(Oh,Sr<n.length?n.charAt(Sr):null,Sr<n.length?ia(Sr,Sr+1):ia(Sr,Sr))}jm.exports={SyntaxError:Ei,parse:UA}});var Xm=rr((BD,Hm)=>{var zA=Wm();Hm.exports=zA.parse});var l0=rr(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var Kh=class{constructor(...e){this._head=this._tail=null,this._length=0,e.length>0&&e.forEach(t=>{this.append(t)})}*iterator(){let e=this._head;for(;e;)yield e.value,e=e.next}[Symbol.iterator](){return this.iterator()}get head(){return this._head?this._head.value:null}get tail(){return this._tail?this._tail.value:null}get length(){return this._length}insert(e,t,i=!1){if(i&&this.isDuplicate(e))return!1;let s=new ks(e),o=this._head;if(o)for(;;){if(o.value===t)return s.next=o.next,s.prev=o,o.next=s,s.next?s.next.prev=s:this._tail=s,this._length++,!0;if(o.next)o=o.next;else return!1}else return!1}append(e,t=!1){if(t&&this.isDuplicate(e))return!1;let i=new ks(e);return this._tail?(this._tail.next=i,i.prev=this._tail,this._tail=i):this._head=this._tail=i,this._length++,!0}prepend(e,t=!1){if(t&&this.isDuplicate(e))return!1;let i=new ks(e);return this._head?(i.next=this._head,this._head.prev=i,this._head=i):this._head=this._tail=i,this._length++,!0}remove(e){let t=this._head;if(!!t){if(t.value===e)return this._head=t.next,this._head.prev=null,t.next=t.prev=null,this._length--,t.value;for(;;){if(t.value===e)return t.next?(t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null):(t.prev.next=null,this._tail=t.prev,t.next=t.prev=null),this._length--,t.value;if(t.next)t=t.next;else return}}}removeHead(){let e=this._head;if(!!e)return this._head.next?(this._head.next.prev=null,this._head=this._head.next,e.next=e.prev=null):(this._head=null,this._tail=null),this._length--,e.value}removeTail(){let e=this._tail;if(!!e)return this._tail.prev?(this._tail.prev.next=null,this._tail=this._tail.prev,e.next=e.prev=null):(this._head=null,this._tail=null),this._length--,e.value}first(e){let t=this.iterator(),i=[],s=Math.min(e,this.length);for(let o=0;o<s;o++){let a=t.next();i.push(a.value)}return i}toArray(){return[...this]}isDuplicate(e){return new Set(this.toArray()).has(e)}};Kl.LinkedList=Kh;var ks=class{constructor(e){this.value=e,this.next=null,this.prev=null}};Kl.LinkedListItem=ks});var c0=rr(Jh=>{"use strict";Object.defineProperty(Jh,"__esModule",{value:!0});var av=l0(),$h=class extends av.LinkedList{constructor(...e){super(...e)}get front(){return this.head}enqueue(e){this.append(e)}dequeue(){return this.removeHead()}};Jh.Queue=$h});var x0=rr((KO,m0)=>{m0.exports={rgb2hsl:ca,rgb2hsv:Ql,rgb2hwb:fa,rgb2cmyk:ha,rgb2keyword:da,rgb2xyz:td,rgb2lab:rd,rgb2lch:dv,hsl2rgb:ec,hsl2hsv:pv,hsl2hwb:gv,hsl2cmyk:mv,hsl2keyword:xv,hsv2rgb:tc,hsv2hsl:yv,hsv2hwb:Ev,hsv2cmyk:_v,hsv2keyword:bv,hwb2rgb:pa,hwb2hsl:Av,hwb2hsv:vv,hwb2cmyk:Tv,hwb2keyword:wv,cmyk2rgb:ga,cmyk2hsl:Sv,cmyk2hsv:Pv,cmyk2hwb:Cv,cmyk2keyword:Mv,keyword2rgb:wi,keyword2hsl:Dv,keyword2hsv:Fv,keyword2hwb:Ov,keyword2cmyk:Nv,keyword2lab:Bv,keyword2xyz:kv,xyz2rgb:h0,xyz2lab:d0,xyz2lch:Iv,lab2xyz:nd,lab2rgb:p0,lab2lch:id,lch2lab:sd,lch2xyz:Lv,lch2rgb:Rv};function ca(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255,s=Math.min(e,t,i),o=Math.max(e,t,i),a=o-s,u,l,c;return o==s?u=0:e==o?u=(t-i)/a:t==o?u=2+(i-e)/a:i==o&&(u=4+(e-t)/a),u=Math.min(u*60,360),u<0&&(u+=360),c=(s+o)/2,o==s?l=0:c<=.5?l=a/(o+s):l=a/(2-o-s),[u,l*100,c*100]}function Ql(n){var e=n[0],t=n[1],i=n[2],s=Math.min(e,t,i),o=Math.max(e,t,i),a=o-s,u,l,c;return o==0?l=0:l=a/o*1e3/10,o==s?u=0:e==o?u=(t-i)/a:t==o?u=2+(i-e)/a:i==o&&(u=4+(e-t)/a),u=Math.min(u*60,360),u<0&&(u+=360),c=o/255*1e3/10,[u,l,c]}function fa(n){var e=n[0],t=n[1],o=n[2],i=ca(n)[0],s=1/255*Math.min(e,Math.min(t,o)),o=1-1/255*Math.max(e,Math.max(t,o));return[i,s*100,o*100]}function ha(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255,s,o,a,u;return u=Math.min(1-e,1-t,1-i),s=(1-e-u)/(1-u)||0,o=(1-t-u)/(1-u)||0,a=(1-i-u)/(1-u)||0,[s*100,o*100,a*100,u*100]}function da(n){return g0[JSON.stringify(n)]}function td(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var s=e*.4124+t*.3576+i*.1805,o=e*.2126+t*.7152+i*.0722,a=e*.0193+t*.1192+i*.9505;return[s*100,o*100,a*100]}function rd(n){var e=td(n),t=e[0],i=e[1],s=e[2],o,a,u;return t/=95.047,i/=100,s/=108.883,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,o=116*i-16,a=500*(t-i),u=200*(i-s),[o,a,u]}function dv(n){return id(rd(n))}function ec(n){var e=n[0]/360,t=n[1]/100,i=n[2]/100,s,o,a,u,l;if(t==0)return l=i*255,[l,l,l];i<.5?o=i*(1+t):o=i+t-i*t,s=2*i-o,u=[0,0,0];for(var c=0;c<3;c++)a=e+1/3*-(c-1),a<0&&a++,a>1&&a--,6*a<1?l=s+(o-s)*6*a:2*a<1?l=o:3*a<2?l=s+(o-s)*(2/3-a)*6:l=s,u[c]=l*255;return u}function pv(n){var e=n[0],t=n[1]/100,i=n[2]/100,s,o;return i===0?[0,0,0]:(i*=2,t*=i<=1?i:2-i,o=(i+t)/2,s=2*t/(i+t),[e,s*100,o*100])}function gv(n){return fa(ec(n))}function mv(n){return ha(ec(n))}function xv(n){return da(ec(n))}function tc(n){var e=n[0]/60,t=n[1]/100,l=n[2]/100,i=Math.floor(e)%6,s=e-Math.floor(e),o=255*l*(1-t),a=255*l*(1-t*s),u=255*l*(1-t*(1-s)),l=255*l;switch(i){case 0:return[l,u,o];case 1:return[a,l,o];case 2:return[o,l,u];case 3:return[o,a,l];case 4:return[u,o,l];case 5:return[l,o,a]}}function yv(n){var e=n[0],t=n[1]/100,i=n[2]/100,s,o;return o=(2-t)*i,s=t*i,s/=o<=1?o:2-o,s=s||0,o/=2,[e,s*100,o*100]}function Ev(n){return fa(tc(n))}function _v(n){return ha(tc(n))}function bv(n){return da(tc(n))}function pa(n){var e=n[0]/360,t=n[1]/100,i=n[2]/100,s=t+i,o,a,u,l;switch(s>1&&(t/=s,i/=s),o=Math.floor(6*e),a=1-i,u=6*e-o,(o&1)!=0&&(u=1-u),l=t+u*(a-t),o){default:case 6:case 0:r=a,g=l,b=t;break;case 1:r=l,g=a,b=t;break;case 2:r=t,g=a,b=l;break;case 3:r=t,g=l,b=a;break;case 4:r=l,g=t,b=a;break;case 5:r=a,g=t,b=l;break}return[r*255,g*255,b*255]}function Av(n){return ca(pa(n))}function vv(n){return Ql(pa(n))}function Tv(n){return ha(pa(n))}function wv(n){return da(pa(n))}function ga(n){var e=n[0]/100,t=n[1]/100,i=n[2]/100,s=n[3]/100,o,a,u;return o=1-Math.min(1,e*(1-s)+s),a=1-Math.min(1,t*(1-s)+s),u=1-Math.min(1,i*(1-s)+s),[o*255,a*255,u*255]}function Sv(n){return ca(ga(n))}function Pv(n){return Ql(ga(n))}function Cv(n){return fa(ga(n))}function Mv(n){return da(ga(n))}function h0(n){var e=n[0]/100,t=n[1]/100,i=n[2]/100,s,o,a;return s=e*3.2406+t*-1.5372+i*-.4986,o=e*-.9689+t*1.8758+i*.0415,a=e*.0557+t*-.204+i*1.057,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]}function d0(n){var e=n[0],t=n[1],i=n[2],s,o,a;return e/=95.047,t/=100,i/=108.883,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,s=116*t-16,o=500*(e-t),a=200*(t-i),[s,o,a]}function Iv(n){return id(d0(n))}function nd(n){var e=n[0],t=n[1],i=n[2],s,o,a,u;return e<=8?(o=e*100/903.3,u=7.787*(o/100)+16/116):(o=100*Math.pow((e+16)/116,3),u=Math.pow(o/100,1/3)),s=s/95.047<=.008856?s=95.047*(t/500+u-16/116)/7.787:95.047*Math.pow(t/500+u,3),a=a/108.883<=.008859?a=108.883*(u-i/200-16/116)/7.787:108.883*Math.pow(u-i/200,3),[s,o,a]}function id(n){var e=n[0],t=n[1],i=n[2],s,o,a;return s=Math.atan2(i,t),o=s*360/2/Math.PI,o<0&&(o+=360),a=Math.sqrt(t*t+i*i),[e,a,o]}function p0(n){return h0(nd(n))}function sd(n){var e=n[0],t=n[1],i=n[2],s,o,a;return a=i/360*2*Math.PI,s=t*Math.cos(a),o=t*Math.sin(a),[e,s,o]}function Lv(n){return nd(sd(n))}function Rv(n){return p0(sd(n))}function wi(n){return ed[n]}function Dv(n){return ca(wi(n))}function Fv(n){return Ql(wi(n))}function Ov(n){return fa(wi(n))}function Nv(n){return ha(wi(n))}function Bv(n){return rd(wi(n))}function kv(n){return td(wi(n))}var ed={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},g0={};for(Qh in ed)g0[JSON.stringify(ed[Qh])]=Qh;var Qh});var _0=rr(($O,E0)=>{var od=x0(),Si=function(){return new ma};for(Gs in od)Si[Gs+"Raw"]=function(n){return function(e){return typeof e=="number"&&(e=Array.prototype.slice.call(arguments)),od[n](e)}}(Gs),ad=/(\w+)2(\w+)/.exec(Gs),rc=ad[1],y0=ad[2],Si[rc]=Si[rc]||{},Si[rc][y0]=Si[Gs]=function(n){return function(e){typeof e=="number"&&(e=Array.prototype.slice.call(arguments));var t=od[n](e);if(typeof t=="string"||t===void 0)return t;for(var i=0;i<t.length;i++)t[i]=Math.round(t[i]);return t}}(Gs);var ad,rc,y0,Gs,ma=function(){this.convs={}};ma.prototype.routeSpace=function(n,e){var t=e[0];return t===void 0?this.getValues(n):(typeof t=="number"&&(t=Array.prototype.slice.call(e)),this.setValues(n,t))};ma.prototype.setValues=function(n,e){return this.space=n,this.convs={},this.convs[n]=e,this};ma.prototype.getValues=function(n){var e=this.convs[n];if(!e){var t=this.space,i=this.convs[t];e=Si[t][n](i),this.convs[n]=e}return e};["rgb","hsl","hsv","cmyk","keyword"].forEach(function(n){ma.prototype[n]=function(e){return this.routeSpace(n,arguments)}});E0.exports=Si});var A0=rr((JO,b0)=>{var ud=_0();b0.exports=function(n){var e,t,i,s;if(e=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(n)){var o=e[1],a=o.replace(/a$/,""),u=a==="cmyk"?4:3;t=ud[a],i=e[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(c,f){return/%$/.test(c)&&f===u?parseFloat(c)/100:(/%$/.test(c),parseFloat(c))}),o===a&&i.push(1),s=i[u]===void 0?1:i[u],i=i.slice(0,u),t[a]=function(){return i}}else if(/^#[A-Fa-f0-9]+$/.test(n)){var a=n.replace(/^#/,""),u=a.length;t=ud.rgb,i=a.split(u===3?/(.)/:/(..)/),i=i.filter(Boolean).map(function(h){return parseInt(u===3?h+h:h,16)}),s=1,t.rgb=function(){return i},i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0)}else t=ud.keyword,t.keyword=function(){return n},i=n,s=1;var l={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{l.rgb=t.rgb(i)}catch{}try{l.hsl=t.hsl(i)}catch{}try{l.hsv=t.hsv(i)}catch{}try{l.cmyk=t.cmyk(i)}catch{}try{l.keyword=t.keyword(i)}catch{}return l.rgb&&(l.hex="#"+l.rgb.map(function(c){var f=c.toString(16);return f.length===1?"0"+f:f}).join("")),l.rgb&&(l.rgba=l.rgb.concat(s)),l.hsl&&(l.hsla=l.hsl.concat(s)),l.hsv&&(l.hsva=l.hsv.concat(s)),l.cmyk&&(l.cmyka=l.cmyk.concat(s)),l}});var ME=rr((jq,pf)=>{(function(n,e,t,i){"use strict";var s=["","webkit","Moz","MS","ms","o"],o=e.createElement("div"),a="function",u=Math.round,l=Math.abs,c=Date.now;function f(_,v,P){return setTimeout(D(_,P),v)}function h(_,v,P){return Array.isArray(_)?(d(_,P[v],P),!0):!1}function d(_,v,P){var F;if(!!_)if(_.forEach)_.forEach(v,P);else if(_.length!==i)for(F=0;F<_.length;)v.call(P,_[F],F,_),F++;else for(F in _)_.hasOwnProperty(F)&&v.call(P,_[F],F,_)}function x(_,v,P){var F="DEPRECATED METHOD: "+v+`
`+P+` AT 
`;return function(){var z=new Error("get-stack-trace"),X=z&&z.stack?z.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ue=n.console&&(n.console.warn||n.console.log);return ue&&ue.call(n.console,F,X),_.apply(this,arguments)}}var E;typeof Object.assign!="function"?E=function(v){if(v===i||v===null)throw new TypeError("Cannot convert undefined or null to object");for(var P=Object(v),F=1;F<arguments.length;F++){var z=arguments[F];if(z!==i&&z!==null)for(var X in z)z.hasOwnProperty(X)&&(P[X]=z[X])}return P}:E=Object.assign;var w=x(function(v,P,F){for(var z=Object.keys(P),X=0;X<z.length;)(!F||F&&v[z[X]]===i)&&(v[z[X]]=P[z[X]]),X++;return v},"extend","Use `assign`."),S=x(function(v,P){return w(v,P,!0)},"merge","Use `assign`.");function M(_,v,P){var F=v.prototype,z;z=_.prototype=Object.create(F),z.constructor=_,z._super=F,P&&E(z,P)}function D(_,v){return function(){return _.apply(v,arguments)}}function C(_,v){return typeof _==a?_.apply(v&&v[0]||i,v):_}function L(_,v){return _===i?v:_}function B(_,v,P){d(Z(v),function(F){_.addEventListener(F,P,!1)})}function j(_,v,P){d(Z(v),function(F){_.removeEventListener(F,P,!1)})}function J(_,v){for(;_;){if(_==v)return!0;_=_.parentNode}return!1}function te(_,v){return _.indexOf(v)>-1}function Z(_){return _.trim().split(/\s+/g)}function q(_,v,P){if(_.indexOf&&!P)return _.indexOf(v);for(var F=0;F<_.length;){if(P&&_[F][P]==v||!P&&_[F]===v)return F;F++}return-1}function H(_){return Array.prototype.slice.call(_,0)}function ie(_,v,P){for(var F=[],z=[],X=0;X<_.length;){var ue=v?_[X][v]:_[X];q(z,ue)<0&&F.push(_[X]),z[X]=ue,X++}return P&&(v?F=F.sort(function(je,Ke){return je[v]>Ke[v]}):F=F.sort()),F}function ee(_,v){for(var P,F,z=v[0].toUpperCase()+v.slice(1),X=0;X<s.length;){if(P=s[X],F=P?P+z:v,F in _)return F;X++}return i}var fe=1;function mt(){return fe++}function Hr(_){var v=_.ownerDocument||_;return v.defaultView||v.parentWindow||n}var An=/mobile|tablet|ip(ad|hone|od)|android/i,Xr="ontouchstart"in n,wt=ee(n,"PointerEvent")!==i,gh=Xr&&An.test(navigator.userAgent),li="touch",bl="pen",jo="mouse",Al="kinect",mh=25,Qe=1,qr=2,De=4,st=8,vn=1,Yr=2,ci=4,fi=8,hi=16,zt=Yr|ci,Zr=fi|hi,vl=zt|Zr,Tl=["x","y"],As=["clientX","clientY"];function xt(_,v){var P=this;this.manager=_,this.callback=v,this.element=_.element,this.target=_.options.inputTarget,this.domHandler=function(F){C(_.options.enable,[_])&&P.handler(F)},this.init()}xt.prototype={handler:function(){},init:function(){this.evEl&&B(this.element,this.evEl,this.domHandler),this.evTarget&&B(this.target,this.evTarget,this.domHandler),this.evWin&&B(Hr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&j(this.element,this.evEl,this.domHandler),this.evTarget&&j(this.target,this.evTarget,this.domHandler),this.evWin&&j(Hr(this.element),this.evWin,this.domHandler)}};function wl(_){var v,P=_.options.inputClass;return P?v=P:wt?v=Xo:gh?v=ws:Xr?v=di:v=Ts,new v(_,xh)}function xh(_,v,P){var F=P.pointers.length,z=P.changedPointers.length,X=v&Qe&&F-z===0,ue=v&(De|st)&&F-z===0;P.isFirst=!!X,P.isFinal=!!ue,X&&(_.session={}),P.eventType=v,yh(_,P),_.emit("hammer.input",P),_.recognize(P),_.session.prevInput=P}function yh(_,v){var P=_.session,F=v.pointers,z=F.length;P.firstInput||(P.firstInput=Pl(v)),z>1&&!P.firstMultiple?P.firstMultiple=Pl(v):z===1&&(P.firstMultiple=!1);var X=P.firstInput,ue=P.firstMultiple,Ve=ue?ue.center:X.center,je=v.center=Cl(F);v.timeStamp=c(),v.deltaTime=v.timeStamp-X.timeStamp,v.angle=Ho(Ve,je),v.distance=vs(Ve,je),Eh(P,v),v.offsetDirection=Wo(v.deltaX,v.deltaY);var Ke=Ml(v.deltaTime,v.deltaX,v.deltaY);v.overallVelocityX=Ke.x,v.overallVelocityY=Ke.y,v.overallVelocity=l(Ke.x)>l(Ke.y)?Ke.x:Ke.y,v.scale=ue?Il(ue.pointers,F):1,v.rotation=ue?_h(ue.pointers,F):0,v.maxPointers=P.prevInput?v.pointers.length>P.prevInput.maxPointers?v.pointers.length:P.prevInput.maxPointers:v.pointers.length,Sl(P,v);var Ct=_.element;J(v.srcEvent.target,Ct)&&(Ct=v.srcEvent.target),v.target=Ct}function Eh(_,v){var P=v.center,F=_.offsetDelta||{},z=_.prevDelta||{},X=_.prevInput||{};(v.eventType===Qe||X.eventType===De)&&(z=_.prevDelta={x:X.deltaX||0,y:X.deltaY||0},F=_.offsetDelta={x:P.x,y:P.y}),v.deltaX=z.x+(P.x-F.x),v.deltaY=z.y+(P.y-F.y)}function Sl(_,v){var P=_.lastInterval||v,F=v.timeStamp-P.timeStamp,z,X,ue,Ve;if(v.eventType!=st&&(F>mh||P.velocity===i)){var je=v.deltaX-P.deltaX,Ke=v.deltaY-P.deltaY,Ct=Ml(F,je,Ke);X=Ct.x,ue=Ct.y,z=l(Ct.x)>l(Ct.y)?Ct.x:Ct.y,Ve=Wo(je,Ke),_.lastInterval=v}else z=P.velocity,X=P.velocityX,ue=P.velocityY,Ve=P.direction;v.velocity=z,v.velocityX=X,v.velocityY=ue,v.direction=Ve}function Pl(_){for(var v=[],P=0;P<_.pointers.length;)v[P]={clientX:u(_.pointers[P].clientX),clientY:u(_.pointers[P].clientY)},P++;return{timeStamp:c(),pointers:v,center:Cl(v),deltaX:_.deltaX,deltaY:_.deltaY}}function Cl(_){var v=_.length;if(v===1)return{x:u(_[0].clientX),y:u(_[0].clientY)};for(var P=0,F=0,z=0;z<v;)P+=_[z].clientX,F+=_[z].clientY,z++;return{x:u(P/v),y:u(F/v)}}function Ml(_,v,P){return{x:v/_||0,y:P/_||0}}function Wo(_,v){return _===v?vn:l(_)>=l(v)?_<0?Yr:ci:v<0?fi:hi}function vs(_,v,P){P||(P=Tl);var F=v[P[0]]-_[P[0]],z=v[P[1]]-_[P[1]];return Math.sqrt(F*F+z*z)}function Ho(_,v,P){P||(P=Tl);var F=v[P[0]]-_[P[0]],z=v[P[1]]-_[P[1]];return Math.atan2(z,F)*180/Math.PI}function _h(_,v){return Ho(v[1],v[0],As)+Ho(_[1],_[0],As)}function Il(_,v){return vs(v[0],v[1],As)/vs(_[0],_[1],As)}var bh={mousedown:Qe,mousemove:qr,mouseup:De},Ah="mousedown",vh="mousemove mouseup";function Ts(){this.evEl=Ah,this.evWin=vh,this.pressed=!1,xt.apply(this,arguments)}M(Ts,xt,{handler:function(v){var P=bh[v.type];P&Qe&&v.button===0&&(this.pressed=!0),P&qr&&v.which!==1&&(P=De),this.pressed&&(P&De&&(this.pressed=!1),this.callback(this.manager,P,{pointers:[v],changedPointers:[v],pointerType:jo,srcEvent:v}))}});var Th={pointerdown:Qe,pointermove:qr,pointerup:De,pointercancel:st,pointerout:st},wh={2:li,3:bl,4:jo,5:Al},Ll="pointerdown",Rl="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(Ll="MSPointerDown",Rl="MSPointerMove MSPointerUp MSPointerCancel");function Xo(){this.evEl=Ll,this.evWin=Rl,xt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}M(Xo,xt,{handler:function(v){var P=this.store,F=!1,z=v.type.toLowerCase().replace("ms",""),X=Th[z],ue=wh[v.pointerType]||v.pointerType,Ve=ue==li,je=q(P,v.pointerId,"pointerId");X&Qe&&(v.button===0||Ve)?je<0&&(P.push(v),je=P.length-1):X&(De|st)&&(F=!0),!(je<0)&&(P[je]=v,this.callback(this.manager,X,{pointers:P,changedPointers:[v],pointerType:ue,srcEvent:v}),F&&P.splice(je,1))}});var Sh={touchstart:Qe,touchmove:qr,touchend:De,touchcancel:st},Ph="touchstart",Dl="touchstart touchmove touchend touchcancel";function qo(){this.evTarget=Ph,this.evWin=Dl,this.started=!1,xt.apply(this,arguments)}M(qo,xt,{handler:function(v){var P=Sh[v.type];if(P===Qe&&(this.started=!0),!!this.started){var F=Tn.call(this,v,P);P&(De|st)&&F[0].length-F[1].length===0&&(this.started=!1),this.callback(this.manager,P,{pointers:F[0],changedPointers:F[1],pointerType:li,srcEvent:v})}}});function Tn(_,v){var P=H(_.touches),F=H(_.changedTouches);return v&(De|st)&&(P=ie(P.concat(F),"identifier",!0)),[P,F]}var wn={touchstart:Qe,touchmove:qr,touchend:De,touchcancel:st},Ch="touchstart touchmove touchend touchcancel";function ws(){this.evTarget=Ch,this.targetIds={},xt.apply(this,arguments)}M(ws,xt,{handler:function(v){var P=wn[v.type],F=Yo.call(this,v,P);!F||this.callback(this.manager,P,{pointers:F[0],changedPointers:F[1],pointerType:li,srcEvent:v})}});function Yo(_,v){var P=H(_.touches),F=this.targetIds;if(v&(Qe|qr)&&P.length===1)return F[P[0].identifier]=!0,[P,P];var z,X,ue=H(_.changedTouches),Ve=[],je=this.target;if(X=P.filter(function(Ke){return J(Ke.target,je)}),v===Qe)for(z=0;z<X.length;)F[X[z].identifier]=!0,z++;for(z=0;z<ue.length;)F[ue[z].identifier]&&Ve.push(ue[z]),v&(De|st)&&delete F[ue[z].identifier],z++;if(!!Ve.length)return[ie(X.concat(Ve),"identifier",!0),Ve]}var Zo=2500,Ss=25;function di(){xt.apply(this,arguments);var _=D(this.handler,this);this.touch=new ws(this.manager,_),this.mouse=new Ts(this.manager,_),this.primaryTouch=null,this.lastTouches=[]}M(di,xt,{handler:function(v,P,F){var z=F.pointerType==li,X=F.pointerType==jo;if(!(X&&F.sourceCapabilities&&F.sourceCapabilities.firesTouchEvents)){if(z)Mh.call(this,P,F);else if(X&&Sn.call(this,F))return;this.callback(v,P,F)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Mh(_,v){_&Qe?(this.primaryTouch=v.changedPointers[0].identifier,St.call(this,v)):_&(De|st)&&St.call(this,v)}function St(_){var v=_.changedPointers[0];if(v.identifier===this.primaryTouch){var P={x:v.clientX,y:v.clientY};this.lastTouches.push(P);var F=this.lastTouches,z=function(){var X=F.indexOf(P);X>-1&&F.splice(X,1)};setTimeout(z,Zo)}}function Sn(_){for(var v=_.srcEvent.clientX,P=_.srcEvent.clientY,F=0;F<this.lastTouches.length;F++){var z=this.lastTouches[F],X=Math.abs(v-z.x),ue=Math.abs(P-z.y);if(X<=Ss&&ue<=Ss)return!0}return!1}var Fl=ee(o.style,"touchAction"),Ps=Fl!==i,Cs="compute",Ko="auto",$o="manipulation",Vt="none",Tr="pan-x",pi="pan-y",gi=Lh();function Jo(_,v){this.manager=_,this.set(v)}Jo.prototype={set:function(_){_==Cs&&(_=this.compute()),Ps&&this.manager.element.style&&gi[_]&&(this.manager.element.style[Fl]=_),this.actions=_.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var _=[];return d(this.manager.recognizers,function(v){C(v.options.enable,[v])&&(_=_.concat(v.getTouchAction()))}),Ih(_.join(" "))},preventDefaults:function(_){var v=_.srcEvent,P=_.offsetDirection;if(this.manager.session.prevented){v.preventDefault();return}var F=this.actions,z=te(F,Vt)&&!gi[Vt],X=te(F,pi)&&!gi[pi],ue=te(F,Tr)&&!gi[Tr];if(z){var Ve=_.pointers.length===1,je=_.distance<2,Ke=_.deltaTime<250;if(Ve&&je&&Ke)return}if(!(ue&&X)&&(z||X&&P&zt||ue&&P&Zr))return this.preventSrc(v)},preventSrc:function(_){this.manager.session.prevented=!0,_.preventDefault()}};function Ih(_){if(te(_,Vt))return Vt;var v=te(_,Tr),P=te(_,pi);return v&&P?Vt:v||P?v?Tr:pi:te(_,$o)?$o:Ko}function Lh(){if(!Ps)return!1;var _={},v=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(P){_[P]=v?n.CSS.supports("touch-action",P):!0}),_}var Ms=1,yt=2,Kr=4,wr=8,er=wr,mi=16,jt=32;function tr(_){this.options=E({},this.defaults,_||{}),this.id=mt(),this.manager=null,this.options.enable=L(this.options.enable,!0),this.state=Ms,this.simultaneous={},this.requireFail=[]}tr.prototype={defaults:{},set:function(_){return E(this.options,_),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(_){if(h(_,"recognizeWith",this))return this;var v=this.simultaneous;return _=Is(_,this),v[_.id]||(v[_.id]=_,_.recognizeWith(this)),this},dropRecognizeWith:function(_){return h(_,"dropRecognizeWith",this)?this:(_=Is(_,this),delete this.simultaneous[_.id],this)},requireFailure:function(_){if(h(_,"requireFailure",this))return this;var v=this.requireFail;return _=Is(_,this),q(v,_)===-1&&(v.push(_),_.requireFailure(this)),this},dropRequireFailure:function(_){if(h(_,"dropRequireFailure",this))return this;_=Is(_,this);var v=q(this.requireFail,_);return v>-1&&this.requireFail.splice(v,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(_){return!!this.simultaneous[_.id]},emit:function(_){var v=this,P=this.state;function F(z){v.manager.emit(z,_)}P<wr&&F(v.options.event+Ol(P)),F(v.options.event),_.additionalEvent&&F(_.additionalEvent),P>=wr&&F(v.options.event+Ol(P))},tryEmit:function(_){if(this.canEmit())return this.emit(_);this.state=jt},canEmit:function(){for(var _=0;_<this.requireFail.length;){if(!(this.requireFail[_].state&(jt|Ms)))return!1;_++}return!0},recognize:function(_){var v=E({},_);if(!C(this.options.enable,[this,v])){this.reset(),this.state=jt;return}this.state&(er|mi|jt)&&(this.state=Ms),this.state=this.process(v),this.state&(yt|Kr|wr|mi)&&this.tryEmit(v)},process:function(_){},getTouchAction:function(){},reset:function(){}};function Ol(_){return _&mi?"cancel":_&wr?"end":_&Kr?"move":_&yt?"start":""}function Nl(_){return _==hi?"down":_==fi?"up":_==Yr?"left":_==ci?"right":""}function Is(_,v){var P=v.manager;return P?P.get(_):_}function Pt(){tr.apply(this,arguments)}M(Pt,tr,{defaults:{pointers:1},attrTest:function(_){var v=this.options.pointers;return v===0||_.pointers.length===v},process:function(_){var v=this.state,P=_.eventType,F=v&(yt|Kr),z=this.attrTest(_);return F&&(P&st||!z)?v|mi:F||z?P&De?v|wr:v&yt?v|Kr:yt:jt}});function xi(){Pt.apply(this,arguments),this.pX=null,this.pY=null}M(xi,Pt,{defaults:{event:"pan",threshold:10,pointers:1,direction:vl},getTouchAction:function(){var _=this.options.direction,v=[];return _&zt&&v.push(pi),_&Zr&&v.push(Tr),v},directionTest:function(_){var v=this.options,P=!0,F=_.distance,z=_.direction,X=_.deltaX,ue=_.deltaY;return z&v.direction||(v.direction&zt?(z=X===0?vn:X<0?Yr:ci,P=X!=this.pX,F=Math.abs(_.deltaX)):(z=ue===0?vn:ue<0?fi:hi,P=ue!=this.pY,F=Math.abs(_.deltaY))),_.direction=z,P&&F>v.threshold&&z&v.direction},attrTest:function(_){return Pt.prototype.attrTest.call(this,_)&&(this.state&yt||!(this.state&yt)&&this.directionTest(_))},emit:function(_){this.pX=_.deltaX,this.pY=_.deltaY;var v=Nl(_.direction);v&&(_.additionalEvent=this.options.event+v),this._super.emit.call(this,_)}});function Qo(){Pt.apply(this,arguments)}M(Qo,Pt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Vt]},attrTest:function(_){return this._super.attrTest.call(this,_)&&(Math.abs(_.scale-1)>this.options.threshold||this.state&yt)},emit:function(_){if(_.scale!==1){var v=_.scale<1?"in":"out";_.additionalEvent=this.options.event+v}this._super.emit.call(this,_)}});function ea(){tr.apply(this,arguments),this._timer=null,this._input=null}M(ea,tr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ko]},process:function(_){var v=this.options,P=_.pointers.length===v.pointers,F=_.distance<v.threshold,z=_.deltaTime>v.time;if(this._input=_,!F||!P||_.eventType&(De|st)&&!z)this.reset();else if(_.eventType&Qe)this.reset(),this._timer=f(function(){this.state=er,this.tryEmit()},v.time,this);else if(_.eventType&De)return er;return jt},reset:function(){clearTimeout(this._timer)},emit:function(_){this.state===er&&(_&&_.eventType&De?this.manager.emit(this.options.event+"up",_):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function ta(){Pt.apply(this,arguments)}M(ta,Pt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Vt]},attrTest:function(_){return this._super.attrTest.call(this,_)&&(Math.abs(_.rotation)>this.options.threshold||this.state&yt)}});function ra(){Pt.apply(this,arguments)}M(ra,Pt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:zt|Zr,pointers:1},getTouchAction:function(){return xi.prototype.getTouchAction.call(this)},attrTest:function(_){var v=this.options.direction,P;return v&(zt|Zr)?P=_.overallVelocity:v&zt?P=_.overallVelocityX:v&Zr&&(P=_.overallVelocityY),this._super.attrTest.call(this,_)&&v&_.offsetDirection&&_.distance>this.options.threshold&&_.maxPointers==this.options.pointers&&l(P)>this.options.velocity&&_.eventType&De},emit:function(_){var v=Nl(_.offsetDirection);v&&this.manager.emit(this.options.event+v,_),this.manager.emit(this.options.event,_)}});function Ls(){tr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}M(Ls,tr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$o]},process:function(_){var v=this.options,P=_.pointers.length===v.pointers,F=_.distance<v.threshold,z=_.deltaTime<v.time;if(this.reset(),_.eventType&Qe&&this.count===0)return this.failTimeout();if(F&&z&&P){if(_.eventType!=De)return this.failTimeout();var X=this.pTime?_.timeStamp-this.pTime<v.interval:!0,ue=!this.pCenter||vs(this.pCenter,_.center)<v.posThreshold;this.pTime=_.timeStamp,this.pCenter=_.center,!ue||!X?this.count=1:this.count+=1,this._input=_;var Ve=this.count%v.taps;if(Ve===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=er,this.tryEmit()},v.interval,this),yt):er}return jt},failTimeout:function(){return this._timer=f(function(){this.state=jt},this.options.interval,this),jt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==er&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Wt(_,v){return v=v||{},v.recognizers=L(v.recognizers,Wt.defaults.preset),new yi(_,v)}Wt.VERSION="2.0.7",Wt.defaults={domEvents:!1,touchAction:Cs,enable:!0,inputTarget:null,inputClass:null,preset:[[ta,{enable:!1}],[Qo,{enable:!1},["rotate"]],[ra,{direction:zt}],[xi,{direction:zt},["swipe"]],[Ls],[Ls,{event:"doubletap",taps:2},["tap"]],[ea]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Rh=1,$r=2;function yi(_,v){this.options=E({},Wt.defaults,v||{}),this.options.inputTarget=this.options.inputTarget||_,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=_,this.input=wl(this),this.touchAction=new Jo(this,this.options.touchAction),na(this,!0),d(this.options.recognizers,function(P){var F=this.add(new P[0](P[1]));P[2]&&F.recognizeWith(P[2]),P[3]&&F.requireFailure(P[3])},this)}yi.prototype={set:function(_){return E(this.options,_),_.touchAction&&this.touchAction.update(),_.inputTarget&&(this.input.destroy(),this.input.target=_.inputTarget,this.input.init()),this},stop:function(_){this.session.stopped=_?$r:Rh},recognize:function(_){var v=this.session;if(!v.stopped){this.touchAction.preventDefaults(_);var P,F=this.recognizers,z=v.curRecognizer;(!z||z&&z.state&er)&&(z=v.curRecognizer=null);for(var X=0;X<F.length;)P=F[X],v.stopped!==$r&&(!z||P==z||P.canRecognizeWith(z))?P.recognize(_):P.reset(),!z&&P.state&(yt|Kr|wr)&&(z=v.curRecognizer=P),X++}},get:function(_){if(_ instanceof tr)return _;for(var v=this.recognizers,P=0;P<v.length;P++)if(v[P].options.event==_)return v[P];return null},add:function(_){if(h(_,"add",this))return this;var v=this.get(_.options.event);return v&&this.remove(v),this.recognizers.push(_),_.manager=this,this.touchAction.update(),_},remove:function(_){if(h(_,"remove",this))return this;if(_=this.get(_),_){var v=this.recognizers,P=q(v,_);P!==-1&&(v.splice(P,1),this.touchAction.update())}return this},on:function(_,v){if(_!==i&&v!==i){var P=this.handlers;return d(Z(_),function(F){P[F]=P[F]||[],P[F].push(v)}),this}},off:function(_,v){if(_!==i){var P=this.handlers;return d(Z(_),function(F){v?P[F]&&P[F].splice(q(P[F],v),1):delete P[F]}),this}},emit:function(_,v){this.options.domEvents&&Dh(_,v);var P=this.handlers[_]&&this.handlers[_].slice();if(!(!P||!P.length)){v.type=_,v.preventDefault=function(){v.srcEvent.preventDefault()};for(var F=0;F<P.length;)P[F](v),F++}},destroy:function(){this.element&&na(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function na(_,v){var P=_.element;if(!!P.style){var F;d(_.options.cssProps,function(z,X){F=ee(P.style,X),v?(_.oldCssProps[F]=P.style[F],P.style[F]=z):P.style[F]=_.oldCssProps[F]||""}),v||(_.oldCssProps={})}}function Dh(_,v){var P=e.createEvent("Event");P.initEvent(_,!0,!0),P.gesture=v,v.target.dispatchEvent(P)}E(Wt,{INPUT_START:Qe,INPUT_MOVE:qr,INPUT_END:De,INPUT_CANCEL:st,STATE_POSSIBLE:Ms,STATE_BEGAN:yt,STATE_CHANGED:Kr,STATE_ENDED:wr,STATE_RECOGNIZED:er,STATE_CANCELLED:mi,STATE_FAILED:jt,DIRECTION_NONE:vn,DIRECTION_LEFT:Yr,DIRECTION_RIGHT:ci,DIRECTION_UP:fi,DIRECTION_DOWN:hi,DIRECTION_HORIZONTAL:zt,DIRECTION_VERTICAL:Zr,DIRECTION_ALL:vl,Manager:yi,Input:xt,TouchAction:Jo,TouchInput:ws,MouseInput:Ts,PointerEventInput:Xo,TouchMouseInput:di,SingleTouchInput:qo,Recognizer:tr,AttrRecognizer:Pt,Tap:Ls,Pan:xi,Swipe:ra,Pinch:Qo,Rotate:ta,Press:ea,on:B,off:j,each:d,merge:S,extend:w,assign:E,inherit:M,bindFn:D,prefixed:ee});var Fh=typeof n<"u"?n:typeof self<"u"?self:{};Fh.Hammer=Wt,typeof define=="function"&&define.amd?define(function(){return Wt}):typeof pf<"u"&&pf.exports?pf.exports=Wt:n[t]=Wt})(window,document,"Hammer")});var X_=rr((CJ,Ig)=>{"use strict";Ig.exports=Ff;Ig.exports.default=Ff;function Ff(n,e,t){t=t||2;var i=e&&e.length,s=i?e[0]*t:n.length,o=j_(n,0,s,t,!0),a=[];if(!o||o.next===o.prev)return a;var u,l,c,f,h,d,x;if(i&&(o=uL(n,e,o,t)),n.length>80*t){u=c=n[0],l=f=n[1];for(var E=t;E<s;E+=t)h=n[E],d=n[E+1],h<u&&(u=h),d<l&&(l=d),h>c&&(c=h),d>f&&(f=d);x=Math.max(c-u,f-l),x=x!==0?32767/x:0}return Qu(o,a,t,u,l,x,0),a}function j_(n,e,t,i,s){var o,a;if(s===Mg(n,e,t,i)>0)for(o=e;o<t;o+=i)a=V_(o,n[o],n[o+1],a);else for(o=t-i;o>=e;o-=i)a=V_(o,n[o],n[o+1],a);return a&&Of(a,a.next)&&(tl(a),a=a.next),a}function cs(n,e){if(!n)return n;e||(e=n);var t=n,i;do if(i=!1,!t.steiner&&(Of(t,t.next)||Re(t.prev,t,t.next)===0)){if(tl(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Qu(n,e,t,i,s,o,a){if(!!n){!a&&o&&dL(n,i,s,o);for(var u=n,l,c;n.prev!==n.next;){if(l=n.prev,c=n.next,o?sL(n,i,s,o):iL(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(c.i/t|0),tl(n),n=c.next,u=c.next;continue}if(n=c,n===u){a?a===1?(n=oL(cs(n),e,t),Qu(n,e,t,i,s,o,2)):a===2&&aL(n,e,t,i,s,o):Qu(cs(n),e,t,i,s,o,1);break}}}}function iL(n){var e=n.prev,t=n,i=n.next;if(Re(e,t,i)>=0)return!1;for(var s=e.x,o=t.x,a=i.x,u=e.y,l=t.y,c=i.y,f=s<o?s<a?s:a:o<a?o:a,h=u<l?u<c?u:c:l<c?l:c,d=s>o?s>a?s:a:o>a?o:a,x=u>l?u>c?u:c:l>c?l:c,E=i.next;E!==e;){if(E.x>=f&&E.x<=d&&E.y>=h&&E.y<=x&&Io(s,u,o,l,a,c,E.x,E.y)&&Re(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function sL(n,e,t,i){var s=n.prev,o=n,a=n.next;if(Re(s,o,a)>=0)return!1;for(var u=s.x,l=o.x,c=a.x,f=s.y,h=o.y,d=a.y,x=u<l?u<c?u:c:l<c?l:c,E=f<h?f<d?f:d:h<d?h:d,w=u>l?u>c?u:c:l>c?l:c,S=f>h?f>d?f:d:h>d?h:d,M=Pg(x,E,e,t,i),D=Pg(w,S,e,t,i),C=n.prevZ,L=n.nextZ;C&&C.z>=M&&L&&L.z<=D;){if(C.x>=x&&C.x<=w&&C.y>=E&&C.y<=S&&C!==s&&C!==a&&Io(u,f,l,h,c,d,C.x,C.y)&&Re(C.prev,C,C.next)>=0||(C=C.prevZ,L.x>=x&&L.x<=w&&L.y>=E&&L.y<=S&&L!==s&&L!==a&&Io(u,f,l,h,c,d,L.x,L.y)&&Re(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;C&&C.z>=M;){if(C.x>=x&&C.x<=w&&C.y>=E&&C.y<=S&&C!==s&&C!==a&&Io(u,f,l,h,c,d,C.x,C.y)&&Re(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;L&&L.z<=D;){if(L.x>=x&&L.x<=w&&L.y>=E&&L.y<=S&&L!==s&&L!==a&&Io(u,f,l,h,c,d,L.x,L.y)&&Re(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function oL(n,e,t){var i=n;do{var s=i.prev,o=i.next.next;!Of(s,o)&&W_(s,i,i.next,o)&&el(s,o)&&el(o,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(o.i/t|0),tl(i),tl(i.next),i=n=o),i=i.next}while(i!==n);return cs(i)}function aL(n,e,t,i,s,o){var a=n;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&mL(a,u)){var l=H_(a,u);a=cs(a,a.next),l=cs(l,l.next),Qu(a,e,t,i,s,o,0),Qu(l,e,t,i,s,o,0);return}u=u.next}a=a.next}while(a!==n)}function uL(n,e,t,i){var s=[],o,a,u,l,c;for(o=0,a=e.length;o<a;o++)u=e[o]*i,l=o<a-1?e[o+1]*i:n.length,c=j_(n,u,l,i,!1),c===c.next&&(c.steiner=!0),s.push(gL(c));for(s.sort(lL),o=0;o<s.length;o++)t=cL(s[o],t);return t}function lL(n,e){return n.x-e.x}function cL(n,e){var t=fL(n,e);if(!t)return e;var i=H_(t,n);return cs(i,i.next),cs(t,t.next)}function fL(n,e){var t=e,i=n.x,s=n.y,o=-1/0,a;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){var u=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=i&&u>o&&(o=u,a=t.x<t.next.x?t:t.next,u===i))return a}t=t.next}while(t!==e);if(!a)return null;var l=a,c=a.x,f=a.y,h=1/0,d;t=a;do i>=t.x&&t.x>=c&&i!==t.x&&Io(s<f?i:o,s,c,f,s<f?o:i,s,t.x,t.y)&&(d=Math.abs(s-t.y)/(i-t.x),el(t,n)&&(d<h||d===h&&(t.x>a.x||t.x===a.x&&hL(a,t)))&&(a=t,h=d)),t=t.next;while(t!==l);return a}function hL(n,e){return Re(n.prev,n,e.prev)<0&&Re(e.next,n,n.next)<0}function dL(n,e,t,i){var s=n;do s.z===0&&(s.z=Pg(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,pL(s)}function pL(n){var e,t,i,s,o,a,u,l,c=1;do{for(t=n,n=null,o=null,a=0;t;){for(a++,i=t,u=0,e=0;e<c&&(u++,i=i.nextZ,!!i);e++);for(l=c;u>0||l>0&&i;)u!==0&&(l===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,u--):(s=i,i=i.nextZ,l--),o?o.nextZ=s:n=s,s.prevZ=o,o=s;t=i}o.nextZ=null,c*=2}while(a>1);return n}function Pg(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function gL(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Io(n,e,t,i,s,o,a,u){return(s-a)*(e-u)>=(n-a)*(o-u)&&(n-a)*(i-u)>=(t-a)*(e-u)&&(t-a)*(o-u)>=(s-a)*(i-u)}function mL(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!xL(n,e)&&(el(n,e)&&el(e,n)&&yL(n,e)&&(Re(n.prev,n,e.prev)||Re(n,e.prev,e))||Of(n,e)&&Re(n.prev,n,n.next)>0&&Re(e.prev,e,e.next)>0)}function Re(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Of(n,e){return n.x===e.x&&n.y===e.y}function W_(n,e,t,i){var s=Df(Re(n,e,t)),o=Df(Re(n,e,i)),a=Df(Re(t,i,n)),u=Df(Re(t,i,e));return!!(s!==o&&a!==u||s===0&&Rf(n,t,e)||o===0&&Rf(n,i,e)||a===0&&Rf(t,n,i)||u===0&&Rf(t,e,i))}function Rf(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Df(n){return n>0?1:n<0?-1:0}function xL(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&W_(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function el(n,e){return Re(n.prev,n,n.next)<0?Re(n,e,n.next)>=0&&Re(n,n.prev,e)>=0:Re(n,e,n.prev)<0||Re(n,n.next,e)<0}function yL(n,e){var t=n,i=!1,s=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&s<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function H_(n,e){var t=new Cg(n.i,n.x,n.y),i=new Cg(e.i,e.x,e.y),s=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function V_(n,e,t,i){var s=new Cg(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function tl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Cg(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ff.deviation=function(n,e,t,i){var s=e&&e.length,o=s?e[0]*t:n.length,a=Math.abs(Mg(n,0,o,t));if(s)for(var u=0,l=e.length;u<l;u++){var c=e[u]*t,f=u<l-1?e[u+1]*t:n.length;a-=Math.abs(Mg(n,c,f,t))}var h=0;for(u=0;u<i.length;u+=3){var d=i[u]*t,x=i[u+1]*t,E=i[u+2]*t;h+=Math.abs((n[d]-n[E])*(n[x+1]-n[d+1])-(n[d]-n[x])*(n[E+1]-n[d+1]))}return a===0&&h===0?0:Math.abs((h-a)/a)};function Mg(n,e,t,i){for(var s=0,o=e,a=t-i;o<t;o+=i)s+=(n[a]-n[o])*(n[o+1]+n[a+1]),a=o;return s}Ff.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,s=0;s<n.length;s++){for(var o=0;o<n[s].length;o++)for(var a=0;a<e;a++)t.vertices.push(n[s][o][a]);s>0&&(i+=n[s-1].length,t.holes.push(i))}return t}});var f2=rr((tQ,Lg)=>{"use strict";Lg.exports=il;Lg.exports.default=il;var Ro=1e20;function il(n,e,t,i,s,o){this.fontSize=n||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=s||"sans-serif",this.fontWeight=o||"normal",this.radius=t||8;var a=this.size=this.fontSize+this.buffer*2,u=a+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function CL(n,e,t,i,s,o,a){o.fill(Ro,0,e*t),a.fill(0,0,e*t);for(var u=(e-i)/2,l=0;l<s;l++)for(var c=0;c<i;c++){var f=(l+u)*e+c+u,h=n.data[4*(l*i+c)+3]/255;if(h===1)o[f]=0,a[f]=Ro;else if(h===0)o[f]=Ro,a[f]=0;else{var d=Math.max(0,.5-h),x=Math.max(0,h-.5);o[f]=d*d,a[f]=x*x}}}function ML(n,e,t,i,s,o,a){for(var u=0;u<e*t;u++){var l=Math.sqrt(i[u])-Math.sqrt(s[u]);n[u]=Math.round(255-255*(l/o+a))}}il.prototype._draw=function(n,e){var t=this.ctx.measureText(n),i=t.width,s=2*this.buffer,o,a,u,l,c,f,h,d;e&&this.useMetrics?(c=Math.floor(t.actualBoundingBoxAscent),d=this.buffer+Math.ceil(t.actualBoundingBoxAscent),f=this.buffer,h=this.buffer,a=Math.min(this.size,Math.ceil(t.actualBoundingBoxRight-t.actualBoundingBoxLeft)),l=Math.min(this.size-f,Math.ceil(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)),o=a+s,u=l+s,this.ctx.textBaseline="alphabetic"):(o=a=this.size,u=l=this.size,c=19*this.fontSize/24,f=h=0,d=this.middle,this.ctx.textBaseline="middle");var x;a&&l&&(this.ctx.clearRect(h,f,a,l),this.ctx.fillText(n,this.buffer,d),x=this.ctx.getImageData(h,f,a,l));var E=new Uint8ClampedArray(o*u);return CL(x,o,u,a,l,this.gridOuter,this.gridInner),l2(this.gridOuter,o,u,this.f,this.v,this.z),l2(this.gridInner,o,u,this.f,this.v,this.z),ML(E,o,u,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:E,metrics:{width:a,height:l,sdfWidth:o,sdfHeight:u,top:c,left:0,advance:i}}};il.prototype.draw=function(n){return this._draw(n,!1).data};il.prototype.drawWithMetrics=function(n){return this._draw(n,!0)};function l2(n,e,t,i,s,o){for(var a=0;a<e;a++)c2(n,a,e,t,i,s,o);for(var u=0;u<t;u++)c2(n,u*e,1,e,i,s,o)}function c2(n,e,t,i,s,o,a){var u,l,c,f;for(o[0]=0,a[0]=-Ro,a[1]=Ro,u=0;u<i;u++)s[u]=n[e+u*t];for(u=1,l=0,c=0;u<i;u++){do f=o[l],c=(s[u]-s[f]+u*u-f*f)/(u-f)/2;while(c<=a[l]&&--l>-1);l++,o[l]=u,a[l]=c,a[l+1]=Ro}for(u=0,l=0;u<i;u++){for(;a[l+1]<u;)l++;f=o[l],n[e+u*t]=s[f]+(u-f)*(u-f)}}});var Em={};zm(Em,{Renderer:()=>El,SearchControl:()=>_l,initLayoutWorker:()=>nc});var xe=we(We(),1);var Gv=we(Xm(),1),Y=we(We(),1);var nr=(C=>(C[C.normal=0]="normal",C[C.inv=1]="inv",C[C.dot=2]="dot",C[C.invdot=3]="invdot",C[C.odot=4]="odot",C[C.invodot=5]="invodot",C[C.none=6]="none",C[C.tee=7]="tee",C[C.empty=8]="empty",C[C.invempty=9]="invempty",C[C.diamond=10]="diamond",C[C.odiamond=11]="odiamond",C[C.ediamond=12]="ediamond",C[C.crow=13]="crow",C[C.box=14]="box",C[C.obox=15]="obox",C[C.open=16]="open",C[C.halfopen=17]="halfopen",C[C.vee=18]="vee",C))(nr||{});var Ir=(L=>(L[L.diamond=0]="diamond",L[L.ellipse=1]="ellipse",L[L.box=2]="box",L[L.circle=3]="circle",L[L.record=4]="record",L[L.plaintext=5]="plaintext",L[L.point=6]="point",L[L.mdiamond=7]="mdiamond",L[L.msquare=8]="msquare",L[L.polygon=9]="polygon",L[L.doublecircle=10]="doublecircle",L[L.house=11]="house",L[L.invhouse=12]="invhouse",L[L.parallelogram=13]="parallelogram",L[L.octagon=14]="octagon",L[L.tripleoctagon=15]="tripleoctagon",L[L.triangle=16]="triangle",L[L.trapezium=17]="trapezium",L[L.drawFromGeometry=18]="drawFromGeometry",L[L.hexagon=19]="hexagon",L))(Ir||{});var Ul=(o=>(o[o.same=0]="same",o[o.min=1]="min",o[o.source=2]="source",o[o.max=3]="max",o[o.sink=4]="sink",o))(Ul||{});var sa=(c=>(c[c.none=0]="none",c[c.dashed=1]="dashed",c[c.solid=2]="solid",c[c.invis=3]="invis",c[c.bold=4]="bold",c[c.filled=5]="filled",c[c.diagonals=6]="diagonals",c[c.dotted=7]="dotted",c[c.rounded=8]="rounded",c))(sa||{});var zl=(s=>(s[s.forward=0]="forward",s[s.back=1]="back",s[s.both=2]="both",s[s.none=3]="none",s))(zl||{});var Vl=(t=>(t[t.in=0]="in",t[t.out=1]="out",t))(Vl||{});var T=class{static mkWithKeyword(e,t,i,s,o){let a=new T(e,t,i,s);return a.keyword=o,a}static parse(e){switch(e.toLowerCase()){case"aliceblue":return T.AliceBlue;case"antiquewhite":return T.AntiqueWhite;case"aqua":return T.Aqua;case"aquamarine":return T.Aquamarine;case"azure":return T.Azure;case"beige":return T.Beige;case"bisque":return T.Bisque;case"black":return T.Black;case"blanchedalmond":return T.BlanchedAlmond;case"blue":return T.Blue;case"blueviolet":return T.BlueViolet;case"brown":return T.Brown;case"burlywood":return T.BurlyWood;case"cadetblue":return T.CadetBlue;case"chartreuse":return T.Chartreuse;case"chocolate":return T.Chocolate;case"coral":return T.Coral;case"cornflowerblue":return T.CornflowerBlue;case"cornsilk":return T.Cornsilk;case"crimson":return T.Crimson;case"cyan":return T.Cyan;case"darkblue":return T.DarkBlue;case"darkcyan":return T.DarkCyan;case"darkgoldenrod":return T.DarkGoldenrod;case"darkgray":return T.DarkGray;case"darkgreen":return T.DarkGreen;case"darkkhaki":return T.DarkKhaki;case"darkmagenta":return T.DarkMagenta;case"darkolivegreen":return T.DarkOliveGreen;case"darkorange":return T.DarkOrange;case"darkorchid":return T.DarkOrchid;case"darkred":return T.DarkRed;case"darksalmon":return T.DarkSalmon;case"darkseagreen":return T.DarkSeaGreen;case"darkslateblue":return T.DarkSlateBlue;case"darkslategray":return T.DarkSlateGray;case"darkturquoise":return T.DarkTurquoise;case"darkviolet":return T.DarkViolet;case"deeppink":return T.DeepPink;case"deepskyblue":return T.DeepSkyBlue;case"dimgray":return T.DimGray;case"dodgerblue":return T.DodgerBlue;case"firebrick":return T.Firebrick;case"floralwhite":return T.FloralWhite;case"forestgreen":return T.ForestGreen;case"fuchsia":return T.Fuchsia;case"gainsboro":return T.Gainsboro;case"ghostwhite":return T.GhostWhite;case"gold":return T.Gold;case"goldenrod":return T.Goldenrod;case"gray":return T.Gray;case"green":return T.Green;case"greenyellow":return T.GreenYellow;case"honeydew":return T.Honeydew;case"hotpink":return T.HotPink;case"indianred":return T.IndianRed;case"indigo":return T.Indigo;case"ivory":return T.Ivory;case"khaki":return T.Khaki;case"lavender":return T.Lavender;case"lavenderblush":return T.LavenderBlush;case"lawngreen":return T.LawnGreen;case"lemonchiffon":return T.LemonChiffon;case"lightblue":return T.LightBlue;case"lightcoral":return T.LightCoral;case"lightcyan":return T.LightCyan;case"lightgoldenrodyellow":return T.LightGoldenrodYellow;case"lightgray":case"lightgrey":return T.LightGray;case"lightgreen":return T.LightGreen;case"lightpink":return T.LightPink;case"lightsalmon":return T.LightSalmon;case"lightseagreen":return T.LightSeaGreen;case"lightskyblue":return T.LightSkyBlue;case"lightslategray":return T.LightSlateGray;case"lightsteelblue":return T.LightSteelBlue;case"lightyellow":return T.LightYellow;case"lime":return T.Lime;case"limegreen":return T.LimeGreen;case"linen":return T.Linen;case"magenta":return T.Magenta;case"maroon":return T.Maroon;case"mediumaquamarine":return T.MediumAquamarine;case"mediumblue":return T.MediumBlue;case"mediumorchid":return T.MediumOrchid;case"mediumpurple":return T.MediumPurple;case"mediumseagreen":return T.MediumSeaGreen;case"mediumslateblue":return T.MediumSlateBlue;case"mediumspringgreen":return T.MediumSpringGreen;case"mediumturquoise":return T.MediumTurquoise;case"mediumvioletred":return T.MediumVioletRed;case"midnightblue":return T.MidnightBlue;case"mintcream":return T.MintCream;case"mistyrose":return T.MistyRose;case"moccasin":return T.Moccasin;case"navajowhite":return T.NavajoWhite;case"navy":return T.Navy;case"oldlace":return T.OldLace;case"olive":return T.Olive;case"olivedrab":return T.OliveDrab;case"orange":return T.Orange;case"orangered":return T.OrangeRed;case"orchid":return T.Orchid;case"palegoldenrod":return T.PaleGoldenrod;case"palegreen":return T.PaleGreen;case"paleturquoise":return T.PaleTurquoise;case"palevioletred":return T.PaleVioletRed;case"papayawhip":return T.PapayaWhip;case"peachpuff":return T.PeachPuff;case"peru":return T.Peru;case"pink":return T.Pink;case"plum":return T.Plum;case"powderblue":return T.PowderBlue;case"purple":return T.Purple;case"red":return T.Red;case"rosybrown":return T.RosyBrown;case"royalblue":return T.RoyalBlue;case"saddlebrown":return T.SaddleBrown;case"salmon":return T.Salmon;case"sandybrown":return T.SandyBrown;case"seagreen":return T.SeaGreen;case"seashell":return T.SeaShell;case"sienna":return T.Sienna;case"silver":return T.Silver;case"skyblue":return T.SkyBlue;case"slateblue":return T.SlateBlue;case"slategray":return T.SlateGray;case"snow":return T.Snow;case"springgreen":return T.SpringGreen;case"steelblue":return T.SteelBlue;case"tan":return T.Tan;case"teal":return T.Teal;case"thistle":return T.Thistle;case"tomato":return T.Tomato;case"transparent":return T.Transparent;case"turquoise":return T.Turquoise;case"violet":return T.Violet;case"wheat":return T.Wheat;case"white":return T.White;case"whitesmoke":return T.WhiteSmoke;case"yellow":return T.Yellow;case"yellowgreen":return T.YellowGreen;default:return}}get keyword(){return this.keyword_}set keyword(e){this.keyword_=e}constructor(e,t,i,s){this.a=e,this.r=t,this.g=i,this.b=s}static mkRGB(e,t,i){return new T(255,e,t,i)}get A(){return this.a}set A(e){this.a=e}get R(){return this.r}set R(e){this.r=e}get G(){return this.g}set G(e){this.g=e}get B(){return this.b}set B(e){this.b=e}static Xex(e){let t=e.toString(16);return t.length===1?"0"+t:t.substring(t.length-2,2)}static equal(e,t){return e.a===t.a&&e.r===t.r&&e.b===t.b&&e.g===t.g}toString(){return this.keyword?this.keyword:'"#'+T.Xex(this.R)+T.Xex(this.G)+T.Xex(this.B)+(this.A===255?"":T.Xex(this.A))+'"'}static get AliceBlue(){return T.mkWithKeyword(255,240,248,255,"aliceblue")}static get AntiqueWhite(){return T.mkWithKeyword(255,250,235,215,"antiquewhite")}static get Aqua(){return T.mkWithKeyword(255,0,255,255,"aqua")}static get Aquamarine(){return T.mkWithKeyword(255,127,255,212,"aquamarine")}static get Azure(){return T.mkWithKeyword(255,240,255,255,"azure")}static get Beige(){return T.mkWithKeyword(255,245,245,220,"beige")}static get Bisque(){return T.mkWithKeyword(255,255,228,196,"bisque")}static get Black(){return T.mkWithKeyword(255,0,0,0,"black")}static get BlanchedAlmond(){return T.mkWithKeyword(255,255,235,205,"blanchedalmond")}static get Blue(){return T.mkWithKeyword(255,0,0,255,"blue")}static get BlueViolet(){return T.mkWithKeyword(255,138,43,226,"blueviolet")}static get Brown(){return T.mkWithKeyword(255,165,42,42,"brown")}static get BurlyWood(){return T.mkWithKeyword(255,222,184,135,"burlywood")}static get CadetBlue(){return T.mkWithKeyword(255,95,158,160,"cadetblue")}static get Chartreuse(){return T.mkWithKeyword(255,127,255,0,"chartreuse")}static get Chocolate(){return T.mkWithKeyword(255,210,105,30,"chocolate")}static get Coral(){return T.mkWithKeyword(255,255,127,80,"coral")}static get CornflowerBlue(){return T.mkWithKeyword(255,100,149,237,"cornflowerblue")}static get Cornsilk(){return T.mkWithKeyword(255,255,248,220,"cornsilk")}static get Crimson(){return T.mkWithKeyword(255,220,20,60,"crimson")}static get Cyan(){return T.mkWithKeyword(255,0,255,255,"cyan")}static get DarkBlue(){return T.mkWithKeyword(255,0,0,139,"darkblue")}static get DarkCyan(){return T.mkWithKeyword(255,0,139,139,"darkcyan")}static get DarkGoldenrod(){return T.mkWithKeyword(255,184,134,11,"darkgoldenrod")}static get DarkGray(){return T.mkWithKeyword(255,169,169,169,"darkgray")}static get DarkGreen(){return T.mkWithKeyword(255,0,100,0,"darkgreen")}static get DarkKhaki(){return T.mkWithKeyword(255,189,183,107,"darkkhaki")}static get DarkMagenta(){return T.mkWithKeyword(255,139,0,139,"darkmagenta")}static get DarkOliveGreen(){return T.mkWithKeyword(255,85,107,47,"darkolivegreen")}static get DarkOrange(){return T.mkWithKeyword(255,255,140,0,"darkorange")}static get DarkOrchid(){return T.mkWithKeyword(255,153,50,204,"darkorchid")}static get DarkRed(){return T.mkWithKeyword(255,139,0,0,"darkred")}static get DarkSalmon(){return T.mkWithKeyword(255,233,150,122,"darksalmon")}static get DarkSeaGreen(){return T.mkWithKeyword(255,143,188,139,"darkseagreen")}static get DarkSlateBlue(){return T.mkWithKeyword(255,72,61,139,"darkslateblue")}static get DarkSlateGray(){return T.mkWithKeyword(255,47,79,79,"darkslategray")}static get DarkTurquoise(){return T.mkWithKeyword(255,0,206,209,"darkturquoise")}static get DarkViolet(){return T.mkWithKeyword(255,148,0,211,"darkviolet")}static get DeepPink(){return T.mkWithKeyword(255,255,20,147,"deeppink")}static get DeepSkyBlue(){return T.mkWithKeyword(255,0,191,255,"deepskyblue")}static get DimGray(){return T.mkWithKeyword(255,105,105,105,"dimgray")}static get DodgerBlue(){return T.mkWithKeyword(255,30,144,255,"dodgerblue")}static get Firebrick(){return T.mkWithKeyword(255,178,34,34,"firebrick")}static get FloralWhite(){return T.mkWithKeyword(255,255,250,240,"floralwhite")}static get ForestGreen(){return T.mkWithKeyword(255,34,139,34,"forestgreen")}static get Fuchsia(){return T.mkWithKeyword(255,255,0,255,"fuchsia")}static get Gainsboro(){return T.mkWithKeyword(255,220,220,220,"gainsboro")}static get GhostWhite(){return T.mkWithKeyword(255,248,248,255,"ghostwhite")}static get Gold(){return T.mkWithKeyword(255,255,215,0,"gold")}static get Goldenrod(){return T.mkWithKeyword(255,218,165,32,"goldenrod")}static get Gray(){return T.mkWithKeyword(255,128,128,128,"gray")}static get Green(){return T.mkWithKeyword(255,0,128,0,"green")}static get GreenYellow(){return T.mkWithKeyword(255,173,255,47,"greenyellow")}static get Honeydew(){return T.mkWithKeyword(255,240,255,240,"honeydew")}static get HotPink(){return T.mkWithKeyword(255,255,105,180,"hotpink")}static get IndianRed(){return T.mkWithKeyword(255,205,92,92,"indianred")}static get Indigo(){return T.mkWithKeyword(255,75,0,130,"indigo")}static get Ivory(){return T.mkWithKeyword(255,255,255,240,"ivory")}static get Khaki(){return T.mkWithKeyword(255,240,230,140,"khaki")}static get Lavender(){return T.mkWithKeyword(255,230,230,250,"lavender")}static get LavenderBlush(){return T.mkWithKeyword(255,255,240,245,"lavenderblush")}static get LawnGreen(){return T.mkWithKeyword(255,124,252,0,"lawngreen")}static get LemonChiffon(){return T.mkWithKeyword(255,255,250,205,"lemonchiffon")}static get LightBlue(){return T.mkWithKeyword(255,173,216,230,"lightblue")}static get LightCoral(){return T.mkWithKeyword(255,240,128,128,"lightcoral")}static get LightCyan(){return T.mkWithKeyword(255,224,255,255,"lightcyan")}static get LightGoldenrodYellow(){return T.mkWithKeyword(255,250,250,210,"lightgoldenrodyellow")}static get LightGray(){return T.mkWithKeyword(255,211,211,211,"lightgray")}static get LightGreen(){return T.mkWithKeyword(255,144,238,144,"lightgreen")}static get LightPink(){return T.mkWithKeyword(255,255,182,193,"lightpink")}static get LightSalmon(){return T.mkWithKeyword(255,255,160,122,"lightsalmon")}static get LightSeaGreen(){return T.mkWithKeyword(255,32,178,170,"lightseagreen")}static get LightSkyBlue(){return T.mkWithKeyword(255,135,206,250,"lightskyblue")}static get LightSlateGray(){return T.mkWithKeyword(255,119,136,153,"lightslategray")}static get LightSteelBlue(){return T.mkWithKeyword(255,176,196,222,"lightsteelblue")}static get LightYellow(){return T.mkWithKeyword(255,255,255,224,"lightyellow")}static get Lime(){return T.mkWithKeyword(255,0,255,0,"lime")}static get LimeGreen(){return T.mkWithKeyword(255,50,205,50,"limegreen")}static get Linen(){return T.mkWithKeyword(255,250,240,230,"linen")}static get Magenta(){return T.mkWithKeyword(255,255,0,255,"magenta")}static get Maroon(){return T.mkWithKeyword(255,128,0,0,"maroon")}static get MediumAquamarine(){return T.mkWithKeyword(255,102,205,170,"mediumaquamarine")}static get MediumBlue(){return T.mkWithKeyword(255,0,0,205,"mediumblue")}static get MediumOrchid(){return T.mkWithKeyword(255,186,85,211,"mediumorchid")}static get MediumPurple(){return T.mkWithKeyword(255,147,112,219,"mediumpurple")}static get MediumSeaGreen(){return T.mkWithKeyword(255,60,179,113,"mediumseagreen")}static get MediumSlateBlue(){return T.mkWithKeyword(255,123,104,238,"mediumslateblue")}static get MediumSpringGreen(){return T.mkWithKeyword(255,0,250,154,"mediumspringgreen")}static get MediumTurquoise(){return T.mkWithKeyword(255,72,209,204,"mediumturquoise")}static get MediumVioletRed(){return T.mkWithKeyword(255,199,21,133,"mediumvioletred")}static get MidnightBlue(){return T.mkWithKeyword(255,25,25,112,"midnightblue")}static get MintCream(){return T.mkWithKeyword(255,245,255,250,"mintcream")}static get MistyRose(){return T.mkWithKeyword(255,255,228,225,"mistyrose")}static get Moccasin(){return T.mkWithKeyword(255,255,228,181,"moccasin")}static get NavajoWhite(){return T.mkWithKeyword(255,255,222,173,"navajowhite")}static get Navy(){return T.mkWithKeyword(255,0,0,128,"navy")}static get OldLace(){return T.mkWithKeyword(255,253,245,230,"oldlace")}static get Olive(){return T.mkWithKeyword(255,128,128,0,"olive")}static get OliveDrab(){return T.mkWithKeyword(255,107,142,35,"olivedrab")}static get Orange(){return T.mkWithKeyword(255,255,165,0,"orange")}static get OrangeRed(){return T.mkWithKeyword(255,255,69,0,"orangered")}static get Orchid(){return T.mkWithKeyword(255,218,112,214,"orchid")}static get PaleGoldenrod(){return T.mkWithKeyword(255,238,232,170,"palegoldenrod")}static get PaleGreen(){return T.mkWithKeyword(255,152,251,152,"palegreen")}static get PaleTurquoise(){return T.mkWithKeyword(255,175,238,238,"paleturquoise")}static get PaleVioletRed(){return T.mkWithKeyword(255,219,112,147,"palevioletred")}static get PapayaWhip(){return T.mkWithKeyword(255,255,239,213,"papayawhip")}static get PeachPuff(){return T.mkWithKeyword(255,255,218,185,"peachpuff")}static get Peru(){return T.mkWithKeyword(255,205,133,63,"peru")}static get Pink(){return T.mkWithKeyword(255,255,192,203,"pink")}static get Plum(){return T.mkWithKeyword(255,221,160,221,"plum")}static get PowderBlue(){return T.mkWithKeyword(255,176,224,230,"powderblue")}static get Purple(){return T.mkWithKeyword(255,128,0,128,"purple")}static get Red(){return T.mkWithKeyword(255,255,0,0,"red")}static get RosyBrown(){return T.mkWithKeyword(255,188,143,143,"rosybrown")}static get RoyalBlue(){return T.mkWithKeyword(255,65,105,225,"royalblue")}static get SaddleBrown(){return T.mkWithKeyword(255,139,69,19,"saddlebrown")}static get Salmon(){return T.mkWithKeyword(255,250,128,114,"salmon")}static get SandyBrown(){return T.mkWithKeyword(255,244,164,96,"sandybrown")}static get SeaGreen(){return T.mkWithKeyword(255,46,139,87,"seagreen")}static get SeaShell(){return T.mkWithKeyword(255,255,245,238,"seashell")}static get Sienna(){return T.mkWithKeyword(255,160,82,45,"sienna")}static get Silver(){return T.mkWithKeyword(255,192,192,192,"silver")}static get SkyBlue(){return T.mkWithKeyword(255,135,206,235,"skyblue")}static get SlateBlue(){return T.mkWithKeyword(255,106,90,205,"slateblue")}static get SlateGray(){return T.mkWithKeyword(255,112,128,144,"slategray")}static get Snow(){return T.mkWithKeyword(255,255,250,250,"snow")}static get SpringGreen(){return T.mkWithKeyword(255,0,255,127,"springgreen")}static get SteelBlue(){return T.mkWithKeyword(255,70,130,180,"steelblue")}static get Tan(){return T.mkWithKeyword(255,210,180,140,"tan")}static get Teal(){return T.mkWithKeyword(255,0,128,128,"teal")}static get Thistle(){return T.mkWithKeyword(255,216,191,216,"thistle")}static get Tomato(){return T.mkWithKeyword(255,255,99,71,"tomato")}static get Transparent(){return T.mkWithKeyword(0,255,255,255,"transparent")}static get Turquoise(){return T.mkWithKeyword(255,64,224,208,"turquoise")}static get Violet(){return T.mkWithKeyword(255,238,130,238,"violet")}static get Wheat(){return T.mkWithKeyword(255,245,222,179,"wheat")}static get White(){return T.mkWithKeyword(255,255,255,255,"white")}static get WhiteSmoke(){return T.mkWithKeyword(255,245,245,245,"whitesmoke")}static get Yellow(){return T.mkWithKeyword(255,255,255,0,"yellow")}static get YellowGreen(){return T.mkWithKeyword(255,154,205,50,"yellowgreen")}};var ae=we(We(),1);var Ds=we(We(),1),Rs=class extends Ds.Attribute{constructor(t){super(t,Ds.AttributeRegistry.DrawingObjectIndex);this.labelfontcolor=T.Black;this.styles=[];this.penwidth=1;this.fontname=Rs.defaultLabelFontName,this.fontsize=Rs.defaultLabelFontSize}rebind(t){this.entity=t,this.bind(Ds.AttributeRegistry.DrawingObjectIndex)}static copyValidFields(t,i){t==null||i==null||(t.color&&t.color.keyword&&t.color.keyword.toLowerCase()!=="black"&&(i.color=t.color),t.fillColor&&(i.fillColor=t.fillColor),t.labelfontcolor&&t.labelfontcolor.keyword.toLowerCase()!=="black"&&(i.labelfontcolor=t.labelfontcolor),t.labelText!=null&&t.labelText!==""&&t.labelText!==t.id&&(i.labelText=t.labelText),t.fontColor&&t.fontColor.keyword&&t.fontColor.keyword.toLowerCase()!=="black"&&(i.fontColor=t.fontColor),t.styles&&t.styles.length&&(i.styles=t.styles.map(s=>s)),t.pencolor&&t.pencolor.keyword!=="black"&&(i.pencolor=t.pencolor),t.penwidth&&t.penwidth!==1&&(i.penwidth=t.penwidth),t.rankdir&&(i.rankdir=t.rankdir),t.fontname&&t.fontname!==Rs.defaultLabelFontName&&(i.fontname=t.fontname),t.margin&&(i.margin=t.margin),t.fontsize&&t.fontsize!==Rs.defaultLabelFontSize&&(i.fontsize=t.fontsize),t.orientation&&(i.orientation=t.orientation),t.ranksep&&(i.ranksep=t.ranksep),t.arrowtail&&(i.arrowtail=t.arrowtail),t.arrowhead&&(i.arrowhead=t.arrowhead),t.ordering&&(i.ordering=t.ordering),t.bgcolor&&(i.bgcolor=t.bgcolor),t.pos&&(i.pos=t.pos),t.nodesep&&(i.nodesep=t.nodesep),t.arrowsize&&(i.arrowsize=t.arrowsize),t.samehead&&(i.samehead=t.samehead),t.layersep&&(i.layersep=t.layersep),t.clusterRank&&(i.clusterRank=t.clusterRank))}get labelText(){return this._labelText}set labelText(t){this._labelText=t}get arrowhead(){return this._arrowhead}set arrowhead(t){this._arrowhead=t}get id(){return this._id}set id(t){this._id=t}static getDrawingObj(t){return t==null?null:t.getAttr(Ds.AttributeRegistry.DrawingObjectIndex)}},de=Rs;de.defaultLabelFontName="Times-Roman",de.defaultLabelFontSize=12;var jl=class extends de{constructor(t){super(t);this.shape=2;this.padding=2;this.xRad=3;this.yRad=3;this.labelMargin=1;this.labelWidthToHeightRatio=1;t!=null&&(this.labelText=t.id)}clone(){throw new Error("Method not implemented.")}get Padding(){return this.padding}set Padding(t){this.padding=Math.max(0,t)}get XRadius(){return this.xRad}set XRadius(t){this.xRad=t}get YRadius(){return this.yRad}set YRadius(t){this.yRad=t}static get DefaultFillColor(){return jl.defaultFillColor}static set DefaultFillColor(t){jl.defaultFillColor=t}get ShapeEnum(){return this.shape}set ShapeEnum(t){this.shape=t}get LabelMargin(){return this.labelMargin}set LabelMargin(t){this.labelMargin=t}get LabelWidthToHeightRatio(){return this.labelWidthToHeightRatio}set LabelWidthToHeightRatio(t){this.labelWidthToHeightRatio=t}get node(){return this.entity}get id(){return this.node?this.node.id:""}},He=jl;He.defaultFillColor=T.LightGray;var ir=class extends de{constructor(t,i){super(t);this.directed=!0;this.directed=i,i?this.arrowhead=0:this.arrowhead=6,this.arrowtail=6}clone(){let t=new ir(null,this.directed);return de.copyValidFields(this,t),t.directed=this.directed,t.arrowtail=this.arrowtail,t.arrowhead=this.arrowhead,t}};var Ie=class extends He{constructor(){super(...arguments);this.graphVisData={sameRanks:new Array,minRanks:new Array,maxRanks:new Array,sourceRanks:new Array,sinkRanks:new Array}}get defaultNodeObject(){return this._defaultNodeObject}set defaultNodeObject(t){this._defaultNodeObject=t}static getDrawingGraph(t){return de.getDrawingObj(t)}get graph(){return this.entity}findNode(t){let s=this.graph.findNode(t);return s==null?null:de.getDrawingObj(s)}hasDirectedEdge(){for(let t of this.graph.deepEdges)if(de.getDrawingObj(t).directed)return!0;return!1}createGeometry(t=i=>i?new ae.Size(i.length*8+8,20):null){let i=new ae.GeomGraph(this.graph);this.textMeasure=t;let s={fontFamily:this.fontname,fontSize:this.fontsize,fontStyle:"normal"};i.labelSize=t(this.labelText,s);for(let o of this.graph.nodesBreadthFirst)this.createNodeGeometry(o);for(let o of this.graph.deepEdges)this.createEdgeGeometry(o);if(this.rankdir){let o=i.layoutSettings=new ae.SugiyamaLayoutSettings;o.layerDirection=this.rankdir}return i}createEdgeGeometry(t){let i=ir.getDrawingObj(t),s=new ae.GeomEdge(t);if(i.arrowhead!=6&&(s.targetArrowhead=new ae.Arrowhead),i.arrowtail!=6&&(s.sourceArrowhead=new ae.Arrowhead),i.labelText){let o=this.textMeasure(i.labelText,{fontSize:i.fontsize,fontFamily:i.fontname,fontStyle:"normal"}),a=t.label=new ae.Label(t);new ae.GeomLabel(a,ae.Rectangle.mkPP(new ae.Point(0,0),new ae.Point(o.width,o.height))),i.measuredTextSize=o}i.penwidth&&(s.lineWidth=i.penwidth)}curveByShape(t,i,s,o){let a;switch(o.shape){case 0:a=ae.CurveFactory.mkDiamond(t,i,s);break;case 1:a=ae.CurveFactory.mkEllipse(t/1.6,i/1.6,s);break;case 4:case 2:a=ae.CurveFactory.mkRectangleWithRoundedCorners(t,i,o.XRadius,o.YRadius,s);break;case 3:a=ae.CurveFactory.mkCircle(Math.sqrt(t*t+i*i),s);break;case 5:break;case 6:break;case 7:break;case 8:break;case 9:break;case 10:a=ae.CurveFactory.mkCircle(Math.sqrt(t*t+i*i)+2*o.penwidth,s);break;case 11:a=ae.CurveFactory.createHouse(t,i,s);break;case 12:a=ae.CurveFactory.createInvertedHouse(t,i,s);break;case 13:a=ae.CurveFactory.createParallelogram(t,i,s);break;case 14:a=ae.CurveFactory.createOctagon(t,i,s);break;case 15:break;case 16:break;case 17:break;case 18:break;case 19:a=ae.CurveFactory.createHexagon(t,i,s);break}return a!=null?a:ae.CurveFactory.mkRectangleWithRoundedCorners(t,i,o.XRadius,o.YRadius,s)}createNodeGeometry(t,i=new ae.Point(0,0)){if(t instanceof ae.Graph){let s=de.getDrawingObj(t),o=new ae.GeomGraph(t);s.labelText&&(o.labelSize=s.measuredTextSize=jh(s,this.textMeasure))}else{let s=He.getDrawingObj(t),o=new ae.Size(1,1);s.labelText&&(o=jh(s,this.textMeasure)),s.measuredTextSize=o;let a=new ae.GeomNode(t),u=o.width+s.LabelMargin*2,l=o.height+s.LabelMargin*2;a.boundaryCurve=this.curveByShape(u,l,i,s)}}measureLabelSizes(t){var i;for(let s of this.graph.nodesBreadthFirst){let o=He.getDrawingObj(s);o.measuredTextSize=(i=jh(o,t))!=null?i:new ae.Size(1,1)}}};function jh(n,e){return n.labelText?e(n.labelText,{fontSize:n.fontsize,fontFamily:n.fontname,fontStyle:"normal"}):null}var Ee=we(We(),1);var Fs;(function(n){n.has=Symbol.for("@esfx/collection-core!ReadonlyCollection.has"),n.name="ReadonlyContainer";function e(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&n.has in t}n.hasInstance=e})(Fs||(Fs={}));var oa;(function(n){n.has=Fs.has,n.add=Symbol.for("@esfx/collection-core!Collection.add"),n.delete=Symbol.for("@esfx/collection-core!Collection.delete"),n.name="Container";function e(t){return Fs.hasInstance(t)&&n.add in t&&n.delete in t}n.hasInstance=e})(oa||(oa={}));var Ht;(function(n){n.has=Fs.has,n.size=Symbol.for("@esfx/collection-core!ReadonlyCollection.size"),n.name="ReadonlyCollection";function e(t){return Fs.hasInstance(t)&&(typeof t=="object"&&t!==null||typeof t=="function")&&Symbol.iterator in t&&n.size in t}n.hasInstance=e})(Ht||(Ht={}));var aa;(function(n){n.size=Ht.size,n.has=Ht.has,n.add=oa.add,n.delete=oa.delete,n.clear=Symbol.for("@esfx/collection-core!Collection.clear"),n.name="Collection";function e(t){return Ht.hasInstance(t)&&oa.hasInstance(t)&&n.clear in t}n.hasInstance=e})(aa||(aa={}));var _i;(function(n){n.size=Ht.size,n.has=Ht.has,n.indexOf=Symbol.for("@esfx/collection-core!ReadonlyIndexedCollection.indexOf"),n.getAt=Symbol.for("@esfx/collection-core!ReadonlyIndexedCollection.getAt"),n.name="ReadonlyIndexedCollection";function e(t){return Ht.hasInstance(t)&&n.indexOf in t&&n.getAt in t}n.hasInstance=e})(_i||(_i={}));var Wl;(function(n){n.size=Ht.size,n.has=Ht.has,n.indexOf=_i.indexOf,n.getAt=_i.getAt,n.setAt=Symbol.for("@esfx/collection-core!FixedSizeIndexedCollection.setAt"),n.name="FixedSizeIndexedCollection";function e(t){return _i.hasInstance(t)&&n.setAt in t}n.hasInstance=e})(Wl||(Wl={}));var qm;(function(n){n.size=Ht.size,n.has=Ht.has,n.indexOf=_i.indexOf,n.getAt=_i.getAt,n.setAt=Wl.setAt,n.add=aa.add,n.delete=aa.delete,n.clear=aa.clear,n.insertAt=Symbol.for("@esfx/collection-core!IndexedCollection.insertAt"),n.removeAt=Symbol.for("@esfx/collection-core!IndexedCollection.removeAt"),n.name="IndexedCollection";function e(t){return Wl.hasInstance(t)&&n.insertAt in t&&n.removeAt in t}n.hasInstance=e})(qm||(qm={}));var Cn;(function(n){n.has=Symbol.for("@esfx/collection-core!ReadonlyKeyedContainer.has"),n.get=Symbol.for("@esfx/collection-core!ReadonlyKeyedContainer.get"),n.name="ReadonlyKeyedContainer";function e(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&n.has in t&&n.get in t}n.hasInstance=e})(Cn||(Cn={}));var ua;(function(n){n.has=Cn.has,n.get=Cn.get,n.set=Symbol.for("@esfx/collection-core!KeyedCollection.set"),n.delete=Symbol.for("@esfx/collection-core!KeyedCollection.delete"),n.name="KeyedContainer";function e(t){return Cn.hasInstance(t)&&n.set in t&&n.delete in t}n.hasInstance=e})(ua||(ua={}));var Pn;(function(n){n.has=Cn.has,n.get=Cn.get,n.size=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.size"),n.keys=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.keys"),n.values=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.values"),n.name="ReadonlyKeyedCollection";function e(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&Symbol.iterator in t&&Cn.hasInstance(t)&&n.size in t&&n.keys in t&&n.values in t}n.hasInstance=e})(Pn||(Pn={}));var sr;(function(n){n.size=Pn.size,n.has=Pn.has,n.get=Pn.get,n.keys=Pn.keys,n.values=Pn.values,n.set=ua.set,n.delete=ua.delete,n.clear=Symbol.for("@esfx/collection-core!KeyedCollection.clear"),n.name="KeyedCollection";function e(t){return Pn.hasInstance(t)&&ua.hasInstance(t)&&n.clear in t}n.hasInstance=e})(sr||(sr={}));var Jr;(function(n){n.size=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.size"),n.has=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.has"),n.hasValue=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.hasValue"),n.get=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.get"),n.keys=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.keys"),n.values=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.values"),n.name="ReadonlyKeyedMultiCollection";function e(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&Symbol.iterator in t&&n.size in t&&n.has in t&&n.hasValue in t&&n.get in t&&n.keys in t&&n.values in t}n.hasInstance=e})(Jr||(Jr={}));var Ym;(function(n){n.size=Jr.size,n.has=Jr.has,n.hasValue=Jr.hasValue,n.get=Jr.get,n.keys=Jr.keys,n.values=Jr.values,n.add=Symbol.for("@esfx/collection-core!KeyedMultiCollection.add"),n.delete=Symbol.for("@esfx/collection-core!KeyedMultiCollection.delete"),n.deleteValue=Symbol.for("@esfx/collection-core!KeyedMultiCollection.deleteValue"),n.clear=Symbol.for("@esfx/collection-core!KeyedMultiCollection.clear"),n.name="KeyedMultiCollection";function e(t){return Jr.hasInstance(t)&&n.add in t&&n.delete in t&&n.deleteValue in t&&n.clear in t}n.hasInstance=e})(Ym||(Ym={}));function Zm(n,e,t,i){if(e%4)throw new TypeError("Pointer not aligned");let s=new Uint32Array(n),o,a,u,l,c,f,h;if(a=e+t,e>>=2,t>=16){u=a-16>>2,l=(i+2654435761|0)+2246822519|0,c=i+2246822519|0,f=i+0|0,h=i+2654435761|0;do l=l+s[e++]*2246822519|0|0,l=(l<<13|l>>>19)*2654435761|0,c=c+s[e++]*2246822519|0|0,c=(c<<13|c>>>19)*2654435761|0,f=f+s[e++]*2246822519|0|0,f=(f<<13|f>>>19)*2654435761|0,h=h+s[e++]*2246822519|0|0,h=(h<<13|h>>>19)*2654435761|0;while(e<=u);o=(l<<1|l>>>31)+(c<<7|c>>>25)|(f<<12|f>>>20)|(h<<18|h>>>14)}else o=i+374761393|0;for(o=o+t|0,u=a-4>>2;e<=u;)o=o+s[e++]*3266489917|0|0,o=(o<<17|o>>>15)*668265263|0;if(e=e<<2,e<a){let d=new Uint8Array(s.buffer);do o=o+d[e++]*374761393|0|0,o=(o<<11|o>>>21)*2654435761|0;while(e<a)}return o=(o^o>>>15)*2246822519|0,o=(o^o>>>13)*3266489917|0,o=o^o>>>16,o>>>0}var WA=typeof WebAssembly<"u"&&typeof WebAssembly.Module=="function"&&typeof WebAssembly.Instance=="function",HA=new Uint8Array([0,97,115,109,1,0,0,0,1,8,1,96,3,127,127,126,1,126,3,2,1,0,5,3,1,0,1,7,15,2,3,109,101,109,2,0,5,120,120,104,54,52,0,0,10,130,6,1,255,5,2,3,126,1,127,32,0,32,1,106,33,6,32,1,65,32,79,4,126,32,6,65,32,107,33,6,32,2,66,214,235,130,238,234,253,137,245,224,0,124,33,3,32,2,66,177,169,172,193,173,184,212,166,61,125,33,4,32,2,66,249,234,208,208,231,201,161,228,225,0,124,33,5,3,64,32,3,32,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,3,32,4,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,4,32,2,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,2,32,5,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,5,32,6,32,0,65,8,106,34,0,79,13,0,11,32,2,66,12,137,32,5,66,18,137,124,32,4,66,7,137,124,32,3,66,1,137,124,32,3,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,32,4,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,32,2,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,32,5,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,5,32,2,66,197,207,217,178,241,229,186,234,39,124,11,32,1,173,124,33,2,32,0,32,1,65,31,113,106,33,1,3,64,32,1,32,0,65,8,106,79,4,64,32,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,32,2,133,66,27,137,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,33,2,32,0,65,8,106,33,0,12,1,11,11,32,0,65,4,106,32,1,77,4,64,32,2,32,0,53,2,0,66,135,149,175,175,152,182,222,155,158,127,126,133,66,23,137,66,207,214,211,190,210,199,171,217,66,126,66,249,243,221,241,153,246,153,171,22,124,33,2,32,0,65,4,106,33,0,11,3,64,32,0,32,1,73,4,64,32,2,32,0,49,0,0,66,197,207,217,178,241,229,186,234,39,126,133,66,11,137,66,135,149,175,175,152,182,222,155,158,127,126,33,2,32,0,65,1,106,33,0,12,1,11,11,32,2,32,2,66,33,136,133,66,207,214,211,190,210,199,171,217,66,126,34,2,66,29,136,32,2,133,66,249,243,221,241,153,246,153,171,22,126,34,2,66,32,136,32,2,133,11]),bi=WA?new WebAssembly.Instance(new WebAssembly.Module(HA)).exports:void 0;var Ai=bi===null||bi===void 0?void 0:bi.mem,Wh=bi===null||bi===void 0?void 0:bi.xxh64;var YA=typeof TextEncoder=="function",Km=(n,e)=>(Km=ZA())(n,e),Hh=(n,e)=>Km(n,e);function ZA(){function n(){let t=new TextEncoder;function i(s,o){let{written:a=0}=t.encodeInto(s,o);return a}return i}function e(){function t(i,s){let o=i.length,a=0;for(let u=0;u<o;u++){let l=i.charCodeAt(u);if((l&55296)!==0&&(l&4294910976)===0&&u<o-1){let c=i.charCodeAt(u+1);(c&64512)===56320&&(l=((l&1023)<<10)+(c&1023)+65536,u++)}if((l&4294967168)===0)s[a++]=l;else if((l&4294965248)===0)s[a++]=l>>6|192,s[a++]=l&63|128;else if((l&268431360)===0)s[a++]=l>>12|224,s[a++]=l>>6&63|128,s[a++]=l&63|128;else if((l&4292870144)===0)s[a++]=l>>18|240,s[a++]=l>>12&63|128,s[a++]=l>>6&63|128,s[a++]=l&63|128;else throw new RangeError("Unsupported charCode.")}return a}return t}return YA?n():e()}var Xh=typeof BigInt=="function"&&typeof BigInt(0)=="bigint",$m=typeof BigUint64Array=="function",$A=typeof Ai=="object"&&typeof Wh=="function",qh=new ArrayBuffer(8),JA=new Float64Array(qh),Qr=new Uint32Array(qh),Os=()=>(Os=QA())(),Jm=n=>(Jm=ev())(n),Qm=n=>(Qm=tv())(n),e0=n=>(e0=Os())(n),t0=n=>(t0=rv())(n),r0=n=>(r0=nv())(n),n0=n=>Jm(n),i0=n=>Qm(n),s0=n=>e0(n),o0=n=>t0(n),Yh=n=>r0(n);function QA(){function n(){let t=new BigUint64Array(Qr.buffer),i=new Uint8Array(Ai.buffer);function s(c){Ai.buffer.byteLength<c&&(Ai.grow(Math.ceil((c-Ai.buffer.byteLength)/65536)),i=new Uint8Array(Ai.buffer))}function o(c){t[0]=c;let f=Qr[0],h=Qr[1];return(f<<7|f>>>25)^h}function a(){return Qr[0]=Hl(),Qr[1]=Hl(),t[0]}function u(c,f){s(c.length*3);let h=Hh(c,i);return o(Wh(0,h,f))}function l(){let c=a();function f(h){return u(h,c)}return f}return l}function e(){let t=new Uint8Array(65536);function i(a){t.byteLength<a&&(t=new Uint8Array(a+(65536-a%65536)))}function s(a,u){i(a.length*3);let l=Hh(a,t);return Zm(t.buffer,0,l,u)>>0}function o(){let a=Hl();function u(l){return s(l,a)}return u}return o}return Xh&&$m&&$A?n():e()}function ev(){function n(t){JA[0]=t;let i=Qr[0],s=Qr[1];return(i<<7|i>>>25)^s|0}function e(t){return t>>0===t?t|0:n(t)}return e}function tv(){function n(){let i=new BigUint64Array(qh),s=BigInt(0),o=BigInt(1),a=BigInt(2),u=BigInt(2)**BigInt(31)-BigInt(1),l=~u,c=BigInt(64);function f(h){if(h===s)return 0;if(h>=l&&h<=u)return Number(h);h=h<s?~h*a+o:h*a;let d=0;for(;h;)i[0]=h,d=(d<<7|d>>>25)^Qr[0],d=(d<<7|d>>>25)^Qr[1],h=h>>c;return d|0}return f}function e(){let i=BigInt(0),s=BigInt(1),o=BigInt(2),a=BigInt(2)**BigInt(31)-BigInt(1),u=~a,l=BigInt(32),c=BigInt("0xFFFFFFFF");function f(h){if(h===i)return 0;if(h>=u&&h<=a)return Number(h);h=h<i?~h*o+s:h*o;let d=0;for(;h!==i;)d=(d<<7|d>>>25)^Number(h&c),h>>=l,d=(d<<7|d>>>25)^Number(h&c),h>>=l;return d|0}return f}function t(){let i=Os();function s(o){return i(o.toString())}return s}return Xh&&$m?n():Xh?e():t()}function rv(){let n="description"in Symbol.prototype?x=>x.description:x=>{let E=x.toString();return E.length>=8&&E.slice(0,7)==="Symbol("&&E.slice(-1)===")"?E.slice(7,-1):E},e=Os(),t,i;try{new WeakMap().set(Symbol.iterator,null),t=new WeakMap,i=new WeakMap}catch{t=new Map,i=new Map}for(let x of Object.getOwnPropertyNames(Symbol))if(typeof x=="string"){let E=Symbol[x];typeof E=="symbol"&&i.set(E,`Symbol.${x}`)}let s=Os(),o;try{new WeakMap().set(Symbol.for("@esfx/equatable!~globalSymbolTest"),null),o=new WeakMap}catch{o=new Map}let a=Os(),u,l=1;try{new WeakMap().set(Symbol(),null),u=new WeakMap}catch{u=new Map}function c(x,E){let w=o.get(x);return w===void 0&&(w=s(E),o.set(x,w)),w}function f(x,E){let w=t.get(x);return w===void 0&&(w=e(E),t.set(x,w)),w}function h(x){let E=u.get(x);return E===void 0&&(E=a(`${l++}#${n(x)}`),u.set(x,E)),E}function d(x){let E=i.get(x);if(E!==void 0)return f(x,E);let w=Symbol.keyFor(x);return w!==void 0?c(x,w):h(x)}return d}function nv(){let n=new WeakMap,e=Hl(),t=1;function i(o){return o=~o+(o<<15),o=o^o>>12,o=o+(o<<2),o=o^o>>4,o=o*2057,o=o^o>>16,o>>>0}function s(o){let a=n.get(o);return a===void 0&&(a=i(t++^e)^e,n.set(o,a)),a}return s}function Hl(){return Math.floor(Math.random()*4294967295)>>>0}var Xl=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:void 0,Zh=Symbol.for("@esfx/equatable!~hashUnknown"),ql;Xl&&typeof Xl[Zh]=="function"?ql=Xl[Zh]:(ql=function(e){switch(typeof e){case"boolean":return e?1:0;case"number":return n0(e);case"bigint":return i0(e);case"string":return s0(e);case"symbol":return o0(e);case"function":return Yh(e);case"object":return e===null?0:Yh(e);case"undefined":return 0;default:throw new TypeError(`Unsupported type: ${typeof e}`)}},Object.defineProperty(Xl,Zh,{value:ql}));function a0(n){return ql(n)}var Mn;(function(n){n.equals=Symbol.for("@esfx/equatable:Equatable.equals"),n.hash=Symbol.for("@esfx/equatable:Equatable.hash"),n.name="Equatable";function e(t){let i;return t!=null&&n.equals in(i=Object(t))&&n.hash in i}n.hasInstance=e,Object.defineProperty(n,Symbol.hasInstance,{configurable:!0,writable:!0,value:e})})(Mn||(Mn={}));var Ns;(function(n){n.compareTo=Symbol.for("@esfx/equatable:Comparable.compareTo"),n.name="Comparable";function e(t){return t!=null&&n.compareTo in Object(t)}n.hasInstance=e,Object.defineProperty(n,Symbol.hasInstance,{configurable:!0,writable:!0,value:e})})(Ns||(Ns={}));var In;(function(n){n.structuralEquals=Symbol.for("@esfx/equatable:StructualEquatable.structuralEquals"),n.structuralHash=Symbol.for("@esfx/equatable:StructuralEquatable.structuralHash"),n.name="StructuralEquatable";function e(t){let i;return t!=null&&n.structuralEquals in(i=Object(t))&&n.structuralHash in i}n.hasInstance=e,Object.defineProperty(n,Symbol.hasInstance,{configurable:!0,writable:!0,value:e})})(In||(In={}));var Bs;(function(n){n.structuralCompareTo=Symbol.for("@esfx/equatable:StructuralComparable.structuralCompareTo"),n.name="StructuralComparable";function e(t){return t!=null&&n.structuralCompareTo in Object(t)}n.hasInstance=e,Object.defineProperty(n,Symbol.hasInstance,{configurable:!0,writable:!0,value:e})})(Bs||(Bs={}));var vi;(function(n){let e=Object.defineProperty({},Symbol.toStringTag,{configurable:!0,value:"Equaler"});n.defaultEqualer=t((o,a)=>Mn.hasInstance(o)?o[Mn.equals](a):Mn.hasInstance(a)?a[Mn.equals](o):Object.is(o,a),o=>Mn.hasInstance(o)?o[Mn.hash]():sv(o)),n.structuralEqualer=t((o,a)=>In.hasInstance(o)?o[In.structuralEquals](a,n.structuralEqualer):In.hasInstance(a)?a[In.structuralEquals](o,n.structuralEqualer):n.defaultEqualer.equals(o,a),o=>In.hasInstance(o)?o[In.structuralHash](n.structuralEqualer):n.defaultEqualer.hash(o)),n.tupleEqualer=t((o,a)=>{if(o!=null&&!Array.isArray(o)||a!=null&&!Array.isArray(a))throw new TypeError("Array expected");if(o===a)return!0;if(!o||!a||o.length!==a.length)return!1;for(let u=0;u<o.length;u++)if(!n.defaultEqualer.equals(o[u],a[u]))return!1;return!0},o=>{if(o==null)return 0;if(!Array.isArray(o))throw new TypeError("Array expected");let a=0;for(let u of o)a=i(a,n.defaultEqualer.hash(u));return a}),n.tupleStructuralEqualer=t((o,a)=>{if(o!=null&&!Array.isArray(o)||a!=null&&!Array.isArray(a))throw new TypeError("Array expected");if(o===a)return!0;if(!o||!a||o.length!==a.length)return!1;for(let u=0;u<o.length;u++)if(!n.structuralEqualer.equals(o[u],a[u]))return!1;return!0},o=>{if(o==null)return 0;if(!Array.isArray(o))throw new TypeError("Array expected");let a=0;for(let u of o)a=i(a,n.structuralEqualer.hash(u));return a});function t(o,a=n.defaultEqualer.hash){return Object.setPrototypeOf({equals:o,hash:a},e)}n.create=t;function i(o,a,u=7){if(typeof o!="number")throw new TypeError("Integer expected: x");if(typeof a!="number")throw new TypeError("Integer expected: y");if(typeof u!="number")throw new TypeError("Integer expected: rotate");if(isNaN(o)||!isFinite(o))throw new RangeError("Argument must be a finite number value: x");if(isNaN(a)||!isFinite(a))throw new RangeError("Argument must be a finite number value: y");if(isNaN(u)||!isFinite(u))throw new RangeError("Argument must be a finite number value: rotate");for(;u<0;)u+=32;for(;u>=32;)u-=32;return(o<<u|o>>>32-u)^a}n.combineHashes=i;function s(o){return typeof o=="object"&&o!==null&&typeof o.equals=="function"&&typeof o.hash=="function"}n.hasInstance=s,Object.defineProperty(n,Symbol.hasInstance,{configurable:!0,writable:!0,value:s})})(vi||(vi={}));var hF=vi.defaultEqualer,dF=vi.structuralEqualer,pF=vi.tupleEqualer,gF=vi.tupleEqualer,mF=vi.combineHashes,en;(function(n){let e=Object.defineProperty({},Symbol.toStringTag,{configurable:!0,value:"Comparer"});n.defaultComparer=t((s,o)=>Ns.hasInstance(s)?s[Ns.compareTo](o):Ns.hasInstance(o)?-o[Ns.compareTo](s):s<o?-1:s>o?1:0),n.structuralComparer=t((s,o)=>Bs.hasInstance(s)?s[Bs.structuralCompareTo](o,n.structuralComparer):Bs.hasInstance(o)?-o[Bs.structuralCompareTo](s,n.structuralComparer):n.defaultComparer.compare(s,o)),n.tupleComparer=t((s,o)=>{if(s!=null&&!Array.isArray(s)||o!=null&&!Array.isArray(o))throw new TypeError("Array expected");let a;if(a=n.defaultComparer.compare(s.length,o.length))return a;for(let u=0;u<s.length;u++)if(a=n.defaultComparer.compare(s[u],o[u]))return a;return 0}),n.tupleStructuralComparer=t((s,o)=>{if(s!=null&&!Array.isArray(s)||o!=null&&!Array.isArray(o))throw new TypeError("Array expected");let a;if(a=n.defaultComparer.compare(s.length,o.length))return a;for(let u=0;u<s.length;u++)if(a=n.structuralComparer.compare(s[u],o[u]))return a;return 0});function t(s){return Object.setPrototypeOf({compare:s},e)}n.create=t;function i(s){return typeof s=="object"&&s!==null&&typeof s.compare=="function"}n.hasInstance=i,Object.defineProperty(n,Symbol.hasInstance,{configurable:!0,writable:!0,value:i})})(en||(en={}));var xF=en.defaultComparer,yF=en.structuralComparer,EF=en.tupleComparer,_F=en.tupleStructuralComparer;function sv(n){return a0(n)}var u0,Yl=function(){var n={exports:{}};return function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function s(o,a,u){if(o.length===0)return-1;let l=0,c=o.length-1;for(;l<=c;){let f=l+(c-l>>1),h=o[f];switch(Math.sign(u.compare(h,a))){case-1:l=f+1;break;case 0:return f;case 1:c=f-1;break}}return~l}t.binarySearch=s}(n,n.exports,null),n.exports}(),Zl=class{constructor(...e){this._keys=[],this._values=[];let t,i;if(e.length>0){let s=e[0];s===void 0||s!=null&&Symbol.iterator in Object(s)?(t=s,e.length>1&&(i=e[1])):i=s}if(i??(i=en.defaultComparer),this._comparer=typeof i=="function"?en.create(i):i,t)for(let[s,o]of t)this.set(s,o)}get comparer(){return this._comparer}get size(){return this._keys.length}has(e){return(0,Yl.binarySearch)(this._keys,e,this._comparer)>=0}get(e){let t=(0,Yl.binarySearch)(this._keys,e,this._comparer);return t>=0?this._values[t]:void 0}set(e,t){let i=(0,Yl.binarySearch)(this._keys,e,this._comparer);return i>=0?this._values[i]=t:(this._keys.splice(~i,0,e),this._values.splice(~i,0,t)),this}delete(e){let t=(0,Yl.binarySearch)(this._keys,e,this._comparer);return t>=0?(this._keys.splice(t,1),this._values.splice(t,1),!0):!1}clear(){this._keys.length=0,this._values.length=0}keys(){return this._keys.values()}values(){return this._values.values()}*entries(){for(let e=0;e<this._keys.length;e++)yield[this._keys[e],this._values[e]]}[Symbol.iterator](){return this.entries()}forEach(e,t){if(typeof e!="function")throw new TypeError("Function expected: callback");for(let[i,s]of this)e.call(t,s,i,this)}get[sr.size](){return this.size}[sr.has](e){return this.has(e)}[sr.get](e){return this.get(e)}[sr.set](e,t){this.set(e,t)}[sr.delete](e){return this.delete(e)}[sr.clear](){this.clear()}[sr.keys](){return this.keys()}[sr.values](){return this.values()}};u0=Zl;Object.defineProperty(u0.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"SortedMap"});var Jl=we(We(),1);var $l=we(We(),1),uv=we(We(),1),lv=we(c0(),1);var f0=we(We(),1);var Ti=we(We(),1);var $e=we(We(),1);var v0=we(A0(),1);function tn(n){let e=(0,v0.default)(n);if(e.keyword!=null)return T.parse(e.keyword.toString());if(e!=null){if(e.rgba!=null)return new T(e.rgba[3],e.rgba[0],e.rgba[1],e.rgba[2]);if(e.rgb!=null)return T.mkRGB(e.rgb[0],e.rgb[1],e.rgb[2])}return T.Black}function cd(n,e,t){for(let s of t.attr_list)if(s.type==="attr"){let o=s.eq;switch(s.id){case"edgeCurve":{let a=xa(n),u=JSON.parse(o);a.curve=(0,Y.JSONToICurve)(u)}break;case"graphBoundingBox":{let a=xa(n),u=JSON.parse(o);a.boundingBox=new Y.Rectangle(u)}break;case"boundaryCurve":{let a=xa(n),u=JSON.parse(o),l=(0,Y.JSONToICurve)(u);a instanceof Y.GeomGraph?a.boundingBox=l.boundingBox:a.boundaryCurve=l}break;case"sourceArrowhead":{let a=xa(n);a.sourceArrowhead==null&&(a.sourceArrowhead=new Y.Arrowhead),a.sourceArrowhead.tipPosition=Y.Point.fromJSON(JSON.parse(o));break}case"targetArrowhead":{let a=xa(n);a.targetArrowhead==null&&(a.targetArrowhead=new Y.Arrowhead),a.targetArrowhead.tipPosition=Y.Point.fromJSON(JSON.parse(o));break}case"geomEdgeLabel":{let a=JSON.parse(o),u=n;i(u),new Y.GeomLabel(u.label,new Y.Rectangle(a)).setBoundingBox(new Y.Rectangle(a));break}case"color":e.color=tn(o);break;case"pencolor":e.pencolor=tn(o);break;case"labelfontcolor":e.labelfontcolor=tn(o);break;case"fontcolor":e.fontColor=tn(o);break;case"fillcolor":e.fillColor=tn(o);break;case"style":for(let a of zv(o))e.styles.push(a);break;case"shape":{let a=e;a.shape=Vv(o);break}case"peripheries":e.peripheries=parseInt(o);break;case"headlabel":e.headlabel=o;break;case"label":if(typeof o=="string"){let a="\\n",u=0;e.labelText="";do{let l=o.indexOf(a,u);if(l>=0)e.labelText+=o.substring(u,l)+`
`,u=l+2;else{e.labelText+=o.substring(u);break}}while(!0)}else typeof o=="number"&&(e.labelText=o.toString());n instanceof Y.Edge&&i(n);break;case"size":e.size=ld(o);break;case"pos":e.pos=ld(o);break;case"rankdir":e.rankdir=jv(o);break;case"fontname":e.fontname=o;break;case"fontsize":e.fontsize=parseFloat(o);break;case"width":e.width=parseFloat(o);break;case"penwidth":e.penwidth=parseFloat(o);break;case"height":e.height=parseFloat(o);break;case"margin":e.margin=parseFloat(o);break;case"len":e.len=parseFloat(o);break;case"minlen":e.minlen=parseFloat(o);break;case"rank":e.rank=Wv(o);break;case"charset":e.charset=o;break;case"orientation":e.orientation=o;break;case"ratio":e.ratio=o;break;case"weight":e.weight=parseFloat(o);break;case"nodesep":e.nodesep=parseFloat(o);break;case"layersep":e.layersep=parseFloat(o);break;case"arrowsize":e.arrowsize=parseFloat(o);break;case"rotate":e.rotate=parseFloat(o);break;case"ranksep":e.ranksep=parseFloat(o);break;case"splines":e.splines=o==="true";break;case"overlap":e.overlap=o==="true";break;case"arrowtail":e.arrowtail=T0(o);break;case"taillabel":e.taillabel=o;break;case"arrowhead":e.arrowhead=T0(o);break;case"ordering":e.ordering=Hv(o);break;case"URL":e.URL=o;break;case"dir":e.dir=Xv(o);break;case"concentrate":e.concentrate=o==="true";break;case"compound":e.compound=o==="true";break;case"lhead":e.lhead=o;break;case"ltail":e.ltail=o;break;case"bgcolor":e.bgcolor=tn(o);break;case"center":e.center=o===!0||parseInt(o)===1;break;case"colorscheme":e.colorscheme=o;break;case"sides":e.sides=parseInt(o);break;case"distortion":e.distortion=parseFloat(o);break;case"skew":e.skew=parseFloat(o);break;case"bb":e.bb=qv(o);break;case"labelloc":e.labelloc=o;break;case"decorate":e.decorate=o==="true";break;case"tailclip":e.tailclip=o==="true";break;case"headclip":e.headclip=o==="true";break;case"constraint":e.constraint=o==="true";break;case"gradientangle":e.gradientangle=parseFloat(o);break;case"samehead":e.samehead=o;break;case"href":e.href=o;break;case"imagepath":e.imagepath=o;break;case"image":e.image=o;break;case"labeljust":e.labejust=o;break;case"layers":e.layers=o.split(",");break;case"layer":e.layer=o;break;case"f":e.f=parseFloat(o);break;case"nojustify":e.nojustify=o==="true";break;case"root":e.root=o==="true";break;case"page":e.page=ld(o);break;case"pname":e.pname=o;break;case"kind":e.kind=o;break;case"fname":e.fname=o;break;case"subkind":e.subkind=o;break;case"area":e.area=parseFloat(o);break;case"tailport":e.tailport=o;break;case"headport":e.headport=o;break;case"wt":e.wt=o;break;case"id":e instanceof He||(e.id=o);break;case"edgetooltip":e.edgetooltip=o;break;case"headtooltip":e.headtooltip=o;break;case"tailtooltip":e.tailtooltip=o;break;case"headURL":e.headURL=o;break;case"tailURL":e.tailURL=o;break;case"labelURL":e.labelURL=o;break;case"edgeurl":e.edgeurl=o;break;case"shapefile":e.shapefile=o;break;case"xlabel":e.xlabel=o;break;case"sametail":e.sametail=o;break;case"clusterrank":e.clusterRank=o;break;case"measuredTextSize":e.measuredTextSize=JSON.parse(o);break;default:break}}else throw new Error("unexpected type "+s.type);function i(s){s.label==null&&(s.label=new Y.Label(s))}}function Us(n,e){let t=de.getDrawingObj(e);n.attr_list!=null&&cd(e,t,n)}var fd=class{constructor(e){this.nodeMap=new Map;this.ast=e}parseEdge(e,t,i,s,o){let a,u;if(e.type==="node_id"){let c=e.id.toString();a=this.nodeMap.get(c),a==null?a=this.newNode(c,i,!1):this.tryToMoveToADeeperGraph(a,i)}else{let c=[];for(let f of e.children)if(f.type==="node_stmt")for(let h of this.parseEdge(f.node_id,t,i,s,o))c.push(h);else if(f.type!=="attr_stmt")throw new Error("not implemented");for(let f of e.children)if(f.type==="attr_stmt")for(let h of c)Us(f,h);return c}if(t.type==="node_id"){let c=t.id.toString();u=this.nodeMap.get(c),u==null?u=this.newNode(c,i,!1):this.tryToMoveToADeeperGraph(u,i)}else if(t.type==="subgraph"){let c=new Array;for(let f of t.children)if(f.type==="node_stmt")for(let h of this.parseEdge(e,f.node_id,i,s,o))c.push(h);else if(f.type!=="attr_stmt")throw new Error("not implemented");for(let f of t.children)if(f.type==="attr_stmt")for(let h of c)Us(f,h);return c}let l=new Y.Edge(a,u);return new ir(l,s),Us(o,l),[l]}tryToMoveToADeeperGraph(e,t){Y.Assert.assert(e.parent!=null);let i=e.parent;i!=t&&s(i)<s(t)&&(i.remove(e),t.addNode(e));function s(o){let a=0,u=o.parent;for(;u;)a++,u=u.parent;return a}}newNode(e,t,i){let s=this.nodeMap.get(e);if(s==null){s=new Y.Node(e),this.nodeMap.set(e,s),t.addNode(s);let o=new He(s);o.labelText=e;let a=Ie.getDrawingObj(t);de.copyValidFields(a.defaultNodeObject,o)}else i&&(0,Y.setNewParent)(t,s);return s}parseNode(e,t,i){let s=e.node_id.id.toString(),o=this.newNode(s,t,i);return de.getDrawingObj(o)==null&&new He(o),Us(e,o),o}parse(){return this.ast==null?null:(this.graph=new Y.Graph(this.ast[0].id?this.ast[0].id.toString():"__graph__"),this.drawingGraph=new Ie(this.graph),this.parseUnderGraph(this.ast[0].children,this.graph,this.ast[0].type==="digraph",!1),Zv(this.graph),Kv(this.graph),this.graph)}parseGraphAttr(e,t){if(e.target==="node"){let i=Ie.getDrawingObj(t);i.defaultNodeObject==null&&(i.defaultNodeObject=new He(null)),cd(null,i.defaultNodeObject,e)}else e.target==="graph"&&Us(e,t)}getEntitiesSubg(e,t,i){let s=[];for(let o of e.children)if(o.type==="edge_stmt")for(let a=0;a<o.edge_list.length-1;a++)for(let u of this.parseEdge(o.edge_list[a],o.edge_list[a+1],t,i,o))s.push(u);else if(o.type!=="attr_stmt")if(o.type==="node_stmt")s.push(this.parseNode(o,t,!0));else if(o.type==="subgraph")if(o.id!=null){let a=new Y.Graph(o.id.toString());t.addNode(a),this.nodeMap.set(a.id,a);let u=new Ie(a);this.parseUnderGraph(o.children,a,i,!0),s.push(u.graph),a.isEmpty&&(t.removeNode(a),this.nodeMap.delete(a.id))}else s=s.concat(this.getEntitiesSubg(o,t,i));else throw new Error("Function not implemented.");return s}parseUnderGraph(e,t,i,s){for(let o of e)switch(o.type){case"node_stmt":this.parseNode(o,t,s);break;case"edge_stmt":{let a=o.edge_list;for(let u=0;u<a.length-1;u++)this.parseEdge(a[u],a[u+1],t,i,o)}break;case"subgraph":if(!this.process_same_rank(o,Ie.getDrawingGraph(t)))if(o.id==null){let a=this.getEntitiesSubg(o,t,i);Yv(o,Ie.getDrawingGraph(t),a)}else{let a=new Y.Graph(o.id.toString());this.nodeMap.set(o.id.toString(),a),t.addNode(a),new Ie(a),this.parseUnderGraph(o.children,a,i,!0),a.isEmpty()&&(t.remove(a),this.nodeMap.delete(a.id))}break;case"attr_stmt":this.parseGraphAttr(o,t);break;default:throw new Error("not implemented")}}process_same_rank(e,t){let i=e.children[0];if(i==null||i.type!=="attr_stmt")return!1;let s=i.attr_list;if(s==null||s.length===0)return!1;let o=s[0];if(o.type!=="attr"||o.id!=="rank")return!1;switch(o.eq){case"min":for(let a=1;a<e.children.length;a++){let u=e.children[a];if(u.type==="node_stmt")t.graphVisData.minRanks.push(u.node_id.id.toString());else throw new Error}return!0;case"max":for(let a=1;a<e.children.length;a++){let u=e.children[a];if(u.type==="node_stmt")t.graphVisData.minRanks.push(u.node_id.id.toString());else throw new Error}return!0;case"same":{let a=[];for(let u=1;u<e.children.length;u++){let l=e.children[u];l.type==="node_stmt"?(this.newNode(l.node_id.id.toString(),t.graph,!1),a.push(l.node_id.id.toString())):l.type==="attr_stmt"&&l.target==="node"&&(t.defaultNodeObject==null&&(t.defaultNodeObject=new He(null)),cd(null,t.defaultNodeObject,l))}return t.graphVisData.sameRanks.push(a),!0}case"source":{for(let a=1;a<e.children.length;a++){let u=e.children[a];if(u.type==="node_stmt")t.graphVisData.sourceRanks.push(u.node_id.id.toString());else throw new Error}return!0}case"sink":for(let a=1;a<e.children.length;a++){let u=e.children[a];if(u.type==="node_stmt")t.graphVisData.sinkRanks.push(u.node_id.id.toString());else throw new Error}return!0;default:throw new Error("incorrect rank")}}};function Uv(n){try{return new fd([n]).parse()}catch(e){return console.log(e.message),null}}function*zv(n){let e=n.split(",");for(let t of e){let s=sa[t];s&&(yield s)}}function Vv(n){let e=n.toLowerCase();return Ir[e]}function ld(n){let e=n.split(",");return[parseFloat(e[0]),parseFloat(e[1])]}function jv(n){return Y.LayerDirectionEnum[n]}function Wv(n){return Ul[n]}function T0(n){return nr[n]}function Hv(n){return Vl[n]}function Xv(n){return zl[n]}function qv(n){let e=n.split(",");return[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])]}function Yv(n,e,t){for(let i of n.children)if(i.type==="attr_stmt")for(let s of t)Us(i,s)}function Zv(n){let e=[];for(let t of n.subgraphsBreadthFirst())t.isEmpty()&&e.push(t);for(let t of e){let i=t.parent;i&&i.removeNode(t)}}function Kv(n){for(let e of n.subgraphsBreadthFirst())Y.GeomGraph.getGeom(e)==null&&e.hasSomeAttrOnIndex(Y.AttributeRegistry.GeomObjectIndex)&&new Y.GeomGraph(e);Y.GeomGraph.getGeom(n)==null&&n.hasSomeAttrOnIndex(Y.AttributeRegistry.GeomObjectIndex)&&new Y.GeomGraph(n)}function ya(n){let e=sT(n);return{type:nT(n),id:n.id,children:Jv(n,e)}}function $v(n){return{type:"edge_stmt",edge_list:[{type:"node_id",id:n.source.id},{type:"node_id",id:n.target.id}],attr_list:Array.from(Qv(n))}}function Jv(n,e){let t=new Map,i=[],s=Y.GeomGraph.getGeom(n);if(s){let o=Array.from(S0(s));i.push({type:"attr_stmt",target:"graph",attr_list:o})}aT(i,n);for(let o of n.nodesBreadthFirst)t.set(o.id,eT(o));for(let o of n.nodesBreadthFirst){if(o.parent===n)continue;t.get(o.parent.id).children.push(t.get(o.id))}for(let o of n.deepEdges){let a=$v(o),u=iT(o,e);u===n?i.push(a):t.get(u.id).children.push(a)}for(let o of n.shallowNodes)i.push(t.get(o.id));return i}function*Qv(n){let e=Y.GeomObject.getGeom(n);if(e&&e.curve&&(yield{type:"attr",id:"edgeCurve",eq:JSON.stringify((0,Y.iCurveToJSON)(e.curve))},e.sourceArrowhead&&(yield{type:"attr",id:"sourceArrowhead",eq:JSON.stringify(e.sourceArrowhead.tipPosition.toJSON())}),e.targetArrowhead&&(yield{type:"attr",id:"targetArrowhead",eq:JSON.stringify(e.targetArrowhead.tipPosition.toJSON())}),n.label)){let t=n.label.getAttr(Y.AttributeRegistry.GeomObjectIndex).boundingBox,i={left:t.left,right:t.right,top:t.top,bottom:t.bottom};yield{type:"attr",id:"geomEdgeLabel",eq:JSON.stringify(i)}}yield*hd(de.getDrawingObj(n))}function eT(n){if(n instanceof Y.Graph){let t=Array.from(S0(Y.GeomGraph.getGeom(n))),i=[],s={type:"attr_stmt",target:"graph",attr_list:t};return i.push(s),{type:"subgraph",children:i,id:n.id}}else return{type:"node_stmt",node_id:{type:"node_id",id:n.id},attr_list:Array.from(rT(n))}}function tT(n){let e=Y.GeomNode.getGeom(n).boundaryCurve;return{type:"attr",id:"boundaryCurve",eq:JSON.stringify((0,Y.iCurveToJSON)(e))}}function*rT(n){Y.GeomObject.getGeom(n)&&(yield tT(n)),yield*hd(de.getDrawingObj(n))}function*hd(n){if(n.color&&n.color.keyword.toLowerCase()!=="black"&&(yield{type:"attr",id:"color",eq:n.color.toString()}),n.fillColor&&(yield{type:"attr",id:"fillColor",eq:n.fillColor.toString()}),n.labelfontcolor&&n.labelfontcolor.keyword.toLowerCase()!=="black"&&(yield{type:"attr",id:"labelfontcolor",eq:n.labelfontcolor.toString()}),!(n.labelText==null||n.labelText==="")&&n.entity&&n.labelText!==n.id&&(yield{type:"attr",id:"label",eq:n.labelText}),n.fontColor&&n.fontColor.keyword.toLowerCase()!=="black"&&(yield{type:"attr",id:"fontColor",eq:n.fontColor.toString()}),n.styles&&n.styles.length){let e=n.styles.map(t=>sa[t]).reduce((t,i)=>t.concat(","+i));yield{type:"attr",id:"style",eq:e}}n.pencolor&&n.pencolor.keyword!=="black"&&(yield{type:"attr",id:"pencolor",eq:n.pencolor.toString()}),n.penwidth&&n.penwidth!==1&&(yield{type:"attr",id:"penwidth",eq:n.penwidth.toString()}),n.rankdir&&(yield{type:"attr",id:"rankdir",eq:n.rankdir.toString()}),n.fontname&&n.fontname!==de.defaultLabelFontName&&(yield{type:"attr",id:"fontname",eq:n.fontname}),n.margin&&(yield{type:"attr",id:"margin",eq:n.margin.toString()}),n.fontsize&&n.fontsize!==de.defaultLabelFontSize&&(yield{type:"attr",id:"fontsize",eq:n.fontsize.toString()}),n.orientation&&(yield{type:"attr",id:"orientation",eq:n.orientation.toString()}),n.ranksep&&(yield{type:"attr",id:"ranksep",eq:n.ranksep.toString()}),n.arrowtail&&(yield{type:"attr",id:"arrowtail",eq:nr[n.arrowtail]}),n.arrowhead&&(yield{type:"attr",id:"arrowhead",eq:nr[n.arrowhead]}),n.ordering&&(yield{type:"attr",id:"ordering",eq:n.ordering.toString()}),n.bgcolor&&(yield{type:"attr",id:"bgcolor",eq:n.bgcolor.toString()}),n.pos&&(yield{type:"attr",id:"pos",eq:n.pos.toString()}),n.nodesep&&(yield{type:"attr",id:"nodesep",eq:n.nodesep.toString()}),n.arrowsize&&(yield{type:"attr",id:"arrowsize",eq:n.arrowsize.toString()}),n.samehead&&(yield{type:"attr",id:"samehead",eq:n.samehead.toString()}),n.layersep&&(yield{type:"attr",id:"layersep",eq:n.layersep.toString()}),n.clusterRank&&(yield{type:"attr",id:"clusterrank",eq:n.clusterRank.toString()}),n.measuredTextSize&&(yield{type:"attr",id:"measuredTextSize",eq:JSON.stringify(n.measuredTextSize)}),n instanceof He&&(n.shape&&n.shape!==2&&(yield{type:"attr",id:"shape",eq:n.shape.toString()}),n.xRad&&n.xRad!==3&&(yield{type:"attr",id:"xRad",eq:n.xRad.toString()}),n.yRad&&n.yRad!==3&&(yield{type:"attr",id:"yRad",eq:n.yRad.toString()}),n.padding&&n.padding!==2&&(yield{type:"attr",id:"padding",eq:n.padding.toString()}))}function nT(n){return Ie.getDrawingGraph(n).hasDirectedEdge()?"digraph":"graph"}function iT(n,e){let t=n.source,i=n.target,s=e.get(t.id),o=e.get(i.id);for(;s>o;)t=t.parent,s--;for(;s<o;)i=i.parent,o--;for(;t.parent!==i.parent;)t=t.parent,i=i.parent;return t.parent}function sT(n){let e=new Map;return e.set(n.id,0),w0(n,e),e}function w0(n,e){let t=e.get(n.id)+1;for(let i of n.shallowNodes)e.set(i.id,t),i instanceof Y.Graph&&w0(i,e)}function xa(n){var e;return(e=Y.GeomObject.getGeom(n))!=null?e:oT(n)}function oT(n){if(n instanceof Y.Graph)return new Y.GeomGraph(n);if(n instanceof Y.Node)return new Y.GeomNode(n);if(n instanceof Y.Edge)return new Y.GeomEdge(n);throw new Error("unsupported type "+n)}function aT(n,e){let t=Ie.getDrawingObj(e);if(t==null)return;let i=t.defaultNodeObject;i&&n.push({type:"attr_stmt",target:"node",attr_list:Array.from(hd(i))})}function*S0(n){if(n==null)return;let e=n.boundingBox;if(e&&e.isEmpty()===!1){let t={left:e.left,right:e.right,top:e.top,bottom:e.bottom};yield{type:"attr",id:"graphBoundingBox",eq:JSON.stringify(t)}}n.radX!==10&&(yield{type:"attr",id:"radX",eq:n.radX.toString()}),n.radY!==10&&(yield{type:"attr",id:"radY",eq:n.radY.toString()})}function Ea(n){return"nodes"in n?uT(n):Uv(n)}function uT(n){let e=new Y.Graph;for(let t of n.nodes){let i=String(t.id),s=e.addNode(new Y.Node(i)),o=new He(s),{label:a=i,shape:u="box"}=t;o.labelText=a,o.ShapeEnum=Ir[u],"weight"in t&&(o.weight=t.weight),"color"in t&&(o.color=tn(t.color))}for(let t of n.edges){let i=e.setEdge(String(t.source),String(t.target)),s=new ir(i,!1),{arrowhead:o="none",arrowtail:a="none",directed:u=!0}=t;s.arrowhead=nr[o],s.arrowtail=nr[a],s.directed=u,"weight"in t&&(s.weight=t.weight),"color"in t&&(s.color=tn(t.color))}return new Ie(e),e}var zs=null,P0=!1;async function dd(n,e,t,i=!1){if(P0&&(zs.terminate(),zs=null),!zs){n=new URL(n,location.href).href;let s=`importScripts( "${n}" )`,o=URL.createObjectURL(new Blob([s],{type:"text/javascript"}));zs=new Worker(o)}return new Promise((s,o)=>{zs.onmessage=({data:a})=>{if(a.type==="error")o(a.message);else if(a.type==="layout-done")try{e=Ea(a.graph),console.debug("graph transfer to main thread",Date.now()-a.timestamp+" ms"),s(e)}catch(u){o(u.message)}},zs.postMessage({type:"layout",timestamp:Date.now(),graph:ya(e),options:t,forceUpdate:i}),P0=!0})}function _a(n,e,t=!1){let i=!1,s=t,o=Ie.getDrawingObj(n),a=xe.GeomGraph.getGeom(n);function u(l){if(!l)return;for(let h of l.subgraphs())u(h);let c=lT(o,l,e),f=cT(l.layoutSettings,c);s=s||f.layoutChanged,i=i||f.routingChanged,l.layoutSettings=c}if(u(a),s||i)for(let l of a.deepEdges)l.requireRouting();return s?(0,xe.layoutGeomGraph)(a,null):i&&(0,xe.routeEdges)(a,Array.from(a.deepEdges),null),n}function lT(n,e,t){let i=!1;for(let o of e.deepEdges)if(o.sourceArrowhead!=null||o.targetArrowhead!=null){i=!0;break}let s;switch(t.layoutType){case"Sugiyama LR":{let o=s=new xe.SugiyamaLayoutSettings;o.layerDirection=xe.LayerDirectionEnum.LR;break}case"Sugiyama RL":{let o=s=new xe.SugiyamaLayoutSettings;o.layerDirection=xe.LayerDirectionEnum.RL;break}case"Sugiyama TB":{let o=s=new xe.SugiyamaLayoutSettings;o.layerDirection=xe.LayerDirectionEnum.TB;break}case"Sugiyama BT":{let o=s=new xe.SugiyamaLayoutSettings;o.layerDirection=xe.LayerDirectionEnum.BT;break}case"MDS":s=new xe.MdsLayoutSettings;break;case"IPsepCola":s=new xe.FastIncrementalLayoutSettings;break;default:{let o=e.graph.shallowNodeCount>2001||e.graph.deepEdgesCount>4e3;if(i&&!o){let a=s=new xe.SugiyamaLayoutSettings;n&&n.rankdir&&(a.layerDirection=n.rankdir)}else s=new xe.FastIncrementalLayoutSettings}}return t.edgeRoutingMode==null?s instanceof xe.SugiyamaLayoutSettings?s.edgeRoutingSettings.EdgeRoutingMode=xe.EdgeRoutingMode.SugiyamaSplines:s.edgeRoutingSettings.EdgeRoutingMode=xe.EdgeRoutingMode.Spline:s.edgeRoutingSettings.EdgeRoutingMode=t.edgeRoutingMode,s}function cT(n,e){if(!n)return{layoutChanged:!0,routingChanged:!0};let t=n.commonSettings.edgeRoutingSettings.EdgeRoutingMode!==e.commonSettings.edgeRoutingSettings.EdgeRoutingMode,i=t&&e.commonSettings.edgeRoutingSettings.EdgeRoutingMode===xe.EdgeRoutingMode.SugiyamaSplines,s=n instanceof xe.SugiyamaLayoutSettings&&e instanceof xe.SugiyamaLayoutSettings&&n.layerDirection!=e.layerDirection;return{layoutChanged:n.constructor!==e.constructor||i||s,routingChanged:t}}var C0=we(We(),1),Vs=class{constructor(e={}){this.opts={fontFamily:"sans-serif",fontSize:16,lineHeight:1,fontStyle:"normal",fontWeight:"normal"};this.el=document.createElement("canvas"),this.ctx=this.el.getContext("2d"),this.measure=this.measure.bind(this),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e);let{fontFamily:t,fontSize:i,fontStyle:s,fontWeight:o}=this.opts;this.ctx.font=`${s} ${o} ${i}px ${t}`}measure(e,t){this.setOptions(t);let{fontSize:i,lineHeight:s}=this.opts,o=i*1.2,a=i*(s-1),u=0,l=e.split(`
`);for(let c of l){let f=this.ctx.measureText(c);u=Math.max(u,f.width)}return new C0.Size(u,l.length*o+(l.length-1)*a)}};var fT=we(We(),1);function ba(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ba(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){let t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(let s of t)if(!e.hasOwnProperty(s)||!ba(n[s],e[s]))return!1;return!0}return!1}function nc(){globalThis.onmessage=({data:n})=>{switch(n.type){case"layout":{let e=Ea(n.graph);console.debug("graph transfer to worker",Date.now()-n.timestamp+" ms"),(Ie.getDrawingObj(e)||new Ie(e)).createGeometry(),_a(e,n.options,n.forceUpdate),postMessage({type:"layout-done",timestamp:Date.now(),graph:ya(e)})}}},globalThis.onerror=n=>{postMessage({type:"Error",message:n.toString()})}}function Ln(n,e){if(!n)throw new Error(e||"loader assertion failed.")}var Lr={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},hT=Lr.self||Lr.window||Lr.global||{},dT=Lr.window||Lr.self||Lr.global||{},pT=Lr.global||Lr.self||Lr.window||{},gT=Lr.document||{};var Pi=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser);var M0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),mT=M0&&parseFloat(M0[1])||0;var I0="3.2.12";function ot(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}var Rr={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},WN=Rr.self||Rr.window||Rr.global||{},HN=Rr.window||Rr.self||Rr.global||{},XN=Rr.global||Rr.self||Rr.window||{},qN=Rr.document||{};var Ci=typeof process!="object"||String(process)!=="[object process]"||process.browser;var R0=typeof window<"u"&&typeof window.orientation<"u",L0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),YN=L0&&parseFloat(L0[1])||0;function m(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var Aa=class{constructor(e,t){m(this,"name",void 0),m(this,"workerThread",void 0),m(this,"isRunning",!0),m(this,"result",void 0),m(this,"_resolve",()=>{}),m(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ot(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ot(this.isRunning),this.isRunning=!1,this._reject(e)}};var js=class{};var pd=new Map;function D0(n){ot(n.source&&!n.url||!n.source&&n.url);let e=pd.get(n.source||n.url);return e||(n.url&&(e=xT(n.url),pd.set(n.url,e)),n.source&&(e=F0(n.source),pd.set(n.source,e))),ot(e),e}function xT(n){if(!n.startsWith("http"))return n;let e=yT(n);return F0(e)}function F0(n){let e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function yT(n){return`try {
  importScripts('`.concat(n,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function gd(n,e=!0,t){let i=t||new Set;if(n){if(O0(n))i.add(n);else if(O0(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(let s in n)gd(n[s],e,i)}}return t===void 0?Array.from(i):[]}function O0(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}var md=()=>{},Rn=class{static isSupported(){return typeof Worker<"u"&&Ci||typeof js<"u"&&!Ci}constructor(e){m(this,"name",void 0),m(this,"source",void 0),m(this,"url",void 0),m(this,"terminated",!1),m(this,"worker",void 0),m(this,"onMessage",void 0),m(this,"onError",void 0),m(this,"_loadableURL","");let{name:t,source:i,url:s}=e;ot(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=md,this.onError=o=>console.log(o),this.worker=Ci?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=md,this.onError=md,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||gd(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=D0({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){let i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new js(i,{eval:!1})}else if(this.source)e=new js(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}};var va=class{static isSupported(){return Rn.isSupported()}constructor(e){m(this,"name","unnamed"),m(this,"source",void 0),m(this,"url",void 0),m(this,"maxConcurrency",1),m(this,"maxMobileConcurrency",1),m(this,"onDebug",()=>{}),m(this,"reuseWorkers",!0),m(this,"props",{}),m(this,"jobQueue",[]),m(this,"idleQueue",[]),m(this,"count",0),m(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,o,a)=>s.done(a),i=(s,o)=>s.error(o)){let s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let i=new Aa(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Rn({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return R0?this.maxMobileConcurrency:this.maxConcurrency}};var ET={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Et=class{static isSupported(){return Rn.isSupported()}static getWorkerFarm(e={}){return Et._workerFarm=Et._workerFarm||new Et({}),Et._workerFarm.setProps(e),Et._workerFarm}constructor(e){m(this,"props",void 0),m(this,"workerPools",new Map),this.props={...ET},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:i,url:s}=e,o=this.workerPools.get(t);return o||(o=new va({name:t,source:i,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};m(Et,"_workerFarm",void 0);var _T="latest";function xd(n,e={}){let t=e[n.id]||{},i="".concat(n.id,"-worker.js"),s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(n.module,"/dist/").concat(i)),!s){let o=n.version;o==="latest"&&(o=_T);let a=o?"@".concat(o):"";s="https://unpkg.com/@loaders.gl/".concat(n.module).concat(a,"/dist/").concat(i)}return ot(s),s}function yd(n,e=I0){ot(n,"no worker provided");let t=n.version;return!(!e||!t)}function Ed(n,e){return!Et.isSupported()||!Ci&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&e?.worker}async function _d(n,e,t,i,s){let o=n.id,a=xd(n,t),l=Et.getWorkerFarm(t).getWorkerPool({name:o,url:a});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));let c=await l.startJob("process-on-worker",bT.bind(null,s));return c.postMessage("process",{input:e,options:t,context:i}),await(await c.result).result}async function bT(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":let{id:s,input:o,options:a}=i;try{let u=await n(o,a);e.postMessage("done",{id:s,result:u})}catch(u){let l=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:s,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function bd(n){return n&&typeof n=="object"&&n.isBuffer}function N0(n){return bd(n)?new Uint8Array(n.buffer,n.byteOffset,n.length).slice().buffer:n}function ic(n){if(bd(n))return N0(n);if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){let e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Ad(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;let i=new Uint8Array(n),s=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0}function vd(...n){let e=n.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,a)=>o+a.byteLength,0),i=new Uint8Array(t),s=0;for(let o of e)i.set(o,s),s+=o.byteLength;return i.buffer}async function Td(n){let e=[];for await(let t of n)e.push(t);return vd(...e)}function Ta(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){let e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}var Dn=class{constructor(e,t){m(this,"name",void 0),m(this,"type",void 0),m(this,"sampleSize",1),m(this,"time",void 0),m(this,"count",void 0),m(this,"samples",void 0),m(this,"lastTiming",void 0),m(this,"lastSampleTime",void 0),m(this,"lastSampleCount",void 0),m(this,"_count",0),m(this,"_time",0),m(this,"_samples",0),m(this,"_startTime",0),m(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Ta(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Ta()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Lt=class{constructor(e){m(this,"id",void 0),m(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(let e in this.stats)this.stats[e].reset();return this}forEach(e){for(let t in this.stats)e(this.stats[t])}getTable(){let e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;let{name:t,type:i}=e;return this.stats[t]||(e instanceof Dn?this.stats[t]=e:this.stats[t]=new Dn(t,i)),this.stats[t]}};var AT="Queued Requests",vT="Active Requests",TT="Cancelled Requests",wT="Queued Requests Ever",ST="Active Requests Ever",PT={id:"request-scheduler",throttleRequests:!0,maxRequests:6},Ws=class{constructor(e={}){m(this,"props",void 0),m(this,"stats",void 0),m(this,"activeRequestCount",0),m(this,"requestQueue",[]),m(this,"requestMap",new Map),m(this,"deferredUpdate",null),this.props={...PT,...e},this.stats=new Lt({id:this.props.id}),this.stats.get(AT),this.stats.get(vT),this.stats.get(TT),this.stats.get(wT),this.stats.get(ST)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let i={handle:e,priority:0,getPriority:t},s=new Promise(o=>(i.resolve=o,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){let{handle:t,resolve:i}=e,s=!1,o=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){let i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){let e=this.requestQueue;for(let t=0;t<e.length;++t){let i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}};var CT="",B0={};function wd(n){for(let e in B0)if(n.startsWith(e)){let t=B0[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n="".concat(CT).concat(n)),n}var sc={};zm(sc,{dirname:()=>IT,filename:()=>MT,join:()=>LT});function MT(n){let e=n&&n.lastIndexOf("/");return e>=0?n.substr(e+1):""}function IT(n){let e=n&&n.lastIndexOf("/");return e>=0?n.substr(0,e):""}function LT(...n){let e="/";return n=n.map((t,i)=>(i&&(t=t.replace(new RegExp("^".concat(e)),"")),i!==n.length-1&&(t=t.replace(new RegExp("".concat(e,"$")),"")),t)),n.join(e)}var RT=n=>typeof n=="boolean",wa=n=>typeof n=="function",Hs=n=>n!==null&&typeof n=="object",Sd=n=>Hs(n)&&n.constructor==={}.constructor;var k0=n=>n&&typeof n[Symbol.iterator]=="function",G0=n=>n&&typeof n[Symbol.asyncIterator]=="function";var or=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json;var ar=n=>typeof Blob<"u"&&n instanceof Blob,U0=n=>n&&typeof n=="object"&&n.isBuffer;var DT=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Hs(n)&&wa(n.tee)&&wa(n.cancel)&&wa(n.getReader);var FT=n=>Hs(n)&&wa(n.read)&&wa(n.pipe)&&RT(n.readable),oc=n=>DT(n)||FT(n);var OT=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,NT=/^([-\w.]+\/[-\w.+]+)/;function z0(n){let e=NT.exec(n);return e?e[1]:n}function Pd(n){let e=OT.exec(n);return e?e[1]:""}var BT=/\?.*/;function Mi(n){if(or(n)){let e=Cd(n.url||""),t=n.headers.get("content-type")||"";return{url:e,type:z0(t)||Pd(e)}}return ar(n)?{url:Cd(n.name||""),type:n.type||""}:typeof n=="string"?{url:Cd(n),type:Pd(n)}:{url:"",type:""}}function V0(n){return or(n)?n.headers["content-length"]||-1:ar(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}function Cd(n){return n.replace(BT,"")}async function ac(n){if(or(n))return n;let e={},t=V0(n);t>=0&&(e["content-length"]=String(t));let{url:i,type:s}=Mi(n);s&&(e["content-type"]=s);let o=await GT(n);o&&(e["x-first-bytes"]=o),typeof n=="string"&&(n=new TextEncoder().encode(n));let a=new Response(n,{headers:e});return Object.defineProperty(a,"url",{value:i}),a}async function j0(n){if(!n.ok){let e=await kT(n);throw new Error(e)}}async function kT(n){let e="Failed to fetch resource ".concat(n.url," (").concat(n.status,"): ");try{let t=n.headers.get("Content-Type"),i=n.statusText;t.includes("application/json")&&(i+=" ".concat(await n.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function GT(n){if(typeof n=="string")return"data:,".concat(n.slice(0,5));if(n instanceof Blob){let t=n.slice(0,5);return await new Promise(i=>{let s=new FileReader;s.onload=o=>{var a;return i(o==null||(a=o.target)===null||a===void 0?void 0:a.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){let t=n.slice(0,5),i=UT(t);return"data:base64,".concat(i)}return null}function UT(n){let e="",t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}async function Md(n,e){if(typeof n=="string"){n=wd(n);let t=e;return e!=null&&e.fetch&&typeof e?.fetch!="function"&&(t=e.fetch),await fetch(n,t)}return await ac(n)}function Sa(n){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;let e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=n||e;return!!(t&&t.indexOf("Electron")>=0)}function Xe(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Sa()}var Fn={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process};var zT=Fn.self||Fn.window||Fn.global,Xs=Fn.window||Fn.self||Fn.global,VT=Fn.document||{},Ii=Fn.process||{};var uc=typeof __VERSION__<"u"?__VERSION__:"untranspiled source",LB=Xe();var Id=globalThis;function qs(n){if(!n&&!Xe())return"Node";if(Sa(n))return"Electron";let t=n||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";let i=t.indexOf("MSIE ")!==-1,s=t.indexOf("Trident/")!==-1;return i||s?"IE":Id.chrome?"Chrome":Id.safari?"Safari":Id.mozInnerScreenX?"Firefox":"Unknown"}function jT(n){try{let e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}var Pa=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";m(this,"storage",void 0),m(this,"id",void 0),m(this,"config",{}),this.storage=jT(i),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){let t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let e={};if(this.storage){let t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function W0(n){let e;return n<10?e="".concat(n.toFixed(2),"ms"):n<100?e="".concat(n.toFixed(1),"ms"):n<1e3?e="".concat(n.toFixed(0),"ms"):e="".concat((n/1e3).toFixed(2),"s"),e}function H0(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,t=Math.max(e-n.length,0);return"".concat(" ".repeat(t)).concat(n)}function lc(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,s=n.src.replace(/\(/g,"%28").replace(/\)/g,"%29");n.width>i&&(t=Math.min(t,i/n.width));let o=n.width*t,a=n.height*t,u=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(s,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),u]}var cc;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(cc||(cc={}));function X0(n){return typeof n=="string"?cc[n.toUpperCase()]||cc.WHITE:n}function q0(n,e,t){return!Xe&&typeof n=="string"&&(e&&(e=X0(e),n="\x1B[".concat(e,"m").concat(n,"\x1B[39m")),t&&(e=X0(t),n="\x1B[".concat(t+10,"m").concat(n,"\x1B[49m"))),n}function Y0(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t);for(let s of i)typeof n[s]=="function"&&(e.find(o=>s===o)||(n[s]=n[s].bind(n)))}function Ys(n,e){if(!n)throw new Error(e||"Assertion failed")}function Li(){let n;if(Xe&&"performance"in Xs){var e,t;n=Xs===null||Xs===void 0||(e=Xs.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Ii){var i;let s=Ii===null||Ii===void 0||(i=Ii.hrtime)===null||i===void 0?void 0:i.call(Ii);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}var Zs={debug:Xe&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},WT={enabled:!0,level:0};function Xt(){}var Z0={},K0={once:!0},at=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};m(this,"id",void 0),m(this,"VERSION",uc),m(this,"_startTs",Li()),m(this,"_deltaTs",Li()),m(this,"_storage",void 0),m(this,"userData",{}),m(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new Pa("__probe-".concat(this.id,"__"),WT),this.userData={},this.timeStamp("".concat(this.id," started")),Y0(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Li()-this._startTs).toPrecision(10))}getDelta(){return Number((Li()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Ys(e,t)}warn(e){return this._getLogFunction(0,e,Zs.warn,arguments,K0)}error(e){return this._getLogFunction(0,e,Zs.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Zs.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Zs.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];return this._getLogFunction(e,t,Zs.debug||Zs.info,arguments,K0)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Xt,i&&[i],{tag:YT(t)}):Xt}image(e){let{logLevel:t,priority:i,image:s,message:o="",scale:a=1}=e;return this._shouldLog(t||i)?Xe?qT({image:s,message:o,scale:a}):XT({image:s,message:o,scale:a}):Xt}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Xt)}group(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},s=$0({logLevel:e,message:t,opts:i}),{collapsed:o}=i;return s.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Xt)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=J0(e)}_getLogFunction(e,t,i,s,o){if(this._shouldLog(e)){o=$0({logLevel:e,message:t,args:s,opts:o}),i=i||o.method,Ys(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Li();let a=o.tag||o.message;if(o.once)if(!Z0[a])Z0[a]=Li();else return Xt;return t=HT(this.id,o.message,o),i.bind(console,t,...o.args)}return Xt}};m(at,"VERSION",uc);function J0(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Ys(Number.isFinite(e)&&e>=0),e}function $0(n){let{logLevel:e,message:t}=n;n.logLevel=J0(e);let i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break;default:}typeof n.message=="function"&&(n.message=n.message());let s=typeof n.message;return Ys(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function HT(n,e,t){if(typeof e=="string"){let i=t.time?H0(W0(t.total)):"";e=t.time?"".concat(n,": ").concat(i,"  ").concat(e):"".concat(n,": ").concat(e),e=q0(e,t.color,t.background)}return e}function XT(n){let{image:e,message:t="",scale:i=1}=n,s=null;try{s=module.require("asciify-image")}catch{}return s?()=>s(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then(o=>console.log(o)):Xt}function qT(n){let{image:e,message:t="",scale:i=1}=n;if(typeof e=="string"){let o=new Image;return o.onload=()=>{let a=lc(o,t,i);console.log(...a)},o.src=e,Xt}let s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...lc(e,t,i)),Xt;if(s.toLowerCase()==="canvas"){let o=new Image;return o.onload=()=>console.log(...lc(o,t,i)),o.src=e.toDataURL(),Xt}return Xt}function YT(n){for(let e in n)for(let t in n[e])return t||"untitled";return"empty"}var c4=new at({id:"@probe.gl/log"});var Ld=new at({id:"loaders.gl"}),fc=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},hc=class{constructor(){m(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};var Rd={fetch:null,mimeType:void 0,nothrow:!1,log:new hc,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Pi,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Q0={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Dd(){globalThis.loaders=globalThis.loaders||{};let{loaders:n}=globalThis;return n._state=n._state||{},n._state}var r1=()=>{let n=Dd();return n.globalOptions=n.globalOptions||{...Rd},n.globalOptions};function n1(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],ZT(n,t),$T(e,n,i)}function dc(n,e){let t=r1(),i=n||t;return typeof i.fetch=="function"?i.fetch:Hs(i.fetch)?s=>Md(s,i):e!=null&&e.fetch?e?.fetch:Md}function ZT(n,e){e1(n,null,Rd,Q0,e);for(let t of e){let i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};e1(i,t.id,s,o,e)}}function e1(n,e,t,i,s){let o=e||"Top level",a=e?"".concat(e,"."):"";for(let u in n){let l=!e&&Hs(n[u]),c=u==="baseUri"&&!e,f=u==="workerUrl"&&e;if(!(u in t)&&!c&&!f){if(u in i)Ld.warn("".concat(o," loader option '").concat(a).concat(u,"' no longer supported, use '").concat(i[u],"'"))();else if(!l){let h=KT(u,s);Ld.warn("".concat(o," loader option '").concat(a).concat(u,"' not recognized. ").concat(h))()}}}}function KT(n,e){let t=n.toLowerCase(),i="";for(let s of e)for(let o in s.options){if(n===o)return"Did you mean '".concat(s.id,".").concat(o,"'?");let a=o.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(i=i||"Did you mean '".concat(s.id,".").concat(o,"'?"))}return i}function $T(n,e,t){let s={...n.options||{}};return JT(s,t),s.log===null&&(s.log=new fc),t1(s,r1()),t1(s,e),s}function t1(n,e){for(let t in e)if(t in e){let i=e[t];Sd(i)&&Sd(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function JT(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Ca(n){var e;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((e=n)===null||e===void 0?void 0:e.extensions)):!1}function Ma(n){var e,t;Ln(n,"null loader"),Ln(Ca(n),"invalid loader");let i;return Array.isArray(n)&&(i=n[1],n=n[0],n={...n,options:{...n.options,...i}}),((e=n)!==null&&e!==void 0&&e.parseTextSync||(t=n)!==null&&t!==void 0&&t.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}var i1=()=>{let n=Dd();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Fd(n){let e=i1();n=Array.isArray(n)?n:[n];for(let t of n){let i=Ma(t);e.find(s=>i===s)||e.unshift(i)}}function s1(){return i1()}var o1=new at({id:"loaders.gl"});var QT=/\.([^.]+)$/;async function l1(n,e=[],t,i){if(!c1(n))return null;let s=a1(n,e,{...t,nothrow:!0},i);if(s)return s;if(ar(n)&&(n=await n.slice(0,10).arrayBuffer(),s=a1(n,e,t,i)),!s&&!(t!=null&&t.nothrow))throw new Error(f1(n));return s}function a1(n,e=[],t,i){if(!c1(n))return null;if(e&&!Array.isArray(e))return Ma(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...s1()),tw(s);let o=ew(n,s,t,i);if(!o&&!(t!=null&&t.nothrow))throw new Error(f1(n));return o}function ew(n,e,t,i){let{url:s,type:o}=Mi(n),a=s||i?.url,u=null,l="";if(t!=null&&t.mimeType&&(u=Od(e,t?.mimeType),l="match forced by supplied MIME type ".concat(t?.mimeType)),u=u||rw(e,a),l=l||(u?"matched url ".concat(a):""),u=u||Od(e,o),l=l||(u?"matched MIME type ".concat(o):""),u=u||iw(e,n),l=l||(u?"matched initial data ".concat(h1(n)):""),u=u||Od(e,t?.fallbackMimeType),l=l||(u?"matched fallback MIME type ".concat(o):""),l){var c;o1.log(1,"selectLoader selected ".concat((c=u)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return u}function c1(n){return!(n instanceof Response&&n.status===204)}function f1(n){let{url:e,type:t}=Mi(n),i="No valid loader found (";i+=e?"".concat(sc.filename(e),", "):"no url provided, ",i+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");let s=n?h1(n):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function tw(n){for(let e of n)Ma(e)}function rw(n,e){let t=e&&QT.exec(e),i=t&&t[1];return i?nw(n,i):null}function nw(n,e){e=e.toLowerCase();for(let t of n)for(let i of t.extensions)if(i.toLowerCase()===e)return t;return null}function Od(n,e){for(let t of n)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function iw(n,e){if(!e)return null;for(let t of n)if(typeof e=="string"){if(sw(e,t))return t}else if(ArrayBuffer.isView(e)){if(u1(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&u1(e,0,t))return t;return null}function sw(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function u1(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>ow(n,e,t,s))}function ow(n,e,t,i){if(i instanceof ArrayBuffer)return Ad(i,n,i.byteLength);switch(typeof i){case"function":return i(n,t);case"string":let s=Nd(n,e,i.length);return i===s;default:return!1}}function h1(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Nd(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Nd(n,0,e):""}function Nd(n,e,t){if(n.byteLength<e+t)return"";let i=new DataView(n),s="";for(let o=0;o<t;o++)s+=String.fromCharCode(i.getUint8(e+o));return s}function*d1(n,e){let t=e?.chunkSize||262144,i=0,s=new TextEncoder;for(;i<n.length;){let o=Math.min(n.length-i,t),a=n.slice(i,i+o);i+=o,yield s.encode(a)}}function*p1(n,e={}){let{chunkSize:t=262144}=e,i=0;for(;i<n.byteLength;){let s=Math.min(n.byteLength-i,t),o=new ArrayBuffer(s),a=new Uint8Array(n,i,s);new Uint8Array(o).set(a),i+=s,yield o}}async function*g1(n,e){let t=e?.chunkSize||1048576,i=0;for(;i<n.size;){let s=i+t,o=await n.slice(i,s).arrayBuffer();i=s,yield o}}function Bd(n,e){return Pi?aw(n,e):uw(n,e)}async function*aw(n,e){let t=n.getReader(),i;try{for(;;){let s=i||t.read();e!=null&&e._streamReadAhead&&(i=t.read());let{done:o,value:a}=await s;if(o)return;yield ic(a)}}catch{t.releaseLock()}}async function*uw(n,e){for await(let t of n)yield ic(t)}function m1(n,e){if(typeof n=="string")return d1(n,e);if(n instanceof ArrayBuffer)return p1(n,e);if(ar(n))return g1(n,e);if(oc(n))return Bd(n,e);if(or(n))return Bd(n.body,e);throw new Error("makeIterator")}var x1="Cannot convert supplied data type";function lw(n,e,t){if(e.text&&typeof n=="string")return n;if(U0(n)&&(n=n.buffer),n instanceof ArrayBuffer){let i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer,s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(x1)}async function y1(n,e,t){let i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return lw(n,e,t);if(ar(n)&&(n=await ac(n)),or(n)){let s=n;return await j0(s),e.binary?await s.arrayBuffer():await s.text()}if(oc(n)&&(n=m1(n,t)),k0(n)||G0(n))return Td(n);throw new Error(x1)}function E1(n,e,t=null){if(t)return t;let i={fetch:dc(e,n),...n};return Array.isArray(i.loaders)||(i.loaders=null),i}function _1(n,e){if(!e&&n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){let i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:null}async function pc(n,e,t,i){ot(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Ca(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};let{url:s}=Mi(n),a=_1(e,i),u=await l1(n,a,t);return u?(t=n1(t,u,a,s),i=E1({url:s,parse:pc,loaders:a},t,i),await cw(u,n,t,i)):null}async function cw(n,e,t,i){if(yd(n),or(e)){let s=e,{ok:o,redirected:a,status:u,statusText:l,type:c,url:f}=s,h=Object.fromEntries(s.headers.entries());i.response={headers:h,ok:o,redirected:a,status:u,statusText:l,type:c,url:f}}if(e=await y1(e,n,t),n.parseTextSync&&typeof e=="string")return t.dataType="text",n.parseTextSync(e,t,i,n);if(Ed(n,t))return await _d(n,e,t,i,pc);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,i,n);if(n.parse)return await n.parse(e,t,i,n);throw ot(!n.parseSync),new Error("".concat(n.id," loader - no parser found and worker is disabled"))}async function Dr(n,e,t,i){!Array.isArray(e)&&!Ca(e)&&(i=void 0,t=e,e=void 0);let s=dc(t),o=n;return typeof n=="string"&&(o=await s(n)),ar(n)&&(o=await s(n)),await pc(o,e,t)}var b1="3.2.12";var{_parseImageNode:fw}=globalThis,kd=typeof Image<"u",Gd=typeof ImageBitmap<"u",hw=Boolean(fw),Ud=Pi?!0:hw;function A1(n){switch(n){case"auto":return Gd||kd||Ud;case"imagebitmap":return Gd;case"image":return kd;case"data":return Ud;default:throw new Error("@loaders.gl/images: image ".concat(n," not supported in this environment"))}}function v1(){if(Gd)return"imagebitmap";if(kd)return"image";if(Ud)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function dw(n){let e=pw(n);if(!e)throw new Error("Not an image");return e}function T1(n){switch(dw(n)){case"data":return n;case"image":case"imagebitmap":let e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function pw(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}var gw=/^data:image\/svg\+xml/,mw=/\.svg((\?|#).*)?$/;function gc(n){return n&&(gw.test(n)||mw.test(n))}function w1(n,e){if(gc(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return zd(n,e)}function zd(n,e){if(gc(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Ia(n,e,t){let i=w1(n,t),s=self.URL||self.webkitURL,o=typeof i!="string"&&s.createObjectURL(i);try{return await xw(o||i,e)}finally{o&&s.revokeObjectURL(o)}}async function xw(n,e){let t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=o=>s(new Error("Could not load image ".concat(n,": ").concat(o)))}catch(o){s(o)}})}var yw={},S1=!0;async function Vd(n,e,t){let i;gc(t)?i=await Ia(n,e,t):i=zd(n,t);let s=e&&e.imagebitmap;return await Ew(i,s)}async function Ew(n,e=null){if((_w(e)||!S1)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),S1=!1}return await createImageBitmap(n)}function _w(n){for(let e in n||yw)return!1;return!0}function mc(n){let e=La(n);return bw(e)||Tw(e)||Aw(e)||vw(e)}function bw(n){let e=La(n);return e.byteLength>=24&&e.getUint32(0,!1)===2303741511?{mimeType:"image/png",width:e.getUint32(16,!1),height:e.getUint32(20,!1)}:null}function Aw(n){let e=La(n);return e.byteLength>=10&&e.getUint32(0,!1)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}:null}function vw(n){let e=La(n);return e.byteLength>=14&&e.getUint16(0,!1)===16973&&e.getUint32(2,!0)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,!0),height:e.getUint32(22,!0)}:null}function Tw(n){let e=La(n);if(!(e.byteLength>=3&&e.getUint16(0,!1)===65496&&e.getUint8(2)===255))return null;let{tableMarkers:i,sofMarkers:s}=ww(),o=2;for(;o+9<e.byteLength;){let a=e.getUint16(o,!1);if(s.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,!1),width:e.getUint16(o+7,!1)};if(!i.has(a))return null;o+=2,o+=e.getUint16(o,!1)}return null}function ww(){let n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function La(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function jd(n,e){let{mimeType:t}=mc(n)||{},i=globalThis._parseImageNode;return Ln(i),await i(n,t)}async function Wd(n,e,t){e=e||{};let s=(e.image||{}).type||"auto",{url:o}=t||{},a=Sw(s),u;switch(a){case"imagebitmap":u=await Vd(n,e,o);break;case"image":u=await Ia(n,e,o);break;case"data":u=await jd(n,e);break;default:Ln(!1)}return s==="data"&&(u=T1(u)),u}function Sw(n){switch(n){case"auto":case"data":return v1();default:return A1(n),n}}var Pw=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],Cw=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Mw={image:{type:"auto",decode:!0}},Ri={id:"image",module:"images",name:"Images",version:b1,mimeTypes:Cw,extensions:Pw,parse:Wd,tests:[n=>Boolean(mc(new DataView(n)))],options:Mw};var $=new at({id:"deck"});var Hd={};function P1(n){Hd=n}function Fe(n,e,t,i){$.level>0&&Hd[n]&&Hd[n].call(null,e,t,i)}function Iw(n){let e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}var C1={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Iw,parseTextSync:JSON.parse};var Ra="8.8.20",xc=globalThis.deck&&globalThis.deck.VERSION;if(xc&&xc!==Ra)throw new Error("deck.gl - multiple versions detected: ".concat(xc," vs ").concat(Ra));xc||($.log(1,"deck.gl ".concat(Ra))(),globalThis.deck={...globalThis.deck,VERSION:Ra,version:Ra,log:$,_registerLoggers:P1},Fd([C1,[Ri,{imagebitmap:{premultiplyAlpha:"none"}}]]));var M1=globalThis.deck;var W=new at({id:"luma.gl"});function Be(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}var Lw="Invalid WebGLRenderingContext";var Rw="Requires WebGL2";function rn(n){return typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:Boolean(n&&Number.isFinite(n._version))}function Q(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:Boolean(n&&n._version===2)}function Xd(n){return Q(n)?n:null}function nn(n){return Be(rn(n),Lw),n}function ve(n){return Be(Q(n),Rw),n}var Da={};function Dw(n){globalThis.console&&globalThis.console.error&&globalThis.console.error(n)}function Fw(n){globalThis.console&&globalThis.console.log&&globalThis.console.log(n)}function Ow(n,e){Da[n]=!0,e!==void 0&&Dw(e)}function Nw(n){let e=n.getError;n.getError=function(){let i;do i=e.apply(n),i!==0&&(Da[i]=!0);while(i!==0);for(i in Da)if(Da[i])return delete Da[i],parseInt(i,10);return 0}}var Fa=function n(e){let t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){let s=new n.VertexAttrib(t);this.attribs[i]=s}this.maxAttrib=0};Fa.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Fa.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var Di=function(e){let t=this;this.gl=e,Nw(e);let i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){let a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);let u=a.attribs[o];return u.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){let a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);let u=a.attribs[o];return u.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,a){switch(o){case 34962:t.currentArrayBuffer=a;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=a;break;default:}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,a){let l=t.currentVertexArrayObject.attribs[o];switch(a){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,a,u,l,c,f){let h=t.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,o);let d=h.attribs[o];return d.buffer=t.currentArrayBuffer,d.size=a,d.type=u,d.normalized=l,d.stride=c,d.offset=f,d.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{Fw("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Di.prototype.VERTEX_ARRAY_BINDING_OES=34229;Di.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;let t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new Fa(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Di.prototype.createVertexArrayOES=function(){let e=new Fa(this);return this.vertexArrayObjects.push(e),e};Di.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Di.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Fa&&e.hasBeenBound&&e.ext===this)};Di.prototype.bindVertexArrayOES=function(e){let t=this.gl;if(e&&!e.isAlive){Ow(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}let i=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;let o=this.currentVertexArrayObject;if(s===o)return;(!s||o.elementArrayBuffer!==s.elementArrayBuffer)&&i.bindBuffer.call(t,34963,o.elementArrayBuffer);let a=this.currentArrayBuffer,u=Math.max(s?s.maxAttrib:0,o.maxAttrib);for(let l=0;l<=u;l++){let c=o.attribs[l],f=s?s.attribs[l]:null;if((!s||c.enabled!==f.enabled)&&(c.enabled?i.enableVertexAttribArray.call(t,l):i.disableVertexAttribArray.call(t,l)),c.enabled){let h=!1;(!s||c.buffer!==f.buffer)&&(a!==c.buffer&&(i.bindBuffer.call(t,34962,c.buffer),a=c.buffer),h=!0),(h||c.cached!==f.cached)&&i.vertexAttribPointer.call(t,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==a&&i.bindBuffer.call(t,34962,this.currentArrayBuffer)};function I1(n){if(typeof n.createVertexArray=="function")return;let e=n.getSupportedExtensions;n.getSupportedExtensions=function(){let s=e.call(this)||[];return s.indexOf("OES_vertex_array_object")<0&&s.push("OES_vertex_array_object"),s};let t=n.getExtension;n.getExtension=function(s){let o=t.call(this,s);return o||(s!=="OES_vertex_array_object"?null:(n.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Di(this)),this.__OESVertexArrayObject))}}var L1="OES_element_index",R1="WEBGL_draw_buffers",Bw="EXT_disjoint_timer_query",kw="EXT_disjoint_timer_query_webgl2",Gw="EXT_texture_filter_anisotropic",D1="WEBGL_debug_renderer_info",Uw=35723,zw=4352,Vw=36795,jw=34047,Ww=37445,Hw=37446,_e=n=>Q(n)?void 0:0,Xw={[3074]:n=>Q(n)?void 0:36064,[Uw]:n=>Q(n)?void 0:zw,[35977]:_e,[32937]:_e,[Vw]:(n,e)=>{let t=Q(n)?n.getExtension(kw):n.getExtension(Bw);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[Ww]:(n,e)=>{let t=n.getExtension(D1);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[Hw]:(n,e)=>{let t=n.getExtension(D1);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[jw]:(n,e)=>{let t=n.luma.extensions[Gw];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:_e,[35071]:_e,[37447]:_e,[36063]:(n,e)=>{if(!Q(n)){let t=n.getExtension(R1);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:_e,[35374]:_e,[35377]:_e,[34852]:n=>{if(!Q(n)){let e=n.getExtension(R1);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:n=>n.getExtension(L1)?2147483647:65535,[33001]:n=>n.getExtension(L1)?16777216:65535,[33e3]:n=>16777216,[37157]:_e,[35373]:_e,[35657]:_e,[36183]:_e,[37137]:_e,[34045]:_e,[35978]:_e,[35979]:_e,[35968]:_e,[35376]:_e,[35375]:_e,[35659]:_e,[37154]:_e,[35371]:_e,[35658]:_e,[35076]:_e,[35077]:_e,[35380]:_e};function F1(n,e,t){let i=Xw[t],s=typeof i=="function"?i(n,e,t):i;return s!==void 0?s:e(t)}var qw="OES_vertex_array_object",O1="ANGLE_instanced_arrays",Yw="WEBGL_draw_buffers",Zw="EXT_disjoint_timer_query",Kw="EXT_texture_filter_anisotropic",$w="VertexArray requires WebGL2 or OES_vertex_array_object extension";function Jw(n,e){return{webgl2:Q(n),ext:n.getExtension(e)}}var qd={[qw]:{meta:{suffix:"OES"},createVertexArray:()=>{Be(!1,$w)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[O1]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(n,e){Be(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[Yw]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Be(!1)}},[Zw]:{meta:{suffix:"EXT"},createQuery:()=>{Be(!1)},deleteQuery:()=>{Be(!1)},beginQuery:()=>{Be(!1)},endQuery:()=>{},getQuery(n,e){return this.getQueryObject(n,e)},getQueryParameter(n,e){return this.getQueryObject(n,e)},getQueryObject:()=>{}}},yc={readBuffer:(n,e,t)=>{Q(n)&&e(t)},getVertexAttrib:(n,e,t,i)=>{let{webgl2:s,ext:o}=Jw(n,O1),a;switch(i){case 35069:a=s?void 0:!1;break;case 35070:a=!s&&!o?0:void 0;break;default:}return a!==void 0?a:e(t,i)},getProgramParameter:(n,e,t,i)=>{if(!Q(n))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0;default:}return e(t,i)},getInternalformatParameter:(n,e,t,i,s)=>{if(!Q(n))switch(s){case 32937:return new Int32Array([0]);default:}return n.getInternalformatParameter(t,i,s)},getTexParameter(n,e,t,i){switch(i){case 34046:let{extensions:s}=n.luma,o=s[Kw];i=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break;default:}return e(t,i)},getParameter:F1,hint(n,e,t,i){return e(t,i)}};function N1(n){n.luma=n.luma||{};let{luma:e}=n;return e.polyfilled||(I1(n),Qw(n),tS(n,qd),eS(n,{target:e,target2:n}),e.polyfilled=!0),n}globalThis.polyfillContext=N1;function Qw(n){n.luma.extensions={};let e=n.getSupportedExtensions()||[];for(let t of e)n.luma[t]=n.getExtension(t)}function eS(n,e){let{target:t,target2:i}=e;Object.keys(yc).forEach(s=>{if(typeof yc[s]=="function"){let o=n[s]?n[s].bind(n):()=>{},a=yc[s].bind(null,n,o);t[s]=a,i[s]=a}})}function tS(n,e){for(let t of Object.getOwnPropertyNames(e))t!=="overrides"&&rS(n,{extension:t,target:n.luma,target2:n})}function rS(n,e){let{extension:t,target:i,target2:s}=e,o=qd[t];Be(o);let{meta:a={}}=o,{suffix:u=""}=a,l=n.getExtension(t);for(let c of Object.keys(o)){let f="".concat(c).concat(u),h=null;c==="meta"||typeof n[c]=="function"||(l&&typeof l[f]=="function"?h=function(){return l[f](...arguments)}:typeof o[c]=="function"&&(h=o[c].bind(i))),h&&(i[c]=h,s[c]=h)}}var Na={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},On=(n,e,t)=>e?n.enable(t):n.disable(t),B1=(n,e,t)=>n.hint(t,e),Rt=(n,e,t)=>n.pixelStorei(t,e),nS=(n,e)=>{let t=Q(n)?36009:36160;return n.bindFramebuffer(t,e)},iS=(n,e)=>n.bindFramebuffer(36008,e);function Oa(n){return Array.isArray(n)||ArrayBuffer.isView(n)}var k1={[3042]:On,[32773]:(n,e)=>n.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(n,e)=>n.clearColor(...e),[3107]:(n,e)=>n.colorMask(...e),[2884]:On,[2885]:(n,e)=>n.cullFace(e),[2929]:On,[2931]:(n,e)=>n.clearDepth(e),[2932]:(n,e)=>n.depthFunc(e),[2928]:(n,e)=>n.depthRange(...e),[2930]:(n,e)=>n.depthMask(e),[3024]:On,[35723]:B1,[36006]:nS,[2886]:(n,e)=>n.frontFace(e),[33170]:B1,[2849]:(n,e)=>n.lineWidth(e),[32823]:On,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:On,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:On,[3088]:(n,e)=>n.scissor(...e),[2960]:On,[2961]:(n,e)=>n.clearStencil(e),[2968]:(n,e)=>n.stencilMaskSeparate(1028,e),[36005]:(n,e)=>n.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(n,e)=>n.viewport(...e),[3333]:Rt,[3317]:Rt,[37440]:Rt,[37441]:Rt,[37443]:Rt,[3330]:Rt,[3332]:Rt,[3331]:Rt,[36010]:iS,[3314]:Rt,[32878]:Rt,[3316]:Rt,[3315]:Rt,[32877]:Rt,framebuffer:(n,e)=>{let t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{e=Oa(e)?e:[e,e],n.blendEquationSeparate(...e)},blendFunc:(n,e)=>{e=Oa(e)&&e.length===2?[...e,...e]:e,n.blendFuncSeparate(...e)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(...e),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Oa(e)?e:[e,e];let[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Oa(e)&&e.length===3?[...e,...e]:e;let[t,i,s,o,a,u]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,o,a,u)},stencilOp:(n,e)=>{e=Oa(e)&&e.length===3?[...e,...e]:e;let[t,i,s,o,a,u]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,o,a,u)},viewport:(n,e)=>n.viewport(...e)};function Oe(n,e,t){return e[n]!==void 0?e[n]:t[n]}var G1={blendEquation:(n,e,t)=>n.blendEquationSeparate(Oe(32777,e,t),Oe(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(Oe(32969,e,t),Oe(32968,e,t),Oe(32971,e,t),Oe(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(Oe(32824,e,t),Oe(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(Oe(32938,e,t),Oe(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,Oe(2962,e,t),Oe(2967,e,t),Oe(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,Oe(34816,e,t),Oe(36003,e,t),Oe(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,Oe(2964,e,t),Oe(2965,e,t),Oe(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,Oe(34817,e,t),Oe(34818,e,t),Oe(34819,e,t))},Yd={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({[36006]:t,[36010]:t});case 36009:return n({[36006]:t});case 36008:return n({[36010]:t});default:return null}},blendColor:(n,e,t,i,s)=>n({[32773]:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({[32777]:e,[34877]:e}),blendEquationSeparate:(n,e,t)=>n({[32777]:e,[34877]:t}),blendFunc:(n,e,t)=>n({[32969]:e,[32968]:t,[32971]:e,[32970]:t}),blendFuncSeparate:(n,e,t,i,s)=>n({[32969]:e,[32968]:t,[32971]:i,[32970]:s}),clearColor:(n,e,t,i,s)=>n({[3106]:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({[2931]:e}),clearStencil:(n,e)=>n({[2961]:e}),colorMask:(n,e,t,i,s)=>n({[3107]:[e,t,i,s]}),cullFace:(n,e)=>n({[2885]:e}),depthFunc:(n,e)=>n({[2932]:e}),depthRange:(n,e,t)=>n({[2928]:new Float32Array([e,t])}),depthMask:(n,e)=>n({[2930]:e}),frontFace:(n,e)=>n({[2886]:e}),lineWidth:(n,e)=>n({[2849]:e}),polygonOffset:(n,e,t)=>n({[32824]:e,[10752]:t}),sampleCoverage:(n,e,t)=>n({[32938]:e,[32939]:t}),scissor:(n,e,t,i,s)=>n({[3088]:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({[2968]:e,[36005]:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({[2962]:e,[2967]:t,[2963]:i,[34816]:e,[36003]:t,[36004]:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({[2964]:e,[2965]:t,[2966]:i,[34817]:e,[34818]:t,[34819]:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({[2978]:[e,t,i,s]})},Fr=(n,e)=>n.isEnabled(e),Zd={[3042]:Fr,[2884]:Fr,[2929]:Fr,[3024]:Fr,[32823]:Fr,[32926]:Fr,[32928]:Fr,[3089]:Fr,[2960]:Fr,[35977]:Fr};function Kd(n){for(let e in n)return!1;return!0}function U1(n,e){if(n===e)return!0;let t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}function z1(n,e){let t=n[e].bind(n);n[e]=function(){let s=arguments.length<=0?void 0:arguments[0];return s in n.state.cache?n.state.enable?n.state.cache[s]:t(...arguments):t(...arguments)},Object.defineProperty(n[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function sS(n,e,t){let i=n[e].bind(n);n[e]=function(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];let{valueChanged:l,oldValue:c}=t(n.state._updateCache,...a);return l&&i(...a),c},Object.defineProperty(n[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function oS(n){let e=n.useProgram.bind(n);n.useProgram=function(i){n.state.program!==i&&(e(i),n.state.program=i)}}var $d=class{constructor(e){let{copyState:t=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?bc(e):Object.assign({},Na),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.stateStack.push({})}pop(){Be(this.stateStack.length>0);let e=this.stateStack[this.stateStack.length-1];dt(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,i,s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(let o in e){Be(o!==void 0);let a=e[o],u=this.cache[o];U1(a,u)||(t=!0,i=u,s&&!(o in s)&&(s[o]=u),this.cache[o]=a)}return{valueChanged:t,oldValue:i}}};function Ec(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{enable:t=!0,copyState:i}=e;if(Be(i!==void 0),!n.state){let{polyfillContext:s}=globalThis;s&&s(n),n.state=new $d(n,{copyState:i}),oS(n);for(let o in Yd){let a=Yd[o];sS(n,o,a)}z1(n,"getParameter"),z1(n,"isEnabled")}return n.state.enable=t,n}function Jd(n){n.state||Ec(n,{copyState:!1}),n.state.push()}function _c(n){Be(n.state),n.state.pop()}function dt(n,e){if(Be(rn(n),"setParameters requires a WebGL context"),Kd(e))return;let t={};for(let s in e){let o=Number(s),a=k1[s];a&&(typeof a=="string"?t[a]=!0:a(n,e[s],o))}let i=n.state&&n.state.cache;if(i)for(let s in t){let o=G1[s];o(n,e,i)}}function bc(n,e){if(e=e||Na,typeof e=="number"){let s=e,o=Zd[s];return o?o(n,s):n.getParameter(s)}let t=Array.isArray(e)?e:Object.keys(e),i={};for(let s of t){let o=Zd[s];i[s]=o?o(n,Number(s)):n.getParameter(Number(s))}return i}function Ac(n){dt(n,Na)}function be(n,e,t){if(Kd(e))return t(n);let{nocatch:i=!0}=e;Jd(n),dt(n,e);let s;if(i)s=t(n),_c(n);else try{s=t(n)}finally{_c(n)}return s}function ur(n){let{luma:e}=n;if(n.canvas&&e){let{clientWidth:t}=e.canvasSizeInfo;return t?n.drawingBufferWidth/t:1}return 1}function Ks(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=ur(n),s=n.drawingBufferWidth,o=n.drawingBufferHeight;return aS(e,i,s,o,t)}function W1(n){let e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(n)?n<=0?1:n:n?e:1}function aS(n,e,t,i,s){let o=V1(n[0],e,t),a=j1(n[1],e,i,s),u=V1(n[0]+1,e,t),l=u===t-1?u:u-1;u=j1(n[1]+1,e,i,s);let c;return s?(u=u===0?u:u+1,c=a,a=u):c=u===i-1?u:u-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(c-a+1,1)}}function V1(n,e,t){return Math.min(Math.round(n*e),t-1)}function j1(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}var Qd=Xe(),uS=Qd&&typeof document<"u",H1={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function $s(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Be(Qd,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),n=Object.assign({},H1,n);let{width:e,height:t}=n;function i(u){if(n.throwOnError)throw new Error(u);return console.error(u),null}n.onError=i;let s,{canvas:o}=n,a=cS({canvas:o,width:e,height:t,onError:i});return s=lS(a,n),s?(s=Fi(s,n),fS(s),s):null}function Fi(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!n||n._instrumented)return n;n._version=n._version||hS(n),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{},e=Object.assign({},H1,e);let{manageState:t,debug:i}=e;return t&&Ec(n,{copyState:!1,log:function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return W.log(1,...o)()}}),Qd&&i&&(globalThis.makeDebugContext?(n=globalThis.makeDebugContext(n,e),W.level=Math.max(W.level,1)):W.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),n._instrumented=!0,n}function X1(n){let e=n.getParameter(7936),t=n.getParameter(7937),i=n.getExtension("WEBGL_debug_renderer_info"),s=i&&n.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),o=i&&n.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:n.getParameter(7938),shadingLanguageVersion:n.getParameter(35724)}}function ep(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n.canvas){let i=W1(e.useDevicePixels);dS(n,i,e);return}let t=n.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function lS(n,e){let{onError:t}=e,i=null,s=l=>i=l.statusMessage||i;n.addEventListener("webglcontextcreationerror",s,!1);let{webgl1:o=!0,webgl2:a=!0}=e,u=null;return a&&(u=u||n.getContext("webgl2",e),u=u||n.getContext("experimental-webgl2",e)),o&&(u=u||n.getContext("webgl",e),u=u||n.getContext("experimental-webgl",e)),n.removeEventListener("webglcontextcreationerror",s,!1),u?(e.onContextLost&&n.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&n.addEventListener("webglcontextrestored",e.onContextRestored,!1),u):t("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function cS(n){let{canvas:e,width:t=800,height:i=600,onError:s}=n,o;return typeof e=="string"?(uS&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function fS(n){let e=Q(n)?"WebGL2":"WebGL1",t=X1(n),i=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",s=n.debug?" debug":"";W.info(1,"".concat(e).concat(s," context ").concat(i))()}function hS(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?2:1}function dS(n,e,t){let i="width"in t?t.width:n.canvas.clientWidth,s="height"in t?t.height:n.canvas.clientHeight;(!i||!s)&&(W.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=n.canvas.width||1,s=n.canvas.height||1),n.luma=n.luma||{},n.luma.canvasSizeInfo=n.luma.canvasSizeInfo||{};let o=n.luma.canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==s||o.devicePixelRatio!==e){let a=e,u=Math.floor(i*a),l=Math.floor(s*a);n.canvas.width=u,n.canvas.height=l,(n.drawingBufferWidth!==u||n.drawingBufferHeight!==l)&&(W.warn("Device pixel ratio clamped")(),a=Math.min(n.drawingBufferWidth/i,n.drawingBufferHeight/s),n.canvas.width=Math.floor(i*a),n.canvas.height=Math.floor(s*a)),Object.assign(n.luma.canvasSizeInfo,{clientWidth:i,clientHeight:s,devicePixelRatio:e})}}var Ba="8.5.16",pS="set luma.log.level=1 (or higher) to trace rendering",ka=class{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Lt({id:e})),this.stats.get(e)}},qt=new ka;if(globalThis.luma&&globalThis.luma.VERSION!==Ba)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Ba));globalThis.luma||(Xe()&&W.log(1,"luma.gl ".concat(Ba," - ").concat(pS))(),globalThis.luma=globalThis.luma||{VERSION:Ba,version:Ba,log:W,stats:qt,globals:{modules:{},nodeIO:{}}});var n8=globalThis.luma;function tp(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function rp(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}function U(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}function vc(n,e){if(typeof e!="string")return e;let t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");let i=n[e];return U(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Yt(n,e){e=Number(e);for(let t in n)if(n[t]===e)return"GL.".concat(t);return String(e)}var np={};function pt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";np[n]=np[n]||1;let e=np[n]++;return"".concat(n,"-").concat(e)}function ip(n){return U(typeof n=="number","Input must be a number"),n&&(n&n-1)===0}function Or(n){let e=!0;for(let t in n){e=!1;break}return e}function Tc(n,e,t,i){let s="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(n);i.forEach(a=>{o.methodName||(o[a]=()=>{throw W.removed("Calling removed method ".concat(e,".").concat(a,": "),s)(),new Error(a)})})}var Js="Resource subclass must define virtual methods",ke=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nn(e);let{id:i,userData:s={}}=t;this.gl=e,this.gl2=e,this.id=i||pt(this[Symbol.toStringTag]),this.userData=s,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=vc(this.gl,e),U(e);let s=(this.constructor.PARAMETERS||{})[e];if(s){let o=Q(this.gl);if(!((!("webgl2"in s)||o)&&(!("extension"in s)||this.gl.getExtension(s.extension)))){let u=s.webgl1,l="webgl2"in s?s.webgl2:s.webgl1;return o?l:u}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{parameters:t,keys:i}=e,s=this.constructor.PARAMETERS||{},o=Q(this.gl),a={},u=t||Object.keys(s);for(let l of u){let c=s[l];if(c&&(!("webgl2"in c)||o)&&(!("extension"in c)||this.gl.getExtension(c.extension))){let h=i?Yt(this.gl,l):l;a[h]=this.getParameter(l,e),i&&c.type==="GLenum"&&(a[h]=Yt(this.gl,a[h]))}}return a}setParameter(e,t){e=vc(this.gl,e),U(e);let s=(this.constructor.PARAMETERS||{})[e];if(s){let o=Q(this.gl);if(!((!("webgl2"in s)||o)&&(!("extension"in s)||this.gl.getExtension(s.extension))))throw new Error("Parameter not available on this platform");s.type==="GLenum"&&(t=vc(t))}return this._setParameter(e,t),this}setParameters(e){for(let t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,i){return Tc(this,e,t,i)}initialize(e){}_createHandle(){throw new Error(Js)}_deleteHandle(){throw new Error(Js)}_bindHandle(e){throw new Error(Js)}_getOptsFromHandle(){throw new Error(Js)}_getParameter(e,t){throw new Error(Js)}_setParameter(e,t){throw new Error(Js)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_initStats(){this.gl.stats=this.gl.stats||new ka}_addStats(){let e=this[Symbol.toStringTag],t=qt.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){let e=this[Symbol.toStringTag];qt.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(e,t),this._doTrackAllocatedMemory(e,t,this.gl.stats.get("Memory Usage"))}_doTrackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qt.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get("".concat(t," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(e),this._doTrackDeallocatedMemory(e,this.gl.stats.get("Memory Usage"))}_doTrackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qt.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}};var gS="Failed to deduce GL constant from typed array";function Ga(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(gS)}}function Nn(n){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function q1(n){let{data:e,width:t,height:i,bytesPerPixel:s=4,temp:o}=n,a=t*s;o=o||new Uint8Array(a);for(let u=0;u<i/2;++u){let l=u*a,c=(i-u-1)*a;o.set(e.subarray(l,l+a)),e.copyWithin(l,c,c+a),e.set(o,c)}}function Y1(n){let{data:e,width:t,height:i}=n,s=Math.round(t/2),o=Math.round(i/2),a=new Uint8Array(s*o*4);for(let u=0;u<o;u++)for(let l=0;l<s;l++)for(let c=0;c<4;c++)a[(u*s+l)*4+c]=e[(u*2*t+l*2)*4+c];return{data:a,width:s,height:o}}function Ua(n,e,t){let{removedProps:i={},deprecatedProps:s={},replacedProps:o={}}=t;for(let u in i)if(u in e){let c=i[u]?"".concat(n,".").concat(i[u]):"N/A";W.removed("".concat(n,".").concat(u),c)()}for(let u in s)if(u in e){let l=s[u];W.deprecated("".concat(n,".").concat(u),"".concat(n,".").concat(l))()}let a=null;for(let u in o)if(u in e){let l=o[u];W.deprecated("".concat(n,".").concat(u),"".concat(n,".").concat(l))(),a=a||Object.assign({},e),a[l]=e[u],delete a[u]}return a||e}var mS={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},xS={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},qe=class{static getBytesPerElement(e){return Nn(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return U(e.size),Nn(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new qe(mS,...t)}constructor(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return qe.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return qe.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Ua("Accessor",e,xS),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}};var Z1=10,K1={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},yS={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:K1},ES={removedProps:K1},re=class extends ke{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/qe.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/qe.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Ua("Buffer",e,yS),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Ua("Buffer",e,ES),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new qe(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});let{data:t,offset:i=0,srcOffset:s=0}=e,o=e.byteLength||e.length;U(t);let a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),s!==0||o!==void 0?(ve(this.gl),this.gl.bufferSubData(this.target,i,t,s,o)):this.gl.bufferSubData(a,i,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:i=0,writeOffset:s=0,size:o}=e,{gl:a}=this;return ve(a),a.bindBuffer(36662,t.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,i,s,o),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:i=0,length:s=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ve(this.gl);let o=Nn(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(t),u=i,l,c;e?(c=e.length,l=c-u):(l=Math.min(a,s||a),c=u+l);let f=Math.min(a,l);return s=s||f,U(s<=f),e=e||new o(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,i,s),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:i=0,size:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?s!==void 0?this.gl.bindBufferRange(e,t,this.handle,i,s):(U(i===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Z1,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;U(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();let s=this._getTarget();this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.usage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.debugData=e.slice(0,Z1),this.bytesUsed=i,this._trackAllocatedMemory(i);let o=Ga(e);return U(o),this.setAccessor(new qe(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;U(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));let s=this._getTarget();return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,t),this.gl.bindBuffer(s,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){let t=Nn(this.accessor.type||5126,{clamped:!1}),i=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new qe(this.accessor,{type:Ga(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);let t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return W.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return W.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return W.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return W.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new qe(this.accessor,e),this}};var wc={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},Sc={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},Pc={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function $1(n,e){let t=wc[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;let i=Q(n)&&t.gl2||t.gl1;return typeof i=="string"?n.getExtension(i):i}function J1(n,e){let t=wc[e];switch(t&&t.types[0]){case 5126:return n.getExtension("OES_texture_float_linear");case 5131:return n.getExtension("OES_texture_half_float_linear");default:return!0}}var _S=[9729,9728],Q1=globalThis.WebGLBuffer||function(){},ut=class extends ke{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{format:i,linearFiltering:s}=t,o=!0;return i&&(o=o&&$1(e,i),o=o&&(!s||J1(e,i))),o}constructor(e,t){let{id:i=pt("texture"),handle:s,target:o}=t;super(e,{id:i,handle:s}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(D=>this.initialize(Object.assign({},e,{pixels:D,data:D}))),this;let i=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(i&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;let{pixels:s=null,format:o=6408,border:a=0,recreate:u=!1,parameters:l={},pixelStore:c={},textureUnit:f=void 0}=e;t||(t=s);let{width:h,height:d,dataFormat:x,type:E,compressed:w=!1,mipmaps:S=!0}=e,{depth:M=0}=e;return{width:h,height:d,compressed:w,dataFormat:x,type:E}=this._deduceParameters({format:o,type:E,dataFormat:x,compressed:w,data:t,width:h,height:d}),this.width=h,this.height=d,this.depth=M,this.format=o,this.type=E,this.dataFormat=x,this.border=a,this.textureUnit=f,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),S&&this._isNPOT()&&(W.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),S=!1,this._updateForNPOT(l)),this.mipmaps=S,this.setImageData({data:t,width:h,height:d,depth:M,format:o,type:E,dataFormat:x,border:a,mipmaps:S,parameters:c,compressed:w}),S&&this.generateMipmap(),this.setParameters(l),u&&(this.data=t),i&&(this._video={video:t,parameters:l,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){let{video:e,parameters:t,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:i,mipmaps:s=!1}=e;return i!==this.width||t!==this.height?this.initialize({width:i,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(W.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),be(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");let{target:t=this.target,pixels:i=null,level:s=0,format:o=this.format,border:a=this.border,offset:u=0,parameters:l={}}=e,{data:c=null,type:f=this.type,width:h=this.width,height:d=this.height,dataFormat:x=this.dataFormat,compressed:E=!1}=e;c||(c=i),{type:f,dataFormat:x,compressed:E,width:h,height:d}=this._deduceParameters({format:o,type:f,dataFormat:x,compressed:E,data:c,width:h,height:d});let{gl:w}=this;w.bindTexture(this.target,this.handle);let S=null;({data:c,dataType:S}=this._getDataType({data:c,compressed:E}));let M,D=0;if(be(this.gl,l,()=>{switch(S){case"null":w.texImage2D(t,s,o,h,d,a,x,f,c);break;case"typed-array":w.texImage2D(t,s,o,h,d,a,x,f,c,u);break;case"buffer":M=ve(w),M.bindBuffer(35052,c.handle||c),M.texImage2D(t,s,o,h,d,a,x,f,u),M.bindBuffer(35052,null);break;case"browser-object":Q(w)?w.texImage2D(t,s,o,h,d,a,x,f,c):w.texImage2D(t,s,o,x,f,c);break;case"compressed":for(let[C,L]of c.entries())w.compressedTexImage2D(t,C,L.format,L.width,L.height,a,L.data),D+=L.levelSize;break;default:U(!1,"Unknown image data type")}}),S==="compressed")this._trackAllocatedMemory(D,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{let C=Sc[this.dataFormat]||4,L=Pc[this.type]||1;this._trackAllocatedMemory(this.width*this.height*C*L,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:i=null,data:s=null,x:o=0,y:a=0,width:u=this.width,height:l=this.height,level:c=0,format:f=this.format,type:h=this.type,dataFormat:d=this.dataFormat,compressed:x=!1,offset:E=0,border:w=this.border,parameters:S={}}=e;if({type:h,dataFormat:d,compressed:x,width:u,height:l}=this._deduceParameters({format:f,type:h,dataFormat:d,compressed:x,data:s,width:u,height:l}),U(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=i),s&&s.data){let M=s;s=M.data,u=M.shape[0],l=M.shape[1]}s instanceof re&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),be(this.gl,S,()=>{if(x)this.gl.compressedTexSubImage2D(t,c,o,a,u,l,f,s);else if(s===null)this.gl.texSubImage2D(t,c,o,a,u,l,d,h,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(t,c,o,a,u,l,d,h,s,E);else if(s instanceof Q1){let M=ve(this.gl);M.bindBuffer(35052,s),M.texSubImage2D(t,c,o,a,u,l,d,h,E),M.bindBuffer(35052,null)}else Q(this.gl)?ve(this.gl).texSubImage2D(t,c,o,a,u,l,d,h,s):this.gl.texSubImage2D(t,c,o,a,d,h,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:i=!1}=e;return i?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof re?{data:t.handle,dataType:"buffer"}:t instanceof Q1?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){let{format:t,data:i}=e,{width:s,height:o,dataFormat:a,type:u,compressed:l}=e,c=wc[t];return a=a||c&&c.dataFormat,u=u||c&&c.types[0],l=l||c&&c.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:u,compressed:l,width:s,height:o,format:t,data:i}}_deduceImageSize(e,t,i){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:t,height:i}:s={width:t>=0?t:1,height:i>=0?i:1},U(s,"Could not deduced texture size"),U(t===void 0||s.width===t,"Deduced texture width does not match supplied width"),U(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);let t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:U(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Q(this.gl)||!this.width||!this.height?!1:!ip(this.width)||!ip(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:_S.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break;default:break}return t}};var bS="";function ex(n,e){return U(typeof n=="string"),n=bS+n,new Promise((t,i)=>{try{let s=new Image;s.onload=()=>t(s),s.onerror=()=>i(new Error("Could not load image ".concat(n,"."))),s.crossOrigin=e&&e.crossOrigin||"anonymous",s.src=n}catch(s){i(s)}})}var he=class extends ut{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return ut.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nn(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:ex(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}};var sp=[34069,34070,34071,34072,34073,34074],Oi=class extends ut{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nn(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{mipmaps:t=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:t,data:i,x:s=0,y:o=0,mipmapLevel:a=0}=e;return this._subImage({target:t,data:i,x:s,y:o,mipmapLevel:a})}async setCubeMapImageData(e){let{width:t,height:i,pixels:s,data:o,border:a=0,format:u=6408,type:l=5121}=e,{gl:c}=this,f=s||o,h=await Promise.all(sp.map(d=>{let x=f[d];return Promise.all(Array.isArray(x)?x:[x])}));this.bind(),sp.forEach((d,x)=>{h[x].length>1&&this.opts.mipmaps!==!1&&W.warn("".concat(this.id," has mipmap and multiple LODs."))(),h[x].forEach((E,w)=>{t&&i?c.texImage2D(d,w,u,t,i,a,u,l,E):c.texImage2D(d,w,u,u,l,E)})}),this.unbind()}setImageDataForFace(e){let{face:t,width:i,height:s,pixels:o,data:a,border:u=0,format:l=6408,type:c=5121}=e,{gl:f}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(d=>this.setImageDataForFace(Object.assign({},e,{face:t,data:d,pixels:d}))):this.width||this.height?f.texImage2D(t,0,l,i,s,u,l,c,h):f.texImage2D(t,0,l,l,c,h),this}};Oi.FACES=sp;var Qs=class extends ut{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Q(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ve(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:i=6408,width:s,height:o,depth:a=1,border:u=0,format:l,type:c=5121,offset:f=0,data:h,parameters:d={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),be(this.gl,d,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,t,i,s,o,a,u,l,c,h),h instanceof re&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,t,i,s,o,a,u,l,c,f))}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{let x=Sc[this.dataFormat]||4,E=Pc[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*x*E,"Texture")}return this.loaded=!0,this}};var Ni="EXT_color_buffer_float",op={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Ni,bpp:2},[33327]:{gl2:Ni,bpp:4},[34842]:{gl2:Ni,bpp:8},[33326]:{gl2:Ni,bpp:4},[33328]:{gl2:Ni,bpp:8},[34836]:{gl2:Ni,bpp:16},[35898]:{gl2:Ni,bpp:4}};function AS(n,e,t){let i=t[e];if(!i)return!1;let s=Q(n)&&i.gl2||i.gl1;return typeof s=="string"?n.getExtension(s):s}var _t=class extends ke{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||AS(e,t,op)}static getSamplesForFormat(e,t){let{format:i}=t;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:i=1,height:s=1,samples:o=0}=e;return U(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&Q(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,i,s):this.gl.renderbufferStorage(36161,t,i,s),this.format=t,this.width=i,this.height=s,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*op[this.format].bpp),this}resize(e){let{width:t,height:i}=e;return t!==this.width||i!==this.height?this.initialize({width:t,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}};var vS=256,TS=1024,wS=16384,tx=6144,rx=6145,nx=6146,ix=34041,sx="clear: bad arguments";function Bn(n){let{framebuffer:e=null,color:t=null,depth:i=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o={};e&&(o.framebuffer=e);let a=0;t&&(a|=wS,t!==!0&&(o.clearColor=t)),i&&(a|=vS,i!==!0&&(o.clearDepth=i)),s&&(a|=TS,i!==!0&&(o.clearStencil=i)),U(a!==0,sx),be(n,o,()=>{n.clear(a)})}function ap(n){let{framebuffer:e=null,buffer:t=tx,drawBuffer:i=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ve(n),be(n,{framebuffer:e},()=>{switch(t){case tx:switch(s.constructor){case Int32Array:n.clearBufferiv(t,i,s);break;case Uint32Array:n.clearBufferuiv(t,i,s);break;case Float32Array:default:n.clearBufferfv(t,i,s)}break;case rx:n.clearBufferfv(rx,0,[s]);break;case nx:n.clearBufferiv(nx,0,[s]);break;case ix:let[o,a]=s;n.clearBufferfi(ix,0,o,a);break;default:U(!1,sx)}})}function ox(n){switch(n){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return U(!1),0}}function sn(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{sourceX:t=0,sourceY:i=0,sourceFormat:s=6408}=e,{sourceAttachment:o=36064,target:a=null,sourceWidth:u,sourceHeight:l,sourceType:c}=e,{framebuffer:f,deleteFramebuffer:h}=ax(n);U(f);let{gl:d,handle:x,attachments:E}=f;u=u||f.width,l=l||f.height,o===36064&&x===null&&(o=1028),U(E[o]),c=c||E[o].type,a=SS(a,c,s,u,l),c=c||Ga(a);let w=d.bindFramebuffer(36160,x);return d.readPixels(t,i,u,l,s,c,a),d.bindFramebuffer(36160,w||null),h&&f.delete(),a}function Cc(n){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=sn(n,{sourceAttachment:e}),{width:s,height:o}=n;for(;o>t;)({data:i,width:s,height:o}=Y1({data:i,width:s,height:o}));q1({data:i,width:s,height:o});let a=document.createElement("canvas");a.width=s,a.height=o;let u=a.getContext("2d"),l=u.createImageData(s,o);return l.data.set(i),u.putImageData(l,0,0),a.toDataURL()}function Mc(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{sourceX:i=0,sourceY:s=0,targetMipmaplevel:o=0,targetInternalFormat:a=6408}=t,{targetX:u,targetY:l,targetZ:c,width:f,height:h}=t,{framebuffer:d,deleteFramebuffer:x}=ax(n);U(d);let{gl:E,handle:w}=d,S=typeof u<"u"||typeof l<"u"||typeof c<"u";u=u||0,l=l||0,c=c||0;let M=E.bindFramebuffer(36160,w);U(e);let D=null;if(e instanceof ut&&(D=e,f=Number.isFinite(f)?f:D.width,h=Number.isFinite(h)?h:D.height,D.bind(0),e=D.target),!S)E.copyTexImage2D(e,o,a,i,s,f,h,0);else switch(e){case 3553:case 34067:E.copyTexSubImage2D(e,o,u,l,i,s,f,h);break;case 35866:case 32879:ve(E).copyTexSubImage3D(e,o,u,l,c,i,s,f,h);break;default:}return D&&D.unbind(),E.bindFramebuffer(36160,M||null),x&&d.delete(),D}function ax(n){return n instanceof le?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:ux(n),deleteFramebuffer:!0}}function SS(n,e,t,i,s){if(n)return n;e=e||5121;let o=Nn(e,{clamped:!1}),a=ox(t);return new o(i*s*a)}var me={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function PS(n){let e=new he(n,{format:6408,type:5126,dataFormat:6408}),t=new le(n,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=t.getStatus();return e.delete(),t.delete(),i===36053}var up={[me.WEBGL2]:[!1,!0],[me.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[me.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[me.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[me.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[me.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[me.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[me.FLOAT_BLEND]:["EXT_float_blend"],[me.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[me.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[me.TEXTURE_FLOAT]:["OES_texture_float",!0],[me.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[me.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[me.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[me.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[me.COLOR_ATTACHMENT_RGBA32F]:[PS,"EXT_color_buffer_float"],[me.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[me.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[me.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[me.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[me.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[me.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};var CS=2;function za(n,e){return kn(n,e)}function kn(n,e){return e=Array.isArray(e)?e:[e],e.every(t=>lx(n,t))}function Ic(n){n.luma=n.luma||{},n.luma.caps=n.luma.caps||{};for(let e in up)n.luma.caps[e]===void 0&&(n.luma.caps[e]=lx(n,e));return n.luma.caps}function lx(n,e){return n.luma=n.luma||{},n.luma.caps=n.luma.caps||{},n.luma.caps[e]===void 0&&(n.luma.caps[e]=MS(n,e)),n.luma.caps[e]||W.log(CS,"Feature: ".concat(e," not supported"))(),n.luma.caps[e]}function MS(n,e){let t=up[e];U(t,e);let i,s=Q(n)&&t[1]||t[0];if(typeof s=="function")i=s(n);else if(Array.isArray(s)){i=!0;for(let o of s)i=i&&Boolean(n.getExtension(o))}else typeof s=="string"?i=Boolean(n.getExtension(s)):typeof s=="boolean"?i=s:U(!1);return i}var cx="Multiple render targets not supported",le=class extends ke{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{colorBufferFloat:i,colorBufferHalfFloat:s}=t,o=!0;return i&&(o=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),s&&(o=o&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new le(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){let e=ve(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){let e=ve(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:i=1,attachments:s=null,color:o=!0,depth:a=!0,stencil:u=!1,check:l=!0,readBuffer:c=void 0,drawBuffers:f=void 0}=e;if(U(t>=0&&i>=0,"Width and height need to be integers"),this.width=t,this.height=i,s)for(let h in s){let d=s[h];(Array.isArray(d)?d[0]:d).resize({width:t,height:i})}else s=this._createDefaultAttachments(o,a,u,t,i);this.update({clearAttachments:!0,attachments:s,readBuffer:c,drawBuffers:f}),s&&l&&this.checkStatus()}delete(){for(let e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:i,drawBuffers:s,clearAttachments:o=!1,resizeAttachments:a=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:a});let{gl:u}=this,l=u.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),s&&this._setDrawBuffers(s),u.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:i}=e;if(this.handle===null)return U(t===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),t!==this.width&&i!==this.height&&W.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(i))();for(let s in this.attachments)this.attachments[s].resize({width:t,height:i});return this.width=t,this.height=i,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s={};t&&Object.keys(this.attachments).forEach(a=>{s[a]=null}),Object.assign(s,e);let o=this.gl.bindFramebuffer(36160,this.handle);for(let a in s){U(a!==void 0,"Misspelled framebuffer binding point?");let u=Number(a),l=s[u],c=l;if(!c)this._unattach(u);else if(c instanceof _t)this._attachRenderbuffer({attachment:u,renderbuffer:c});else if(Array.isArray(l)){let[f,h=0,d=0]=l;c=f,this._attachTexture({attachment:u,texture:f,layer:h,level:d})}else this._attachTexture({attachment:u,texture:c,layer:0,level:0});i&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){let{gl:e}=this,t=this.getStatus();if(t!==36053)throw new Error(LS(t));return this}getStatus(){let{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{color:t,depth:i,stencil:s,drawBuffers:o=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(t||i||s)&&Bn(this.gl,{color:t,depth:i,stencil:s}),o.forEach((u,l)=>{ap(this.gl,{drawBuffer:l,value:u})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:i=0,y:s=0,width:o,height:a}=e,u=ve(this.gl),l=u.bindFramebuffer(36008,this.handle);return i===0&&s===0&&o===void 0&&a===void 0?u.invalidateFramebuffer(36008,t):u.invalidateFramebuffer(36008,t,i,s,o,a),u.bindFramebuffer(36008,l),this}getAttachmentParameter(e,t,i){let s=this._getAttachmentParameterFallback(t);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),i&&s>1e3&&(s=Yt(this.gl,s)),s}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],s={};for(let o of i){let a=t?Yt(this.gl,o):o;s[a]=this.getAttachmentParameter(e,o,t)}return s}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=Object.keys(this.attachments),i={};for(let s of t){let o=Number(s),a=e?Yt(this.gl,o):o;i[a]=this.getAttachmentParameters(o,e)}return i}show(){return typeof window<"u"&&window.open(Cc(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>W.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);let i=Cc(this,{targetMaxHeight:100});return W.image({logLevel:e,message:t,image:i},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,i,s,o){let a=null;return e&&(a=a||{},a[36064]=new he(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:o,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(a[36064])),t&&i?(a=a||{},a[33306]=new _t(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(a[33306])):t?(a=a||{},a[36096]=new _t(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:o}),this.ownResources.push(a[36096])):i&&U(!1),a}_unattach(e){let t=this.attachments[e];!t||(t instanceof _t?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:i}=e,{gl:s}=this;s.framebufferRenderbuffer(36160,t,36161,i.handle),this.attachments[t]=i}_attachTexture(e){let{attachment:t=36064,texture:i,layer:s,level:o}=e,{gl:a}=this;switch(a.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:ve(a).framebufferTextureLayer(36160,t,i.target,o,s);break;case 34067:let l=IS(s);a.framebufferTexture2D(36160,t,l,i.handle,o);break;case 3553:a.framebufferTexture2D(36160,t,3553,i.handle,o);break;default:U(!1,"Illegal texture type")}a.bindTexture(i.target,null),this.attachments[t]=i}_setReadBuffer(e){let t=Xd(this.gl);t?t.readBuffer(e):U(e===36064||e===1029,cx),this.readBuffer=e}_setDrawBuffers(e){let{gl:t}=this,i=ve(t);if(i)i.drawBuffers(e);else{let s=t.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(e):U(e.length===1&&(e[0]===36064||e[0]===1029),cx)}this.drawBuffers=e}_getAttachmentParameterFallback(e){let t=Ic(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}};function IS(n){return n<34069?n+34069:n}function LS(n){return(le.STATUS||{})[n]||"Framebuffer error ".concat(n)}var RS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];le.ATTACHMENT_PARAMETERS=RS;function Lc(n,e){U(n instanceof he||n instanceof Oi||n instanceof Qs);let t=n.constructor,{gl:i,width:s,height:o,format:a,type:u,dataFormat:l,border:c,mipmaps:f}=n,h=Object.assign({width:s,height:o,format:a,type:u,dataFormat:l,border:c,mipmaps:f},e);return new t(i,h)}function ux(n,e){let{gl:t,width:i,height:s,id:o}=n;return new le(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:i,height:s,attachments:{[36064]:n}}))}function Gn(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed",t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=n.match(t);return i?i[1]:e}function lp(n){switch(n){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}function cp(n,e,t,i){let s=n.split(/\r?\n/),o={},a={},u=i||Gn(e)||"(unnamed)",l="".concat(lp(t)," shader ").concat(u);for(let f=0;f<s.length;f++){let h=s[f];if(h.length<=1)continue;let d=h.split(":"),x=d[0],E=parseInt(d[2],10);if(isNaN(E))throw new Error("GLSL compilation error in ".concat(l,": ").concat(n));x!=="WARNING"?o[E]=h:a[E]=h}let c=DS(e);return{shaderName:l,errors:fx(o,c),warnings:fx(a,c)}}function fx(n,e){let t="";for(let i=0;i<e.length;i++){let s=e[i];if(!(!n[i+3]&&!n[i+2]&&!n[i+1])&&(t+="".concat(s,`
`),n[i+1])){let o=n[i+1],a=o.split(":",3),u=a[0],l=parseInt(a[1],10)||0,c=o.substring(a.join(":").length+1).trim();t+=hx("^^^ ".concat(u,": ").concat(c,`

`),l)}}return t}function DS(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ",i=n.split(/\r?\n/),s=String(i.length+e-1).length;return i.map((o,a)=>{let u=String(a+e),l=u.length;return hx(u,s-l)+t+o})}function hx(n,e){let t="";for(let i=0;i<e;++i)t+=" ";return"".concat(t).concat(n)}function eo(n){let e=100,t=n.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){let i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}return e}var FS="Shader: GLSL source code must be a JavaScript string",Bi=class extends ke{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return U(!1),"unknown"}}constructor(e,t){nn(e),U(typeof t.source=="string",FS);let i=Gn(t.source,null)||t.id||pt("unnamed ".concat(Bi.getTypeName(t.shaderType)));super(e,{id:i}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e,i=Gn(t,null);i&&(this.id=pt(i)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Bi.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Gn(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){let e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){let i=this.gl.getShaderInfoLog(this.handle),{shaderName:s,errors:o,warnings:a}=cp(i,this.source,this.shaderType,this.id);throw W.error("GLSL compilation errors in ".concat(s,`
`).concat(o))(),W.warn("GLSL compilation warnings in ".concat(s,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(s))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}},ki=class extends Bi{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}},Gi=class extends Bi{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}};var OS={[5126]:Te.bind(null,"uniform1fv",Dt,1,lt),[35664]:Te.bind(null,"uniform2fv",Dt,2,lt),[35665]:Te.bind(null,"uniform3fv",Dt,3,lt),[35666]:Te.bind(null,"uniform4fv",Dt,4,lt),[5124]:Te.bind(null,"uniform1iv",Un,1,lt),[35667]:Te.bind(null,"uniform2iv",Un,2,lt),[35668]:Te.bind(null,"uniform3iv",Un,3,lt),[35669]:Te.bind(null,"uniform4iv",Un,4,lt),[35670]:Te.bind(null,"uniform1iv",Un,1,lt),[35671]:Te.bind(null,"uniform2iv",Un,2,lt),[35672]:Te.bind(null,"uniform3iv",Un,3,lt),[35673]:Te.bind(null,"uniform4iv",Un,4,lt),[35674]:Te.bind(null,"uniformMatrix2fv",Dt,4,on),[35675]:Te.bind(null,"uniformMatrix3fv",Dt,9,on),[35676]:Te.bind(null,"uniformMatrix4fv",Dt,16,on),[35678]:et,[35680]:et,[5125]:Te.bind(null,"uniform1uiv",Rc,1,lt),[36294]:Te.bind(null,"uniform2uiv",Rc,2,lt),[36295]:Te.bind(null,"uniform3uiv",Rc,3,lt),[36296]:Te.bind(null,"uniform4uiv",Rc,4,lt),[35685]:Te.bind(null,"uniformMatrix2x3fv",Dt,6,on),[35686]:Te.bind(null,"uniformMatrix2x4fv",Dt,8,on),[35687]:Te.bind(null,"uniformMatrix3x2fv",Dt,6,on),[35688]:Te.bind(null,"uniformMatrix3x4fv",Dt,12,on),[35689]:Te.bind(null,"uniformMatrix4x2fv",Dt,8,on),[35690]:Te.bind(null,"uniformMatrix4x3fv",Dt,12,on),[35678]:et,[35680]:et,[35679]:et,[35682]:et,[36289]:et,[36292]:et,[36293]:et,[36298]:et,[36299]:et,[36300]:et,[36303]:et,[36306]:et,[36307]:et,[36308]:et,[36311]:et},NS={},BS={},kS={},dx=[0];function fp(n,e,t,i){e===1&&typeof n=="boolean"&&(n=n?1:0),Number.isFinite(n)&&(dx[0]=n,n=dx);let s=n.length;if(s%e&&W.warn("Uniform size should be multiples of ".concat(e),n)(),n instanceof t)return n;let o=i[s];o||(o=new t(s),i[s]=o);for(let a=0;a<s;a++)o[a]=n[a];return o}function Dt(n,e){return fp(n,e,Float32Array,NS)}function Un(n,e){return fp(n,e,Int32Array,BS)}function Rc(n,e){return fp(n,e,Uint32Array,kS)}function hp(n,e,t){let i=OS[t.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(t.type));return i().bind(null,n,e)}function px(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};let e=/([^[]*)(\[[0-9]+\])?/,t=n.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(n));return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function gx(n,e,t){for(let i in n){let s=n[i];if((!t||Boolean(t[i]))&&!GS(s))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),s),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function GS(n){return Array.isArray(n)||ArrayBuffer.isView(n)?US(n):isFinite(n)||n===!0||n===!1||n instanceof ut||n instanceof _t?!0:n instanceof le?Boolean(n.texture):!1}function mx(n,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(n[e]){let i=n[e];for(let s=0,o=t.length;s<o;++s)i[s]=t[s]}else n[e]=t.slice();else n[e]=t}function US(n){if(n.length===0)return!1;let e=Math.min(n.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(n[t]))return!1;return!0}function et(){let n=null;return(e,t,i)=>{let s=n!==i;return s&&(e.uniform1i(t,i),n=i),s}}function Te(n,e,t,i){let s=null,o=null;return(a,u,l)=>{let c=e(l,t),f=c.length,h=!1;if(s===null)s=new Float32Array(f),o=f,h=!0;else{U(o===f,"Uniform length cannot change.");for(let d=0;d<f;++d)if(c[d]!==s[d]){h=!0;break}}return h&&(i(a,n,u,c),s.set(c)),h}}function lt(n,e,t,i){n[e](t,i)}function on(n,e,t,i){n[e](t,!1,i)}var zS=5120,VS=5121,jS=5122,WS=5123,xx=0,Dc=1,HS=2,XS=3,Fc=4,qS=5,YS=6,Ye=5126,ZS=35664,KS=35665,$S=35666,Va=5124,JS=35667,QS=35668,eP=35669,ja=5125,tP=36294,rP=36295,nP=36296,iP=35670,sP=35671,oP=35672,aP=35673,uP=35674,lP=35675,cP=35676,fP=35685,hP=35686,dP=35687,pP=35688,gP=35689,mP=35690,dp={[Ye]:[Ye,1,"float"],[ZS]:[Ye,2,"vec2"],[KS]:[Ye,3,"vec3"],[$S]:[Ye,4,"vec4"],[Va]:[Va,1,"int"],[JS]:[Va,2,"ivec2"],[QS]:[Va,3,"ivec3"],[eP]:[Va,4,"ivec4"],[ja]:[ja,1,"uint"],[tP]:[ja,2,"uvec2"],[rP]:[ja,3,"uvec3"],[nP]:[ja,4,"uvec4"],[iP]:[Ye,1,"bool"],[sP]:[Ye,2,"bvec2"],[oP]:[Ye,3,"bvec3"],[aP]:[Ye,4,"bvec4"],[uP]:[Ye,8,"mat2"],[fP]:[Ye,8,"mat2x3"],[hP]:[Ye,8,"mat2x4"],[lP]:[Ye,12,"mat3"],[dP]:[Ye,12,"mat3x2"],[pP]:[Ye,12,"mat3x4"],[cP]:[Ye,16,"mat4"],[gP]:[Ye,16,"mat4x2"],[mP]:[Ye,16,"mat4x3"]};function yx(n){switch(n){case xx:return xx;case Dc:return Dc;case XS:return Dc;case HS:return Dc;case Fc:return Fc;case qS:return Fc;case YS:return Fc;default:return U(!1),0}}function pp(n){let e=dp[n];if(!e)return null;let[t,i]=e;return{type:t,components:i}}function Oc(n,e){switch(n){case zS:case VS:case jS:case WS:n=Ye;break;default:}for(let t in dp){let[i,s,o]=dp[t];if(i===n&&s===e)return{glType:t,name:o}}return null}var Wa=class{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){let t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){let t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){let t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){let t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){let t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){let t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){let{gl:t}=e,i=t.getProgramParameter(e.handle,35721);for(let s=0;s<i;s++){let{name:o,type:a,size:u}=t.getActiveAttrib(e.handle,s),l=t.getAttribLocation(e.handle,o);l>=0&&this._addAttribute(l,o,a,u)}this.attributeInfos.sort((s,o)=>s.location-o.location)}_readVaryingsFromProgram(e){let{gl:t}=e;if(!Q(t))return;let i=t.getProgramParameter(e.handle,35971);for(let s=0;s<i;s++){let{name:o,type:a,size:u}=t.getTransformFeedbackVarying(e.handle,s);this._addVarying(s,o,a,u)}this.varyingInfos.sort((s,o)=>s.location-o.location)}_addAttribute(e,t,i,s){let{type:o,components:a}=pp(i),u={type:o,size:s*a};this._inferProperties(e,t,u);let l={location:e,name:t,accessor:new qe(u)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,t,i){/instance/i.test(t)&&(i.divisor=1)}_addVarying(e,t,i,s){let{type:o,components:a}=pp(i),u=new qe({type:o,size:s*a}),l={location:e,name:t,accessor:u};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}};var Ex=4,xP=35981,yP=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],an=class extends ke{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",yP),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{hash:t,vs:i,fs:s,varyings:o,bufferMode:a=xP}=e;return this.hash=t||"",this.vs=typeof i=="string"?new ki(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof s=="string"?new Gi(this.gl,{id:"".concat(e.id,"-fs"),source:s}):s,U(this.vs instanceof ki),U(this.fs instanceof Gi),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(ve(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Wa(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:i=4,vertexCount:s,offset:o=0,start:a,end:u,isIndexed:l=!1,indexType:c=5123,instanceCount:f=0,isInstanced:h=f>0,vertexArray:d=null,transformFeedback:x,framebuffer:E,parameters:w={},uniforms:S,samplers:M}=e;if((S||M)&&(W.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(S||{})),W.priority>=t){let D=E?E.id:"default",C="mode=".concat(Yt(this.gl,i)," verts=").concat(s," ")+"instances=".concat(f," indexType=").concat(Yt(this.gl,c)," ")+"isInstanced=".concat(h," isIndexed=").concat(l," ")+"Framebuffer=".concat(D);W.log(t,C)()}return U(d),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||h&&f===0?!1:(d.bindForDraw(s,f,()=>{if(E!==void 0&&(w=Object.assign({},w,{framebuffer:E})),x){let D=yx(i);x.begin(D)}this._bindTextures(),be(this.gl,w,()=>{l&&h?this.gl2.drawElementsInstanced(i,s,c,o,f):l&&Q(this.gl)&&!isNaN(a)&&!isNaN(u)?this.gl2.drawRangeElements(i,a,u,s,c,o):l?this.gl.drawElements(i,s,c,o):h?this.gl2.drawArraysInstanced(i,o,s,f):this.gl.drawArrays(i,o,s)}),x&&x.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W.priority>=2&&gx(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(let t in e){let i=e[t],s=this._uniformSetters[t];if(s){let o=i,a=!1;if(o instanceof le&&(o=o.texture),o instanceof ut)if(a=this.uniforms[t]!==i,a){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);let u=o,{textureIndex:l}=s;u.bind(l),o=l,this._textureUniforms[t]=u}else o=s.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(s(o)||a)&&mx(this.uniforms,t,i)}}return this}_areTexturesRenderable(){let e=!0;for(let t in this._textureUniforms){let i=this._textureUniforms[t];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(let e in this._textureUniforms){let t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){let t=this.gl.getAttachedShaders(e),i={};for(let s of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new ki({handle:s});break;case 35632:i.fs=new Gi({handle:s});break;default:}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){let t=this._getName();this.id=pt(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){let{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),W.time(Ex,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),W.timeEnd(Ex,"linkProgram for ".concat(this._getName()))(),e.debug||W.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){let{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){let i=this.gl.getActiveUniform(this.handle,t),{name:s}=px(i.name),o=e.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=hp(e,o,i),i.size>1)for(let a=0;a<i.size;a++)o=e.getUniformLocation(this.handle,"".concat(s,"[").concat(a,"]")),this._uniformSetters["".concat(s,"[").concat(a,"]")]=hp(e,o,i)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}};var EP=34918,_P=34919,bP=35007,AP=36795,vP=35976,TP=35887,wP=36202,un=class extends ke{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=Q(e),s=kn(e,me.TIMER_QUERY),o=i||s;for(let a of t)switch(a){case"queries":o=o&&i;break;case"timers":o=o&&s;break;default:U(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(bP)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?wP:TP)}beginTransformFeedbackQuery(){return this.begin(vP)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.gl2.getQueryParameter(this.handle,_P);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(AP)}getResult(){return this.gl2.getQueryParameter(this.handle,EP)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,s)=>{let o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return un.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}};var ln=class extends ke{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Q(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ve(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Or(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(let t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){let i=this._getVaryingIndex(e),{buffer:s,byteSize:o,byteOffset:a}=this._getBufferParams(t);return i<0?(this.unused[e]=s,W.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=t,this.bindOnUse||this._bindBuffer(i,s,a,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,i,s;return e instanceof re?s=e:(s=e.buffer,i=e.byteSize,t=e.byteOffset),(t!==void 0||i!==void 0)&&(t=t||0,i=i||s.byteLength-t),{buffer:s,byteOffset:t,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;let t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(let e in this.buffers){let{buffer:t,byteSize:i,byteOffset:s}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,s,i)}}_unbindBuffers(){if(this.bindOnUse)for(let e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,o=t&&t.handle;return!o||s===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,i,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}};var Nc=null;function SP(n){return(!Nc||Nc.byteLength<n)&&(Nc=new ArrayBuffer(n)),Nc}function _x(n,e){let t=SP(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function bx(n){let{target:e,source:t,start:i=0,count:s=1}=n,o=t.length,a=s*o,u=0;for(let l=i;u<o;u++)e[l++]=t[u];for(;u<a;)u<a-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+a-u),u=a);return e}var PP="elements must be GL.ELEMENT_ARRAY_BUFFER",tt=class extends ke{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Q(e)||qs()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new tt(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return tt.MAX_ATTRIBUTES=tt.MAX_ATTRIBUTES||e.getParameter(34921),tt.MAX_ATTRIBUTES}static setConstant(e,t,i){switch(i.constructor){case Float32Array:tt._setConstantFloatArray(e,t,i);break;case Int32Array:tt._setConstantIntArray(e,t,i);break;case Uint32Array:tt._setConstantUintArray(e,t,i);break;default:U(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return tt.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return U(!e||e.target===34963,PP),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,i){if(t.target===34963)return this.setElementBuffer(t,i);let{size:s,type:o,stride:a,offset:u,normalized:l,integer:c,divisor:f}=i,{gl:h,gl2:d}=this;return e=Number(e),this.bind(()=>{h.bindBuffer(34962,t.handle),c?(U(Q(h)),d.vertexAttribIPointer(e,s,o,a,u)):h.vertexAttribPointer(e,s,o,l,a,u),h.enableVertexAttribArray(e),d.vertexAttribDivisor(e,f||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!tt.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){let i=this._normalizeConstantArrayValue(t),s=i.byteLength*e,o=i.length*e,a=!this.buffer;if(this.buffer=this.buffer||new re(this.gl,s),a=a||this.buffer.reallocate(s),a=a||!this._compareConstantArrayValues(i,this.bufferValue),a){let u=_x(t.constructor,o);bx({target:u,source:i,start:0,count:o}),this.buffer.subData(u),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}static _setConstantFloatArray(e,t,i){switch(i.length){case 1:e.vertexAttrib1fv(t,i);break;case 2:e.vertexAttrib2fv(t,i);break;case 3:e.vertexAttrib3fv(t,i);break;case 4:e.vertexAttrib4fv(t,i);break;default:U(!1)}}static _setConstantIntArray(e,t,i){switch(U(Q(e)),i.length){case 1:e.vertexAttribI1iv(t,i);break;case 2:e.vertexAttribI2iv(t,i);break;case 3:e.vertexAttribI3iv(t,i);break;case 4:e.vertexAttribI4iv(t,i);break;default:U(!1)}}static _setConstantUintArray(e,t,i){switch(U(Q(e)),i.length){case 1:e.vertexAttribI1uiv(t,i);break;case 2:e.vertexAttribI2uiv(t,i);break;case 3:e.vertexAttribI3uiv(t,i);break;case 4:e.vertexAttribI4uiv(t,i);break;default:U(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:i}=t;return U(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}};var CP="VertexArray: attributes must be Buffers or constants (i.e. typed array)",MP=/^(.+)__LOCATION_([0-9]+)$/,IP=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],to=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.id||t.program&&t.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new tt(e),Tc(this,"VertexArray","v6.0",IP),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;let{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(let t in e){let i=e[t];this._setAttribute(t,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,i);let{location:s,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,i);return s>=0&&(this.values[s]=t,this.accessors[s]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,t,o)),this}setConstant(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{location:s,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},i));return s>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[s]=t,this.accessors[s]=o,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new re(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof re&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){let t=this.values[e];t instanceof re&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,i){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),s=i()}),s}_resolveLocationAndAccessor(e,t,i,s){let o={location:-1,accessor:null},{location:a,name:u}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,W.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;let l=this._getAttributeInfo(u||a);if(!l)return o;let c=this.accessors[a]||{},f=qe.resolve(l.accessor,c,i,s),{size:h,type:d}=f;return U(Number.isFinite(h)&&Number.isFinite(d)),{location:a,accessor:f}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){let t=Number(e);if(Number.isFinite(t))return{location:t};let i=MP.exec(e),s=i?i[1]:e,o=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+o,name:s}:{location:-1}}_setAttribute(e,t){if(t instanceof re)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof re){let i=t[0],s=t[1];this.setBuffer(e,i,s)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){let i=t;this.setConstant(e,i)}else if(t.buffer instanceof re){let i=t;this.setBuffer(e,i.buffer,i)}else throw new Error(CP)}_setConstantAttributes(e,t){let i=Math.max(e|0,t|0),s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,i);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)s=this.values[o],ArrayBuffer.isView(s)&&this._setConstantAttribute(o,s)}_setConstantAttributeZero(e,t){if(tt.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}let i=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,t){tt.setConstant(this.gl,e,t)}_updateDrawParams(){let e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){let i=this.values[t],s=this.accessors[t];if(!i)return;let{divisor:o}=s,a=o>0;if(e.isInstanced=e.isInstanced||a,i instanceof re){let u=i;if(a){let l=u.getVertexCount(s);e.instanceCount=Math.min(e.instanceCount,l)}else{let l=u.getVertexCount(s);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return W.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}};function LP(n,e){let{maxElts:t=16,size:i=1}=e,s="[";for(let a=0;a<n.length&&a<t;++a)a>0&&(s+=",".concat(a%i===0?" ":"")),s+=Ui(n[a],e);let o=n.length>t?"...":"]";return"".concat(s).concat(o)}function Ui(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=1e-16,{isInteger:i=!1}=e;if(Array.isArray(n)||ArrayBuffer.isView(n))return LP(n,e);if(!Number.isFinite(n))return String(n);if(Math.abs(n)<t)return i?"0":"0.";if(i||Math.abs(n)>100&&Math.abs(n)<1e4)return n.toFixed(0);let s=n.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function Bc(n){let{header:e="Uniforms",program:t,uniforms:i,undefinedOnly:s=!1}=n;U(t);let o=".*_.*",a=".*Matrix",u=t._uniformSetters,l={},c=Object.keys(u).sort(),f=0;for(let x of c)!x.match(o)&&!x.match(a)&&gp({table:l,header:e,uniforms:i,uniformName:x,undefinedOnly:s})&&f++;for(let x of c)x.match(a)&&gp({table:l,header:e,uniforms:i,uniformName:x,undefinedOnly:s})&&f++;for(let x of c)l[x]||gp({table:l,header:e,uniforms:i,uniformName:x,undefinedOnly:s})&&f++;let h=0,d={};if(!s)for(let x in i){let E=i[x];l[x]||(h++,d[x]={Type:"NOT USED: ".concat(E),[e]:Ui(E)})}return{table:l,count:f,unusedTable:d,unusedCount:h}}function gp(n){let{table:e,header:t,uniforms:i,uniformName:s,undefinedOnly:o}=n,a=i[s],u=RP(a);return!o||!u?(e[s]={[t]:u?Ui(a):"N/A","Uniform Type":u?a:"NOT PROVIDED"},!0):!1}function RP(n){return n!=null}function mp(n){let{vertexArray:e,header:t="Attributes"}=n;if(!e.configuration)return{};let i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=Ax(e,e.elements,null,t));let s=e.values;for(let o in s){let a=e._getAttributeInfo(o);if(a){let u="".concat(o,": ").concat(a.name),l=e.accessors[a.location];l&&(u="".concat(o,": ").concat(DP(a.name,l))),i[u]=Ax(e,s[o],l,t)}}return i}function Ax(n,e,t,i){let{gl:s}=n;if(!e)return{[i]:"null","Format ":"N/A"};let o="NOT PROVIDED",a=1,u=0,l=0,c,f,h;if(t&&(o=t.type,a=t.size,o=String(o).replace("Array",""),c=o.indexOf("nt")!==-1),e instanceof re){let d=e,{data:x,changed:E}=d.getDebugData();f=E?"*":"",h=x,l=d.byteLength,u=l/x.BYTES_PER_ELEMENT/a;let w;if(t){let S=t.divisor>0;w="".concat(S?"I ":"P "," ").concat(u," (x").concat(a,"=").concat(l," bytes ").concat(Yt(s,o),")")}else c=!0,w="".concat(l," bytes");return{[i]:"".concat(f).concat(Ui(h,{size:a,isInteger:c})),"Format ":w}}return h=e,a=e.length,o=String(e.constructor.name).replace("Array",""),c=o.indexOf("nt")!==-1,{[i]:"".concat(Ui(h,{size:a,isInteger:c})," (constant)"),"Format ":"".concat(a,"x").concat(o," (constant)")}}function DP(n,e){let{type:t,size:i}=e,s=Oc(t,i);return s?"".concat(n," (").concat(s.name,")"):n}function xp(n){let e={},t="Accessors for ".concat(n.id);for(let i of n.attributeInfos)if(i){let s=vx(i);e["in ".concat(s)]={[t]:JSON.stringify(i.accessor)}}for(let i of n.varyingInfos)if(i){let s=vx(i);e["out ".concat(s)]={[t]:JSON.stringify(i.accessor)}}return e}function vx(n){let{type:e,size:t}=n.accessor,i=Oc(e,t);return i?"".concat(i.name," ").concat(n.name):n.name}var Tx=Xe()&&typeof document<"u",OP=0,zi=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{onCreateContext:t=S=>$s(S),onAddHTML:i=null,onInitialize:s=()=>{},onRender:o=()=>{},onFinalize:a=()=>{},onError:u,gl:l=null,glOptions:c={},debug:f=!1,createFramebuffer:h=!1,autoResizeViewport:d=!0,autoResizeDrawingBuffer:x=!0,stats:E=qt.get("animation-loop-".concat(OP++))}=e,{useDevicePixels:w=!0}=e;"useDevicePixelRatio"in e&&(W.deprecated("useDevicePixelRatio","useDevicePixels")(),w=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:i,onInitialize:s,onRender:o,onFinalize:a,onError:u,gl:l,glOptions:c,debug:f,createFramebuffer:h},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=E,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:d,autoResizeDrawingBuffer:x,useDevicePixels:w}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return U(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;let t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=un.isSupported(this.gl,["timers"])?new un(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.getElementById(e);return i?Number(i.value):t}setViewParameters(){return W.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){let e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Tx?new Promise((e,t)=>{if(Tx&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):rp(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):tp(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){let{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Fi(this.props.gl,e):this.onCreateContext(e),!rn(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Ac(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);let i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){let e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight,i=1,{canvas:s}=this.gl;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&ep(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new le(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){let{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}};var Vi="vs",Ha="fs";function Ge(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}var yp={number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},array:{validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function Sx(n){let e={};for(let t in n){let i=n[t],s=NP(i);e[t]=s}return e}function NP(n){let e=wx(n);return e==="object"?n?"type"in n?Object.assign({},n,yp[n.type]):"value"in n?(e=wx(n.value),Object.assign({type:e},n,yp[e])):{type:"object",value:n}:{type:"object",value:null}:Object.assign({type:e,value:n},yp[e])}function wx(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}var BP="vs",kP="fs",ro=class{constructor(e){let{name:t,vs:i,fs:s,dependencies:o=[],uniforms:a,getUniforms:u,deprecations:l=[],defines:c={},inject:f={},vertexShader:h,fragmentShader:d}=e;Ge(typeof t=="string"),this.name=t,this.vs=i||h,this.fs=s||d,this.getModuleUniforms=u,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=GP(f),a&&(this.uniforms=Sx(a))}getModuleSource(e){let t;switch(e){case BP:t=this.vs||"";break;case kP:t=this.fs||"";break;default:Ge(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={},i=this.uniforms;for(let s in i){let o=i[s];s in e&&!o.private?(o.validate&&Ge(o.validate(e[s],o),"".concat(this.name,": invalid ").concat(s)),t[s]=e[s]):t[s]=o.value}return t}};function GP(n){let e={vs:{},fs:{}};for(let t in n){let i=n[t],s=t.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function Px(n){return UP(Mx(n))}function UP(n){let e={},t={};return Cx({modules:n,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i])}function Cx(n){let{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(let o of e)i[o.name]=o,(s[o.name]===void 0||s[o.name]<t)&&(s[o.name]=t);for(let o of e)o.dependencies&&Cx({modules:o.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function Mx(n,e){return n.map(t=>(t instanceof ro||(Ge(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),Ge(t.name,"shader module has no name"),t=new ro(t),t.dependencies=Mx(t.dependencies)),t))}function Ep(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=typeof window<"u"?window.navigator||{}:{},t=n.userAgent||e.userAgent||"",i=t.indexOf("MSIE ")!==-1,s=t.indexOf("Trident/")!==-1;return i||s}var zP=7936,VP=7937,jP=7938,WP=35724,bp={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},zn={};Object.keys(bp).forEach(n=>{zn[n]=n});function HP(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:Boolean(n&&n._version===2)}function Ix(n){let e=n.getExtension("WEBGL_debug_renderer_info"),t=n.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||zP),i=n.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||VP);return{gpuVendor:XP(t,i),vendor:t,renderer:i,version:n.getParameter(jP),shadingLanguageVersion:n.getParameter(WP)}}function XP(n,e){return n.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":n.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":n.match(/AMD/i)||e.match(/AMD/i)||n.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}var _p={};function Ap(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=bp[e];if(Ge(i,e),!Ep(t))return!0;if(e in _p)return _p[e];let s=i[0],o=t.behavior||"enable",a="#extension GL_".concat(s," : ").concat(o,`
void main(void) {}`),u=n.createShader(35633);n.shaderSource(u,a),n.compileShader(u);let l=n.getShaderParameter(u,35713);return n.deleteShader(u),_p[e]=l,l}function qP(n,e){let t=bp[e];Ge(t,e);let i=HP(n)&&t[1]||t[0],s=typeof i=="string"?Boolean(n.getExtension(i)):i;return Ge(s===!1||s===!0),s}function Xa(n,e){return e=Array.isArray(e)?e:[e],e.every(t=>qP(n,t))}function Lx(n){switch(Ix(n).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Rx(n,e,t){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Xa(n,zn.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Xa(n,zn.GLSL_DERIVATIVES)&&Ap(n,zn.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Xa(n,zn.GLSL_FRAG_DATA)&&Ap(n,zn.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Xa(n,zn.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}var Dx=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Fx=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var YP={[Vi]:Dx,[Ha]:Fx},qa="__LUMA_INJECT_DECLARATIONS__",Ox=/void\s+main\s*\([^)]*\)\s*\{\n?/,Nx=/}\n?[^{}]*$/,vp=[];function kc(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=e===Vi;for(let o in t){let a=t[o];a.sort((l,c)=>l.order-c.order),vp.length=a.length;for(let l=0,c=a.length;l<c;++l)vp[l]=a[l].injection;let u="".concat(vp.join(`
`),`
`);switch(o){case"vs:#decl":s&&(n=n.replace(qa,u));break;case"vs:#main-start":s&&(n=n.replace(Ox,l=>l+u));break;case"vs:#main-end":s&&(n=n.replace(Nx,l=>u+l));break;case"fs:#decl":s||(n=n.replace(qa,u));break;case"fs:#main-start":s||(n=n.replace(Ox,l=>l+u));break;case"fs:#main-end":s||(n=n.replace(Nx,l=>u+l));break;default:n=n.replace(o,l=>l+u)}}return n=n.replace(qa,""),i&&(n=n.replace(/\}\s*$/,o=>o+YP[e])),n}function no(n){let e={};return Ge(Array.isArray(n)&&n.length>1),n.forEach(t=>{for(let i in t)e[i]=e[i]?"".concat(e[i],`
`).concat(t[i]):t[i]}),e}function io(n){return new RegExp("\\b".concat(n,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var Bx=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ZP=[...Bx,[io("attribute"),"in $1"],[io("varying"),"out $1"]],KP=[...Bx,[io("varying"),"in $1"]],kx=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],$P=[...kx,[io("in"),"attribute $1"],[io("out"),"varying $1"]],JP=[...kx,[io("in"),"varying $1"]],Tp="gl_FragColor",wp=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,QP=/void\s+main\s*\([^)]*\)\s*\{\n?/;function Sp(n,e,t){switch(e){case 300:return t?Gc(n,ZP):eC(n);case 100:return t?Gc(n,$P):tC(n);default:throw new Error("unknown GLSL version ".concat(e))}}function Gc(n,e){for(let[t,i]of e)n=n.replace(t,i);return n}function eC(n){n=Gc(n,KP);let e=n.match(wp);if(e){let t=e[1];n=n.replace(new RegExp("\\b".concat(Tp,"\\b"),"g"),t)}else{let t="fragmentColor";n=n.replace(QP,i=>"out vec4 ".concat(t,`;
`).concat(i)).replace(new RegExp("\\b".concat(Tp,"\\b"),"g"),t)}return n}function tC(n){n=Gc(n,JP);let e=n.match(wp);if(e){let t=e[1];n=n.replace(wp,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),Tp)}return n}var rC=`

`.concat(qa,`

`),Ux={[Vi]:"vertex",[Ha]:"fragment"},nC=`precision highp float;

`;function Pp(n,e){let{vs:t,fs:i}=e,s=Px(e.modules||[]);return{gl:n,vs:Gx(n,Object.assign({},e,{source:t,type:Vi,modules:s})),fs:Gx(n,Object.assign({},e,{source:i,type:Ha,modules:s})),getUniforms:iC(s)}}function Gx(n,e){let{id:t,source:i,type:s,modules:o,defines:a={},hookFunctions:u=[],inject:l={},transpileToGLSL100:c=!1,prologue:f=!0,log:h}=e;Ge(typeof i=="string","shader source must be a string");let d=s===Vi,x=i.split(`
`),E=100,w="",S=i;x[0].indexOf("#version ")===0?(E=300,w=x[0],S=x.slice(1).join(`
`)):w="#version ".concat(E);let M={};o.forEach(J=>{Object.assign(M,J.getDefines())}),Object.assign(M,a);let D=f?"".concat(w,`
`).concat(oC({id:t,source:i,type:s}),`
`).concat(sC({type:s}),`
`).concat(Lx(n),`
`).concat(Rx(n,E,!d),`
`).concat(aC(M),`
`).concat(d?"":nC,`
`):"".concat(w,`
`),C=lC(u),L={},B={},j={};for(let J in l){let te=typeof l[J]=="string"?{injection:l[J],order:0}:l[J],Z=J.match(/^(v|f)s:(#)?([\w-]+)$/);if(Z){let q=Z[2],H=Z[3];q?H==="decl"?B[J]=[te]:j[J]=[te]:L[J]=[te]}else j[J]=[te]}for(let J of o){h&&J.checkDeprecations(S,h),D+=J.getModuleSource(s,E);let Z=J.injections[s];for(let q in Z){let H=q.match(/^(v|f)s:#([\w-]+)$/);if(H){let ee=H[2]==="decl"?B:j;ee[q]=ee[q]||[],ee[q].push(Z[q])}else L[q]=L[q]||[],L[q].push(Z[q])}}return D+=rC,D=kc(D,s,B),D+=uC(C[s],L),D+=S,D=kc(D,s,j),D=Sp(D,c?100:E,d),D}function iC(n){return function(t){let i={};for(let s of n){let o=s.getUniforms(t,i);Object.assign(i,o)}return i}}function sC(n){let{type:e}=n;return`
#define SHADER_TYPE_`.concat(Ux[e].toUpperCase(),`
`)}function oC(n){let{id:e,source:t,type:i}=n;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(Ux[i],`

`):""}function aC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(let i in n){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;let s=n[i];(s||Number.isFinite(s))&&(t+="#define ".concat(i.toUpperCase()," ").concat(n[i],`
`))}return e===0&&(t+=`
`),t}function uC(n,e){let t="";for(let i in n){let s=n[i];if(t+="void ".concat(s.signature,` {
`),s.header&&(t+="  ".concat(s.header)),e[i]){let o=e[i];o.sort((a,u)=>a.order-u.order);for(let a of o)t+="  ".concat(a.injection,`
`)}s.footer&&(t+="  ".concat(s.footer)),t+=`}
`}return t}function lC(n){let e={vs:{},fs:{}};return n.forEach(t=>{let i;typeof t!="string"?(i=t,t=i.hook):i={},t=t.trim();let[s,o]=t.split(":"),a=t.replace(/\(.+/,"");e[s][a]=Object.assign(i,{signature:o})}),e}var cC="void main() {gl_FragColor = vec4(0);}",zx=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,fC=`#version 300 es
`.concat(zx);function Uc(n,e){e=Array.isArray(e)?e:[e];let t=n.replace(/^\s+/,"").split(/\s+/),[i,s,o]=t;if(!e.includes(i)||!s||!o)return null;let a=o.split(";")[0];return{qualifier:i,type:s,name:a}}function Ya(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{version:e=100,input:t,inputType:i,output:s}=n;if(!t)return e===300?fC:e>300?"#version ".concat(e,`
`).concat(zx):cC;let o=Vx(t,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(t,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(o,`;
}`):"varying ".concat(i," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function Cp(n){switch(n){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Ge(!1),null}}function Mp(n){switch(n){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Ge(!1),null}}function Vx(n,e){switch(e){case"float":return"vec4(".concat(n,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(n,", 0.0, 1.0)");case"vec3":return"vec4(".concat(n,", 1.0)");case"vec4":return n;default:return Ge(!1),null}}var hC=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,zc={name:"fp32",vs:hC,fs:null};function lr(n,e){if(!n)throw new Error("math.gl assertion ".concat(e))}var C9=1/Math.PI*180,M9=1/180*Math.PI,Ue={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Ip(n,{precision:e=Ue.precision}={}){return n=dC(n),"".concat(parseFloat(n.toPrecision(e)))}function cr(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Le(n,e,t){return gC(n,i=>Math.max(e,Math.min(t,i)))}function ji(n,e,t){return cr(n)?n.map((i,s)=>ji(i,e[s],t)):t*e+(1-t)*n}function rt(n,e,t){let i=Ue.EPSILON;t&&(Ue.EPSILON=t);try{if(n===e)return!0;if(cr(n)&&cr(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!rt(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Ue.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Ue.EPSILON=i}}function dC(n){return Math.round(n/Ue.EPSILON)*Ue.EPSILON}function pC(n){return n.clone?n.clone():new Array(n.length)}function gC(n,e,t){if(cr(n)){let i=n;t=t||pC(i);for(let s=0;s<t.length&&s<i.length;++s)t[s]=e(n[s],s,t);return t}return e(n)}function mC(n){function e(){var t=Reflect.construct(n,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(n.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n,e}var cn=class extends mC(Array){clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:cr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ue)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+Ip(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!rt(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){let o=e[s];this[s]=o+i*(t[s]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Ue.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}};function xC(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function pe(n){if(!Number.isFinite(n))throw new Error("Invalid number ".concat(n));return n}function Vn(n,e,t=""){if(Ue.debug&&!xC(n,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return n}var Wi=class extends cn{get x(){return this[0]}set x(e){this[0]=pe(e)}get y(){return this[1]}set y(e){this[1]=pe(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){let s=this[i]-e[i];t+=s*s}return pe(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return pe(t)}normalize(){let e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return lr(e>=0&&e<this.ELEMENTS,"index is out of range"),pe(this[e])}setComponent(e,t){return lr(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var fr=1e-6,nt=typeof Float32Array<"u"?Float32Array:Array;var G9=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function yC(){var n=new nt(2);return nt!=Float32Array&&(n[0]=0,n[1]=0),n}function oo(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function Vc(n,e){return n[0]=-e[0],n[1]=-e[1],n}function jc(n,e,t,i){var s=e[0],o=e[1];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n}function jx(n,e,t){var i=e[0],s=e[1];return n[0]=t[0]*i+t[3]*s+t[6],n[1]=t[1]*i+t[4]*s+t[7],n}function Wx(n,e,t){var i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}var U9=function(){var n=yC();return function(e,t,i,s,o,a){var u,l;for(t||(t=2),i||(i=0),s?l=Math.min(s*t+i,e.length):l=e.length,u=i;u<l;u+=t)n[0]=e[u],n[1]=e[u+1],o(n,n,a),e[u]=n[0],e[u+1]=n[1];return e}}();function Hx(n,e,t){let i=e[0],s=e[1],o=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/o,n[1]=(t[1]*i+t[5]*s)/o,n}function Wc(n,e,t){let i=e[0],s=e[1],o=e[2],a=t[3]*i+t[7]*s+t[11]*o||1;return n[0]=(t[0]*i+t[4]*s+t[8]*o)/a,n[1]=(t[1]*i+t[5]*s+t[9]*o)/a,n[2]=(t[2]*i+t[6]*s+t[10]*o)/a,n}function Xx(n,e,t){let i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function qx(n,e,t){let i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n[3]=e[3],n}function Hc(n,e,t){let i=e[0],s=e[1],o=e[2];return n[0]=t[0]*i+t[3]*s+t[6]*o,n[1]=t[1]*i+t[4]*s+t[7]*o,n[2]=t[2]*i+t[5]*s+t[8]*o,n[3]=e[3],n}function Rp(){var n=new nt(3);return nt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function EC(n){var e=n[0],t=n[1],i=n[2];return Math.hypot(e,t,i)}function Dp(n,e,t){var i=new nt(3);return i[0]=n,i[1]=e,i[2]=t,i}function _C(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function bC(n){var e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function Yx(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Zx(n,e){var t=e[0],i=e[1],s=e[2],o=t*t+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n}function Fp(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function uo(n,e,t){var i=e[0],s=e[1],o=e[2],a=t[0],u=t[1],l=t[2];return n[0]=s*l-o*u,n[1]=o*a-i*l,n[2]=i*u-s*a,n}function Kx(n,e,t,i){var s=e[0],o=e[1],a=e[2];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n[2]=a+i*(t[2]-a),n}function lo(n,e,t){var i=e[0],s=e[1],o=e[2],a=t[3]*i+t[7]*s+t[11]*o+t[15];return a=a||1,n[0]=(t[0]*i+t[4]*s+t[8]*o+t[12])/a,n[1]=(t[1]*i+t[5]*s+t[9]*o+t[13])/a,n[2]=(t[2]*i+t[6]*s+t[10]*o+t[14])/a,n}function Xc(n,e,t){var i=e[0],s=e[1],o=e[2];return n[0]=i*t[0]+s*t[3]+o*t[6],n[1]=i*t[1]+s*t[4]+o*t[7],n[2]=i*t[2]+s*t[5]+o*t[8],n}function qc(n,e,t){var i=t[0],s=t[1],o=t[2],a=t[3],u=e[0],l=e[1],c=e[2],f=s*c-o*l,h=o*u-i*c,d=i*l-s*u,x=s*d-o*h,E=o*f-i*d,w=i*h-s*f,S=a*2;return f*=S,h*=S,d*=S,x*=2,E*=2,w*=2,n[0]=u+f+x,n[1]=l+h+E,n[2]=c+d+w,n}function $x(n,e,t,i){var s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0],o[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),o[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function Jx(n,e,t,i){var s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),o[1]=s[1],o[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function Qx(n,e,t,i){var s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function ey(n,e){var t=n[0],i=n[1],s=n[2],o=e[0],a=e[1],u=e[2],l=Math.sqrt(t*t+i*i+s*s),c=Math.sqrt(o*o+a*a+u*u),f=l*c,h=f&&Fp(n,e)/f;return Math.acos(Math.min(Math.max(h,-1),1))}var Yc=_C;var Zc=EC,Kc=bC,V9=function(){var n=Rp();return function(e,t,i,s,o,a){var u,l;for(t||(t=3),i||(i=0),s?l=Math.min(s*t+i,e.length):l=e.length,u=i;u<l;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],o(n,n,a),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2];return e}}();var Op=[0,0,0],$c,V=class extends Wi{static get ZERO(){return $c||($c=new V(0,0,0),Object.freeze($c)),$c}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&cr(e)?this.copy(e):(Ue.debug&&(pe(e),pe(t),pe(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ue.debug&&(pe(e.x),pe(e.y),pe(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=pe(e)}angle(e){return ey(this,e)}cross(e){return uo(this,this,e),this.check()}rotateX({radians:e,origin:t=Op}){return $x(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Op}){return Jx(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Op}){return Qx(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return lo(this,this,e),this.check()}transformAsVector(e){return Wc(this,this,e),this.check()}transformByMatrix3(e){return Xc(this,this,e),this.check()}transformByMatrix2(e){return Xx(this,this,e),this.check()}transformByQuaternion(e){return qc(this,this,e),this.check()}};var Jc,Hi=class extends Wi{static get ZERO(){return Jc||(Jc=new Hi(0,0,0,0),Object.freeze(Jc)),Jc}constructor(e=0,t=0,i=0,s=0){super(-0,-0,-0,-0),cr(e)&&arguments.length===1?this.copy(e):(Ue.debug&&(pe(e),pe(t),pe(i),pe(s)),this[0]=e,this[1]=t,this[2]=i,this[3]=s)}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ue.debug&&(pe(e.x),pe(e.y),pe(e.z),pe(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=pe(e)}get w(){return this[3]}set w(e){this[3]=pe(e)}transform(e){return lo(this,this,e),this.check()}transformByMatrix3(e){return Hc(this,this,e),this.check()}transformByMatrix2(e){return qx(this,this,e),this.check()}transformByQuaternion(e){return qc(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}};var Xi=class extends cn{toString(){let e="[";if(Ue.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=pe(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){let i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}};function ty(){var n=new nt(9);return nt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ry(n,e){if(n===e){var t=e[1],i=e[2],s=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=i,n[7]=s}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function ny(n,e){var t=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],c=e[7],f=e[8],h=f*a-u*c,d=-f*o+u*l,x=c*o-a*l,E=t*h+i*d+s*x;return E?(E=1/E,n[0]=h*E,n[1]=(-f*i+s*c)*E,n[2]=(u*i-s*a)*E,n[3]=d*E,n[4]=(f*t-s*l)*E,n[5]=(-u*t+s*o)*E,n[6]=x*E,n[7]=(-c*t+i*l)*E,n[8]=(a*t-i*o)*E,n):null}function iy(n){var e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],a=n[5],u=n[6],l=n[7],c=n[8];return e*(c*o-a*l)+t*(-c*s+a*u)+i*(l*s-o*u)}function Np(n,e,t){var i=e[0],s=e[1],o=e[2],a=e[3],u=e[4],l=e[5],c=e[6],f=e[7],h=e[8],d=t[0],x=t[1],E=t[2],w=t[3],S=t[4],M=t[5],D=t[6],C=t[7],L=t[8];return n[0]=d*i+x*a+E*c,n[1]=d*s+x*u+E*f,n[2]=d*o+x*l+E*h,n[3]=w*i+S*a+M*c,n[4]=w*s+S*u+M*f,n[5]=w*o+S*l+M*h,n[6]=D*i+C*a+L*c,n[7]=D*s+C*u+L*f,n[8]=D*o+C*l+L*h,n}function sy(n,e,t){var i=e[0],s=e[1],o=e[2],a=e[3],u=e[4],l=e[5],c=e[6],f=e[7],h=e[8],d=t[0],x=t[1];return n[0]=i,n[1]=s,n[2]=o,n[3]=a,n[4]=u,n[5]=l,n[6]=d*i+x*a+c,n[7]=d*s+x*u+f,n[8]=d*o+x*l+h,n}function oy(n,e,t){var i=e[0],s=e[1],o=e[2],a=e[3],u=e[4],l=e[5],c=e[6],f=e[7],h=e[8],d=Math.sin(t),x=Math.cos(t);return n[0]=x*i+d*a,n[1]=x*s+d*u,n[2]=x*o+d*l,n[3]=x*a-d*i,n[4]=x*u-d*s,n[5]=x*l-d*o,n[6]=c,n[7]=f,n[8]=h,n}function Bp(n,e,t){var i=t[0],s=t[1];return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function ay(n,e){var t=e[0],i=e[1],s=e[2],o=e[3],a=t+t,u=i+i,l=s+s,c=t*a,f=i*a,h=i*u,d=s*a,x=s*u,E=s*l,w=o*a,S=o*u,M=o*l;return n[0]=1-h-E,n[3]=f-M,n[6]=d+S,n[1]=f+M,n[4]=1-c-E,n[7]=x-w,n[2]=d-S,n[5]=x+w,n[8]=1-c-h,n}var kp;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(kp||(kp={}));var AC=Object.freeze([1,0,0,0,1,0,0,0,1]),Se=class extends Xi{static get IDENTITY(){return TC()}static get ZERO(){return vC()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return kp}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(AC)}fromObject(e){return this.check()}fromQuaternion(e){return ay(this,e),this.check()}set(e,t,i,s,o,a,u,l,c){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=a,this[6]=u,this[7]=l,this[8]=c,this.check()}setRowMajor(e,t,i,s,o,a,u,l,c){return this[0]=e,this[1]=s,this[2]=u,this[3]=t,this[4]=o,this[5]=l,this[6]=i,this[7]=a,this[8]=c,this.check()}determinant(){return iy(this)}transpose(){return ry(this,this),this.check()}invert(){return ny(this,this),this.check()}multiplyLeft(e){return Np(this,e,this),this.check()}multiplyRight(e){return Np(this,this,e),this.check()}rotate(e){return oy(this,this,e),this.check()}scale(e){return Array.isArray(e)?Bp(this,this,e):Bp(this,this,[e,e]),this.check()}translate(e){return sy(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=jx(t||[-0,-0],e,this);break;case 3:i=Xc(t||[-0,-0,-0],e,this);break;case 4:i=Hc(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vn(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}},Qc,ef;function vC(){return Qc||(Qc=new Se([0,0,0,0,0,0,0,0,0]),Object.freeze(Qc)),Qc}function TC(){return ef||(ef=new Se,Object.freeze(ef)),ef}function wC(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ly(n,e){if(n===e){var t=e[1],i=e[2],s=e[3],o=e[6],a=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=o,n[11]=e[14],n[12]=s,n[13]=a,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Za(n,e){var t=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],c=e[7],f=e[8],h=e[9],d=e[10],x=e[11],E=e[12],w=e[13],S=e[14],M=e[15],D=t*u-i*a,C=t*l-s*a,L=t*c-o*a,B=i*l-s*u,j=i*c-o*u,J=s*c-o*l,te=f*w-h*E,Z=f*S-d*E,q=f*M-x*E,H=h*S-d*w,ie=h*M-x*w,ee=d*M-x*S,fe=D*ee-C*ie+L*H+B*q-j*Z+J*te;return fe?(fe=1/fe,n[0]=(u*ee-l*ie+c*H)*fe,n[1]=(s*ie-i*ee-o*H)*fe,n[2]=(w*J-S*j+M*B)*fe,n[3]=(d*j-h*J-x*B)*fe,n[4]=(l*q-a*ee-c*Z)*fe,n[5]=(t*ee-s*q+o*Z)*fe,n[6]=(S*L-E*J-M*C)*fe,n[7]=(f*J-d*L+x*C)*fe,n[8]=(a*ie-u*q+c*te)*fe,n[9]=(i*q-t*ie-o*te)*fe,n[10]=(E*j-w*L+M*D)*fe,n[11]=(h*L-f*j-x*D)*fe,n[12]=(u*Z-a*H-l*te)*fe,n[13]=(t*H-i*Z+s*te)*fe,n[14]=(w*C-E*B-S*D)*fe,n[15]=(f*B-h*C+d*D)*fe,n):null}function cy(n){var e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],a=n[5],u=n[6],l=n[7],c=n[8],f=n[9],h=n[10],d=n[11],x=n[12],E=n[13],w=n[14],S=n[15],M=e*a-t*o,D=e*u-i*o,C=e*l-s*o,L=t*u-i*a,B=t*l-s*a,j=i*l-s*u,J=c*E-f*x,te=c*w-h*x,Z=c*S-d*x,q=f*w-h*E,H=f*S-d*E,ie=h*S-d*w;return M*ie-D*H+C*q+L*Z-B*te+j*J}function Nr(n,e,t){var i=e[0],s=e[1],o=e[2],a=e[3],u=e[4],l=e[5],c=e[6],f=e[7],h=e[8],d=e[9],x=e[10],E=e[11],w=e[12],S=e[13],M=e[14],D=e[15],C=t[0],L=t[1],B=t[2],j=t[3];return n[0]=C*i+L*u+B*h+j*w,n[1]=C*s+L*l+B*d+j*S,n[2]=C*o+L*c+B*x+j*M,n[3]=C*a+L*f+B*E+j*D,C=t[4],L=t[5],B=t[6],j=t[7],n[4]=C*i+L*u+B*h+j*w,n[5]=C*s+L*l+B*d+j*S,n[6]=C*o+L*c+B*x+j*M,n[7]=C*a+L*f+B*E+j*D,C=t[8],L=t[9],B=t[10],j=t[11],n[8]=C*i+L*u+B*h+j*w,n[9]=C*s+L*l+B*d+j*S,n[10]=C*o+L*c+B*x+j*M,n[11]=C*a+L*f+B*E+j*D,C=t[12],L=t[13],B=t[14],j=t[15],n[12]=C*i+L*u+B*h+j*w,n[13]=C*s+L*l+B*d+j*S,n[14]=C*o+L*c+B*x+j*M,n[15]=C*a+L*f+B*E+j*D,n}function qi(n,e,t){var i=t[0],s=t[1],o=t[2],a,u,l,c,f,h,d,x,E,w,S,M;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*o+e[12],n[13]=e[1]*i+e[5]*s+e[9]*o+e[13],n[14]=e[2]*i+e[6]*s+e[10]*o+e[14],n[15]=e[3]*i+e[7]*s+e[11]*o+e[15]):(a=e[0],u=e[1],l=e[2],c=e[3],f=e[4],h=e[5],d=e[6],x=e[7],E=e[8],w=e[9],S=e[10],M=e[11],n[0]=a,n[1]=u,n[2]=l,n[3]=c,n[4]=f,n[5]=h,n[6]=d,n[7]=x,n[8]=E,n[9]=w,n[10]=S,n[11]=M,n[12]=a*i+f*s+E*o+e[12],n[13]=u*i+h*s+w*o+e[13],n[14]=l*i+d*s+S*o+e[14],n[15]=c*i+x*s+M*o+e[15]),n}function co(n,e,t){var i=t[0],s=t[1],o=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function fy(n,e,t,i){var s=i[0],o=i[1],a=i[2],u=Math.hypot(s,o,a),l,c,f,h,d,x,E,w,S,M,D,C,L,B,j,J,te,Z,q,H,ie,ee,fe,mt;return u<fr?null:(u=1/u,s*=u,o*=u,a*=u,l=Math.sin(t),c=Math.cos(t),f=1-c,h=e[0],d=e[1],x=e[2],E=e[3],w=e[4],S=e[5],M=e[6],D=e[7],C=e[8],L=e[9],B=e[10],j=e[11],J=s*s*f+c,te=o*s*f+a*l,Z=a*s*f-o*l,q=s*o*f-a*l,H=o*o*f+c,ie=a*o*f+s*l,ee=s*a*f+o*l,fe=o*a*f-s*l,mt=a*a*f+c,n[0]=h*J+w*te+C*Z,n[1]=d*J+S*te+L*Z,n[2]=x*J+M*te+B*Z,n[3]=E*J+D*te+j*Z,n[4]=h*q+w*H+C*ie,n[5]=d*q+S*H+L*ie,n[6]=x*q+M*H+B*ie,n[7]=E*q+D*H+j*ie,n[8]=h*ee+w*fe+C*mt,n[9]=d*ee+S*fe+L*mt,n[10]=x*ee+M*fe+B*mt,n[11]=E*ee+D*fe+j*mt,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function tf(n,e,t){var i=Math.sin(t),s=Math.cos(t),o=e[4],a=e[5],u=e[6],l=e[7],c=e[8],f=e[9],h=e[10],d=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*s+c*i,n[5]=a*s+f*i,n[6]=u*s+h*i,n[7]=l*s+d*i,n[8]=c*s-o*i,n[9]=f*s-a*i,n[10]=h*s-u*i,n[11]=d*s-l*i,n}function hy(n,e,t){var i=Math.sin(t),s=Math.cos(t),o=e[0],a=e[1],u=e[2],l=e[3],c=e[8],f=e[9],h=e[10],d=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s-c*i,n[1]=a*s-f*i,n[2]=u*s-h*i,n[3]=l*s-d*i,n[8]=o*i+c*s,n[9]=a*i+f*s,n[10]=u*i+h*s,n[11]=l*i+d*s,n}function rf(n,e,t){var i=Math.sin(t),s=Math.cos(t),o=e[0],a=e[1],u=e[2],l=e[3],c=e[4],f=e[5],h=e[6],d=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s+c*i,n[1]=a*s+f*i,n[2]=u*s+h*i,n[3]=l*s+d*i,n[4]=c*s-o*i,n[5]=f*s-a*i,n[6]=h*s-u*i,n[7]=d*s-l*i,n}function dy(n,e){var t=e[0],i=e[1],s=e[2],o=e[4],a=e[5],u=e[6],l=e[8],c=e[9],f=e[10];return n[0]=Math.hypot(t,i,s),n[1]=Math.hypot(o,a,u),n[2]=Math.hypot(l,c,f),n}function py(n,e){var t=e[0],i=e[1],s=e[2],o=e[3],a=t+t,u=i+i,l=s+s,c=t*a,f=i*a,h=i*u,d=s*a,x=s*u,E=s*l,w=o*a,S=o*u,M=o*l;return n[0]=1-h-E,n[1]=f+M,n[2]=d-S,n[3]=0,n[4]=f-M,n[5]=1-c-E,n[6]=x+w,n[7]=0,n[8]=d+S,n[9]=x-w,n[10]=1-c-h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function gy(n,e,t,i,s,o,a){var u=1/(t-e),l=1/(s-i),c=1/(o-a);return n[0]=o*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*l,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(s+i)*l,n[10]=(a+o)*c,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*o*2*c,n[15]=0,n}function SC(n,e,t,i,s){var o=1/Math.tan(e/2),a;return n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0?(a=1/(i-s),n[10]=(s+i)*a,n[14]=2*s*i*a):(n[10]=-1,n[14]=-2*i),n}var Gp=SC;function PC(n,e,t,i,s,o,a){var u=1/(e-t),l=1/(i-s),c=1/(o-a);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*c,n[11]=0,n[12]=(e+t)*u,n[13]=(s+i)*l,n[14]=(a+o)*c,n[15]=1,n}var my=PC;function xy(n,e,t,i){var s,o,a,u,l,c,f,h,d,x,E=e[0],w=e[1],S=e[2],M=i[0],D=i[1],C=i[2],L=t[0],B=t[1],j=t[2];return Math.abs(E-L)<fr&&Math.abs(w-B)<fr&&Math.abs(S-j)<fr?wC(n):(f=E-L,h=w-B,d=S-j,x=1/Math.hypot(f,h,d),f*=x,h*=x,d*=x,s=D*d-C*h,o=C*f-M*d,a=M*h-D*f,x=Math.hypot(s,o,a),x?(x=1/x,s*=x,o*=x,a*=x):(s=0,o=0,a=0),u=h*a-d*o,l=d*s-f*a,c=f*o-h*s,x=Math.hypot(u,l,c),x?(x=1/x,u*=x,l*=x,c*=x):(u=0,l=0,c=0),n[0]=s,n[1]=u,n[2]=f,n[3]=0,n[4]=o,n[5]=l,n[6]=h,n[7]=0,n[8]=a,n[9]=c,n[10]=d,n[11]=0,n[12]=-(s*E+o*w+a*S),n[13]=-(u*E+l*w+c*S),n[14]=-(f*E+h*w+d*S),n[15]=1,n)}function CC(){var n=new nt(4);return nt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function yy(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function fo(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Ey(n){var e=n[0],t=n[1],i=n[2],s=n[3];return Math.hypot(e,t,i,s)}function _y(n){var e=n[0],t=n[1],i=n[2],s=n[3];return e*e+t*t+i*i+s*s}function by(n,e){var t=e[0],i=e[1],s=e[2],o=e[3],a=t*t+i*i+s*s+o*o;return a>0&&(a=1/Math.sqrt(a)),n[0]=t*a,n[1]=i*a,n[2]=s*a,n[3]=o*a,n}function Ay(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function vy(n,e,t,i){var s=e[0],o=e[1],a=e[2],u=e[3];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n[2]=a+i*(t[2]-a),n[3]=u+i*(t[3]-u),n}function hr(n,e,t){var i=e[0],s=e[1],o=e[2],a=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*o+t[12]*a,n[1]=t[1]*i+t[5]*s+t[9]*o+t[13]*a,n[2]=t[2]*i+t[6]*s+t[10]*o+t[14]*a,n[3]=t[3]*i+t[7]*s+t[11]*o+t[15]*a,n}function Ty(n,e,t){var i=e[0],s=e[1],o=e[2],a=t[0],u=t[1],l=t[2],c=t[3],f=c*i+u*o-l*s,h=c*s+l*i-a*o,d=c*o+a*s-u*i,x=-a*i-u*s-l*o;return n[0]=f*c+x*-a+h*-l-d*-u,n[1]=h*c+x*-u+d*-a-f*-l,n[2]=d*c+x*-l+f*-u-h*-a,n[3]=e[3],n}var az=function(){var n=CC();return function(e,t,i,s,o,a){var u,l;for(t||(t=4),i||(i=0),s?l=Math.min(s*t+i,e.length):l=e.length,u=i;u<l;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],n[3]=e[u+3],o(n,n,a),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2],e[u+3]=n[3];return e}}();var Vp;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Vp||(Vp={}));var MC=45*Math.PI/180,IC=1,Up=.1,zp=500,LC=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ge=class extends Xi{static get IDENTITY(){return DC()}static get ZERO(){return RC()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Vp}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,o,a,u,l,c,f,h,d,x,E,w,S){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=a,this[6]=u,this[7]=l,this[8]=c,this[9]=f,this[10]=h,this[11]=d,this[12]=x,this[13]=E,this[14]=w,this[15]=S,this.check()}setRowMajor(e,t,i,s,o,a,u,l,c,f,h,d,x,E,w,S){return this[0]=e,this[1]=o,this[2]=c,this[3]=x,this[4]=t,this[5]=a,this[6]=f,this[7]=E,this[8]=i,this[9]=u,this[10]=h,this[11]=w,this[12]=s,this[13]=l,this[14]=d,this[15]=S,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(LC)}fromObject(e){return this.check()}fromQuaternion(e){return py(this,e),this.check()}frustum(e){let{left:t,right:i,bottom:s,top:o,near:a=Up,far:u=zp}=e;return u===1/0?FC(this,t,i,s,o,a):gy(this,t,i,s,o,a,u),this.check()}lookAt(e){let{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return xy(this,t,i,s),this.check()}ortho(e){let{left:t,right:i,bottom:s,top:o,near:a=Up,far:u=zp}=e;return my(this,t,i,s,o,a,u),this.check()}orthographic(e){let{fovy:t=MC,aspect:i=IC,focalDistance:s=1,near:o=Up,far:a=zp}=e;wy(t);let u=t/2,l=s*Math.tan(u),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:o,far:a})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:o=500}=e;return wy(t),Gp(this,t,i,s,o),this.check()}determinant(){return cy(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),s=1/i[0],o=1/i[1],a=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*o,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*o,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),s=1/i[0],o=1/i[1],a=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=this[4]*s,e[4]=this[5]*o,e[5]=this[6]*a,e[6]=this[8]*s,e[7]=this[9]*o,e[8]=this[10]*a,e}transpose(){return ly(this,this),this.check()}invert(){return Za(this,this),this.check()}multiplyLeft(e){return Nr(this,e,this),this.check()}multiplyRight(e){return Nr(this,this,e),this.check()}rotateX(e){return tf(this,this,e),this.check()}rotateY(e){return hy(this,this,e),this.check()}rotateZ(e){return rf(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return fy(this,this,e,t),this.check()}scale(e){return co(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return qi(this,this,e),this.check()}transform(e,t){return e.length===4?(t=hr(t||[-0,-0,-0,-0],e,this),Vn(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let{length:i}=e,s;switch(i){case 2:s=Wx(t||[-0,-0],e,this);break;case 3:s=lo(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vn(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=Hx(t||[-0,-0],e,this);break;case 3:i=Wc(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vn(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}},nf,sf;function RC(){return nf||(nf=new ge([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(nf)),nf}function DC(){return sf||(sf=new ge,Object.freeze(sf)),sf}function wy(n){if(n>Math.PI*2)throw Error("expected radians")}function FC(n,e,t,i,s,o){let a=2*o/(t-e),u=2*o/(s-i),l=(t+e)/(t-e),c=(s+i)/(s-i),f=-1,h=-1,d=-2*o;return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=l,n[9]=c,n[10]=f,n[11]=h,n[12]=0,n[13]=0,n[14]=d,n[15]=0,n}function Sy(){var n=new nt(4);return nt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Py(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function jp(n,e,t){t=t*.5;var i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function Wp(n,e,t){var i=e[0],s=e[1],o=e[2],a=e[3],u=t[0],l=t[1],c=t[2],f=t[3];return n[0]=i*f+a*u+s*c-o*l,n[1]=s*f+a*l+o*u-i*c,n[2]=o*f+a*c+i*l-s*u,n[3]=a*f-i*u-s*l-o*c,n}function Cy(n,e,t){t*=.5;var i=e[0],s=e[1],o=e[2],a=e[3],u=Math.sin(t),l=Math.cos(t);return n[0]=i*l+a*u,n[1]=s*l+o*u,n[2]=o*l-s*u,n[3]=a*l-i*u,n}function My(n,e,t){t*=.5;var i=e[0],s=e[1],o=e[2],a=e[3],u=Math.sin(t),l=Math.cos(t);return n[0]=i*l-o*u,n[1]=s*l+a*u,n[2]=o*l+i*u,n[3]=a*l-s*u,n}function Iy(n,e,t){t*=.5;var i=e[0],s=e[1],o=e[2],a=e[3],u=Math.sin(t),l=Math.cos(t);return n[0]=i*l+s*u,n[1]=s*l-i*u,n[2]=o*l+a*u,n[3]=a*l-o*u,n}function Ly(n,e){var t=e[0],i=e[1],s=e[2];return n[0]=t,n[1]=i,n[2]=s,n[3]=Math.sqrt(Math.abs(1-t*t-i*i-s*s)),n}function $a(n,e,t,i){var s=e[0],o=e[1],a=e[2],u=e[3],l=t[0],c=t[1],f=t[2],h=t[3],d,x,E,w,S;return x=s*l+o*c+a*f+u*h,x<0&&(x=-x,l=-l,c=-c,f=-f,h=-h),1-x>fr?(d=Math.acos(x),E=Math.sin(d),w=Math.sin((1-i)*d)/E,S=Math.sin(i*d)/E):(w=1-i,S=i),n[0]=w*s+S*l,n[1]=w*o+S*c,n[2]=w*a+S*f,n[3]=w*u+S*h,n}function Ry(n,e){var t=e[0],i=e[1],s=e[2],o=e[3],a=t*t+i*i+s*s+o*o,u=a?1/a:0;return n[0]=-t*u,n[1]=-i*u,n[2]=-s*u,n[3]=o*u,n}function Dy(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function Hp(n,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var o=(s+1)%3,a=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[a*3+a]+1),n[s]=.5*i,i=.5/i,n[3]=(e[o*3+a]-e[a*3+o])*i,n[o]=(e[o*3+s]+e[s*3+o])*i,n[a]=(e[a*3+s]+e[s*3+a])*i}return n}var Fy=yy;var Oy=fo,Ny=Ay,By=vy,ky=Ey;var Gy=_y;var Uy=by;var zy=function(){var n=Rp(),e=Dp(1,0,0),t=Dp(0,1,0);return function(i,s,o){var a=Fp(s,o);return a<-.999999?(uo(n,e,s),Zc(n)<1e-6&&uo(n,t,s),Zx(n,n),jp(i,n,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(uo(n,s,o),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+a,Uy(i,i))}}(),yz=function(){var n=Sy(),e=Sy();return function(t,i,s,o,a,u){return $a(n,i,a,u),$a(e,s,o,u),$a(t,n,e,2*u*(1-u)),t}}(),Ez=function(){var n=ty();return function(e,t,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Uy(e,Hp(e,n))}}();var NC=[0,0,0,1],Yi=class extends cn{constructor(e=0,t=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Hp(this,e),this.check()}fromAxisRotation(e,t){return jp(this,e,t),this.check()}identity(){return Py(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=pe(e)}get y(){return this[1]}set y(e){this[1]=pe(e)}get z(){return this[2]}set z(e){this[2]=pe(e)}get w(){return this[3]}set w(e){this[3]=pe(e)}len(){return ky(this)}lengthSquared(){return Gy(this)}dot(e){return Ny(this,e)}rotationTo(e,t){return zy(this,e,t),this.check()}add(e){return Fy(this,this,e),this.check()}calculateW(){return Ly(this,this),this.check()}conjugate(){return Dy(this,this),this.check()}invert(){return Ry(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):(By(this,e,t,i),this.check())}multiplyRight(e){return Wp(this,this,e),this.check()}multiplyLeft(e){return Wp(this,e,this),this.check()}normalize(){let e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Cy(this,this,e),this.check()}rotateY(e){return My(this,this,e),this.check()}rotateZ(e){return Iy(this,this,e),this.check()}scale(e){return Oy(this,this,e),this.check()}slerp(e,t,i){let s,o,a;switch(arguments.length){case 1:({start:s=NC,target:o,ratio:a}=e);break;case 2:s=this,o=e,a=t;break;default:s=e,o=t,a=i}return $a(this,s,o,a),this.check()}transformVector4(e,t=new Hi){return Ty(t,e,this),Vn(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};var of={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2};var Xp=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;var BC={lightSources:{}};function qp(){let{color:n=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return n.map(t=>t*e/255)}function kC(n){let{ambientLight:e,pointLights:t=[],directionalLights:i=[]}=n,s={};return e?s["lighting_uAmbientLight.color"]=qp(e):s["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,a)=>{s["lighting_uPointLight[".concat(a,"].color")]=qp(o),s["lighting_uPointLight[".concat(a,"].position")]=o.position,s["lighting_uPointLight[".concat(a,"].attenuation")]=o.attenuation||[1,0,0]}),s.lighting_uPointLightCount=t.length,i.forEach((o,a)=>{s["lighting_uDirectionalLight[".concat(a,"].color")]=qp(o),s["lighting_uDirectionalLight[".concat(a,"].direction")]=o.direction}),s.lighting_uDirectionalLightCount=i.length,s}function Vy(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:BC;if("lightSources"in n){let{ambientLight:e,pointLights:t,directionalLights:i}=n.lightSources||{};return e||t&&t.length>0||i&&i.length>0?Object.assign({},kC({ambientLight:e,pointLights:t,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in n){let e={pointLights:[],directionalLights:[]};for(let t of n.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break;default:}return Vy({lightSources:e})}return{}}var jy={name:"lights",vs:Xp,fs:Xp,getUniforms:Vy,defines:{MAX_LIGHTS:3}};var GC=new Uint8Array([0,255,255,255]),UC={pickingSelectedColor:null,pickingHighlightColor:GC,pickingActive:!1,pickingAttribute:!1};function zC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:UC,e={};if(n.pickingSelectedColor!==void 0)if(!n.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{let t=n.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(n.pickingHighlightColor){let t=Array.from(n.pickingHighlightColor,i=>i/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return n.pickingActive!==void 0&&(e.picking_uActive=Boolean(n.pickingActive),e.picking_uAttribute=Boolean(n.pickingAttribute)),e}var VC=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,jC=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Wn={name:"picking",vs:VC,fs:jC,getUniforms:zC};var Wy=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;var WC={};function HC(n){let{ambient:e=.35,diffuse:t=.6,shininess:i=32,specularColor:s=[30,30,30]}=n;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:i,lighting_uSpecularColor:s.map(o=>o/255)}}function XC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:WC;if(!("material"in n))return{};let{material:e}=n;return e?HC(e):{lighting_uEnabled:!1}}var po={name:"gouraud-lighting",dependencies:[jy],vs:Wy,defines:{LIGHTING_VERTEX:1},getUniforms:XC};var qC=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Yp={name:"transform",vs:qC,fs:null};var Ft=class{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Ft(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){let t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{vs:t="",fs:i="",defines:s={},inject:o={},varyings:a=[],bufferMode:u=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),f=this._getHash(t),h=this._getHash(i),d=c.map(C=>this._getHash(C.name)).sort(),x=a.map(C=>this._getHash(C)),E=Object.keys(s).sort(),w=Object.keys(o).sort(),S=[],M=[];for(let C of E)S.push(this._getHash(C)),S.push(this._getHash(s[C]));for(let C of w)M.push(this._getHash(C)),M.push(this._getHash(o[C]));let D="".concat(f,"/").concat(h,"D").concat(S.join("/"),"M").concat(d.join("/"),"I").concat(M.join("/"),"V").concat(x.join("/"),"H").concat(this.stateHash,"B").concat(u).concat(l?"T":"");if(!this._programCache[D]){let C=Pp(this.gl,{vs:t,fs:i,modules:c,inject:o,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[D]=new an(this.gl,{hash:D,vs:C.vs,fs:C.fs,varyings:a,bufferMode:u}),this._getUniforms[D]=C.getUniforms||(L=>{}),this._useCounts[D]=0}return this._useCounts[D]++,this._programCache[D]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){let t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=new Array(this._defaultModules.length+e.length),i={},s=0;for(let o=0,a=this._defaultModules.length;o<a;++o){let u=this._defaultModules[o],l=u.name;t[s++]=u,i[l]=!0}for(let o=0,a=e.length;o<a;++o){let u=e[o],l=u.name;i[l]||(t[s++]=u,i[l]=!0)}return t.length=s,t}};var YC={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Hy(n,e,t){let i={},s=e.indices;for(let o in e.attributes){let a=e.attributes[o],u=ZC(o,t);if(o==="indices")s=a;else if(a.constant)i[u]=a.value;else{let l=a.value,c={...a};delete c.value,i[u]=[new re(n,l),c],KC(o,c)}}if(s){let o=s.value||s;U(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');let a={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};i.indices=[new re(n,{data:o,target:34963}),a]}return i}function ZC(n,e){let{attributeMap:t=YC}=e||{};return t&&t[n]||n}function KC(n,e){let t;switch(n){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break;default:}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break;default:}U(Number.isFinite(e.size),"attribute ".concat(n," needs size"))}var go=2,$C=1e4,JC="Model needs drawMode and vertexCount",Xy=()=>{},QC={},Pe=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{id:i=pt("model")}=t;U(rn(e)),this.id=i,this.gl=e,this.id=t.id||pt("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Ft.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;let{program:t=null,vs:i,fs:s,modules:o,defines:a,inject:u,varyings:l,bufferMode:c,transpileToGLSL100:f}=e;this.programProps={program:t,vs:i,fs:s,modules:o,defines:a,inject:u,varyings:l,bufferMode:c,transpileToGLSL100:f},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},U(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),JC)}setProps(e){this._setModelProps(e)}delete(){for(let e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){let{program:t,vs:i,fs:s,modules:o,defines:a,inject:u,varyings:l,bufferMode:c,transpileToGLSL100:f}=e;this.programProps={program:t,vs:i,fs:s,modules:o,defines:a,inject:u,varyings:l,bufferMode:c,transpileToGLSL100:f},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return U(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return U(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Hy(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Or(e))return this;let t={};for(let i in e){let s=e[i];t[i]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();let t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){let t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return Bn(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();let{moduleSettings:t=null,framebuffer:i,uniforms:s={},attributes:o={},transformFeedback:a=this.transformFeedback,parameters:u={},vertexArray:l=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(s);let c;W.priority>=go&&(c=this._logDrawCallStart(go));let f=this.vertexArray.getDrawParams(),{isIndexed:h=f.isIndexed,indexType:d=f.indexType,indexOffset:x=f.indexOffset,vertexArrayInstanced:E=f.isInstanced}=this.props;E&&!this.isInstanced&&W.warn("Found instanced attributes on non-instanced model",this.id)();let{isInstanced:w,instanceCount:S}=this,{onBeforeRender:M=Xy,onAfterRender:D=Xy}=this.props;M(),this.program.setUniforms(this.uniforms);let C=this.program.draw(Object.assign(QC,e,{logPriority:c,uniforms:null,framebuffer:i,parameters:u,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:a,isIndexed:h,indexType:d,isInstanced:w,instanceCount:S,offset:h?x:0}));return D(),W.priority>=go&&this._logDrawCallEnd(c,l,i),C}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{discard:t=!0,feedbackBuffers:i,unbindModels:s=[]}=e,{parameters:o}=e;i&&this._setFeedbackBuffers(i),t&&(o=Object.assign({},o,{[35977]:t})),s.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{s.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{let{vs:i,fs:s,modules:o,inject:a,defines:u,varyings:l,bufferMode:c,transpileToGLSL100:f}=this.programProps;t=this.programManager.get({vs:i,fs:s,modules:o,inject:a,defines:u,varyings:l,bufferMode:c,transpileToGLSL100:f}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}U(t instanceof an,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new to(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(let e in this.geometryBuffers){let t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof re&&t.delete()}}_setAnimationProps(e){this.animated&&U(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Or(e))return this;let{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new ln(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){let t=e>3?0:$C;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),W.group(go,">>> DRAWING MODEL ".concat(this.id),{collapsed:W.level<=2})(),e}_logDrawCallEnd(e,t,i,s){if(e===void 0)return;let o=mp({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:u,unusedCount:l}=Bc({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:c,count:f}=Bc({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});f>0&&W.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&W.log("UNUSED UNIFORMS",Object.keys(u))();let h=xp(this.vertexArray.configuration);W.table(e,o)(),W.table(e,a)(),W.table(e+1,h)(),s&&s.log({logLevel:go,message:"Rendered to ".concat(s.id)}),W.groupEnd(go)()}};var Ja=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(let t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:s}=t;return{attributes:Object.assign({},i,e.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){let{feedbackBuffers:t}=this.bindings[this.currentIndex],i=e?t[e]:null;return i?i instanceof re?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{varyingName:t}=e,i=this.getBuffer(t);return i?i.getData():null}delete(){for(let e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&U(Q(this.gl))}_getFeedbackBuffers(e){let{sourceBuffers:t={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(let s in this.feedbackMap){let o=this.feedbackMap[s];s in t&&(i[o]=s)}Object.assign(i,e.feedbackBuffers);for(let s in i){let o=i[s];if(typeof o=="string"){let a=t[o],{byteLength:u,usage:l,accessor:c}=a;i[s]=this._createNewBuffer(s,{byteLength:u,usage:l,accessor:c})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);let i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:i})}_setupTransformFeedback(e,t){let{model:i}=t,{program:s}=i;e.transformFeedback=new ln(this.gl,{program:s,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){let{sourceBuffers:t,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:t,feedbackBuffers:i})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;let t=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(let s in this.feedbackMap){let o=this.feedbackMap[s];t[s]=e.feedbackBuffers[o],i[o]=e.sourceBuffers[s],U(i[o]instanceof re)}return{sourceBuffers:t,feedbackBuffers:i}}_createNewBuffer(e,t){let i=new re(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}};var e3="transform_uSampler_",af="transform_uSize_",qy="transform_position";function Yy(n){let{vs:e,sourceTextureMap:t,targetTextureVarying:i,targetTexture:s}=n,a=Object.keys(t).length,u=null,l={},c=e,f={};if(a>0||i){let h=c.split(`
`),d=h.slice();if(h.forEach((x,E,w)=>{if(a>0){let S=i3(x,t);if(S){let{updatedLine:M,inject:D}=S;d[E]=M,f=no([f,D]),Object.assign(l,S.samplerTextureMap),a--}}i&&!u&&(u=n3(x,i))}),i){U(s);let x="".concat(af).concat(i),E="uniform vec2 ".concat(x,`;
`),w="     vec2 ".concat(qy," = transform_getPos(").concat(x,`);
     gl_Position = vec4(`).concat(qy,`, 0, 1.);
`);f=no([f,{"vs:#decl":E,"vs:#main-start":w}])}c=d.join(`
`)}return{vs:c,targetTextureType:u,inject:f,samplerTextureMap:l}}function Zy(n){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:i}=n,s={},o,a;t&&({width:o,height:a}=i,s["".concat(af).concat(t)]=[o,a]);for(let u in e)({width:o,height:a}=e[u]),s["".concat(af).concat(u)]=[o,a];return s}function t3(n){return Uc(n,["attribute","in"])}function r3(n){let e="".concat(e3).concat(n),t="".concat(af).concat(n),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:i}}function n3(n,e){let t=Uc(n,["varying","out"]);return t&&t.name===e?t.type:null}function i3(n,e){let t={},i=t3(n);if(!i)return null;let{type:s,name:o}=i;if(o&&e[o]){let a="// ".concat(n," => Replaced by Transform with a sampler"),{samplerName:u,sizeName:l,uniformDeclerations:c}=r3(o),f=Cp(s),h="  ".concat(s," ").concat(o," = transform_getInput(").concat(u,", ").concat(l,").").concat(f,`;
`);return t[u]=o,{updatedLine:a,inject:{"vs:#decl":c,"vs:#main-start":h},samplerTextureMap:t}}return null}var s3={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},o3="transform_output",Qa=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{sourceBuffers:t,sourceTextures:i,framebuffer:s,targetTexture:o}=this.bindings[this.currentIndex],a=Object.assign({},t,e.attributes),u=Object.assign({},e.uniforms),l=Object.assign({},e.parameters),c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(let h in this.samplerTextureMap){let d=this.samplerTextureMap[h];u[h]=i[d]}this._setSourceTextureParameters();let f=Zy({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(u,f)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,s.width,s.height]),{attributes:a,framebuffer:s,uniforms:u,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){let{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{framebuffer:t}=this.bindings[this.currentIndex],i=sn(t);if(!e)return i;let s=i.constructor,o=Mp(this.targetTextureType),a=new s(i.length*o/4),u=0;for(let l=0;l<i.length;l+=4)for(let c=0;c<o;c++)a[u++]=i[l+c];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{_targetTextureVarying:t,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){let{sourceTextures:t,textureOrReference:i}=e;if(i instanceof he)return i;let s=t[i];return s?(this._targetRefTexName=i,this._createNewTexture(s)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{sourceBuffers:t,_sourceTextures:i={},_targetTexture:s}=e,o=this._createTargetTexture({sourceTextures:i,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:i,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;let t=new Float32Array(e);t.forEach((i,s,o)=>{o[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new re(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){let{sourceTextures:t,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:t,targetTexture:i})}}_updateBinding(e,t){let{sourceBuffers:i,sourceTextures:s,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,s),Object.assign(e.sourceBuffers,i),o){e.targetTexture=o;let{width:a,height:u}=o,{framebuffer:l}=e;l?(l.update({attachments:{[36064]:o},resizeAttachments:!1}),l.resize({width:a,height:u})):e.framebuffer=new le(this.gl,{id:"transform-framebuffer",width:a,height:u,attachments:{[36064]:o}})}return e}_setSourceTextureParameters(){let e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(let i in t)t[i].setParameters(s3)}_swapTextures(e){if(!this._swapTexture)return null;let t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;let i=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:i}}_createNewTexture(e){let t=Lc(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{sourceTextures:t,targetTexture:i}=this.bindings[this.currentIndex],{vs:s,uniforms:o,targetTextureType:a,inject:u,samplerTextureMap:l}=Yy({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),c=no([e.inject||{},u]);this.targetTextureType=a,this.samplerTextureMap=l;let f=e._fs||Ya({version:eo(s),input:this.targetTextureVarying,inputType:a,output:o3}),h=this.hasSourceTextures||this.targetTextureVarying?[Yp].concat(e.modules||[]):e.modules;return{vs:s,fs:f,modules:h,uniforms:o,inject:c}}};var Ot=class{static isSupported(e){return Q(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){let{model:e,bufferTransform:t,textureTransform:i}=this;e&&e.delete(),t&&t.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{clearRenderTarget:t=!0}=e,i=this._updateDrawOptions(e);t&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1,t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(let i of t)e=e||i.swap();U(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(let i of t){let s=i.getData(e);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);let t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(let i of t)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Pe(t,Object.assign({},e,{fs:e.fs||Ya({version:eo(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(let s of i)t=s.updateModelProps(t);return t}_buildResourceTransforms(e,t){a3(t)&&(this.bufferTransform=new Ja(e,t)),u3(t)&&(this.textureTransform=new Qa(e,t)),U(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(let s of i)t=Object.assign(t,s.getDrawOptions(t));return t}};function a3(n){return!!(!Or(n.feedbackBuffers)||!Or(n.feedbackMap)||n.varyings&&n.varyings.length>0)}function u3(n){return!!(!Or(n._sourceTextures)||n._targetTexture||n._targetTextureVarying)}var Ky={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ze=class{static get DRAW_MODE(){return Ky}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{id:t=pt("geometry"),drawMode:i=Ky.TRIANGLES,attributes:s={},indices:o=null,vertexCount:a=null}=e;this.id=t,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(s,o),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(let i in e){let s=e[i];s=ArrayBuffer.isView(s)?{value:s}:s,U(ArrayBuffer.isView(s.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!s.size&&(s.size=3),i==="indices"?(U(!this.indices),this.indices=s):this.attributes[i]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(let s in e){let o=e[s],{value:a,size:u,constant:l}=o;!l&&a&&u>=1&&(i=Math.min(i,a.length/u))}return U(Number.isFinite(i)),i}};var l3=1,c3=1,Hn=class{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){let{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:o=1}=e,a=l3++,u={time:0,delay:t,duration:i,rate:s,repeat:o};return this._setChannelTime(u,this.time),this.channels.set(a,u),a}removeChannel(e){this.channels.delete(e);for(let[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;let t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);let t=this.channels.values();for(let s of t)this._setChannelTime(s,this.time);let i=this.animations.values();for(let s of i){let{animation:o,channel:a}=s;o.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let i=c3++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}};var $y="#define SMOOTH_EDGE_RADIUS 0.5",f3=`
`.concat($y,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),h3=`
`.concat($y,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Jy={name:"geometry",vs:f3,fs:h3};var ce={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ce,"IDENTITY",{get:()=>($.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var ct={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},it={common:0,meters:1,pixels:2},Kp={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},dr={DRAW:"draw",MASK:"mask"};var d3=Object.keys(ce).map(n=>"const int COORDINATE_SYSTEM_".concat(n," = ").concat(ce[n],";")).join(""),p3=Object.keys(ct).map(n=>"const int PROJECTION_MODE_".concat(n," = ").concat(ct[n],";")).join(""),g3=Object.keys(it).map(n=>"const int UNIT_".concat(n.toUpperCase()," = ").concat(it[n],";")).join(""),Qy="".concat(d3,`
`).concat(p3,`
`).concat(g3,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function m3(n,e){if(n===e)return!0;if(Array.isArray(n)){let t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function pr(n){let e={},t;return i=>{for(let s in i)if(!m3(i[s],e[s])){t=n(i),e=i;break}return t}}var eE=[0,0,0,0],x3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],tE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y3=[0,0,0],rE=[0,0,0],E3=pr(b3);function $p(n,e,t=rE){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,o=!0;switch(e===ce.LNGLAT_OFFSETS||e===ce.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case ct.WEB_MERCATOR:(e===ce.LNGLAT||e===ce.CARTESIAN)&&(s=[0,0,0],o=!1);break;case ct.WEB_MERCATOR_AUTO_OFFSET:e===ce.LNGLAT?i=s:e===ce.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case ct.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case ct.GLOBE:o=!1,s=null;break;default:o=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:o}}function _3(n,e,t){let{viewMatrixUncentered:i,projectionMatrix:s}=n,{viewMatrix:o,viewProjectionMatrix:a}=n,u=eE,l=eE,c=n.cameraPosition,{geospatialOrigin:f,shaderCoordinateOrigin:h,offsetMode:d}=$p(n,e,t);return d&&(l=n.projectPosition(f||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,u=hr([],l,a),o=i||o,a=Nr([],s,o),a=Nr([],a,x3)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:u,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:f}}function nE({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=ce.DEFAULT,coordinateOrigin:s=rE,autoWrapLongitude:o=!1}){i===ce.DEFAULT&&(i=n.isGeospatial?ce.LNGLAT:ce.CARTESIAN);let a=E3({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return a.project_uWrapLongitude=o,a.project_uModelMatrix=t||tE,a}function b3({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){let{projectionCenter:s,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:u,shaderCoordinateOrigin:l,geospatialOrigin:c}=_3(n,t,i),f=n.getDistanceScales(),h=[n.width*e,n.height*e],d=hr([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,x={project_uCoordinateSystem:t,project_uProjectionMode:n.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:a.slice(0,3),project_uCenter:s,project_uPseudoMeters:Boolean(n._pseudoMeters),project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:d,project_uCommonUnitsPerMeter:f.unitsPerMeter,project_uCommonUnitsPerWorldUnit:f.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:y3,project_uScale:n.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:tE,project_uCameraPosition:u};if(c){let E=n.getDistanceScales(c);switch(t){case ce.METER_OFFSETS:x.project_uCommonUnitsPerWorldUnit=E.unitsPerMeter,x.project_uCommonUnitsPerWorldUnit2=E.unitsPerMeter2;break;case ce.LNGLAT:case ce.LNGLAT_OFFSETS:n._pseudoMeters||(x.project_uCommonUnitsPerMeter=E.unitsPerMeter),x.project_uCommonUnitsPerWorldUnit=E.unitsPerDegree,x.project_uCommonUnitsPerWorldUnit2=E.unitsPerDegree2;break;case ce.CARTESIAN:x.project_uCommonUnitsPerWorldUnit=[1,1,E.unitsPerMeter[2]],x.project_uCommonUnitsPerWorldUnit2=[0,0,E.unitsPerMeter2[2]];break;default:break}}return x}var A3={};function v3(n=A3){return"viewport"in n?nE(n):{}}var Zi={name:"project",dependencies:[zc,Jy],vs:Qy,getUniforms:v3};var T3=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ft={name:"project32",dependencies:[Zi],vs:T3};function Jp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xn(n,e){let t=hr([],e,n);return fo(t,t,1/t[3]),t}function Qp(n,e){let t=n%e;return t<0?e+t:t}function eu(n,e,t){return n<e?e:n>t?t:n}function w3(n){return Math.log(n)*Math.LOG2E}var mo=Math.log2||w3;function Zt(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var gr=Math.PI,iE=gr/4,mr=gr/180,eg=180/gr,tu=512,tg=4003e4,xo=85.051129,sE=1.5;function rg(n){return mo(n)}function Kt(n){let[e,t]=n;Zt(Number.isFinite(e)),Zt(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");let i=e*mr,s=t*mr,o=tu*(i+gr)/(2*gr),a=tu*(gr+Math.log(Math.tan(iE+s*.5)))/(2*gr);return[o,a]}function Nt(n){let[e,t]=n,i=e/tu*(2*gr)-gr,s=2*(Math.atan(Math.exp(t/tu*(2*gr)-gr))-iE);return[i*eg,s*eg]}function ng(n){let{latitude:e}=n;Zt(Number.isFinite(e));let t=Math.cos(e*mr);return rg(tg*t)-9}function yo(n){let{latitude:e,longitude:t,highPrecision:i=!1}=n;Zt(Number.isFinite(e)&&Number.isFinite(t));let s=tu,o=Math.cos(e*mr),a=s/360,u=a/o,l=s/tg/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[a,u,l],degreesPerUnit:[1/a,1/u,1/l]};if(i){let f=mr*Math.tan(e*mr)/o,h=a*f/2,d=s/tg*f,x=d/u*l;c.unitsPerDegree2=[0,h,d],c.unitsPerMeter2=[x,0,x]}return c}function ru(n,e){let[t,i,s]=n,[o,a,u]=e,{unitsPerMeter:l,unitsPerMeter2:c}=yo({longitude:t,latitude:i,highPrecision:!0}),f=Kt(n);f[0]+=o*(l[0]+c[0]*a),f[1]+=a*(l[1]+c[1]*a);let h=Nt(f),d=(s||0)+(u||0);return Number.isFinite(s)||Number.isFinite(u)?[h[0],h[1],d]:h}function uf(n){let{height:e,pitch:t,bearing:i,altitude:s,scale:o,center:a}=n,u=Jp();qi(u,u,[0,0,-s]),tf(u,u,-t*mr),rf(u,u,i*mr);let l=o/e;return co(u,u,[l,l,l]),a&&qi(u,u,Yx([],a)),u}function ig(n){let{width:e,height:t,altitude:i,pitch:s=0,offset:o,center:a,scale:u,nearZMultiplier:l=1,farZMultiplier:c=1}=n,{fovy:f=Ki(sE)}=n;i!==void 0&&(f=Ki(i));let h=f*mr,d=s*mr,x=nu(f),E=x;a&&(E+=a[2]*u/Math.cos(d)/t);let w=h*(.5+(o?o[1]:0)/t),S=Math.sin(w)*E/Math.sin(eu(Math.PI/2-d-w,.01,Math.PI-.01)),M=Math.sin(d)*S+E,D=E*10,C=Math.min(M*c,D);return{fov:h,aspect:e/t,focalDistance:x,near:l,far:C}}function Ki(n){return 2*Math.atan(.5/n)*eg}function nu(n){return .5/Math.tan(.5*n*mr)}function Eo(n,e){let[t,i,s=0]=n;return Zt(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),Xn(e,[t,i,s,1])}function Br(n,e,t=0){let[i,s,o]=n;if(Zt(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(o))return Xn(e,[i,s,o,1]);let a=Xn(e,[i,s,0,1]),u=Xn(e,[i,s,1,1]),l=a[2],c=u[2],f=l===c?0:((t||0)-l)/(c-l);return jc([],a,u,f)}function $i(n){let{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:o=24,offset:a=[0,0]}=n,[[u,l],[c,f]]=i,h=S3(n.padding),d=Kt([u,eu(f,-xo,xo)]),x=Kt([c,eu(l,-xo,xo)]),E=[Math.max(Math.abs(x[0]-d[0]),s),Math.max(Math.abs(x[1]-d[1]),s)],w=[e-h.left-h.right-Math.abs(a[0])*2,t-h.top-h.bottom-Math.abs(a[1])*2];Zt(w[0]>0&&w[1]>0);let S=w[0]/E[0],M=w[1]/E[1],D=(h.right-h.left)/2/S,C=(h.bottom-h.top)/2/M,L=[(x[0]+d[0])/2+D,(x[1]+d[1])/2+C],B=Nt(L),j=Math.min(o,mo(Math.abs(Math.min(S,M))));return Zt(Number.isFinite(j)),{longitude:B[0],latitude:B[1],zoom:j}}function S3(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Zt(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}var oE=Math.PI/180;function iu(n,e=0){let{width:t,height:i,unproject:s}=n,o={targetZ:e},a=s([0,i],o),u=s([t,i],o),l,c,f=n.fovy?.5*n.fovy*oE:Math.atan(.5/n.altitude),h=(90-n.pitch)*oE;return f>h-.01?(l=aE(n,0,e),c=aE(n,t,e)):(l=s([0,0],o),c=s([t,0],o)),[a,u,c,l]}function aE(n,e,t){let{pixelUnprojectionMatrix:i}=n,s=Xn(i,[e,0,1,1]),o=Xn(i,[e,n.height,1,1]),u=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(o[2]-s[2]),l=jc([],s,o,u),c=Nt(l);return c.push(t),c}var lE=512;function lf(n){let{width:e,height:t,pitch:i=0}=n,{longitude:s,latitude:o,zoom:a,bearing:u=0}=n;(s<-180||s>180)&&(s=Qp(s+180,360)-180),(u<-180||u>180)&&(u=Qp(u+180,360)-180);let l=mo(t/lE);if(a<=l)a=l,o=0;else{let c=t/2/Math.pow(2,a),f=Nt([0,c])[1];if(o<f)o=f;else{let h=Nt([0,lE-c])[1];o>h&&(o=h)}}return{width:e,height:t,longitude:s,latitude:o,zoom:a,pitch:i,bearing:u}}var M3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,I3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,L3=pr(N3),R3=pr(B3),D3=[0,0,0,1],F3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function O3(n,e){let[t,i,s]=n,o=Br([t,i,s],e);return Number.isFinite(s)?o:[o[0],o[1],0]}function N3({viewport:n,center:e}){return new ge(n.viewProjectionMatrix).invert().transform(e)}function B3({viewport:n,shadowMatrices:e}){let t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,o=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(a=>O3(a,i));for(let a of e){let u=a.clone().translate(new V(n.center).negate()),l=o.map(f=>u.transform(f)),c=new ge().ortho({left:Math.min(...l.map(f=>f[0])),right:Math.max(...l.map(f=>f[0])),bottom:Math.min(...l.map(f=>f[1])),top:Math.max(...l.map(f=>f[1])),near:Math.min(...l.map(f=>-f[2])),far:Math.max(...l.map(f=>-f[2]))});t.push(c.multiplyRight(a))}return t}function k3(n,e){let{shadowEnabled:t=!0}=n;if(!t||!n.shadowMatrices||!n.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};let i={shadow_uDrawShadowMap:Boolean(n.drawToShadowMap),shadow_uUseShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,shadow_uColor:n.shadowColor||D3,shadow_uLightId:n.shadowLightId||0,shadow_uLightCount:n.shadowMatrices.length},s=L3({viewport:n.viewport,center:e.project_uCenter}),o=[],a=R3({shadowMatrices:n.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<n.shadowMatrices.length;u++){let l=a[u],c=l.clone().translate(new V(n.viewport.center).negate());e.project_uCoordinateSystem===ce.LNGLAT&&e.project_uProjectionMode===ct.WEB_MERCATOR?(a[u]=c,o[u]=s):(a[u]=l.clone().multiplyRight(F3),o[u]=c.transform(s))}for(let u=0;u<a.length;u++)i["shadow_uViewProjectionMatrices[".concat(u,"]")]=a[u],i["shadow_uProjectCenters[".concat(u,"]")]=o[u],n.shadowMaps&&n.shadowMaps.length>0?i["shadow_uShadowMap".concat(u)]=n.shadowMaps[u]:i["shadow_uShadowMap".concat(u)]=n.dummyShadowMap;return i}var su={name:"shadow",dependencies:[Zi],vs:M3,fs:I3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(n={},e={})=>"viewport"in n&&(n.drawToShadowMap||n.shadowMaps&&n.shadowMaps.length>0)?k3(n,e):{}};var $t={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Wn};var G3=[Zi],U3=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function cE(n){let e=Ft.getDefaultProgramManager(n);for(let t of G3)e.addDefaultModule(t);for(let t of U3)e.addShaderHook(t);return e}var z3=[255,255,255],V3=1,j3=0,cf=class{constructor(e={}){m(this,"id",void 0),m(this,"color",void 0),m(this,"intensity",void 0),m(this,"type","ambient");let{color:t=z3}=e,{intensity:i=V3}=e;this.id=e.id||"ambient-".concat(j3++),this.color=t,this.intensity=i}};var W3=[255,255,255],H3=1,X3=[0,0,-1],q3=0,ou=class{constructor(e={}){m(this,"id",void 0),m(this,"color",void 0),m(this,"intensity",void 0),m(this,"type","directional"),m(this,"direction",void 0),m(this,"shadow",void 0);let{color:t=W3}=e,{intensity:i=H3}=e,{direction:s=X3}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(q3++),this.color=t,this.intensity=i,this.type="directional",this.direction=new V(s).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}};var au=class{constructor(e,t={id:"pass"}){m(this,"id",void 0),m(this,"gl",void 0),m(this,"props",void 0);let{id:i}=t;this.id=i,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}};var xr=class extends au{constructor(...e){super(...e),m(this,"_lastRenderIndex",-1)}render(e){let t=this.gl;return dt(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){let{target:t,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:u=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";let c=this.gl;l&&Z3(c),u&&(this._lastRenderIndex=-1);let f=[];for(let h of s){let d=o&&o[h.id];a(h);let x=this._getDrawLayerParams(h,e),E=h.subViewports||[h];for(let w of E){let S=this._drawLayersInViewport(c,{target:t,moduleParameters:i,viewport:w,view:d,pass:e.pass,layers:e.layers},x);f.push(S)}}return f}_getDrawLayerParams(e,{layers:t,pass:i,layerFilter:s,cullRect:o,effects:a,moduleParameters:u}){let l=[],c=fE(this._lastRenderIndex+1),f={layer:t[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:o},h={};for(let d=0;d<t.length;d++){let x=t[d],E=this._shouldDrawLayer(x,f,s,h),w={shouldDrawLayer:E};E&&(w.layerRenderIndex=c(x,E),w.moduleParameters=this._getModuleParameters(x,a,i,u),w.layerParameters=this.getLayerParameters(x,d,e)),l[d]=w}return l}_drawLayersInViewport(e,{layers:t,moduleParameters:i,pass:s,target:o,viewport:a,view:u},l){let c=Y3(e,{moduleParameters:i,target:o,viewport:a});if(u&&u.props.clear){let h=u.props.clear===!0?{color:!0,depth:!0}:u.props.clear;be(e,{scissorTest:!0,scissor:c},()=>Bn(e,h))}let f={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};dt(e,{viewport:c});for(let h=0;h<t.length;h++){let d=t[h],{shouldDrawLayer:x,layerRenderIndex:E,moduleParameters:w,layerParameters:S}=l[h];if(x&&d.props.pickable&&f.pickableCount++,d.isComposite)f.compositeCount++;else if(x){f.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),w.viewport=a;try{d._drawLayer({moduleParameters:w,uniforms:{layerIndex:E},parameters:S})}catch(M){d.raiseError(M,"drawing ".concat(d," to ").concat(s))}}}return f}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(i){let u=t.layer.id;if(u in s||(s[u]=i(t)),!s[u])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,i,s){var o;let a=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:ur(this.gl)});if(t)for(let l of t){var u;Object.assign(a,(u=l.getModuleParameters)===null||u===void 0?void 0:u.call(l,e))}return Object.assign(a,this.getModuleParameters(e,t),s)}};function fE(n=0,e={}){let t={},i=(s,o)=>{let a=s.props._offset,u=s.id,l=s.parent&&s.parent.id,c;if(l&&!(l in e)&&i(s.parent,!1),l in t){let f=t[l]=t[l]||fE(e[l],e);c=f(s,o),t[u]=f}else Number.isFinite(a)?(c=a+(e[l]||0),t[u]=null):c=n;return o&&c>=n&&(n=c+1),e[u]=c,c};return i}function Y3(n,{moduleParameters:e,target:t,viewport:i}){let s=t&&t.id!=="default-framebuffer",o=e&&e.devicePixelRatio||ur(n),a=s?t.height:n.drawingBufferHeight,u=i;return[u.x*o,a-(u.y+u.height)*o,u.width*o,u.height*o]}function Z3(n){let e=n.drawingBufferWidth,t=n.drawingBufferHeight;dt(n,{viewport:[0,0,e,t]}),n.clear(16640)}var uu=class extends xr{constructor(e,t){super(e,t),m(this,"shadowMap",void 0),m(this,"depthBuffer",void 0),m(this,"fbo",void 0),this.shadowMap=new he(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new _t(e,{format:33189,width:1,height:1}),this.fbo=new le(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){let t=this.fbo;be(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{let i=e.viewports[0],s=ur(this.gl),o=i.width*s,a=i.height*s;(o!==t.width||a!==t.height)&&t.resize({width:o,height:a}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}};var K3={color:[255,255,255],intensity:1},hE=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],$3=[0,0,0,200/255],_o=class{constructor(e={}){m(this,"id","lighting-effect"),m(this,"props",null),m(this,"shadowColor",$3),m(this,"shadow",void 0),m(this,"ambientLight",null),m(this,"directionalLights",[]),m(this,"pointLights",[]),m(this,"shadowPasses",[]),m(this,"shadowMaps",[]),m(this,"dummyShadowMap",null),m(this,"programManager",void 0),m(this,"shadowMatrices",void 0);for(let t in e){let i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow)}preRender(e,{layers:t,layerFilter:i,viewports:s,onViewportActive:o,views:a}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Ft.getDefaultProgramManager(e),su&&this.programManager.addDefaultModule(su)),this.dummyShadowMap||(this.dummyShadowMap=new he(e,{width:1,height:1}));for(let u=0;u<this.shadowPasses.length;u++)this.shadowPasses[u].render({layers:t,layerFilter:i,viewports:s,onViewportActive:o,views:a,moduleParameters:{shadowLightId:u,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){let t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},t}cleanup(){for(let e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(su),this.programManager=null)}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let i=new ge().lookAt({eye:new V(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let i=new uu(e);this.shadowPasses[t]=i,this.shadowMaps[t]=i.shadowMap}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new cf(K3),this.directionalLights.push(new ou(hE[0]),new ou(hE[1])))}};var sg=class{constructor(e={}){m(this,"_pool",[]),m(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:o=0,copy:a=!1,initialize:u=!1,maxCount:l}){let c=s||e&&e.constructor||Float32Array,f=t*i+o;if(ArrayBuffer.isView(e)){if(f<=e.length)return e;if(f*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,f)}let h=1/0;l&&(h=l*i+o);let d=this._allocate(c,f,u,h);return e&&a?d.set(e):u||d.fill(0,0,4),this._release(e),d}release(e){this._release(e)}_allocate(e,t,i,s){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>s&&(o=s);let a=this._pool,u=e.BYTES_PER_ELEMENT*o,l=a.findIndex(c=>c.byteLength>=u);if(l>=0){let c=new e(a.splice(l,1)[0],0,o);return i&&c.fill(0),c}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:i}=e,{byteLength:s}=i,o=t.findIndex(a=>a.byteLength>=s);o<0?t.push(i):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,i),t.length>this.opts.poolSize&&t.shift()}},yr=new sg;function Ao(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pE(n,e){let t=n%e;return t<0?e+t:t}function gE(n){return[n[12],n[13],n[14]]}function mE(n){return{left:bo(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:bo(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:bo(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:bo(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:bo(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:bo(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}var dE=new V;function bo(n,e,t,i){dE.set(n,e,t);let s=dE.len();return{distance:i/s,normal:new V(-n/s,-e/s,-t/s)}}function J3(n){return n-Math.fround(n)}var lu;function ff(n,e){let{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,o=(s-i)/t;lu=yr.allocate(lu,o,{type:Float32Array,size:t*2});let a=i,u=0;for(;a<s;){for(let l=0;l<t;l++){let c=n[a++];lu[u+l]=c,lu[u+l+t]=J3(c)}u+=t*2}return lu.subarray(0,o*t*2)}var Q3=Math.PI/180,eM=Ao(),xE=[0,0,0],tM={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function rM({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:o,near:a,far:u}){let l=n/e,c=t?new ge().orthographic({fovy:i,aspect:l,focalDistance:s,near:a,far:u}):new ge().perspective({fovy:i,aspect:l,near:a,far:u});if(o){let{left:f=0,right:h=0,top:d=0,bottom:x=0}=o,E=Le((f+n-h)/2,0,n)-n/2,w=Le((d+e-x)/2,0,e)-e/2;c[8]-=E*2/n,c[9]+=w*2/e}return c}var ht=class{constructor(e={}){m(this,"id",void 0),m(this,"x",void 0),m(this,"y",void 0),m(this,"width",void 0),m(this,"height",void 0),m(this,"padding",void 0),m(this,"isGeospatial",void 0),m(this,"zoom",void 0),m(this,"focalDistance",void 0),m(this,"position",void 0),m(this,"modelMatrix",void 0),m(this,"distanceScales",void 0),m(this,"scale",void 0),m(this,"center",void 0),m(this,"cameraPosition",void 0),m(this,"projectionMatrix",void 0),m(this,"viewMatrix",void 0),m(this,"viewMatrixUncentered",void 0),m(this,"viewMatrixInverse",void 0),m(this,"viewProjectionMatrix",void 0),m(this,"pixelProjectionMatrix",void 0),m(this,"pixelUnprojectionMatrix",void 0),m(this,"resolution",void 0),m(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||tM,this.focalDistance=e.focalDistance||1,this.position=e.position||xE,this.modelMatrix=e.modelMatrix||null;let{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ct.WEB_MERCATOR:ct.WEB_MERCATOR_AUTO_OFFSET:ct.IDENTITY}equals(e){return e instanceof ht?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&rt(e.projectionMatrix,this.projectionMatrix)&&rt(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){let i=this.projectPosition(e),s=Eo(i,this.pixelProjectionMatrix),[o,a]=s,u=t?a:this.height-a;return e.length===2?[o,u]:[o,u,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let[s,o,a]=e,u=t?o:this.height-o,l=i&&i*this.distanceScales.unitsPerMeter[2],c=Br([s,u,a],this.pixelUnprojectionMatrix,l),[f,h,d]=this.unprojectPosition(c);return Number.isFinite(a)?[f,h,d]:Number.isFinite(i)?[f,h,i]:[f,h]}projectPosition(e){let[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){let[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){let t=Kt(e);return t[1]=Le(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Nt(e):e}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],o[0],a[0]),Math.min(i[1],s[1],o[1],a[1]),Math.max(i[0],s[0],o[0],a[0]),Math.max(i[1],s[1],o[1],a[1])]}getDistanceScales(e){return e?yo({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,mE(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=ng({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||yo({latitude:i,longitude:t}));let s=Math.pow(2,this.zoom);this.scale=s;let{position:o,modelMatrix:a}=e,u=xE;if(o&&(u=a?new ge(a).transformAsVector(o,[]):o),this.isGeospatial){let l=this.projectPosition([t,i,0]);this.center=new V(u).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(u)}_initMatrices(e){let{viewMatrix:t=eM,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:o,fovy:a=75,near:u=.1,far:l=1e3,padding:c=null,focalDistance:f=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new ge().multiplyRight(t).translate(new V(this.center).negate()),this.projectionMatrix=i||rM({width:this.width,height:this.height,orthographic:s,fovyRadians:o||a*Q3,focalDistance:f,padding:c,near:u,far:l});let h=Ao();Nr(h,h,this.projectionMatrix),Nr(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Za([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=gE(this.viewMatrixInverse);let d=Ao(),x=Ao();co(d,d,[this.width/2,-this.height/2,1]),qi(d,d,[1,-1,0]),Nr(x,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=Za(Ao(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$.warn("Pixel project matrix not invertible")()}};m(ht,"displayName","Viewport");var nM=512,iM=4003e4,sM=Math.PI/180;function yE(n){let e=Math.cos(n*sM);return nM/iM/e}var Je=class extends ht{constructor(e={}){let{latitude:t=0,longitude:i=0,zoom:s=0,pitch:o=0,bearing:a=0,nearZMultiplier:u=.1,farZMultiplier:l=1.01,orthographic:c=!1,projectionMatrix:f,repeat:h=!1,worldOffset:d=0,legacyMeterSizes:x=!1}=e,{width:E,height:w,altitude:S=1.5}=e,M=Math.pow(2,s);E=E||1,w=w||1;let D,C=null;f?(S=f[5]/2,D=Ki(S)):(e.fovy?(D=e.fovy,S=nu(D)):D=Ki(S),C=ig({width:E,height:w,pitch:o,fovy:D,nearZMultiplier:u,farZMultiplier:l}));let L=uf({height:w,pitch:o,bearing:a,scale:M,altitude:S});d&&(L=new ge().translate([512*d,0,0]).multiplyLeft(L)),super({...e,width:E,height:w,viewMatrix:L,longitude:i,latitude:t,zoom:s,...C,fovy:D,focalDistance:S}),m(this,"longitude",void 0),m(this,"latitude",void 0),m(this,"pitch",void 0),m(this,"bearing",void 0),m(this,"altitude",void 0),m(this,"fovy",void 0),m(this,"orthographic",void 0),m(this,"_subViewports",void 0),m(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=o,this.bearing=a,this.altitude=S,this.fovy=D,this.orthographic=c,this._subViewports=h?[]:null,this._pseudoMeters=x,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){let o=s?new Je({...this,worldOffset:s}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,i]=this.projectFlat(e),s=(e[2]||0)*yE(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,i]=this.unprojectFlat(e),s=(e[2]||0)/yE(i);return[t,i,s]}addMetersToLngLat(e,t){return ru(e,t)}panByPosition(e,t){let i=Br(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),o=oo([],s,Vc([],i)),a=oo([],this.center,o),[u,l]=this.unprojectFlat(a);return{longitude:u,latitude:l}}getBounds(e={}){let t=iu(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:i,height:s}=this,{longitude:o,latitude:a,zoom:u}=$i({width:i,height:s,bounds:e,...t});return new Je({width:i,height:s,longitude:o,latitude:a,zoom:u})}};m(Je,"displayName","WebMercatorViewport");function og(n,e,t=!1){let i=e.projectPosition(n);if(t&&e instanceof Je){let[s,o,a=0]=n,u=e.getDistanceScales([s,o]);i[2]=a*u.unitsPerMeter[2]}return i}function oM(n){let{viewport:e,modelMatrix:t,coordinateOrigin:i}=n,{coordinateSystem:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=n;return s===ce.DEFAULT&&(s=e.isGeospatial?ce.LNGLAT:ce.CARTESIAN),o===void 0&&(o=s),a===void 0&&(a=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:a}}function ag(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:o}){let[a,u,l=0]=n;switch(t&&([a,u,l]=hr([],[a,u,l,1],t)),i){case ce.LNGLAT:return og([a,u,l],e,o);case ce.LNGLAT_OFFSETS:return og([a+s[0],u+s[1],l+(s[2]||0)],e,o);case ce.METER_OFFSETS:return og(ru(s,[a,u,l]),e,o);case ce.CARTESIAN:default:return e.isGeospatial?[a+s[0],u+s[1],l+s[2]]:e.projectPosition([a,u,l])}}function EE(n,e){let{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:u}=oM(e),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:f}=$p(t,i,s),h=ag(n,{viewport:t,modelMatrix:o,coordinateSystem:a,coordinateOrigin:u,offsetMode:f});if(f){let d=t.projectPosition(l||c);Yc(h,h,d)}return h}var qn={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},vo=Symbol.for("component"),fn=Symbol.for("asyncPropDefaults"),kr=Symbol.for("asyncPropOriginal"),Er=Symbol.for("asyncPropResolved");function hn(n,e=()=>!0){return Array.isArray(n)?_E(n,e,[]):e(n)?[n]:[]}function _E(n,e,t){let i=-1;for(;++i<n.length;){let s=n[i];Array.isArray(s)?_E(s,e,t):e(s)&&t.push(s)}return t}function ug({target:n,source:e,start:t=0,count:i=1}){let s=e.length,o=i*s,a=0;for(let u=t;a<s;a++)n[u++]=e[a];for(;a<o;)a<o-a?(n.copyWithin(t+a,t,t+a),a*=2):(n.copyWithin(t+a,t,t+o-a),a=o);return n}var cu=class{constructor(e,t,i){m(this,"id",void 0),m(this,"context",void 0),m(this,"isLoaded",void 0),m(this,"persistent",void 0),m(this,"_loadCount",0),m(this,"_subscribers",new Set),m(this,"_data",void 0),m(this,"_loader",void 0),m(this,"_error",void 0),m(this,"_content",void 0),this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;let i=++this._loadCount,s=e;typeof e=="string"&&(s=Dr(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(let o of this._subscribers)o.onChange(this.getData())}};var fu=class{constructor({gl:e,protocol:t}){m(this,"protocol",void 0),m(this,"_context",void 0),m(this,"_resources",void 0),m(this,"_consumers",void 0),m(this,"_pruneRequest",void 0),this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let o=this._resources[e];o?o.setData(t,i):(o=new cu(e,t,this._context),this._resources[e]=o),o.persistent=s}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let i in t){let s=t[i],o=this._resources[s.resourceId];o&&o.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){let{_resources:o,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));let u=o[e];if(this._track(i,s,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,i,s){let o=this._consumers,a=o[e]=o[e]||{},u=a[t]||{},l=u.resourceId&&this._resources[u.resourceId];l&&(l.unsubscribe(u),this.prune()),i&&(a[t]=u,u.onChange=s,u.resourceId=i.id,i.subscribe(u))}_prune(){this._pruneRequest=null;for(let e of Object.keys(this._resources)){let t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}};var aM="layerManager.setLayers",uM="layerManager.activateViewport",hu=class{constructor(e,{deck:t,stats:i,viewport:s,timeline:o}={}){m(this,"layers",void 0),m(this,"context",void 0),m(this,"resourceManager",void 0),m(this,"_lastRenderedLayers",[]),m(this,"_needsRedraw",!1),m(this,"_needsUpdate",!1),m(this,"_nextLayers",null),m(this,"_debug",!1),m(this,"activateViewport",a=>{Fe(uM,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new fu({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&cE(e),stats:i||new Lt({id:"deck.gl"}),viewport:s||new ht({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Hn,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(let i of this.layers){let s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Fe(aM,this,t,e),this._lastRenderedLayers=e;let i=hn(e,Boolean);for(let s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,i){i.raiseError(t,"".concat(e," of ").concat(i))}_updateLayers(e,t){let i={};for(let a of e)i[a.id]?$.warn("Multiple old layers with same id ".concat(a.id))():i[a.id]=a;let s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let o=!1;for(let a of s)if(a.hasUniformTransition()){o="Uniform transition in ".concat(a);break}this._needsUpdate=o,this.layers=s}_updateSublayersRecursively(e,t,i){for(let s of e){s.context=this.context;let o=t[s.id];o===null&&$.warn("Multiple new layers with same id ".concat(s.id))(),t[s.id]=null;let a=null;try{this._debug&&o!==s&&s.validateProps(),o?(this._transferLayerState(o,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),a=s.isComposite?s.getSubLayers():null}catch(u){this._handleError("matching",u,s)}a&&this._updateSublayersRecursively(a,t,i)}}_finalizeOldLayers(e){for(let t in e){let i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=qn.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=qn.MATCHED,t!==e&&(e.lifecycle=qn.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=qn.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=qn.FINALIZED}catch(t){this._handleError("finalization",t,e)}}};function Bt(n,e){if(n===e)return!0;if(!n||!e)return!1;for(let t in n){let i=n[t],s=e[t];if(!(i===s||Array.isArray(i)&&Array.isArray(s)&&Bt(i,s)))return!1}return!0}var du=class{constructor(e){m(this,"width",void 0),m(this,"height",void 0),m(this,"views",void 0),m(this,"viewState",void 0),m(this,"controllers",void 0),m(this,"timeline",void 0),m(this,"_viewports",void 0),m(this,"_viewportMap",void 0),m(this,"_isUpdating",void 0),m(this,"_needsRedraw",void 0),m(this,"_needsUpdate",void 0),m(this,"_eventManager",void 0),m(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){let t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){let i=this.getViewports(),s={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){let a=i[o];if(a.containsPixel(s)){let u=e.slice();return u[0]-=a.x,u[1]-=a.y,a.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=hn(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Bt(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):$.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){let i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var a;return(a=this.getView(e.id))===null||a===void 0?void 0:a.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,i,s){let o=e.controller;if(o){let a={...t,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return s||(s=this._createController(e,a)),s&&s.setProps(a),s}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){let o=e[s],a=this.getViewState(o),u=o.makeViewport({viewState:a,width:this.width,height:this.height}),l=t[o.id],c=Boolean(o.controller);c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,a,u,l),this._viewports.unshift(u)}for(let s in t){let o=t[s];o&&!this.controllers[s]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}};var lM=/([0-9]+\.?[0-9]*)(%|px)/;function dn(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":let e=lM.exec(n);if(e&&e.length>=3){let t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error("Could not parse position string ".concat(n))}}function pn(n,e){return n.relative?Math.round(n.position*e):n.position}function Ae(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}var Ji=class{constructor(e){m(this,"id",void 0),m(this,"viewportInstance",void 0),m(this,"_x",void 0),m(this,"_y",void 0),m(this,"_width",void 0),m(this,"_height",void 0),m(this,"_padding",void 0),m(this,"props",void 0);let{id:t,x:i=0,y:s=0,width:o="100%",height:a="100%",padding:u=null,viewportInstance:l}=e||{};Ae(!l||l instanceof ht),this.viewportInstance=l,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=dn(i),this._y=dn(s),this._width=dn(o),this._height=dn(a),this._padding=u&&{left:dn(u.left||0),right:dn(u.right||0),top:dn(u.top||0),bottom:dn(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Bt(this.props,e.props)}makeViewport({width:e,height:t,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);let s=this.getDimensions({width:e,height:t});return new this.ViewportType({...i,...this.props,...s})}getViewStateId(){let{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){let i={x:pn(this._x,e),y:pn(this._y,t),width:pn(this._width,e),height:pn(this._height,t)};return this._padding&&(i.padding={left:pn(this._padding.left,e),top:pn(this._padding.top,t),right:pn(this._padding.right,e),bottom:pn(this._padding.bottom,t)}),i}get controller(){let e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}};var kt=class{constructor(e){m(this,"_inProgress",void 0),m(this,"_handle",void 0),m(this,"_timeline",void 0),m(this,"time",void 0),m(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,(t=(i=this.settings).onStart)===null||t===void 0||t.call(i,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var bE=()=>{},lg={BREAK:1,SNAP_TO_END:2,IGNORE:3},cM=n=>n,fM=lg.BREAK,pu=class{constructor(e){m(this,"getControllerState",void 0),m(this,"props",void 0),m(this,"propsInTransition",void 0),m(this,"transition",void 0),m(this,"onViewStateChange",void 0),m(this,"onStateChange",void 0),m(this,"_onTransitionUpdate",t=>{let{time:i,settings:{interpolator:s,startProps:o,endProps:a,duration:u,easing:l}}=t,c=l(i/u),f=s.interpolateProps(o,a,c);this.propsInTransition=this.getControllerState({...this.props,...f}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new kt(e.timeline),this.onViewStateChange=e.onViewStateChange||bE,this.onStateChange=e.onStateChange||bE}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){let{interruption:o,endProps:a}=this.transition.settings;s={...i,...o===lg.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===lg.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){let i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),o=t.transitionInterpolator,a=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(a===0)return;let u=o.initializeProps(e,s);this.propsInTransition={};let l={duration:a,easing:t.transitionEasing||cM,interpolator:o,interruption:t.transitionInterruption||fM,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}};var gu=class{constructor(e){m(this,"_propsToCompare",void 0),m(this,"_propsToExtract",void 0),m(this,"_requiredProps",void 0);let{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(let i of this._propsToCompare)if(!(i in e)||!(i in t)||!rt(e[i],t[i]))return!1;return!0}initializeProps(e,t){let i={},s={};for(let o of this._propsToExtract)(o in e||o in t)&&(i[o]=e[o],s[o]=t[o]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(t=>{let i=e[t];Ae(Number.isFinite(i)||Array.isArray(i),"".concat(t," is required for transition"))})}};var hM=["longitude","latitude","zoom","bearing","pitch"],dM=["longitude","latitude","zoom"],Jt=class extends gu{constructor(e={}){let t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:hM,required:dM},super(i.transitionProps),m(this,"opts",void 0),this.opts=i}initializeProps(e,t){let i=super.initializeProps(e,t),{makeViewport:s,around:o}=this.opts;if(s&&o){let a=s(e),u=s(t),l=a.unproject(o);i.start.around=o,Object.assign(i.end,{around:u.project(l),aroundPosition:l,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){let s={};for(let o of this._propsToExtract)s[o]=ji(e[o]||0,t[o]||0,i);if(t.aroundPosition&&this.opts.makeViewport){let o=this.opts.makeViewport({...t,...s});Object.assign(s,o.panByPosition(t.aroundPosition,ji(e.around,t.around,i)))}return s}};var Yn={transitionDuration:0},pM=300,hf=n=>1-(1-n)*(1-n),To={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Qi={},es=class{constructor(e){m(this,"props",void 0),m(this,"state",{}),m(this,"transitionManager",void 0),m(this,"eventManager",void 0),m(this,"onViewStateChange",void 0),m(this,"onStateChange",void 0),m(this,"makeViewport",void 0),m(this,"_controllerState",void 0),m(this,"_events",{}),m(this,"_interactionState",{isDragging:!1}),m(this,"_customEvents",[]),m(this,"_eventStartBlocked",null),m(this,"_panMove",!1),m(this,"invertPan",!1),m(this,"dragMode","rotate"),m(this,"inertia",0),m(this,"scrollZoom",!0),m(this,"dragPan",!0),m(this,"dragRotate",!0),m(this,"doubleClickZoom",!0),m(this,"touchZoom",!0),m(this,"touchRotate",!1),m(this,"keyboard",!0),this.transitionManager=new pu({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){let{width:i,height:s}=this.props;if(t&&t.handled)return!1;let o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){let{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?pM:0;let{scrollZoom:i=!0,dragPan:s=!0,dragRotate:o=!0,doubleClickZoom:a=!0,touchZoom:u=!0,touchRotate:l=!1,keyboard:c=!0}=e,f=Boolean(this.onViewStateChange);this.toggleEvents(To.WHEEL,f&&i),this.toggleEvents(To.PAN,f&&(s||o)),this.toggleEvents(To.PINCH,f&&(u||l)),this.toggleEvents(To.TRIPLE_PAN,f&&l),this.toggleEvents(To.DOUBLE_TAP,f&&a),this.toggleEvents(To.KEYBOARD,f&&c),this.scrollZoom=i,this.dragPan=s,this.dragRotate=o,this.doubleClickZoom=a,this.touchZoom=u,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){let s={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){let a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);let s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,Yn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Yn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isPanning:!0})}else{let i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Yn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isRotating:!0})}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e,a=2/(1+Math.exp(-Math.abs(o*i)));o<0&&a!==0&&(a=1/a);let u=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(u,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Yn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Yn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:s});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Qi._startPinchRotation=e.rotation,Qi._lastPinchEvent=e,this.updateViewport(i,Yn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){let{rotation:i}=e;t=t.rotate({deltaAngleX:Qi._startPinchRotation-i})}return this.updateViewport(t,Yn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Qi._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:i}=Qi;if(this.touchZoom&&t&&i&&e.scale!==i.scale){let s=this.getCenter(e),o=this.controllerState.rotateEnd(),a=Math.log2(e.scale),u=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,a+u*t/2);o=o.zoom({pos:s,scale:l}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Qi._startPinchRotation=null,Qi._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;let t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:o,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this,l,c={};switch(e.srcEvent.code){case"Minus":l=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),c.isZooming=!0;break;case"Equal":l=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":t?(l=u.rotateLeft(o),c.isRotating=!0):(l=u.moveLeft(s),c.isPanning=!0);break;case"ArrowRight":t?(l=u.rotateRight(o),c.isRotating=!0):(l=u.moveRight(s),c.isPanning=!0);break;case"ArrowUp":t?(l=u.rotateUp(a),c.isRotating=!0):(l=u.moveUp(s),c.isPanning=!0);break;case"ArrowDown":t?(l=u.rotateDown(a),c.isRotating=!0):(l=u.moveDown(s),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){let{transition:t}=this;return!t||!t.transitionInterpolator?Yn:e?{...t,transitionInterpolator:new Jt({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}};var ts=class{constructor(e,t){m(this,"_viewportProps",void 0),m(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}};var AE=5,gM=1.2,cg=class extends ts{constructor(e){let{width:t,height:i,latitude:s,longitude:o,zoom:a,bearing:u=0,pitch:l=0,altitude:c=1.5,position:f=[0,0,0],maxZoom:h=20,minZoom:d=0,maxPitch:x=60,minPitch:E=0,startPanLngLat:w,startZoomLngLat:S,startRotatePos:M,startBearing:D,startPitch:C,startZoom:L,normalize:B=!0}=e;Ae(Number.isFinite(o)),Ae(Number.isFinite(s)),Ae(Number.isFinite(a)),super({width:t,height:i,latitude:s,longitude:o,zoom:a,bearing:u,pitch:l,altitude:c,maxZoom:h,minZoom:d,maxPitch:x,minPitch:E,normalize:B,position:f},{startPanLngLat:w,startZoomLngLat:S,startRotatePos:M,startBearing:D,startPitch:C,startZoom:L}),m(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;let o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let{startRotatePos:s,startBearing:o,startPitch:a}=this.getState();if(!s||o===void 0||a===void 0)return this;let u;return e?u=this._getNewRotation(e,s,a,o):u={bearing:o+t,pitch:a+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:o}=this.getState();if(o||(s=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;let{maxZoom:a,minZoom:u}=this.getViewportProps(),l=s+Math.log2(i);l=Le(l,u,a);let c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:o}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(o-t.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=Le(s,i,t);let{maxPitch:o,minPitch:a,pitch:u}=e;e.pitch=Le(u,a,o);let{normalize:l=!0}=e;return l&&Object.assign(e,lf(e)),e}_zoomFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){let o=e[0]-t[0],a=e[1]-t[1],u=e[1],l=t[1],{width:c,height:f}=this.getViewportProps(),h=o/c,d=0;a>0?Math.abs(f-l)>AE&&(d=a/(l-f)*gM):a<0&&l>AE&&(d=1-u/l),d=Le(d,-1,1);let{minPitch:x,maxPitch:E}=this.getViewportProps(),w=s+180*h,S=i;return d>0?S=i+d*(E-i):d<0&&(S=i-d*(x-i)),{pitch:S,bearing:w}}},mu=class extends es{constructor(...e){super(...e),m(this,"ControllerState",cg),m(this,"transition",{transitionDuration:300,transitionInterpolator:new Jt({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),m(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};var wo=class extends Ji{get ViewportType(){return Je}get ControllerType(){return mu}};m(wo,"displayName","MapView");var xu=class extends xr{constructor(e,t){super(e,t),m(this,"maskMap",void 0),m(this,"fbo",void 0);let{mapSize:i=2048}=t;this.maskMap=new he(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new le(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){let t=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,be(t,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===dr.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}};var mM=new ge().lookAt({eye:[0,0,1]});function xM({width:n,height:e,near:t,far:i,padding:s}){let o=-n/2,a=n/2,u=-e/2,l=e/2;if(s){let{left:c=0,right:f=0,top:h=0,bottom:d=0}=s,x=Le((c+n-f)/2,0,n)-n/2,E=Le((h+e-d)/2,0,e)-e/2;o-=x,a-=x,u+=E,l+=E}return new ge().ortho({left:o,right:a,bottom:u,top:l,near:t,far:i})}var yu=class extends ht{constructor(e){let{width:t,height:i,near:s=.1,far:o=1e3,zoom:a=0,target:u=[0,0,0],padding:l=null,flipY:c=!0}=e,f=Array.isArray(a)?a[0]:a,h=Array.isArray(a)?a[1]:a,d=Math.min(f,h),x=Math.pow(2,d),E;if(f!==h){let w=Math.pow(2,f),S=Math.pow(2,h);E={unitsPerMeter:[w/x,S/x,1],metersPerUnit:[x/w,x/S,1]}}super({...e,longitude:void 0,position:u,viewMatrix:mM.clone().scale([x,x*(c?-1:1),x]),projectionMatrix:xM({width:t||1,height:i||1,padding:l,near:s,far:o}),zoom:d,distanceScales:E})}projectFlat([e,t]){let{unitsPerMeter:i}=this.distanceScales;return[e*i[0],t*i[1]]}unprojectFlat([e,t]){let{metersPerUnit:i}=this.distanceScales;return[e*i[0],t*i[1]]}panByPosition(e,t){let i=Br(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),o=oo([],s,Vc([],i)),a=oo([],this.center,o);return{target:this.unprojectFlat(a)}}};var df=class extends ts{constructor(e){let{width:t,height:i,rotationX:s=0,rotationOrbit:o=0,target:a=[0,0,0],zoom:u=0,minRotationX:l=-90,maxRotationX:c=90,minZoom:f=-1/0,maxZoom:h=1/0,startPanPosition:d,startRotatePos:x,startRotationX:E,startRotationOrbit:w,startZoomPosition:S,startZoom:M}=e;super({width:t,height:i,rotationX:s,rotationOrbit:o,target:a,zoom:u,minRotationX:l,maxRotationX:c,minZoom:f,maxZoom:h},{startPanPosition:d,startRotatePos:x,startRotationX:E,startRotationOrbit:w,startZoomPosition:S,startZoom:M}),m(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){let i=this.getState().startPanPosition||t;if(!i)return this;let o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let{startRotatePos:s,startRotationX:o,startRotationOrbit:a}=this.getState(),{width:u,height:l}=this.getViewportProps();if(!s||o===void 0||a===void 0)return this;let c;if(e){let f=(e[0]-s[0])/u,h=(e[1]-s[1])/l;(o<-90||o>90)&&(f*=-1),c={rotationX:o+h*180,rotationOrbit:a+f*180}}else c={rotationX:o+i,rotationOrbit:a+t};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:s}=i;return Math.abs(s-t.rotationOrbit)>180&&(i.rotationOrbit=s<0?s+360:s-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomPosition:o}=this.getState();if(o||(s=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;let a=this._calculateNewZoom({scale:i,startZoom:s}),u=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...u.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){let{maxZoom:i,minZoom:s}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);let o=t+Math.log2(e);return Le(o,s,i)}_panFromCenter(e){let{width:t,height:i,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:s,maxRotationX:o,minRotationX:a,rotationOrbit:u}=e;return e.zoom=Array.isArray(s)?[Le(s[0],i,t),Le(s[1],i,t)]:Le(s,i,t),e.rotationX=Le(e.rotationX,a,o),(u<-180||u>180)&&(e.rotationOrbit=pE(u+180,360)-180),e}};var fg=class extends df{constructor(e){super(e),m(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:t}){let{maxZoom:i,minZoom:s}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);let o=Math.log2(e);if(Array.isArray(t)){let[a,u]=t;switch(this.zoomAxis){case"X":a=Le(a+o,s,i);break;case"Y":u=Le(u+o,s,i);break;default:let l=Math.min(a+o,u+o);l<s&&(o+=s-l),l=Math.max(a+o,u+o),l>i&&(o+=i-l),a+=o,u+=o}return[a,u]}return Le(t+o,s,i)}},Eu=class extends es{constructor(...e){super(...e),m(this,"ControllerState",fg),m(this,"transition",{transitionDuration:300,transitionInterpolator:new Jt(["target","zoom"])}),m(this,"dragMode","pan")}_onPanRotate(){return!1}};var gn=class extends Ji{get ViewportType(){return yu}get ControllerType(){return Eu}};m(gn,"displayName","OrthographicView");function vE({layers:n,viewport:e}){let t=null;for(let o of n){let a=o.getBounds();a&&(t?(t[0]=Math.min(t[0],a[0][0]),t[1]=Math.min(t[1],a[0][1]),t[2]=Math.max(t[2],a[1][0]),t[3]=Math.max(t[3],a[1][1])):t=[a[0][0],a[0][1],a[1][0],a[1][1]])}let i=e.getBounds();if(!t)return i;let s=yM(i);return t[2]-t[0]<s[2]-s[0]||t[3]-t[1]<s[3]-s[1]||(t[0]=Math.max(t[0],s[0]),t[1]=Math.max(t[1],s[1]),t[2]=Math.min(t[2],s[2]),t[3]=Math.min(t[3],s[3])),t}function TE({bounds:n,viewport:e,width:t,height:i}){if(n[2]<=n[0]||n[3]<=n[1])return null;let s=1;if(t-=s*2,i-=s*2,e instanceof Je){let{longitude:u,latitude:l,zoom:c}=$i({width:t,height:i,bounds:[[n[0],n[1]],[n[2],n[3]]],maxZoom:20});return new Je({longitude:u,latitude:l,zoom:c,x:s,y:s,width:t,height:i})}let o=[(n[0]+n[2])/2,(n[1]+n[3])/2,0],a=Math.min(20,t/(n[2]-n[0]),i/(n[3]-n[1]));return new gn({x:s,y:s}).makeViewport({width:t,height:i,viewState:{target:o,zoom:Math.log2(a)}})}function yM(n){let e={x:n[2]-n[0],y:n[3]-n[1]},t={x:n[0]+.5*e.x,y:n[1]+.5*e.y};return[t.x-e.x,t.y-e.y,t.x+e.x,t.y+e.y]}var _u=class{constructor(){m(this,"id","mask-effect"),m(this,"props",null),m(this,"useInPicking",!0),m(this,"dummyMaskMap",void 0),m(this,"channels",[]),m(this,"masks",null),m(this,"maskPass",void 0),m(this,"maskMap",void 0),m(this,"lastViewport",void 0)}preRender(e,{layers:t,layerFilter:i,viewports:s,onViewportActive:o,views:a}){this.dummyMaskMap||(this.dummyMaskMap=new he(e,{width:1,height:1}));let u=t.filter(h=>h.props.visible&&h.props.operation===dr.MASK);if(u.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new xu(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);let l=this._sortMaskChannels(u),c=s[0],f=!this.lastViewport||!this.lastViewport.equals(c);for(let h in l)this._renderChannel(l[h],{layerFilter:i,onViewportActive:o,views:a,viewport:c,viewportChanged:f})}_renderChannel(e,{layerFilter:t,onViewportActive:i,views:s,viewport:o,viewportChanged:a}){let u=this.channels[e.index];if(!u)return;let l=e===u||u.layers.length!==e.layers.length||e.layerBounds.some((c,f)=>c!==u.layerBounds[f]);if(e.bounds=u.bounds,e.maskBounds=u.maskBounds,this.channels[e.index]=e,(l||a)&&(this.lastViewport=o,e.bounds=vE({layers:e.layers,viewport:o}),l||!rt(e.bounds,u.bounds))){let{maskPass:c,maskMap:f}=this,h=TE({bounds:e.bounds,viewport:o,width:f.width,height:f.height});e.maskBounds=h?h.getBounds():[0,0,1,1],c.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:t,viewports:h?[h]:[],onViewportActive:i,views:s,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){let t={},i=0;for(let s of e){let{id:o}=s.root,a=t[o];if(!a){if(++i>4){$.warn("Too many mask layers. The max supported is 4")();continue}a={id:o,index:this.channels.findIndex(u=>u?.id===o),layers:[],layerBounds:[],coordinateOrigin:s.root.props.coordinateOrigin,coordinateSystem:s.root.props.coordinateSystem},t[o]=a}a.layers.push(s),a.layerBounds.push(s.getBounds())}for(let s=0;s<4;s++){let o=this.channels[s];(!o||!(o.id in t))&&(this.channels[s]=null)}for(let s in t){let o=t[s];o.index<0&&(o.index=this.channels.findIndex(a=>!a),this.channels[o.index]=o)}return t}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}};var EM=new _o,bu=class{constructor(){m(this,"effects",void 0),m(this,"_internalEffects",void 0),m(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Bt(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new _u),e.some(t=>t instanceof _o)||this._internalEffects.push(EM)}cleanup(){for(let e of this.effects)e.cleanup();for(let e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}};var Au=class extends xr{shouldDrawLayer(e){return e.props.operation===dr.DRAW}};var wE={blendFunc:[1,0,32771,0],blendEquation:32774},rs=class extends xr{constructor(...e){super(...e),m(this,"pickZ",void 0),m(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,pickingFBO:a,deviceRect:{x:u,y:l,width:c,height:f},cullRect:h,effects:d,pass:x="picking",pickZ:E}){let w=this.gl;this.pickZ=E;let S=E?null:{byLayer:new Map,byAlpha:[]};this._colors=S;let M=be(w,{scissorTest:!0,scissor:[u,l,c,f],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...wE,blend:!E},()=>super.render({target:a,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,cullRect:h,effects:d?.filter(C=>C.useInPicking),pass:x}));return this._colors=null,{decodePickingColor:S&&bM.bind(null,S),stats:M}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===dr.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,i){let s={...e.props.parameters};return this._colors?(Object.assign(s,wE),s.blend=!0,s.blendColor=_M(this._colors,e,i)):s.blend=!1,s}};function _M(n,e,t){let{byLayer:i,byAlpha:s}=n,o,a=i.get(e);return a?(a.viewports.push(t),o=a.a):(o=i.size+1,o<=255?(a={a:o,layer:e,viewports:[t]},i.set(e,a),s[o]=a):($.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function bM(n,e){let t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}var AM="deckRenderer.renderLayers",vu=class{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Au(e),this.pickLayersPass=new rs(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||le.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);let i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,s=t.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,Fe(AM,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){let i=null;for(let s of e)s.preRender(this.gl,t),s.postRender&&(i=s);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){let{renderBuffers:e}=this;e.length===0&&e.push(new le(this.gl),new le(this.gl));for(let t of e)t.resize()}_postRender(e,t){let{renderBuffers:i}=this,s={inputBuffer:i[0],swapBuffer:i[1],target:null};for(let o of e)if(o.postRender){if(o===this.lastPostProcessEffect){s.target=t.target,o.postRender(this.gl,s);break}let a=o.postRender(this.gl,s);s.inputBuffer=a,s.swapBuffer=a===i[0]?i[1]:i[0]}}};var vM={pickedColor:null,pickedObjectIndex:-1};function SE({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:o}){let{x:a,y:u,width:l,height:c}=o,f=s*s,h=-1,d=0;for(let x=0;x<c;x++){let E=x+u-i,w=E*E;if(w>f)d+=4*l;else for(let S=0;S<l;S++){if(n[d+3]-1>=0){let D=S+a-t,C=D*D+w;C<=f&&(f=C,h=d)}d+=4}}if(h>=0){let x=n.slice(h,h+4),E=e(x);if(E){let w=Math.floor(h/4/l),S=h/4-w*l;return{...E,pickedColor:x,pickedX:a+S,pickedY:u+w}}$.error("Picked non-existent layer. Is picking buffer corrupt?")()}return vM}function PE({pickedColors:n,decodePickingColor:e}){let t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){let o=n.slice(i,i+4),a=o.join(",");if(!t.has(a)){let u=e(o);u?t.set(a,{...u,color:o}):$.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function hg({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:o}){let a=e[0];e.length>1&&(a=TM(n?.pickedViewports||e,{x:i,y:s}));let u;if(a){let l=[i-a.x,s-a.y];o!==void 0&&(l[2]=o),u=a.unproject(l)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function CE(n){let{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:o,pickedLayer:a,pickedObjectIndex:u}=e,l=a?[a]:[];if(i==="hover"){let h=t.index,d=t.layerId,x=a?a.props.id:null;if(x!==d||u!==h){if(x!==d){let E=s.find(w=>w.props.id===d);E&&l.unshift(E)}t.layerId=x,t.index=u,t.info=null}}let c=hg(n),f=new Map;return f.set(null,c),l.forEach(h=>{let d={...c};h===a&&(d.color=o,d.index=u,d.picked=!0),d=dg({layer:h,info:d,mode:i});let x=d.layer;h===a&&i==="hover"&&(t.info=d),f.set(x.id,d),i==="hover"&&x.updateAutoHighlight(d)}),f}function dg({layer:n,info:e,mode:t}){for(;n&&e;){let i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function TM(n,e){for(let t=n.length-1;t>=0;t--){let i=n[t];if(i.containsPixel(e))return i}return n[0]}var Tu=class{constructor(e){m(this,"gl",void 0),m(this,"pickingFBO",void 0),m(this,"depthFBO",void 0),m(this,"pickLayersPass",void 0),m(this,"layerFilter",void 0),m(this,"lastPickedInfo",void 0),m(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new rs(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},o=this.lastPickedInfo.info){let a=o&&o.layer&&o.layer.id,u=o&&o.viewport&&o.viewport.id,l=a?i.find(d=>d.id===a):null,c=u&&s.find(d=>d.id===u)||s[0],f=c&&c.unproject([e-c.x,t-c.y]);return{...o,...{x:e,y:t,viewport:c,coordinate:f,layer:l}}}_resizeBuffer(){var e,t;let{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new le(i),le.isSupported(i,{colorBufferFloat:!0}))){let s=new le(i);s.attach({[36064]:new he(i,{format:Q(i)?34836:6408,type:5126})}),this.depthFBO=s}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;let t=e.filter(i=>i.isPickable()&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:o,radius:a=0,depth:u=1,mode:l="query",unproject3D:c,onViewportActive:f,effects:h}){let d=this._getPickable(e),x=ur(this.gl);if(!d)return{result:[],emptyInfo:hg({viewports:i,x:s,y:o,pixelRatio:x})};this._resizeBuffer();let E=Ks(this.gl,[s,o],!0),w=[E.x+Math.floor(E.width/2),E.y+Math.floor(E.height/2)],S=Math.round(a*x),{width:M,height:D}=this.pickingFBO,C=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:S,deviceWidth:M,deviceHeight:D}),L={x:s-a,y:o-a,width:a*2+1,height:a*2+1},B,j=[],J=new Set;for(let te=0;te<u;te++){let Z;if(C){let H=this._drawAndSample({layers:d,views:t,viewports:i,onViewportActive:f,deviceRect:C,cullRect:L,effects:h,pass:"picking:".concat(l)});Z=SE({...H,deviceX:w[0],deviceY:w[1],deviceRadius:S,deviceRect:C})}else Z={pickedColor:null,pickedObjectIndex:-1};let q;Z.pickedLayer&&c&&this.depthFBO&&(q=this._drawAndSample({layers:[Z.pickedLayer],views:t,viewports:i,onViewportActive:f,deviceRect:{x:Z.pickedX,y:Z.pickedY,width:1,height:1},cullRect:L,effects:h,pass:"picking:".concat(l,":z")},!0).pickedColors[0]),Z.pickedLayer&&te+1<u&&(J.add(Z.pickedLayer),Z.pickedLayer.disablePickingIndex(Z.pickedObjectIndex)),B=CE({pickInfo:Z,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:i,x:s,y:o,z:q,pixelRatio:x});for(let H of B.values())H.layer&&j.push(H);if(!Z.pickedColor)break}for(let te of J)te.restorePickingColors();return{result:j,emptyInfo:B.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:o,width:a=1,height:u=1,mode:l="query",maxObjects:c=null,onViewportActive:f,effects:h}){let d=this._getPickable(e);if(!d)return[];this._resizeBuffer();let x=ur(this.gl),E=Ks(this.gl,[s,o],!0),w=E.x,S=E.y+E.height,M=Ks(this.gl,[s+a,o+u],!0),D=M.x+M.width,C=M.y,L={x:w,y:C,width:D-w,height:S-C},B=this._drawAndSample({layers:d,views:t,viewports:i,onViewportActive:f,deviceRect:L,cullRect:{x:s,y:o,width:a,height:u},effects:h,pass:"picking:".concat(l)}),j=PE(B),J=new Map,te=Number.isFinite(c);for(let Z=0;Z<j.length&&!(te&&c&&J.size>=c);Z++){let q=j[Z],H={color:q.pickedColor,layer:null,index:q.pickedObjectIndex,picked:!0,x:s,y:o,pixelRatio:x};H=dg({layer:q.pickedLayer,info:H,mode:l}),J.has(H.object)||J.set(H.object,H)}return Array.from(J.values())}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:o,cullRect:a,effects:u,pass:l},c=!1){let f=c?this.depthFBO:this.pickingFBO,{decodePickingColor:h}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:f,deviceRect:o,cullRect:a,effects:u,pass:l,pickZ:c}),{x:d,y:x,width:E,height:w}=o,S=new(c?Float32Array:Uint8Array)(E*w*4);return sn(f,{sourceX:d,sourceY:x,sourceWidth:E,sourceHeight:w,target:S}),{pickedColors:S,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:o}){let a=Math.max(0,e-i),u=Math.max(0,t-i),l=Math.min(s,e+i+1)-a,c=Math.min(o,t+i+1)-u;return l<=0||c<=0?null:{x:a,y:u,width:l,height:c}}};var wM={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},wu=class{constructor(e){m(this,"el",null),m(this,"isVisible",!1);let t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,wM),t.appendChild(this.el))}setTooltip(e,t,i){let s=this.el;if(!!s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className),Object.assign(s.style,e.style);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(t,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}};var ns=we(ME());var SM={mousedown:1,mousemove:2,mouseup:4};function PM(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return!0;return!1}function IE(n){let e=n.prototype.handler;n.prototype.handler=function(i){let s=this.store;i.button>0&&i.type==="pointerdown"&&(PM(s,o=>o.pointerId===i.pointerId)||s.push(i)),e.call(this,i)}}function LE(n){n.prototype.handler=function(t){let i=SM[t.type];i&1&&t.button>=0&&(this.pressed=!0),i&2&&t.which===0&&(i=4),this.pressed&&(i&4&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}IE(ns.PointerEventInput);LE(ns.MouseInput);var RE=ns.Manager,_r=ns;var br=class{constructor(e,t,i){this.element=e,this.callback=t,this.options={enable:!0,...i}}};var DE=_r?[[_r.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[_r.Rotate,{enable:!1}],[_r.Pinch,{enable:!1}],[_r.Swipe,{enable:!1}],[_r.Pan,{threshold:0,enable:!1}],[_r.Press,{enable:!1}],[_r.Tap,{event:"doubletap",taps:2,enable:!1}],[_r.Tap,{event:"anytap",enable:!1}],[_r.Tap,{enable:!1}]]:null,pg={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},FE={doubletap:["tap"]},OE={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},So={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},NE={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},gg={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var BE=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",is=typeof window<"u"?window:global;var gf=!1;try{let n={get passive(){return gf=!0,!0}};is.addEventListener("test",null,n),is.removeEventListener("test",null)}catch{gf=!1}var CM=BE.indexOf("firefox")!==-1,{WHEEL_EVENTS:MM}=So,kE="wheel",GE=4.000244140625,IM=40,LM=.25,Su=class extends br{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{if(!this.options.enable)return;let o=s.deltaY;is.WheelEvent&&(CM&&s.deltaMode===is.WheelEvent.DOM_DELTA_PIXEL&&(o/=is.devicePixelRatio),s.deltaMode===is.WheelEvent.DOM_DELTA_LINE&&(o*=IM)),o!==0&&o%GE===0&&(o=Math.floor(o/GE)),s.shiftKey&&o&&(o=o*LM),this.callback({type:kE,center:{x:s.clientX,y:s.clientY},delta:-o,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(MM),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,gf?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===kE&&(this.options.enable=t)}};var{MOUSE_EVENTS:RM}=So,UE="pointermove",zE="pointerover",VE="pointerout",jE="pointerenter",WE="pointerleave",Pu=class extends br{constructor(e,t,i){super(e,t,i),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;let{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(RM),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===UE&&(this.enableMoveEvent=t),e===zE&&(this.enableOverEvent=t),e===VE&&(this.enableOutEvent=t),e===jE&&(this.enableEnterEvent=t),e===WE&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(zE,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(VE,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(jE,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(WE,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(UE,e);break;case"mouseup":this.pressed=!1;break;default:}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}};var{KEY_EVENTS:DM}=So,HE="keydown",XE="keyup",Cu=class extends br{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{let o=s.target||s.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:HE,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:XE,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(DM),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===HE&&(this.enableDownEvent=t),e===XE&&(this.enableUpEvent=t)}};var qE="contextmenu",Mu=class extends br{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{!this.options.enable||this.callback({type:qE,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===qE&&(this.options.enable=t)}};var FM={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},OM=1,NM=2,BM=3,kM=0,GM=1,UM=2,zM=1,VM=2,jM=4;function YE(n){let e=FM[n.srcEvent.type];if(!e)return null;let{buttons:t,button:i,which:s}=n.srcEvent,o=!1,a=!1,u=!1;return e===4||e===2&&!Number.isFinite(t)?(o=s===OM,a=s===NM,u=s===BM):e===2?(o=Boolean(t&zM),a=Boolean(t&jM),u=Boolean(t&VM)):e===1&&(o=i===kM,a=i===GM,u=i===UM),{leftButton:o,middleButton:a,rightButton:u}}function ZE(n,e){let t=n.center;if(!t)return null;let i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,a={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/o};return{center:t,offsetCenter:a}}var mg={srcElement:"root",priority:0},Iu=class{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;let i=this._normalizeEvent(t),s=t.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,o=!1){let{handlers:a,handlersByElement:u}=this,l=mg;typeof i=="string"||i&&i.addEventListener?l={...mg,srcElement:i}:i&&(l={...mg,...i});let c=u.get(l.srcElement);c||(c=[],u.set(l.srcElement,c));let f={type:e,handler:t,srcElement:l.srcElement,priority:l.priority};s&&(f.once=!0),o&&(f.passive=!0),a.push(f),this._active=this._active||!f.passive;let h=c.length-1;for(;h>=0&&!(c[h].priority>=f.priority);)h--;c.splice(h+1,0,f)}remove(e,t){let{handlers:i,handlersByElement:s}=this;for(let o=i.length-1;o>=0;o--){let a=i[o];if(a.type===e&&a.handler===t){i.splice(o,1);let u=s.get(a.srcElement);u.splice(u.indexOf(a),1),u.length===0&&s.delete(a.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,t){let i=this.handlersByElement.get(t);if(i){let s=!1,o=()=>{e.handled=!0},a=()=>{e.handled=!0,s=!0},u=[];for(let l=0;l<i.length;l++){let{type:c,handler:f,once:h}=i[l];if(f({...e,type:c,stopPropagation:o,stopImmediatePropagation:a}),h&&u.push(i[l]),s)break}for(let l=0;l<u.length;l++){let{type:c,handler:f}=u[l];this.remove(c,f)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...YE(e),...ZE(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}};var WM={events:null,recognizers:null,recognizerOptions:{},Manager:RE,touchAction:"none",tabIndex:0},Po=class{constructor(e=null,t){this._onBasicInput=s=>{let{srcEvent:o}=s,a=OE[o.type];a&&this.manager.emit(a,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...WM,...t},this.events=new Map,this.setElement(e);let{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;let{options:t}=this,i=t.Manager;this.manager=new i(e,{touchAction:t.touchAction,recognizers:t.recognizers||DE}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(pg).forEach(s=>{let o=this.manager.get(s);o&&pg[s].forEach(a=>{o.recognizeWith(a)})});for(let s in t.recognizerOptions){let o=this.manager.get(s);if(o){let a=t.recognizerOptions[s];delete a.enable,o.set(a)}}this.wheelInput=new Su(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Pu(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Cu(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Mu(e,this._onOtherEvent,{enable:!1});for(let[s,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(s,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:i}=this;if(!i)return;let s=i.get(e);if(s&&s.options.enable!==t){s.set({enable:t});let o=FE[e];o&&!this.options.recognizers&&o.forEach(a=>{let u=i.get(a);t?(u.requireFailure(e),s.dropRequireFailure(a)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,i,s,o){if(typeof e!="string"){i=t;for(let f in e)this._addEventHandler(f,e[f],i,s,o);return}let{manager:a,events:u}=this,l=gg[e]||e,c=u.get(l);c||(c=new Iu(this),u.set(l,c),c.recognizerName=NE[l]||l,a&&a.on(l,c.handleEvent)),c.add(e,t,i,s,o),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(let a in e)this._removeEventHandler(a,e[a]);return}let{events:i}=this,s=gg[e]||e,o=i.get(s);if(!!o&&(o.remove(e,t),o.isEmpty())){let{recognizerName:a}=o,u=!1;for(let l of i.values())if(l.recognizerName===a&&!l.isEmpty()){u=!0;break}u||this._toggleRecognizer(a,!1)}}};function ss(){}var HM=({isDragging:n})=>n?"grabbing":"grab",KE={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:ss,onResize:ss,onViewStateChange:ss,onInteractionStateChange:ss,onBeforeRender:ss,onAfterRender:ss,onLoad:ss,onError:n=>$.error(n.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:HM,getTooltip:null,debug:!1,drawPickingColors:!1},Zn=class{constructor(e){m(this,"props",void 0),m(this,"width",0),m(this,"height",0),m(this,"userData",{}),m(this,"canvas",null),m(this,"viewManager",null),m(this,"layerManager",null),m(this,"effectManager",null),m(this,"deckRenderer",null),m(this,"deckPicker",null),m(this,"eventManager",null),m(this,"tooltip",null),m(this,"metrics",void 0),m(this,"animationLoop",void 0),m(this,"stats",void 0),m(this,"viewState",void 0),m(this,"cursorState",void 0),m(this,"_needsRedraw",void 0),m(this,"_pickRequest",void 0),m(this,"_lastPointerDownInfo",null),m(this,"_metricsCounter",void 0),m(this,"_onPointerMove",t=>{let{_pickRequest:i}=this;if(t.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(t.leftButton||t.rightButton)return;{let s=t.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=t}),m(this,"_onEvent",t=>{let i=Kp[t.type],s=t.offsetCenter;if(!i||!s||!this.layerManager)return;let o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=a,l=u&&(u[i.handler]||u.props[i.handler]),c=this.props[i.handler],f=!1;l&&(f=l.call(u,a,t)),!f&&c&&c(a,t)}),m(this,"_onPointerDown",t=>{let i=t.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...KE,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&$.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),qs()==="IE"&&$.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Lt({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&yr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,s,o,a,u;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(t=this.viewManager)===null||t===void 0||t.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(u=this.tooltip)===null||u===void 0||u.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&$.removed("onLayerHover","onHover")(),"onLayerClick"in e&&$.removed("onLayerClick","onClick")(),e.initialViewState&&!Bt(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||i||s||o||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Ae(this.viewManager),this.viewManager.views}getViewports(e){return Ae(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_pick(e,t,i){Ae(this.deckPicker);let{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();let o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Ae(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:i}=e;if(t||t===0){let o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(i||i===0){var s;let o=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((s=e.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth||e.width,i=e.clientHeight||e.height;if(t!==this.width||i!==this.height){var s;this.width=t,this.height=i,(s=this.viewManager)===null||s===void 0||s.setProps({width:t,height:i}),this.props.onResize({width:t,height:i})}}_createAnimationLoop(e){let{width:t,height:i,gl:s,glOptions:o,debug:a,onError:u,onBeforeRender:l,onAfterRender:c,useDevicePixels:f}=e;return new zi({width:t,height:i,useDevicePixels:f,autoResizeViewport:!1,gl:s,onCreateContext:h=>$s({...o,...h,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:h=>this._setGLContext(h.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:u})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new wo({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){let{_pickRequest:e}=this;if(e.event){let{result:i,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let o=s,a=!1;for(let u of i){var t;o=u,a=((t=u.layer)===null||t===void 0?void 0:t.onHover(u,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){let u=this.props.getTooltip(o);this.tooltip.setTooltip(u,o.x,o.y)}e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Fi(e,{enable:!0,copyState:!0})),this.tooltip=new wu(this.canvas),dt(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);let t=new Hn;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new Po(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let s in Kp)this.eventManager.on(s,this._onEvent);this.viewManager=new du({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new hu(e,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new bu,this.deckRenderer=new vu(e),this.deckPicker=new Tu(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{gl:i}=this.layerManager.context;dt(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let i=qt.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}};m(Zn,"defaultProps",KE);m(Zn,"VERSION",M1.VERSION);var os=class{constructor(e,t){m(this,"opts",void 0),m(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){let e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];let{value:i}=this.source,{size:s}=t,o=i;if(i&&i.length!==s){o=new Float32Array(s);let a=t.elementOffset||0;for(let u=0;u<s;++u)o[u]=i[a+u]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}};function $E(n){switch(n){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function mf(n){return n.stride||n.size*n.bytesPerElement}function JE(n,e){e.offset&&$.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let t=mf(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,o=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:o,stride:t}}function XM(n,e){let t=JE(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}var Lu=class{constructor(e,t,i){m(this,"gl",void 0),m(this,"id",void 0),m(this,"size",void 0),m(this,"settings",void 0),m(this,"value",void 0),m(this,"doublePrecision",void 0),m(this,"_buffer",void 0),m(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;let s=t.logicalType||t.type,o=s===5130,{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let u;o?u=5126:!s&&t.isIndexed?u=e&&za(e,me.ELEMENT_INDEX_UINT32)?5125:5123:u=s||5126;let l=$E(s||u||5126);this.doublePrecision=o,o&&t.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...t,defaultType:l,defaultValue:a,logicalType:s,type:u,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){let{isIndexed:e,type:t}=this.settings;this._buffer=new re(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*mf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),yr.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){let i={},s=this.value instanceof Float64Array,o=XM(this.getAccessor(),t||{});return i[e]=new os(this,o.high),i["".concat(e,"64Low")]=s?new os(this,o.low):new Float32Array(this.size),i}if(t){let i=JE(this.getAccessor(),t);return{[e]:new os(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:i,size:s}=this,o=i*s;if(t&&o&&t.length>=o){let a=new Array(s).fill(1/0),u=new Array(s).fill(-1/0);for(let l=0;l<o;)for(let c=0;c<s;c++){let f=t[l++];f<a[c]&&(a[c]=f),f>u[c]&&(u[c]=f)}e=[a,u]}}return this.state.bounds=e,e}setData(e){let{state:t}=this,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof re?i={buffer:e}:i=e;let s={...this.settings,...i};if(t.bufferAccessor=s,t.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(i.buffer){let o=i.buffer;t.externalBuffer=o,t.constant=!1,this.value=i.value||null;let a=i.value instanceof Float64Array;s.type=i.type||o.accessor.type,s.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(a?2:1),s.stride=mf(s)}else if(i.value){this._checkExternalBuffer(i);let o=i.value;t.externalBuffer=null,t.constant=!1,this.value=o,s.bytesPerElement=o.BYTES_PER_ELEMENT,s.stride=mf(s);let{buffer:a,byteOffset:u}=this;this.doublePrecision&&o instanceof Float64Array&&(o=ff(o,s));let l=o.byteLength+u+s.stride*2;a.byteLength<l&&a.reallocate(l),a.setAccessor(null),a.subData({data:o,offset:u}),s.type=i.type||a.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?ff(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),offset:i*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,t=!1){let{state:i}=this,s=i.allocatedValue,o=yr.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;let{buffer:a,byteOffset:u}=this;return a.byteLength<o.byteLength+u&&(a.reallocate(o.byteLength+u),t&&s&&a.subData({data:s instanceof Float64Array?ff(s,this):s,offset:u})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));let i=this.settings.defaultType,s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&$.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){let{defaultValue:s,size:o}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e)return t[i]=s[0],t;switch(o){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let a=o;for(;--a>=0;)t[i+a]=Number.isFinite(e[a])?e[a]:s[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}};var QE=[],e_=[];function Ar(n,e=0,t=1/0){let i=QE,s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(e_.length=n.length,i=e_):i=QE,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function xf(n){return n&&n[Symbol.asyncIterator]}function yf(n,e){let{size:t,stride:i,offset:s,startIndices:o,nested:a}=e,u=n.BYTES_PER_ELEMENT,l=i?i/u:t,c=s?s/u:0,f=Math.floor((n.length-c)/l);return(h,{index:d,target:x})=>{if(!o){let M=d*l+c;for(let D=0;D<t;D++)x[D]=n[M+D];return x}let E=o[d],w=o[d+1]||f,S;if(a){S=new Array(w-E);for(let M=E;M<w;M++){let D=M*l+c;x=new Array(t);for(let C=0;C<t;C++)x[C]=n[D+C];S[M-E]=x}}else if(l===t)S=n.subarray(E*t+c,w*t+c);else{S=new n.constructor((w-E)*t);let M=0;for(let D=E;D<w;D++){let C=D*l+c;for(let L=0;L<t;L++)S[M++]=n[C+L]}}return S}}var t_=[],Ru=[[0,1/0]];function r_(n,e){if(n===Ru||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;let t=[],i=n.length,s=0;for(let o=0;o<i;o++){let a=n[o];a[1]<e[0]?(t.push(a),s=o+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(s,0,e),t}function xg(n){let{source:e,target:t,start:i=0,size:s,getData:o}=n,a=n.end||t.length,u=e.length,l=a-i;if(u>l){t.set(e.subarray(0,l),i);return}if(t.set(e,i),!o)return;let c=u;for(;c<l;){let f=o(c,e);for(let h=0;h<s;h++)t[i+c]=f[h]||0,c++}}function n_({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:o}){if(!Array.isArray(o))return xg({source:n,target:e,size:t,getData:i}),e;let a=0,u=0,l=i&&((f,h)=>i(f+u,h)),c=Math.min(s.length,o.length);for(let f=1;f<c;f++){let h=s[f]*t,d=o[f]*t;xg({source:n.subarray(a,h),target:e,start:u,end:d,size:t,getData:l}),a=h,u=d}return u<e.length&&xg({source:[],target:e,start:u,size:t,getData:l}),e}var YM={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Ef(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});let t=n.type||"interpolation";return{...YM[t],...e,...n,type:t}}function _f(n,e){let t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function bf(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(n,'"'))}}function Af(n){n.push(n.shift())}function Du(n,e){let{doublePrecision:t,settings:i,value:s,size:o}=n,a=t&&s instanceof Float64Array?2:1;return(i.noAlloc?s.length:e*o)*a}function vf({buffer:n,numInstances:e,attribute:t,fromLength:i,fromStartIndices:s,getData:o=a=>a}){let a=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*a,l=t.byteOffset,c=t.startIndices,f=s&&c,h=Du(t,e),d=t.isConstant;if(!f&&i>=h)return;let x=d?t.value:t.getBuffer().getData({srcByteOffset:l});if(t.settings.normalized&&!d){let M=o;o=(D,C)=>t.normalizeConstant(M(D,C))}let E=d?(M,D)=>o(x,D):(M,D)=>o(x.subarray(M,M+u),D),w=n.getData({length:i}),S=new Float32Array(h);n_({source:w,target:S,sourceStartIndices:s,targetStartIndices:c,size:u,getData:E}),n.byteLength<S.byteLength+l&&n.reallocate(S.byteLength+l),n.subData({data:S,offset:l})}var mn=class extends Lu{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ru}),m(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return Ef(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=r_(this.state.updateRanges,[i,s])}else this.state.updateRanges=Ru}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=t_}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==Ru),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;let{state:{updateRanges:o},settings:{update:a,noAlloc:u}}=this,l=!0;if(a){for(let[c,f]of o)a.call(s,this,{data:t,startRow:c,endRow:f,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[c,f]of o){let h=Number.isFinite(c)?this.getVertexOffset(c):0,d=Number.isFinite(f)?this.getVertexOffset(f):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:d})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let a=e;Ae(ArrayBuffer.isView(a.value),"invalid ".concat(s.accessor));let u=Boolean(a.size)&&a.size!==this.size;return i.binaryAccessor=yf(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?t[e]:e)*this.size}getShaderAttributes(){let e=this.settings.shaderAttributes||{[this.id]:null},t={};for(let i in e)Object.assign(t,super.getShaderAttributes(i,e[i]));return t}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:o,numInstances:a}){if(e.constant)return;let{settings:u,state:l,value:c,size:f,startIndices:h}=e,{accessor:d,transform:x}=u,E=l.binaryAccessor||(typeof d=="function"?d:o[d]);Ae(typeof E=="function",'accessor "'.concat(d,'" is not a function'));let w=e.getVertexOffset(i),{iterable:S,objectInfo:M}=Ar(t,i,s);for(let D of S){M.index++;let C=E(D,M);if(x&&(C=x.call(this,C)),h){let L=(M.index<h.length-1?h[M.index+1]:a)-h[M.index];if(C&&Array.isArray(C[0])){let B=w;for(let j of C)e._normalizeValue(j,c,B),B+=f}else C&&C.length>f?c.set(C,w):(e._normalizeValue(C,M.target,0),ug({target:c,source:M.target,start:w,count:L}));w+=L*f}else e._normalizeValue(C,c,w),w+=f}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}};var Fu=class{constructor({gl:e,attribute:t,timeline:i}){m(this,"gl",void 0),m(this,"type","interpolation"),m(this,"attributeInTransition",void 0),m(this,"settings",void 0),m(this,"attribute",void 0),m(this,"transition",void 0),m(this,"currentStartIndices",void 0),m(this,"currentLength",void 0),m(this,"transform",void 0),m(this,"buffers",void 0),this.gl=e,this.transition=new kt(i),this.attribute=t,this.attributeInTransition=new mn(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=KM(e,t);let s={byteLength:0,usage:35050};this.buffers=[new re(e,s),new re(e,s)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;let{gl:i,buffers:s,attribute:o}=this;Af(s);let a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(let u of s)vf({buffer:u,...a});this.currentStartIndices=o.startIndices,this.currentLength=Du(o,t),this.attributeInTransition.setData({buffer:s[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:s[0],aTo:_f(i,o)},feedbackBuffers:{vCurrent:s[1]}})}update(){let e=this.transition.update();if(e){let{duration:t,easing:i}=this.settings,{time:s}=this.transition,o=s/t;i&&(o=i(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(let e of this.buffers)e.delete();this.buffers.length=0}},ZM=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function KM(n,e){let t=bf(e.size);return new Ot(n,{vs:ZM,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}var Ou=class{constructor({gl:e,attribute:t,timeline:i}){m(this,"gl",void 0),m(this,"type","spring"),m(this,"attributeInTransition",void 0),m(this,"settings",void 0),m(this,"attribute",void 0),m(this,"transition",void 0),m(this,"currentStartIndices",void 0),m(this,"currentLength",void 0),m(this,"texture",void 0),m(this,"framebuffer",void 0),m(this,"transform",void 0),m(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new kt(i),this.attribute=t,this.attributeInTransition=new mn(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=JM(e),this.framebuffer=QM(e,this.texture),this.transform=$M(e,t,this.framebuffer);let s={byteLength:0,usage:35050};this.buffers=[new re(e,s),new re(e,s),new re(e,s)]}get inProgress(){return this.transition.inProgress}start(e,t){let{gl:i,buffers:s,attribute:o}=this,a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(let u of s)vf({buffer:u,...a});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=Du(o,t),this.attributeInTransition.setData({buffer:s[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:_f(i,o)}})}update(){let{buffers:e,transform:t,framebuffer:i,transition:s}=this;if(!s.update())return!1;let a=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Af(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),sn(i)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(let e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}};function $M(n,e,t){let i=bf(e.size);return new Ot(n,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function JM(n){return new he(n,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function QM(n,e){return new le(n,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}var eI={interpolation:Fu,spring:Ou},Nu=class{constructor(e,{id:t,timeline:i}){m(this,"id",void 0),m(this,"isSupported",void 0),m(this,"gl",void 0),m(this,"timeline",void 0),m(this,"transitions",void 0),m(this,"needsRedraw",void 0),m(this,"numInstances",void 0),this.id=t,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Ot.isSupported(e)}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(let s in e){let o=e[s],a=o.getTransitionSetting(t);!a||this._updateAttribute(s,o,a)}for(let s in this.transitions){let o=e[s];(!o||!o.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(let t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,i){let s=this.transitions[e],o=!s||s.type!==i.type;if(o){if(!this.isSupported){$.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}s&&this._removeTransition(e);let a=eI[i.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):($.error("unsupported transition type '".concat(i.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}};var i_="attributeManager.invalidate",tI="attributeManager.updateStart",rI="attributeManager.updateEnd",nI="attribute.updateStart",iI="attribute.allocate",sI="attribute.updateEnd",Bu=class{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){m(this,"id",void 0),m(this,"gl",void 0),m(this,"attributes",void 0),m(this,"updateTriggers",void 0),m(this,"needsRedraw",void 0),m(this,"userData",void 0),m(this,"stats",void 0),m(this,"attributeTransitionManager",void 0),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new Nu(e,{id:"".concat(t,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(let t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let i=this._invalidateTrigger(e,t);Fe(i_,this,e,i)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Fe(i_,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:o={},buffers:a={},context:u={}}){let l=!1;Fe(tI,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let c in this.attributes){let f=this.attributes[c],h=f.settings.accessor;f.startIndices=i,f.numInstances=t,o[c]&&$.removed("props.".concat(c),"data.attributes.".concat(c))(),f.setExternalBuffer(a[c])||f.setBinaryValue(typeof h=="string"?a[h]:void 0,e.startIndices)||typeof h=="string"&&!a[h]&&f.setConstantValue(o[h])||f.needsUpdate()&&(l=!0,this._updateAttribute({attribute:f,numInstances:t,data:e,props:o,context:u})),this.needsRedraw=this.needsRedraw||f.needsRedraw()}l&&Fe(rI,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(let o in t){let a=t[o];a.needsRedraw(e)&&!i.hasAttribute(o)&&(s[o]=a)}return s}getShaderAttributes(e,t={}){e||(e=this.getAttributes());let i={};for(let s in e)t[s]||Object.assign(i,e[s].getShaderAttributes());return i}_add(e,t={}){for(let i in e){let s=e[i];this.attributes[i]=this._createAttribute(i,s,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,i){let s={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:i.instanced?1:t.divisor||0};return new mn(this.gl,s)}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:i,updateTriggers:s}=this,o=s[e];return o&&o.forEach(a=>{let u=i[a];u&&u.setNeedsUpdate(u.id,t)}),o}_updateAttribute(e){let{attribute:t,numInstances:i}=e;if(Fe(nI,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&Fe(iI,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Fe(sI,t,i))}};var ku=class extends kt{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:o}}=this,a=o(e/s);this._value=ji(t,i,a)}};var s_=1e-5;function o_(n,e,t,i,s){let o=e-n,u=(t-e)*s,l=-o*i;return u+l+o+e}function oI(n,e,t,i,s){if(Array.isArray(t)){let o=[];for(let a=0;a<t.length;a++)o[a]=o_(n[a],e[a],t[a],i,s);return o}return o_(n,e,t,i,s)}function a_(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){let s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}var Gu=class extends kt{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:o=e,_currValue:a=e}=this,u=oI(o,a,t,i,s),l=a_(u,t),c=a_(u,a);l<s_&&c<s_&&(u=t,this.end()),this._prevValue=a,this._currValue=u}};var aI={interpolation:ku,spring:Gu},Uu=class{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){let{transitions:o}=this;if(o.has(e)){let l=o.get(e),{value:c=l.settings.fromValue}=l;t=c,this.remove(e)}if(s=Ef(s),!s)return;let a=aI[s.type];if(!a){$.error("unsupported transition type '".concat(s.type,"'"))();return}let u=new a(this.timeline);u.start({...s,fromValue:t,toValue:i}),o.set(e,u)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}};function l_(n){let e=Eg(n);for(let t in e){let i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error("Invalid prop ".concat(t,": ").concat(n[t]))}}function c_(n,e){let t=f_({newProps:n,oldProps:e,propTypes:Eg(n),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=lI(n,e),s=!1;return i||(s=cI(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:fI(n,e),transitionsChanged:uI(n,e)}}function uI(n,e){if(!n.transitions)return!1;let t={},i=Eg(n),s=!1;for(let o in n.transitions){let a=i[o],u=a&&a.type;(u==="number"||u==="color"||u==="array")&&yg(n[o],e[o],a)&&(t[o]=!0,s=!0)}return s?t:!1}function f_({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(let o of Object.keys(n))if(!(o in t)){if(!(o in e))return"".concat(s,".").concat(o," added");let a=yg(n[o],e[o],i[o]);if(a)return"".concat(s,".").concat(o," ").concat(a)}for(let o of Object.keys(e))if(!(o in t)){if(!(o in n))return"".concat(s,".").concat(o," dropped");if(!Object.hasOwnProperty.call(n,o)){let a=yg(n[o],e[o],i[o]);if(a)return"".concat(s,".").concat(o," ").concat(a)}}return!1}function yg(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function lI(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1,{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function cI(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&u_(n,e,"all"))return{all:!0};let t={},i=!1;for(let s in n.updateTriggers)s!=="all"&&u_(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function fI(n,e){if(e===null)return!0;let t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function u_(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},f_({oldProps:s,newProps:i,triggerName:t})}function Eg(n){let e=n[vo],t=e&&e.constructor;return t?t._propTypes:{}}var hI="count(): argument not an object",dI="count(): argument not a container";function h_(n){if(!gI(n))throw new Error(hI);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(pI(n))return Object.keys(n).length;throw new Error(dI)}function pI(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function gI(n){return n!==null&&typeof n=="object"}function d_(n,e){if(!e)return n;let t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){let i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{let i={...n.inject};for(let s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}var mI={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},_g={};function p_(n,e){let t=n.context&&n.context.gl;if(!t||!e)return null;if(e instanceof he)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});let s=new he(t,{...e,parameters:{...mI,...i,...n.props.textureParameters}});return _g[s.id]=!0,s}function g_(n){!n||!(n instanceof he)||_g[n.id]&&(n.delete(),delete _g[n.id])}var xI={boolean:{validate(n,e){return!0},equal(n,e,t){return Boolean(n)===Boolean(e)}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Vu(n)&&(n.length===3||n.length===4)},equal(n,e,t){return bg(n,e)}},accessor:{validate(n,e){let t=Tf(n);return t==="function"||t===Tf(e.value)},equal(n,e,t){return typeof e=="function"?!0:bg(n,e)}},array:{validate(n,e){return e.optional&&!n||Vu(n)},equal(n,e,t){return t.compare?bg(n,e):n===e}},object:{equal(n,e,t){return t.compare?Bt(n,e):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare||n===e}},data:{transform:(n,e,t)=>{let{dataTransform:i}=t.props;return i&&n?i(n):n}},image:{transform:(n,e,t)=>p_(t,n),release:n=>{g_(n)}}};function bg(n,e){if(n===e)return!0;if(!Vu(n)||!Vu(e))return!1;let t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function m_(n){let e={},t={},i={};for(let[s,o]of Object.entries(n)){let a=o?.deprecatedFor;if(a)i[s]=Array.isArray(a)?a:[a];else{let u=yI(s,o);e[s]=u,t[s]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function yI(n,e){switch(Tf(e)){case"object":return zu(n,e);case"array":return zu(n,{type:"array",value:e,compare:!1});case"boolean":return zu(n,{type:"boolean",value:e});case"number":return zu(n,{type:"number",value:e});case"function":return zu(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function zu(n,e){return"type"in e?{name:n,...xI[e.type],...e}:"value"in e?{name:n,type:Tf(e.value),...e}:{name:n,type:"object",value:e}}function Vu(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Tf(n){return Vu(n)?"array":n===null?"null":typeof n}function x_(n,e){let t=y_(n.constructor),i=Object.create(t);i[vo]=n,i[kr]={},i[Er]={};for(let s=0;s<e.length;++s){let o=e[s];for(let a in o)i[a]=o[a]}return Object.freeze(i),i}function y_(n){let e=wf(n,"_mergedDefaultProps");return e||(EI(n),n._mergedDefaultProps)}function EI(n){if(!n.prototype)return;let t=Object.getPrototypeOf(n),i=y_(t),s=wf(n,"defaultProps")||{},o=m_(s),a=_I(o.defaultProps,i,n),u={...t._propTypes,...o.propTypes};AI(a,u);let l={...t._deprecatedProps,...o.deprecatedProps};bI(a,l),n._mergedDefaultProps=a,n._propTypes=u,n._deprecatedProps=l}function _I(n,e,t){let i=Object.create(null);Object.assign(i,e,n);let s=TI(t);return delete n.id,Object.defineProperties(i,{id:{writable:!0,value:s}}),i}function bI(n,e){for(let t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){let s="".concat(this.id,": ").concat(t);for(let o of e[t])E_(this,o)||(this[o]=i);$.deprecated(s,e[t].join("/"))()}})}function AI(n,e){let t={},i={};for(let s in e){let o=e[s],{name:a,value:u}=o;o.async&&(t[a]=u,i[a]=vI(a))}n[fn]=t,n[kr]={},Object.defineProperties(n,i)}function vI(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||xf(e)?this[kr][n]=e:this[Er][n]=e},get(){if(this[Er]){if(n in this[Er])return this[Er][n]||this[fn][n];if(n in this[kr]){let e=this[vo]&&this[vo].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[fn][n]}}return this[fn][n]}}}function E_(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function wf(n,e){return E_(n,e)&&n[e]}function TI(n){let e=wf(n,"layerName")||wf(n,"componentName");return e||$.once(0,"".concat(n.name,".componentName not specified"))(),e||n.name}var wI=0,as=class{constructor(...e){m(this,"id",void 0),m(this,"props",void 0),m(this,"count",void 0),this.props=x_(this,e),this.id=this.props.id,this.count=wI++}clone(e){let{props:t}=this,i={};for(let s in t[fn])s in t[Er]?i[s]=t[Er][s]:s in t[kr]&&(i[s]=t[kr][s]);return new this.constructor({...t,...i,...e})}};m(as,"componentName","Component");m(as,"defaultProps",{});var SI=Object.freeze({}),ju=class{constructor(e){m(this,"component",void 0),m(this,"onAsyncPropUpdated",void 0),m(this,"asyncProps",void 0),m(this,"oldProps",void 0),m(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||SI}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){let t=e[Er]||{},i=e[kr]||e,s=e[fn]||{};for(let o in t){let a=t[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,a),t[o]=this.getAsyncProp(o)}for(let o in i){let a=i[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(!!this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(xf(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){let i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){let s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let s=i.pendingLoadCount;t.then(o=>{o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,s),this._onResolve(e,o)}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let s=i.pendingLoadCount,o=[],a=0;for await(let u of t){let{dataTransform:l}=this.component.props;l?o=l(u,o):o=o.concat(u),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(e,o,s)}this._onResolve(e,o)}_postProcessValue(e,t){let i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let s=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}};var Wu=class extends ju{constructor({attributeManager:e,layer:t}){super(t),m(this,"attributeManager",void 0),m(this,"needsRedraw",void 0),m(this,"needsUpdate",void 0),m(this,"subLayers",void 0),m(this,"usesPickingColorCache",void 0),m(this,"changeFlags",void 0),m(this,"viewport",void 0),m(this,"uniformTransitions",void 0),m(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,t){let i=this.component.props.fetch;return i?i(t,{propName:e,layer:this.layer}):super._fetch(e,t)}_onResolve(e,t){let i=this.component.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:this.layer})}_onError(e,t){this.layer.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}};var PI="layer.changeFlag",CI="layer.initialize",MI="layer.update",II="layer.finalize",LI="layer.matched",__=2**24-1,RI=Object.freeze([]),DI=pr(({oldViewport:n,viewport:e})=>n.equals(e)),Gr=new Uint8ClampedArray(0),FI={data:{type:"data",value:RI,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:o})=>{let{resourceManager:a}=t.context;if(s=s||t.getLoadOptions(),i=i||t.props.loaders,o){var u;s={...s,fetch:{...(u=s)===null||u===void 0?void 0:u.fetch,signal:o}}}let l=a.contains(n);return!l&&!s&&(a.add({resourceId:n,data:Dr(n,i),persistent:!1}),l=!0),l?a.subscribe({resourceId:n,onChange:c=>{var f;return(f=t.internalState)===null||f===void 0?void 0:f.reloadAsyncProp(e,c)},consumerId:t.id,requestId:e}):Dr(n,i,s)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:dr.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:ce.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Ne=class extends as{constructor(...e){super(...e),m(this,"internalState",null),m(this,"lifecycle",qn.NO_STATE),m(this,"context",void 0),m(this,"state",void 0),m(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){let e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ae(this.internalState);let t=this.internalState.viewport||this.context.viewport,i=ag(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,o,a]=Eo(i,t.pixelProjectionMatrix);return e.length===2?[s,o]:[s,o,a]}unproject(e){return Ae(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Ae(this.internalState);let i=this.internalState.viewport||this.context.viewport;return EE(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(let t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===ce.DEFAULT||e===ce.LNGLAT||e===ce.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ae(e instanceof Uint8Array);let[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:h_(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;let t=this.getAttributeManager();if(!t)return null;let{positions:i,instancePositions:s}=t.attributes;return(e=i||s)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(let t of this.props.extensions)e=d_(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(let l of i)t.invalidateAll(l);else t.invalidateAll();let{props:s,oldProps:o}=e,a=Number.isInteger(o.highlightedObjectIndex)||o.pickable,u=Number.isInteger(s.highlightedObjectIndex)||s.pickable;if(a!==u&&t){let{pickingColors:l,instancePickingColors:c}=t.attributes,f=l||c;f&&(u&&f.constant&&(f.constant=!1,t.invalidate(f.id)),!f.value&&!u&&(f.constant=!0,f.value=[0,0,0]))}}finalizeState(e){for(let i of this.getModels())i.delete();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:i}){let{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var i,s;if(t&&(e.message="".concat(t,": ").concat(e.message)),!((i=(s=this.props).onError)!==null&&i!==void 0&&i.call(s,e))){var o,a;(o=this.context)===null||o===void 0||(a=o.onError)===null||a===void 0||a.call(o,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,(!t||!DI({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();!t||(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(let t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),i=Object.create(this.props);for(let s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let i=Math.floor(Gr.length/3);if(this.internalState.usesPickingColorCache=!0,i<t){t>__&&$.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Gr=yr.allocate(Gr,t,{size:3,copy:!0,maxCount:Math.max(t,__)});let s=Math.floor(Gr.length/3),o=[];for(let a=i;a<s;a++)this.encodePickingColor(a,o),Gr[a*3+0]=o[0],Gr[a*3+1]=o[1],Gr[a*3+2]=o[2]}e.value=Gr.subarray(0,t*3)}_setModelAttributes(e,t){let i=this.getAttributeManager(),s=e.userData.excludeAttributes||{},o=i.getShaderAttributes(t,s);e.setAttributes(o)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;let o=s.getVertexOffset(e),a=s.getVertexOffset(e+1);s.buffer.subData({data:new Uint8Array(a-o),offset:o})}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==Gr.buffer&&(i.value=Gr.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ae(!this.internalState),Ae(Number.isFinite(this.props.coordinateSystem)),Fe(CI,this);let e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Wu({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new Uu(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Fe(LI,this,this===e);let{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(Fe(MI,this,e),!e)return;let t=this.props,i=this.context,s=this.internalState,o=i.viewport,a=this._updateUniformTransition();s.propsInTransition=a,i.viewport=s.viewport||o,this.props=a;try{let u=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(u);else try{this.updateState(u)}catch{}for(let f of this.props.extensions)f.updateState.call(this,u,f);let c=this.getModels()[0]!==l[0];this._postUpdate(u,c)}finally{i.viewport=o,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Fe(II,this),this.finalizeState(this.context);for(let e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:t={},parameters:i={}}){this._updateAttributeTransition();let s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;let a=this.props.opacity;t.opacity=Math.pow(a,1/2.2);try{e&&this.setModuleParameters(e);let{getPolygonOffset:u}=this.props,l=u&&u(t)||[0,0];dt(o.gl,{polygonOffset:l}),be(o.gl,i,()=>{let c={moduleParameters:e,uniforms:t,parameters:i,context:o};for(let f of this.props.extensions)f.draw.call(this,c,f);this.draw(c)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let s in e)if(e[s]){let o=!1;switch(s){case"dataChanged":let a=e[s],u=t[s];a&&Array.isArray(u)&&(t.dataChanged=Array.isArray(a)?u.concat(a):a,o=!0);default:t[s]||(t[s]=e[s],o=!0)}o&&Fe(PI,this,s,e)}let i=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let i=c_(e,t);if(i.updateTriggersChanged)for(let o in i.updateTriggersChanged)i.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(i.transitionsChanged)for(let o in i.transitionsChanged){var s;this.internalState.uniformTransitions.add(o,t[o],e[o],(s=e.transitions)===null||s===void 0?void 0:s[o])}return this.setChangeFlags(i)}validateProps(){l_(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.pickingHighlightColor=i(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new Bu(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:i,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();let{model:o}=this.state;o?.setInstanceCount(this.getNumInstances());let{autoHighlight:a,highlightedObjectIndex:u,highlightColor:l}=i;if(t||s.autoHighlight!==a||s.highlightedObjectIndex!==u||s.highlightColor!==l){let c={};a||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),Number.isInteger(u)&&(c.pickingSelectedColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;let i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;return t=t||s,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};m(Ne,"defaultProps",FI);m(Ne,"layerName","Layer");var OI="compositeLayer.renderLayers",Gt=class extends Ne{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){let{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){let t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){var t;let{opacity:i,pickable:s,visible:o,parameters:a,getPolygonOffset:u,highlightedObjectIndex:l,autoHighlight:c,highlightColor:f,coordinateSystem:h,coordinateOrigin:d,wrapLongitude:x,positionFormat:E,modelMatrix:w,extensions:S,fetch:M,operation:D,_subLayerProps:C}=this.props,L={id:"",updateTriggers:{},opacity:i,pickable:s,visible:o,parameters:a,getPolygonOffset:u,highlightedObjectIndex:l,autoHighlight:c,highlightColor:f,coordinateSystem:h,coordinateOrigin:d,wrapLongitude:x,positionFormat:E,modelMatrix:w,extensions:S,fetch:M,operation:D},B=C&&e.id&&C[e.id],j=B&&B.updateTriggers,J=e.id||"sublayer";if(B){let te=this.constructor._propTypes,Z=e.type?e.type._propTypes:{};for(let q in B){let H=Z[q]||te[q];H&&H.type==="accessor"&&(B[q]=this.getSubLayerAccessor(B[q]))}}Object.assign(L,e,B),L.id="".concat(this.props.id,"-").concat(J),L.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...j};for(let te of S){let Z=te.getSubLayerProps.call(this,te);Z&&Object.assign(L,Z,{updateTriggers:Object.assign(L.updateTriggers,Z.updateTriggers)})}return L}_updateAutoHighlight(e){for(let t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers,s=!i||this.needsUpdate();if(s){let o=this.renderLayers();i=hn(o,Boolean),this.internalState.subLayers=i}Fe(OI,this,s,i);for(let o of i)o.parent=this}};m(Gt,"layerName","CompositeLayer");var Sf=Math.PI/180,b_=180/Math.PI,Pf=6370972,Co=256;function NI(){let n=Co/Pf,e=Math.PI/180*Co;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}var Mo=class extends ht{constructor(e={}){let{latitude:t=0,longitude:i=0,zoom:s=0,nearZMultiplier:o=.1,farZMultiplier:a=2,resolution:u=10}=e,{height:l,altitude:c=1.5}=e;l=l||1,c=Math.max(.75,c);let f=new ge().lookAt({eye:[0,-c,0],up:[0,0,1]}),h=Math.pow(2,s);f.rotateX(t*Sf),f.rotateZ(-i*Sf),f.scale(h/l);let d=Math.atan(.5/c),x=Co*2*h/l;super({...e,height:l,viewMatrix:f,longitude:i,latitude:t,zoom:s,distanceScales:NI(),fovyRadians:d*2,focalDistance:c,near:o,far:Math.min(2,1/x+1)*c*a}),m(this,"longitude",void 0),m(this,"latitude",void 0),m(this,"resolution",void 0),this.latitude=t,this.longitude=i,this.resolution=u}get projectionMode(){return ct.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),o=this.unproject([this.width,this.height/2],t),a=this.unproject([this.width/2,this.height],t);return o[0]<this.longitude&&(o[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],o[0],s[0],a[0]),Math.min(i[1],o[1],s[1],a[1]),Math.max(i[0],o[0],s[0],a[0]),Math.max(i[1],o[1],s[1],a[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let[s,o,a]=e,u=t?o:this.height-o,{pixelUnprojectionMatrix:l}=this,c;if(Number.isFinite(a))c=Ag(l,[s,u,a,1]);else{let x=Ag(l,[s,u,-1,1]),E=Ag(l,[s,u,1,1]),w=((i||0)/Pf+1)*Co,S=Kc(Yc([],x,E)),M=Kc(x),D=Kc(E),C=(4*M*D-(S-M-D)**2)/16,L=4*C/S,B=Math.sqrt(M-L),j=Math.sqrt(Math.max(0,w*w-L)),J=(B-j)/Math.sqrt(S);c=Kx([],x,E,J)}let[f,h,d]=this.unprojectPosition(c);return Number.isFinite(a)?[f,h,d]:Number.isFinite(i)?[f,h,i]:[f,h]}projectPosition(e){let[t,i,s=0]=e,o=t*Sf,a=i*Sf,u=Math.cos(a),l=(s/Pf+1)*Co;return[Math.sin(o)*u*l,-Math.cos(o)*u*l,Math.sin(a)*l]}unprojectPosition(e){let[t,i,s]=e,o=Zc(e),a=Math.asin(s/o),l=Math.atan2(t,-i)*b_,c=a*b_,f=(o/Co-1)*Pf;return[l,c,f]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){let i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}};function Ag(n,e){let t=hr([],e,n);return fo(t,t,1/t[3]),t}var xn=class{constructor(e){m(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Bt(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){let{defaultProps:t}=e.constructor,i={updateTriggers:{}};for(let s in t)if(s in this.props){let o=t[s],a=this.props[s];i[s]=a,o&&o.type==="accessor"&&(i.updateTriggers[s]=this.props.updateTriggers[s],typeof a=="function"&&(i[s]=this.getSubLayerAccessor(a)))}return i}initializeState(e,t){}updateState(e,t){}draw(e,t){}finalizeState(e,t){}};m(xn,"defaultProps",{});var Kn=class{constructor(e){m(this,"opts",void 0),m(this,"typedArrayManager",void 0),m(this,"indexStarts",[0]),m(this,"vertexStarts",[0]),m(this,"vertexCount",0),m(this,"instanceCount",0),m(this,"attributes",void 0),m(this,"_attributeDefs",void 0),m(this,"data",void 0),m(this,"getGeometry",void 0),m(this,"geometryBuffer",void 0),m(this,"buffers",void 0),m(this,"positionSize",void 0),m(this,"normalize",void 0);let{attributes:t={}}=e;this.typedArrayManager=yr,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:t,buffers:i={},getGeometry:s,geometryBuffer:o,positionFormat:a,dataChanged:u,normalize:l=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=o&&o.size||(a==="XY"?2:3),this.buffers=i,this.normalize=l,o&&(Ae(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),l||(i.positions=o)),this.geometryBuffer=i.positions,Array.isArray(u))for(let c of u)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){let t=e.value||e;return ArrayBuffer.isView(t)?yf(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){let{attributes:i,buffers:s,_attributeDefs:o,typedArrayManager:a}=this;for(let u in o)if(u in s)a.release(i[u]),i[u]=null;else{let l=o[u];l.copy=t,i[u]=a.allocate(i[u],e,l)}}_forEachGeometry(e,t,i){let{data:s,getGeometry:o}=this,{iterable:a,objectInfo:u}=Ar(s,t,i);for(let l of a){u.index++;let c=o?o(l,u):null;e(c,u.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:s}=this,{data:o,geometryBuffer:a}=this,{startRow:u=0,endRow:l=1/0}=e||{},c={};if(e||(t=[0],i=[0]),this.normalize||!a)this._forEachGeometry((h,d)=>{let x=h&&this.normalizeGeometry(h);c[d]=x,i[d+1]=i[d]+(x?this.getGeometrySize(x):0)},u,l),s=i[i.length-1];else if(i=o.startIndices,s=i[o.length]||0,ArrayBuffer.isView(a))s=s||a.length/this.positionSize;else if(a instanceof re){let h=a.accessor.stride||this.positionSize*4;s=s||a.byteLength/h}else if(a.buffer){let h=a.stride||this.positionSize*4;s=s||a.buffer.byteLength/h}else if(a.value){let h=a.value,d=a.stride/h.BYTES_PER_ELEMENT||this.positionSize;s=s||h.length/d}this._allocate(s,Boolean(e)),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=s;let f={};this._forEachGeometry((h,d)=>{let x=c[d]||h;f.vertexStart=i[d],f.indexStart=t[d];let E=d<i.length-1?i[d+1]:s;f.geometrySize=E-i[d],f.geometryIndex=d,this.updateGeometryAttributes(x,f)},u,l),this.vertexCount=t[t.length-1]}};var A_=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`;var v_=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var BI=1024,kI=4,T_=()=>{},w_={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function GI(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function UI(n,e,t,i){return t===e.width&&i===e.height?e:(n.canvas.height=i,n.canvas.width=t,n.clearRect(0,0,n.canvas.width,n.canvas.height),n.drawImage(e,0,0,e.width,e.height,0,0,t,i),n.canvas)}function Hu(n){return n&&(n.id||n.url)}function zI(n,e,t,i){let s=n.width,o=n.height,a=new he(n.gl,{width:e,height:t,parameters:i});return Mc(n,a,{targetY:0,width:s,height:o}),n.delete(),a}function S_(n,e,t){for(let i=0;i<e.length;i++){let{icon:s,xOffset:o}=e[i],a=Hu(s);n[a]={...s,x:o,y:t}}}function VI({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:s=0,rowHeight:o=0,canvasWidth:a}){let u=[];for(let l=0;l<n.length;l++){let c=n[l],f=Hu(c);if(!t[f]){let{height:h,width:d}=c;i+d+e>a&&(S_(t,u,s),i=0,s=o+s+e,o=0,u=[]),u.push({icon:c,xOffset:i}),i=i+d+e,o=Math.max(o,h)}}return u.length>0&&S_(t,u,s),{mapping:t,rowHeight:o,xOffset:i,yOffset:s,canvasWidth:a,canvasHeight:GI(o+s+e)}}function jI(n,e,t){if(!n||!e)return null;t=t||{};let i={},{iterable:s,objectInfo:o}=Ar(n);for(let a of s){o.index++;let u=e(a,o),l=Hu(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");!i[l]&&(!t[l]||u.url!==t[l].url)&&(i[l]={...u,source:a,sourceIndex:o.index})}return i}var Xu=class{constructor(e,{onUpdate:t=T_,onError:i=T_}){m(this,"gl",void 0),m(this,"onUpdate",void 0),m(this,"onError",void 0),m(this,"_loadOptions",null),m(this,"_texture",null),m(this,"_externalTexture",null),m(this,"_mapping",{}),m(this,"_textureParameters",null),m(this,"_pendingCount",0),m(this,"_autoPacking",!1),m(this,"_xOffset",0),m(this,"_yOffset",0),m(this,"_rowHeight",0),m(this,"_buffer",kI),m(this,"_canvasWidth",BI),m(this,"_canvasHeight",0),m(this,"_canvas",null),this.gl=e,this.onUpdate=t,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let t=this._autoPacking?Hu(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:s,textureParameters:o}){if(e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),i){var a;(a=this._texture)===null||a===void 0||a.delete(),this._texture=null,this._externalTexture=i}o&&(this._textureParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;let i=Object.values(jI(e,t,this._mapping)||{});if(i.length>0){let{mapping:s,xOffset:o,yOffset:a,rowHeight:u,canvasHeight:l}=VI({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=u,this._mapping=s,this._xOffset=o,this._yOffset=a,this._canvasHeight=l,this._texture||(this._texture=new he(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||w_})),this._texture.height!==this._canvasHeight&&(this._texture=zI(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||w_)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){let t=this._canvas.getContext("2d");for(let i of e)this._pendingCount++,Dr(i.url,Ri,this._loadOptions).then(s=>{let o=Hu(i),{x:a,y:u,width:l,height:c}=this._mapping[o],f=UI(t,s,l,c);this._texture.setSubImageData({data:f,x:a,y:u,width:l,height:c}),this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}};var P_=[0,0,0,255],WI={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:P_},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}},Qt=class extends Ne{constructor(...e){super(...e),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:A_,fs:v_,modules:[ft,$t]})}initializeState(){this.state={iconManager:new Xu(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:P_},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:s}=e,o=this.getAttributeManager(),{iconAtlas:a,iconMapping:u,data:l,getIcon:c,textureParameters:f}=t,{iconManager:h}=this.state,d=a||this.internalState.isAsyncPropLoading("iconAtlas");if(h.setProps({loadOptions:t.loadOptions,autoPacking:!d,iconAtlas:a,iconMapping:d?u:null,textureParameters:f}),d?i.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&h.packIcons(l,c),s.extensionsChanged){var x;let{gl:E}=this.context;(x=this.state.model)===null||x===void 0||x.delete(),this.state.model=this._getModel(E),o.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:o,billboard:a,alphaCutoff:u}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:it[o],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,billboard:a,alphaCutoff:u}).draw()}_getModel(e){let t=[-1,-1,-1,1,1,1,1,-1];return new Pe(e,{...this.getShaders(),id:this.props.id,geometry:new Ze({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;let i=(t=this.getCurrentLayer())===null||t===void 0?void 0:t.props.onIconError;i?i(e):$.error(e.error.message)()}getInstanceOffset(e){let{width:t,height:i,anchorX:s=t/2,anchorY:o=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,i/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){let{x:t,y:i,width:s,height:o}=this.state.iconManager.getIconMapping(e);return[t,i,s,o]}};m(Qt,"defaultProps",WI);m(Qt,"layerName","IconLayer");var C_=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var M_=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var I_=[0,0,0,255],HI={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:I_},getLineColor:{type:"accessor",value:I_},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},us=class extends Ne{getShaders(){return super.getShaders({vs:C_,fs:M_,modules:[ft,$t]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;let{gl:i}=this.context;(t=this.state.model)===null||t===void 0||t.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){let{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,stroked:a,filled:u,billboard:l,antialiasing:c,lineWidthUnits:f,lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:x}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:u,billboard:l,antialiasing:c,radiusUnits:it[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,lineWidthUnits:it[f],lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:x}).draw()}_getModel(e){let t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Pe(e,{...this.getShaders(),id:this.props.id,geometry:new Ze({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};m(us,"defaultProps",HI);m(us,"layerName","ScatterplotLayer");var Cf={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function qu(n,e,t={}){return L_(n,t)!==e?(XI(n,t),!0):!1}function L_(n,e={}){return Math.sign(Mf(n,e))}function Mf(n,e={}){let{start:t=0,end:i=n.length}=e,s=e.size||2,o=0;for(let a=t,u=i-s;a<i;a+=s)o+=(n[a]-n[u])*(n[a+1]+n[u+1]),u=a;return o/2}function XI(n,e){let{start:t=0,end:i=n.length,size:s=2}=e,o=(i-t)/s,a=Math.floor(o/2);for(let u=0;u<a;++u){let l=t+u*s,c=t+(o-1-u)*s;for(let f=0;f<s;++f){let h=n[l+f];n[l+f]=n[c+f],n[c+f]=h}}}function bt(n,e){let t=e.length,i=n.length;if(i>0){let s=!0;for(let o=0;o<t;o++)if(n[i-t+o]!==e[o]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[i+s]=e[s];return!0}function Yu(n,e){let t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function $n(n,e,t,i,s=[]){let o=i+e*t;for(let a=0;a<t;a++)s[a]=n[o+a];return s}function If(n,e,t,i,s=[]){let o,a;if(t&8)o=(i[3]-n[1])/(e[1]-n[1]),a=3;else if(t&4)o=(i[1]-n[1])/(e[1]-n[1]),a=1;else if(t&2)o=(i[2]-n[0])/(e[0]-n[0]),a=2;else if(t&1)o=(i[0]-n[0])/(e[0]-n[0]),a=0;else return null;for(let u=0;u<n.length;u++)s[u]=(a&1)===u?i[a]:o*(e[u]-n[u])+n[u];return s}function Zu(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function Ku(n,e){let{size:t=2,broken:i=!1,gridResolution:s=10,gridOffset:o=[0,0],startIndex:a=0,endIndex:u=n.length}=e||{},l=(u-a)/t,c=[],f=[c],h=$n(n,0,t,a),d,x,E=F_(h,s,o,[]),w=[];bt(c,h);for(let S=1;S<l;S++){for(d=$n(n,S,t,a,d),x=Zu(d,E);x;){If(h,d,x,E,w);let M=Zu(w,E);M&&(If(h,w,M,E,w),x=M),bt(c,w),Yu(h,w),ZI(E,s,x),i&&c.length>t&&(c=[],f.push(c),bt(c,h)),x=Zu(d,E)}bt(c,d),Yu(h,d)}return i?f:f[0]}var R_=0,YI=1;function Lf(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}function $u(n,e=null,t){if(!n.length)return[];let{size:i=2,gridResolution:s=10,gridOffset:o=[0,0],edgeTypes:a=!1}=t||{},u=[],l=[{pos:n,types:a?new Array(n.length/i).fill(YI):null,holes:e||[]}],c=[[],[]],f=[];for(;l.length;){let{pos:h,types:d,holes:x}=l.shift();KI(h,i,x[0]||h.length,c),f=F_(c[0],s,o,f);let E=Zu(c[1],f);if(E){let w=D_(h,d,i,0,x[0]||h.length,f,E),S={pos:w[0].pos,types:w[0].types,holes:[]},M={pos:w[1].pos,types:w[1].types,holes:[]};l.push(S,M);for(let D=0;D<x.length;D++)w=D_(h,d,i,x[D],x[D+1]||h.length,f,E),w[0]&&(S.holes.push(S.pos.length),S.pos=Lf(S.pos,w[0].pos),a&&(S.types=Lf(S.types,w[0].types))),w[1]&&(M.holes.push(M.pos.length),M.pos=Lf(M.pos,w[1].pos),a&&(M.types=Lf(M.types,w[1].types)))}else{let w={positions:h};a&&(w.edgeTypes=d),x.length&&(w.holeIndices=x),u.push(w)}}return u}function D_(n,e,t,i,s,o,a){let u=(s-i)/t,l=[],c=[],f=[],h=[],d=[],x,E,w,S=$n(n,u-1,t,i),M=Math.sign(a&8?S[1]-o[3]:S[0]-o[2]),D=e&&e[u-1],C=0,L=0;for(let B=0;B<u;B++)x=$n(n,B,t,i,x),E=Math.sign(a&8?x[1]-o[3]:x[0]-o[2]),w=e&&e[i/t+B],E&&M&&M!==E&&(If(S,x,a,o,d),bt(l,d)&&f.push(D),bt(c,d)&&h.push(D)),E<=0?(bt(l,x)&&f.push(w),C-=E):f.length&&(f[f.length-1]=R_),E>=0?(bt(c,x)&&h.push(w),L+=E):h.length&&(h[h.length-1]=R_),Yu(S,x),M=E,D=w;return[C?{pos:l,types:e&&f}:null,L?{pos:c,types:e&&h}:null]}function F_(n,e,t,i){let s=Math.floor((n[0]-t[0])/e)*e+t[0],o=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=s,i[1]=o,i[2]=s+e,i[3]=o+e,i}function ZI(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function KI(n,e,t,i){let s=1/0,o=-1/0,a=1/0,u=-1/0;for(let l=0;l<t;l+=e){let c=n[l],f=n[l+1];s=c<s?c:s,o=c>o?c:o,a=f<a?f:a,u=f>u?f:u}return i[0][0]=s,i[0][1]=a,i[1][0]=o,i[1][1]=u,i}var $I=85.051129;function vg(n,e){let{size:t=2,startIndex:i=0,endIndex:s=n.length,normalize:o=!0}=e||{},a=n.slice(i,s);O_(a,t,0,s-i);let u=Ku(a,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(let l of u)N_(l,t);return u}function Tg(n,e=null,t){let{size:i=2,normalize:s=!0,edgeTypes:o=!1}=t||{};e=e||[];let a=[],u=[],l=0,c=0;for(let h=0;h<=e.length;h++){let d=e[h]||n.length,x=c,E=JI(n,i,l,d);for(let w=E;w<d;w++)a[c++]=n[w];for(let w=l;w<E;w++)a[c++]=n[w];O_(a,i,x,c),QI(a,i,x,c,t?.maxLatitude),l=d,u[h]=c}u.pop();let f=$u(a,u,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(s)for(let h of f)N_(h.positions,i);return f}function JI(n,e,t,i){let s=-1,o=-1;for(let a=t+1;a<i;a+=e){let u=Math.abs(n[a]);u>s&&(s=u,o=a-1)}return o}function QI(n,e,t,i,s=$I){let o=n[t],a=n[i-e];if(Math.abs(o-a)>180){let u=$n(n,0,e,t);u[0]+=Math.round((a-o)/360)*360,bt(n,u),u[1]=Math.sign(u[1])*s,bt(n,u),u[0]=o,bt(n,u)}}function O_(n,e,t,i){let s=n[0],o;for(let a=t;a<i;a+=e){o=n[a];let u=o-s;(u>180||u<-180)&&(o-=Math.round(u/360)*360),n[a]=s=o}}function N_(n,e){let t,i=n.length/e;for(let o=0;o<i&&(t=n[o*e],(t+180)%360===0);o++);let s=-Math.round(t/360)*360;if(s!==0)for(let o=0;o<i;o++)n[o*e]+=s}function B_(n,e,t,i){let s;if(Array.isArray(n[0])){let o=n.length*e;s=new Array(o);for(let a=0;a<n.length;a++)for(let u=0;u<e;u++)s[a*e+u]=n[a][u]||0}else s=n;return t?Ku(s,{size:e,gridResolution:t}):i?vg(s,{size:e}):s}var tL=1,rL=2,wg=4,Ju=class extends Kn{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?B_(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(k_(e)){let i=0;for(let s of e)i+=this.getGeometrySize(s);return i}let t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&k_(e))for(let i of e){let s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){let i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:a}=t;i.fill(0,o,o+a),s?(i[o]=wg,i[o+a-2]=wg):(i[o]+=tL,i[o+a-2]+=rL),i[o+a-1]=wg}_updatePositions(e,t){let{positions:i}=this.attributes;if(!i||!e)return;let{vertexStart:s,geometrySize:o}=t,a=new Array(3);for(let u=s,l=0;l<o;u++,l++)this.getPointOnPath(e,l,a),i[u*3]=a[0],i[u*3+1]=a[1],i[u*3+2]=a[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){let{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);let o=t*s;return i[0]=e[o],i[1]=e[o+1],i[2]=s===3&&e[o+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);let{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}};function k_(n){return Array.isArray(n[0])}var G_=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var U_=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var z_=[0,0,0,255],nL={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:z_},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Sg={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n},ls=class extends Ne{constructor(...e){super(...e),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:G_,fs:U_,modules:[ft,$t]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Sg,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Sg,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Sg,defaultValue:z_},instancePickingColors:{size:3,type:5121,accessor:(i,{index:s,target:o})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,o)}}),this.setState({pathTesselator:new Ju({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:t,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){let{pathTesselator:u}=this.state,l=t.data.attributes||{};u.updateGeometry({data:t.data,geometryBuffer:l.getPath,buffers:l,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),i.dataChanged||s.invalidateAll()}if(i.extensionsChanged){var a;let{gl:u}=this.context;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(u),s.invalidateAll()}}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i}=t,{data:s}=this.props;return s[0]&&s[0].__source&&(t.object=s.find(o=>o.__source.index===i)),t}disablePickingIndex(e){let{data:t}=this.props;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:t,capRounded:i,billboard:s,miterLimit:o,widthUnits:a,widthScale:u,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(t),capType:Number(i),billboard:s,widthUnits:it[a],widthScale:u,miterLimit:o,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){let t=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Pe(e,{...this.getShaders(),id:this.props.id,geometry:new Ze({drawMode:4,attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}};m(ls,"defaultProps",nL);m(ls,"layerName","PathLayer");var K_=we(X_());var Nf=Cf.CLOCKWISE,q_=Cf.COUNTER_CLOCKWISE,Jn={isClosed:!0};function EL(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function Lo(n){return"positions"in n?n.positions:n}function rl(n){return"holeIndices"in n?n.holeIndices:null}function _L(n){return Array.isArray(n[0])}function bL(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function AL(n){let e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function vL(n,e,t,i){for(let s=0;s<e;s++)if(n[t+s]!==n[i-e+s])return!1;return!0}function Y_(n,e,t,i,s){let o=e,a=t.length;for(let u=0;u<a;u++)for(let l=0;l<i;l++)n[o++]=t[u][l]||0;if(!AL(t))for(let u=0;u<i;u++)n[o++]=t[0][u]||0;return Jn.start=e,Jn.end=o,Jn.size=i,qu(n,s,Jn),o}function Z_(n,e,t,i,s=0,o,a){o=o||t.length;let u=o-s;if(u<=0)return e;let l=e;for(let c=0;c<u;c++)n[l++]=t[s+c];if(!vL(t,i,s,o))for(let c=0;c<i;c++)n[l++]=t[s+c];return Jn.start=e,Jn.end=l,Jn.size=i,qu(n,a,Jn),l}function $_(n,e){EL(n);let t=[],i=[];if("positions"in n){let{positions:s,holeIndices:o}=n;if(o){let a=0;for(let u=0;u<=o.length;u++)a=Z_(t,a,s,e,o[u-1],o[u],u===0?Nf:q_),i.push(a);return i.pop(),{positions:t,holeIndices:i}}n=s}if(!_L(n))return Z_(t,0,n,e,0,t.length,Nf),t;if(!bL(n)){let s=0;for(let[o,a]of n.entries())s=Y_(t,s,a,e,o===0?Nf:q_),i.push(s);return i.pop(),{positions:t,holeIndices:i}}return Y_(t,0,n,e,Nf),t}function J_(n,e,t){let i=rl(n);i&&(i=i.map(o=>o/e));let s=Lo(n);if(t){let o=s.length;s=s.slice();let a=[];for(let u=0;u<o;u+=e){a[0]=s[u],a[1]=s[u+1];let l=t(a);s[u]=l[0],s[u+1]=l[1]}}return(0,K_.default)(s,i,e)}var nl=class extends Kn{constructor(e){let{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){let{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);let t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let t=$_(e,this.positionSize);return this.opts.resolution?$u(Lo(t),rl(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Tg(Lo(t),rl(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(Q_(e)){let t=0;for(let i of e)t+=this.getGeometrySize(i);return t}return Lo(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&Q_(e))for(let i of e){let s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:s}){let{attributes:o,indexStarts:a,typedArrayManager:u}=this,l=o.indices;if(!l||!e)return;let c=s,f=J_(e,this.positionSize,this.opts.preproject);l=u.allocate(l,s+f.length,{copy:!0});for(let h=0;h<f.length;h++)l[c++]=f[h]+i;a[t+1]=s+f.length,o.indices=l}_updatePositions(e,{vertexStart:t,geometrySize:i}){let{attributes:{positions:s},positionSize:o}=this;if(!s||!e)return;let a=Lo(e);for(let u=t,l=0;l<i;u++,l++){let c=a[l*o],f=a[l*o+1],h=o>2?a[l*o+2]:0;s[u*3]=c,s[u*3+1]=f,s[u*3+2]=h}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){let{positionSize:s}=this,o=this.attributes.vertexValid,a=e&&rl(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,t):o.fill(1,t,t+i),a)for(let u=0;u<a.length;u++)o[t+a[u]/s-1]=0;o[t+i-1]=0}};function Q_(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}var Bf=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var e2=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Bf,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`);var t2=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Bf,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`);var r2=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var Gf=[0,0,0,255],wL={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Gf},getLineColor:{type:"accessor",value:Gf},material:!0},kf={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n},fs=class extends Ne{constructor(...e){super(...e),m(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?e2:t2,fs:r2,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ft,po,$t]})}get wrapLongitude(){return!1}initializeState(){let{gl:e,viewport:t}=this.context,{coordinateSystem:i}=this.props;t.isGeospatial&&i===ce.DEFAULT&&(i=ce.LNGLAT),this.setState({numInstances:0,polygonTesselator:new nl({preproject:i===ce.LNGLAT&&t.projectFlat.bind(t),fp64:this.use64bitPositions(),IndexType:!e||kn(e,me.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});let s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:kf,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:kf,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:kf,accessor:"getFillColor",defaultValue:Gf,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:kf,accessor:"getLineColor",defaultValue:Gf,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(a,{index:u,target:l})=>this.encodePickingColor(a&&a.__source?a.__source.index:u,l),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i}=t,{data:s}=this.props;return s[0]&&s[0].__source&&(t.object=s.find(o=>o.__source.index===i)),t}disablePickingIndex(e){let{data:t}=this.props;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){let{extruded:t,filled:i,wireframe:s,elevationScale:o}=this.props,{topModel:a,sideModel:u,polygonTesselator:l}=this.state,c={...e,extruded:Boolean(t),elevationScale:o};u&&(u.setInstanceCount(l.instanceCount-1),u.setUniforms(c),s&&(u.setDrawMode(3),u.setUniforms({isWireframe:!0}).draw()),i&&(u.setDrawMode(6),u.setUniforms({isWireframe:!1}).draw())),a&&(a.setVertexCount(l.vertexCount),a.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:t,oldProps:i,changeFlags:s}=e,o=this.getAttributeManager();if(s.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded){var u;(u=this.state.models)===null||u===void 0||u.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),o.invalidateAll()}}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){let{polygonTesselator:o}=this.state,a=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:a.getPolygon,buffers:a,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){let{id:t,filled:i,extruded:s}=this.props,o,a;if(i){let u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1,o=new Pe(e,{...u,id:"".concat(t,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return s&&(a=new Pe(e,{...this.getShaders("side"),id:"".concat(t,"-side"),geometry:new Ze({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),a.userData.excludeAttributes={indices:!0}),{models:[a,o].filter(Boolean),topModel:o,sideModel:a}}calculateIndices(e){let{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){let{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};m(fs,"defaultProps",wL);m(fs,"layerName","SolidPolygonLayer");function n2({data:n,getIndex:e,dataRange:t,replace:i}){let{startRow:s=0,endRow:o=1/0}=t,a=n.length,u=a,l=a;for(let d=0;d<a;d++){let x=e(n[d]);if(u>d&&x>=s&&(u=d),x>=o){l=d;break}}let c=u,h=l-u!==i.length?n.slice(l):void 0;for(let d=0;d<i.length;d++)n[c++]=i[d];if(h){for(let d=0;d<h.length;d++)n[c++]=h[d];n.length=c}return{startRow:u,endRow:u+i.length}}function i2(n,e){if(!n)return null;let t="startIndices"in n?n.startIndices[e]:e,i=n.featureIds.value[t];return t!==-1?SL(n,i,t):null}function SL(n,e,t){let i={properties:{...n.properties[e]}};for(let s in n.numericProps)i.properties[s]=n.numericProps[s].value[t];return i}function s2(n,e){let t={points:null,lines:null,polygons:null};for(let i in t){let s=n[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(s.length*3);let o=[];for(let a=0;a<s.length;a++)e(s[a],o),t[i][a*3+0]=o[0],t[i][a*3+1]=o[1],t[i][a*3+2]=o[2]}return t}var o2=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var a2=192/256,u2=[],PL={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},hs=class extends Qt{constructor(...e){super(...e),m(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:o2}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e,{outlineColor:s}=t;s!==i.outlineColor&&(s=s.map(o=>o/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!t.sdf&&t.outlineWidth&&$.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){let{sdf:t,smoothing:i,outlineWidth:s}=this.props,{outlineColor:o}=this.state;e.uniforms={...e.uniforms,buffer:a2,outlineBuffer:s?Math.max(i,a2*(1-s)):-1,gamma:i,sdf:Boolean(t),outlineColor:o},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):u2}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):u2}};m(hs,"defaultProps",PL);m(hs,"layerName","MultiIconLayer");var E2=we(f2());var IL=32,LL=[];function RL(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function h2({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:s,mapping:o={},xOffset:a=0,yOffset:u=0}){let l=0,c=a;for(let h of n)if(!o[h]){let d=e(h);c+d+i*2>s&&(c=0,l++),o[h]={x:c+i,y:u+l*(t+i*2)+i,width:d,height:t},c+=d+i*2}let f=t+i*2;return{mapping:o,xOffset:c,yOffset:u+l*f,canvasHeight:RL(u+(l+1)*f)}}function d2(n,e,t,i){let s=0;for(let a=e;a<t;a++){var o;let u=n[a];s+=((o=i[u])===null||o===void 0?void 0:o.width)||0}return s}function p2(n,e,t,i,s,o){let a=e,u=0;for(let l=e;l<t;l++){let c=d2(n,l,l+1,s);u+c>i&&(a<l&&o.push(l),a=l,u=0),u+=c}return u}function DL(n,e,t,i,s,o){let a=e,u=e,l=e,c=0;for(let f=e;f<t;f++)if((n[f]===" "||n[f+1]===" "||f+1===t)&&(l=f+1),l>u){let h=d2(n,u,l,s);c+h>i&&(a<u&&(o.push(u),a=u,c=0),h>i&&(h=p2(n,u,l,i,s,o),a=o[o.length-1])),u=l,c+=h}return c}function FL(n,e,t,i,s=0,o){o===void 0&&(o=n.length);let a=[];return e==="break-all"?p2(n,s,o,t,i,a):DL(n,s,o,t,i,a),a}function OL(n,e,t,i,s,o){let a=0,u=0;for(let l=e;l<t;l++){let c=n[l],f=i[c];f?(u||(u=f.height),s[l]=a+f.width/2,a+=f.width):($.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),s[l]=a,a+=IL)}o[0]=a,o[1]=u}function Rg(n,e,t,i,s){let o=Array.from(n),a=o.length,u=new Array(a),l=new Array(a),c=new Array(a),f=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,h=[0,0],d=[0,0],x=0,E=0,w=0;for(let S=0;S<=a;S++){let M=o[S];if((M===`
`||S===a)&&(w=S),w>E){let D=f?FL(o,t,i,s,E,w):LL;for(let C=0;C<=D.length;C++){let L=C===0?E:D[C-1],B=C<D.length?D[C]:w;OL(o,L,B,s,u,d);for(let j=L;j<B;j++)l[j]=x+d[1]/2,c[j]=d[0];x=x+d[1]*e,h[0]=Math.max(h[0],d[0])}E=w}M===`
`&&(u[E]=0,l[E]=0,c[E]=0,E++)}return h[1]=x,{x:u,y:l,rowWidth:c,size:h}}function g2({value:n,length:e,stride:t,offset:i,startIndices:s,characterSet:o}){let a=n.BYTES_PER_ELEMENT,u=t?t/a:1,l=i?i/a:0,c=s[e]||Math.ceil((n.length-l)/u),f=o&&new Set,h=new Array(e),d=n;if(u>1||l>0){let x=n.constructor;d=new x(c);for(let E=0;E<c;E++)d[E]=n[E*u+l]}for(let x=0;x<e;x++){let E=s[x],w=s[x+1]||c,S=d.subarray(E,w);h[x]=String.fromCodePoint.apply(null,S),f&&S.forEach(f.add,f)}if(f)for(let x of f)o.add(String.fromCodePoint(x));return{texts:h,characterCount:c}}var Do=class{constructor(e=5){m(this,"limit",void 0),m(this,"_cache",{}),m(this,"_order",[]),this.limit=e}get(e){let t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}};function NL(){let n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}var Fo={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:NL(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},m2=1024,BL=.9,x2=1.2,_2=3,Uf=new Do(_2);function kL(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);let i=Uf.get(n);if(!i)return t;for(let s in i.mapping)t.has(s)&&t.delete(s);return t}function GL(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function y2(n,e,t,i){n.font="".concat(i," ").concat(t,"px ").concat(e),n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function b2(n){$.assert(Number.isFinite(n)&&n>=_2,"Invalid cache limit"),Uf=new Do(n)}var sl=class{constructor(){m(this,"props",{...Fo}),m(this,"_key",void 0),m(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return x2}setProps(e={}){Object.assign(this.props,e);let t=this._key;this._key=this._getKey();let i=kL(this._key,this.props.characterSet),s=Uf.get(this._key);if(s&&i.size===0){this._key!==t&&(this._atlas=s);return}let o=this._generateFontAtlas(this._key,i,s);this._atlas=o,Uf.set(this._key,o)}_generateFontAtlas(e,t,i){let{fontFamily:s,fontWeight:o,fontSize:a,buffer:u,sdf:l,radius:c,cutoff:f}=this.props,h=i&&i.data;h||(h=document.createElement("canvas"),h.width=m2);let d=h.getContext("2d");y2(d,s,a,o);let{mapping:x,canvasHeight:E,xOffset:w,yOffset:S}=h2({getFontWidth:M=>d.measureText(M).width,fontHeight:a*x2,buffer:u,characterSet:t,maxCanvasWidth:m2,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(h.height!==E){let M=d.getImageData(0,0,h.width,h.height);h.height=E,d.putImageData(M,0,0)}if(y2(d,s,a,o),l){let M=new E2.default(a,u,c,f,s,o),D=d.getImageData(0,0,M.size,M.size);for(let C of t)GL(M.draw(C),D),d.putImageData(D,x[C].x-u,x[C].y+u)}else for(let M of t)d.fillText(M,x[M].x,x[M].y+a*BL);return{xOffset:w,yOffset:S,mapping:x,data:h,width:h.width,height:h.height}}_getKey(){let{fontFamily:e,fontWeight:t,fontSize:i,buffer:s,sdf:o,radius:a,cutoff:u}=this.props;return o?"".concat(e," ").concat(t," ").concat(i," ").concat(s," ").concat(a," ").concat(u):"".concat(e," ").concat(t," ").concat(i," ").concat(s)}};var A2=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var v2=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var UL={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},ds=class extends Ne{constructor(...e){super(...e),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:A2,fs:v2,modules:[ft,$t]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:t}=e;if(t.extensionsChanged){var i;let{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){let{billboard:t,sizeScale:i,sizeUnits:s,sizeMinPixels:o,sizeMaxPixels:a,getLineWidth:u}=this.props,{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:Boolean(u),padding:l,sizeUnits:it[s],sizeScale:i,sizeMinPixels:o,sizeMaxPixels:a}).draw()}_getModel(e){let t=[0,0,1,0,1,1,0,1];return new Pe(e,{...this.getShaders(),id:this.props.id,geometry:new Ze({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}};m(ds,"defaultProps",UL);m(ds,"layerName","TextBackgroundLayer");var T2={start:1,middle:0,end:-1},w2={top:1,center:0,bottom:-1},Dg=[0,0,0,255],zL=1,VL={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Dg},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Fo.characterSet},fontFamily:Fo.fontFamily,fontWeight:Fo.fontWeight,lineHeight:zL,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Dg},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:Dg},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},At=class extends Gt{constructor(...e){super(...e),m(this,"state",void 0),m(this,"getBoundingRect",(t,i)=>{let s=this.state.fontAtlasManager.mapping,o=this.state.getText,{wordBreak:a,maxWidth:u,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:f}=this.props,h=o(t,i)||"",{size:[d,x]}=Rg(h,l,a,u,s),E=T2[typeof c=="function"?c(t,i):c],w=w2[typeof f=="function"?f(t,i):f];return[(E-1)*d/2,(w-1)*x/2,d,x]}),m(this,"getIconOffsets",(t,i)=>{let s=this.state.fontAtlasManager.mapping,o=this.state.getText,{wordBreak:a,maxWidth:u,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:f}=this.props,h=o(t,i)||"",{x:d,y:x,rowWidth:E,size:[w,S]}=Rg(h,l,a,u,s),M=T2[typeof c=="function"?c(t,i):c],D=w2[typeof f=="function"?f(t,i):f],C=d.length,L=new Array(C*2),B=0;for(let j=0;j<C;j++){let J=(1-M)*(w-E[j])/2;L[B++]=(M-1)*w/2+J+d[j],L[B++]=(D-1)*S/2+x[j]}return L})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new sl}}updateState(e){let{props:t,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:o}=this.state,a={...e,characterSet:o,fontFamily:t,fontWeight:i};if(!s.mapping)return s.setProps(a),!0;for(let u in a)if(a[u]!==s.props[u])return s.setProps(a),!0;return!1}_updateText(){var e;let{data:t,characterSet:i}=this.props,s=(e=t.attributes)===null||e===void 0?void 0:e.getText,{getText:o}=this.props,a=t.startIndices,u,l=i==="auto"&&new Set;if(s&&a){let{texts:c,characterCount:f}=g2({...ArrayBuffer.isView(s)?{value:s}:s,length:t.length,startIndices:a,characterSet:l});u=f,o=(h,{index:d})=>c[d]}else{let{iterable:c,objectInfo:f}=Ar(t);a=[0],u=0;for(let h of c){f.index++;let d=Array.from(o(h,f)||"");l&&d.forEach(l.add,l),u+=d.length,a.push(u)}}this.setState({getText:o,startIndices:a,numInstances:u,characterSet:l||i})}renderLayers(){let{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:s,texture:o,mapping:a},styleVersion:u}=this.state,{data:l,_dataDiff:c,getPosition:f,getColor:h,getSize:d,getAngle:x,getPixelOffset:E,getBackgroundColor:w,getBorderColor:S,getBorderWidth:M,backgroundPadding:D,background:C,billboard:L,fontSettings:B,outlineWidth:j,outlineColor:J,sizeScale:te,sizeUnits:Z,sizeMinPixels:q,sizeMaxPixels:H,transitions:ie,updateTriggers:ee}=this.props,fe=this.getSubLayerClass("characters",hs),mt=this.getSubLayerClass("background",ds);return[C&&new mt({getFillColor:w,getLineColor:S,getLineWidth:M,padding:D,getPosition:f,getSize:d,getAngle:x,getPixelOffset:E,billboard:L,sizeScale:te/this.state.fontAtlasManager.props.fontSize,sizeUnits:Z,sizeMinPixels:q,sizeMaxPixels:H,transitions:ie&&{getPosition:ie.getPosition,getAngle:ie.getAngle,getSize:ie.getSize,getFillColor:ie.getBackgroundColor,getLineColor:ie.getBorderColor,getLineWidth:ie.getBorderWidth,getPixelOffset:ie.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ee.getPosition,getAngle:ee.getAngle,getSize:ee.getSize,getFillColor:ee.getBackgroundColor,getLineColor:ee.getBorderColor,getLineWidth:ee.getBorderWidth,getPixelOffset:ee.getPixelOffset,getBoundingRect:{getText:ee.getText,getTextAnchor:ee.getTextAnchor,getAlignmentBaseline:ee.getAlignmentBaseline,styleVersion:u}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new fe({sdf:B.sdf,smoothing:Number.isFinite(B.smoothing)?B.smoothing:Fo.smoothing,outlineWidth:j,outlineColor:J,iconAtlas:o,iconMapping:a,getPosition:f,getColor:h,getSize:d,getAngle:x,getPixelOffset:E,billboard:L,sizeScale:te*s,sizeUnits:Z,sizeMinPixels:q*s,sizeMaxPixels:H*s,transitions:ie&&{getPosition:ie.getPosition,getAngle:ie.getAngle,getColor:ie.getColor,getSize:ie.getSize,getPixelOffset:ie.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:ee.getText,getPosition:ee.getPosition,getAngle:ee.getAngle,getColor:ee.getColor,getSize:ee.getSize,getPixelOffset:ee.getPixelOffset,getIconOffsets:{getText:ee.getText,getTextAnchor:ee.getTextAnchor,getAlignmentBaseline:ee.getAlignmentBaseline,styleVersion:u}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){b2(e)}};m(At,"defaultProps",VL);m(At,"layerName","TextLayer");var ol={circle:{type:us,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Qt,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:At,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},al={type:ls,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},zf={type:fs,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Oo({type:n,props:e}){let t={};for(let i in e)t[i]=n.defaultProps[e[i]];return t}function Vf(n,e){let{transitions:t,updateTriggers:i}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(let o in e){let a=e[o],u=n.props[o];o.startsWith("get")&&(u=n.getSubLayerAccessor(u),s.updateTriggers[a]=i[o],t&&(s.transitions[a]=t[o])),s[a]=u}return s}function P2(n){if(Array.isArray(n))return n;switch($.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return $.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function Fg(n,e,t={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:o=n.length}=t;for(let a=s;a<o;a++){let u=n[a],{geometry:l}=u;if(!!l)if(l.type==="GeometryCollection"){$.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");let{geometries:c}=l;for(let f=0;f<c.length;f++){let h=c[f];S2(h,i,e,u,a)}}else S2(l,i,e,u,a)}return i}function S2(n,e,t,i,s){let{type:o,coordinates:a}=n,{pointFeatures:u,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:f}=e;if(!WL(o,a)){$.warn("".concat(o," coordinates are malformed"))();return}switch(o){case"Point":u.push(t({geometry:n},i,s));break;case"MultiPoint":a.forEach(h=>{u.push(t({geometry:{type:"Point",coordinates:h}},i,s))});break;case"LineString":l.push(t({geometry:n},i,s));break;case"MultiLineString":a.forEach(h=>{l.push(t({geometry:{type:"LineString",coordinates:h}},i,s))});break;case"Polygon":c.push(t({geometry:n},i,s)),a.forEach(h=>{f.push(t({geometry:{type:"LineString",coordinates:h}},i,s))});break;case"MultiPolygon":a.forEach(h=>{c.push(t({geometry:{type:"Polygon",coordinates:h}},i,s)),h.forEach(d=>{f.push(t({geometry:{type:"LineString",coordinates:d}},i,s))})});break;default:}}var jL={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function WL(n,e){let t=jL[n];for($.assert(t,"Unknown GeoJSON type ".concat(n));e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function C2(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function jf(n){return n.geometry.coordinates}function M2(n,e){let t=C2(),{pointFeatures:i,lineFeatures:s,polygonFeatures:o,polygonOutlineFeatures:a}=n;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=jf,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=jf,t.polygons.data=o,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=jf,t.polygonsOutline.data=a,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=jf,t}function I2(n,e){let t=C2(),{points:i,lines:s,polygons:o}=n,a=s2(n,e);return t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:a.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:a.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open",t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:3,value:a.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:a.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}var HL=["points","linestrings","polygons"],XL={...Oo(ol.circle),...Oo(ol.icon),...Oo(ol.text),...Oo(al),...Oo(zf),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},Qn=class extends Gt{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;let{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){let i=I2(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){let i=P2(e.data),s=this.getSubLayerRow.bind(this),o={},a={};if(Array.isArray(t.dataChanged)){let l=this.state.features;for(let c in l)o[c]=l[c].slice(),a[c]=[];for(let c of t.dataChanged){let f=Fg(i,s,c);for(let h in l)a[h].push(n2({data:o[h],getIndex:d=>d.__source.index,dataRange:c,replace:f[h]}))}}else o=Fg(i,s);let u=M2(o,a);this.setState({features:o,featuresDiff:a,layerProps:u})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i,sourceLayer:s}=t;return t.featureType=HL.find(o=>s.id.startsWith("".concat(this.id,"-").concat(o,"-"))),i>=0&&s.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){let t="".concat(this.id,"-points-"),i=e.featureType==="points";for(let s of this.getSubLayers())s.id.startsWith(t)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,s="polygons-fill",o=this.shouldRenderSubLayer(s,i.polygons.data)&&this.getSubLayerClass(s,zf.type);if(o){let a=Vf(this,zf.props),u=e&&t;return u||delete a.getLineColor,a.updateTriggers.lineColors=u,new o(a,this.getSubLayerProps({id:s,updateTriggers:a.updateTriggers}),i.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,s="polygons-stroke",o="linestrings",a=!e&&t&&this.shouldRenderSubLayer(s,i.polygonsOutline.data)&&this.getSubLayerClass(s,al.type),u=this.shouldRenderSubLayer(o,i.lines.data)&&this.getSubLayerClass(o,al.type);if(a||u){let l=Vf(this,al.props);return[a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.polygonsOutline),u&&new u(l,this.getSubLayerProps({id:o,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:t,binary:i}=this.state,{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=t.points.data.findIndex(u=>u.__source.index===s));let o=new Set(e.split("+")),a=[];for(let u of o){let l="points-".concat(u),c=ol[u],f=c&&this.shouldRenderSubLayer(l,t.points.data)&&this.getSubLayerClass(l,c.type);if(f){let h=Vf(this,c.props),d=t.points;if(u==="text"&&i){let{instancePickingColors:x,...E}=d.data.attributes;d={...d,data:{...d.data,attributes:E}}}a.push(new f(h,this.getSubLayerProps({id:l,updateTriggers:h.updateTriggers,highlightedObjectIndex:s}),d))}}return a}renderLayers(){let{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,i,s,e&&t]}getSubLayerAccessor(e){let{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{let{data:o,index:a}=s,u=i2(o,a);return e(u,s)}}};m(Qn,"layerName","GeoJsonLayer");m(Qn,"defaultProps",XL);var ul=class{constructor(e){m(this,"index",void 0),m(this,"isVisible",void 0),m(this,"isSelected",void 0),m(this,"parent",void 0),m(this,"children",void 0),m(this,"content",void 0),m(this,"state",void 0),m(this,"layers",void 0),m(this,"id",void 0),m(this,"bbox",void 0),m(this,"zoom",void 0),m(this,"userData",void 0),m(this,"_abortController",void 0),m(this,"_loader",void 0),m(this,"_loaderId",void 0),m(this,"_isLoaded",void 0),m(this,"_isCancelled",void 0),m(this,"_needsReload",void 0),this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||$.error("byteLength not defined in tile data")(),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:s}){let{index:o,id:a,bbox:u,userData:l,zoom:c}=this,f=this._loaderId;this._abortController=new AbortController;let{signal:h}=this._abortController,d=await t.scheduleRequest(this,w=>w.isSelected?1:-1);if(!d){this._isCancelled=!0;return}if(this._isCancelled){d.done();return}let x=null,E;try{x=await e({index:o,id:a,bbox:u,userData:l,zoom:c,signal:h})}catch(w){E=w||!0}finally{d.done()}if(f===this._loaderId){if(this._loader=void 0,this.content=x,this._isCancelled&&!x){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,E?s(E,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}};var ze={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var L2=new V,qL=new V,yn=class{constructor(e=[0,0,0],t=[0,0,0],i){m(this,"center",void 0),m(this,"halfDiagonal",void 0),m(this,"minimum",void 0),m(this,"maximum",void 0),i=i||L2.copy(e).add(t).scale(.5),this.center=new V(i),this.halfDiagonal=new V(t).subtract(this.center),this.minimum=new V(e),this.maximum=new V(t)}clone(){return new yn(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:t}=this,i=qL.from(e.normal),s=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-s>0?ze.INSIDE:o+s<0?ze.OUTSIDE:ze.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t=L2.from(e).subtract(this.center),{halfDiagonal:i}=this,s=0,o;return o=Math.abs(t.x)-i.x,o>0&&(s+=o*o),o=Math.abs(t.y)-i.y,o>0&&(s+=o*o),o=Math.abs(t.z)-i.z,o>0&&(s+=o*o),s}};var ll=new V,R2=new V,En=class{constructor(e=[0,0,0],t=0){m(this,"center",void 0),m(this,"radius",void 0),this.radius=-0,this.center=new V,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=ll.from(t),this.center=new V().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new En(this.center,this.radius)}union(e){let t=this.center,i=this.radius,s=e.center,o=e.radius,a=ll.copy(s).subtract(t),u=a.magnitude();if(i>=u+o)return this.clone();if(o>=u+i)return e.clone();let l=(i+u+o)*.5;return R2.copy(a).scale((-i+l)/u).add(t),this.center.copy(R2),this.radius=l,this}expand(e){let i=ll.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);let t=dy(ll,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){let t=this.distanceTo(e);return t*t}distanceTo(e){let i=ll.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){let t=this.center,i=this.radius,o=e.normal.dot(t)+e.distance;return o<-i?ze.OUTSIDE:o<i?ze.INTERSECTING:ze.INSIDE}};var YL=new V,ZL=new V,Wf=new V,Hf=new V,Xf=new V,KL=new V,$L=new V,_n={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},ei=class{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){m(this,"center",void 0),m(this,"halfAxes",void 0),this.center=new V().from(e),this.halfAxes=new Se(t)}get halfSize(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new V(e).len(),new V(t).len(),new V(i).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new V(e).normalize(),o=new V(t).normalize(),a=new V(i).normalize();return new Yi().fromMatrix3(new Se([...s,...o,...a]))}fromCenterHalfSizeQuaternion(e,t,i){let s=new Yi(i),o=new Se().fromQuaternion(s);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new V().from(e),this.halfAxes=o,this}clone(){return new ei(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new En){let t=this.halfAxes,i=t.getColumn(0,Wf),s=t.getColumn(1,Hf),o=t.getColumn(2,Xf),a=YL.copy(i).add(s).add(o);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){let t=this.center,i=e.normal,s=this.halfAxes,o=i.x,a=i.y,u=i.z,l=Math.abs(o*s[_n.COLUMN0ROW0]+a*s[_n.COLUMN0ROW1]+u*s[_n.COLUMN0ROW2])+Math.abs(o*s[_n.COLUMN1ROW0]+a*s[_n.COLUMN1ROW1]+u*s[_n.COLUMN1ROW2])+Math.abs(o*s[_n.COLUMN2ROW0]+a*s[_n.COLUMN2ROW1]+u*s[_n.COLUMN2ROW2]),c=i.dot(t)+e.distance;return c<=-l?ze.OUTSIDE:c>=l?ze.INSIDE:ze.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t=ZL.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,Wf),o=i.getColumn(1,Hf),a=i.getColumn(2,Xf),u=s.magnitude(),l=o.magnitude(),c=a.magnitude();s.normalize(),o.normalize(),a.normalize();let f=0,h;return h=Math.abs(t.dot(s))-u,h>0&&(f+=h*h),h=Math.abs(t.dot(o))-l,h>0&&(f+=h*h),h=Math.abs(t.dot(a))-c,h>0&&(f+=h*h),f}computePlaneDistances(e,t,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=this.center,u=this.halfAxes,l=u.getColumn(0,Wf),c=u.getColumn(1,Hf),f=u.getColumn(2,Xf),h=KL.copy(l).add(c).add(f).add(a),d=$L.copy(h).subtract(e),x=t.dot(d);return s=Math.min(x,s),o=Math.max(x,o),h.copy(a).add(l).add(c).subtract(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),h.copy(a).add(l).subtract(c).add(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),h.copy(a).add(l).subtract(c).subtract(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),a.copy(h).subtract(l).add(c).add(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),a.copy(h).subtract(l).add(c).subtract(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),a.copy(h).subtract(l).subtract(c).add(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),a.copy(h).subtract(l).subtract(c).subtract(f),d.copy(h).subtract(e),x=t.dot(d),s=Math.min(x,s),o=Math.max(x,o),i[0]=s,i[1]=o,i}transform(e){this.center.transformAsPoint(e);let t=this.halfAxes.getColumn(0,Wf);t.transformAsPoint(e);let i=this.halfAxes.getColumn(1,Hf);i.transformAsPoint(e);let s=this.halfAxes.getColumn(2,Xf);return s.transformAsPoint(e),this.halfAxes=new Se([...t,...i,...s]),this}getTransform(){throw new Error("not implemented")}};var D2=new V,F2=new V,Ut=class{constructor(e=[0,0,1],t=0){m(this,"normal",void 0),m(this,"distance",void 0),this.normal=new V,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return lr(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=D2.from(e),this.normal.from(t).normalize();let i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,s){return this.normal.set(e,t,i),lr(rt(this.normal.len(),1)),this.distance=s,this}clone(){return new Ut(this.normal,this.distance)}equals(e){return rt(this.distance,e.distance)&&rt(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let t=F2.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){e=D2.from(e);let i=this.getPointDistance(e),s=F2.copy(this.normal).scale(i);return e.subtract(s).to(t)}};var O2=[new V([1,0,0]),new V([0,1,0]),new V([0,0,1])],N2=new V,JL=new V,yee=new Ut(new V(1,0,0),0),gt=class{constructor(e=[]){m(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*O2.length;let t=e.center,i=e.radius,s=0;for(let o of O2){let a=this.planes[s],u=this.planes[s+1];a||(a=this.planes[s]=new Ut),u||(u=this.planes[s+1]=new Ut);let l=N2.copy(o).scale(-i).add(t),c=-o.dot(l);a.fromPointNormal(l,o);let f=N2.copy(o).scale(i).add(t),h=JL.copy(o).negate(),d=-h.dot(f);u.fromPointNormal(f,h),s+=2}return this}computeVisibility(e){let t=ze.INSIDE;for(let i of this.planes)switch(e.intersectPlane(i)){case ze.OUTSIDE:return ze.OUTSIDE;case ze.INTERSECTING:t=ze.INTERSECTING;break;default:}return t}computeVisibilityWithPlaneMask(e,t){if(lr(Number.isFinite(t),"parentPlaneMask is required."),t===gt.MASK_OUTSIDE||t===gt.MASK_INSIDE)return t;let i=gt.MASK_INSIDE,s=this.planes;for(let o=0;o<this.planes.length;++o){let a=o<31?1<<o:0;if(o<31&&(t&a)===0)continue;let u=s[o],l=e.intersectPlane(u);if(l===ze.OUTSIDE)return gt.MASK_OUTSIDE;l===ze.INTERSECTING&&(i|=a)}return i}};m(gt,"MASK_OUTSIDE",4294967295);m(gt,"MASK_INSIDE",0);m(gt,"MASK_INDETERMINATE",2147483647);var Tee=new V,wee=new V,See=new V,Pee=new V,Cee=new V;var Oee=new V,Nee=new V,Bee=new V,kee=new V,Gee=new V,Uee=new V,zee=new V,Vee=new V,jee=new V,Wee=new V,Hee=new V,Xee=new V,qee=4/3*Math.PI;var Ur=new Se,eR=new Se,tR=new Se,qf=new Se,B2=new Se;function Yf(n,e={}){let t=of.EPSILON20,i=10,s=0,o=0,a=eR,u=tR;a.identity(),u.copy(n);let l=t*rR(u);for(;o<i&&nR(u)>l;)iR(u,qf),B2.copy(qf).transpose(),u.multiplyRight(qf),u.multiplyLeft(B2),a.multiplyRight(qf),++s>2&&(++o,s=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=u.toTarget(e.diagonal),e}function rR(n){let e=0;for(let t=0;t<9;++t){let i=n[t];e+=i*i}return Math.sqrt(e)}var Og=[1,0,0],Ng=[2,2,1];function nR(n){let e=0;for(let t=0;t<3;++t){let i=n[Ur.getElementIndex(Ng[t],Og[t])];e+=2*i*i}return Math.sqrt(e)}function iR(n,e){let t=of.EPSILON15,i=0,s=1;for(let c=0;c<3;++c){let f=Math.abs(n[Ur.getElementIndex(Ng[c],Og[c])]);f>i&&(s=c,i=f)}let o=Og[s],a=Ng[s],u=1,l=0;if(Math.abs(n[Ur.getElementIndex(a,o)])>t){let c=n[Ur.getElementIndex(a,a)],f=n[Ur.getElementIndex(o,o)],h=n[Ur.getElementIndex(a,o)],d=(c-f)/2/h,x;d<0?x=-1/(-d+Math.sqrt(1+d*d)):x=1/(d+Math.sqrt(1+d*d)),u=1/Math.sqrt(1+x*x),l=x*u}return Se.IDENTITY.to(e),e[Ur.getElementIndex(o,o)]=e[Ur.getElementIndex(a,a)]=u,e[Ur.getElementIndex(a,o)]=l,e[Ur.getElementIndex(o,a)]=-l,e}var ti=new V,sR=new V,oR=new V,aR=new V,uR=new V,lR=new Se,cR={diagonal:new Se,unitary:new Se};function Bg(n,e=new ei){if(!n||n.length===0)return e.halfAxes=new Se([0,0,0,0,0,0,0,0,0]),e.center=new V,e;let t=n.length,i=new V(0,0,0);for(let Z of n)i.add(Z);let s=1/t;i.multiplyByScalar(s);let o=0,a=0,u=0,l=0,c=0,f=0;for(let Z of n){let q=ti.copy(Z).subtract(i);o+=q.x*q.x,a+=q.x*q.y,u+=q.x*q.z,l+=q.y*q.y,c+=q.y*q.z,f+=q.z*q.z}o*=s,a*=s,u*=s,l*=s,c*=s,f*=s;let h=lR;h[0]=o,h[1]=a,h[2]=u,h[3]=a,h[4]=l,h[5]=c,h[6]=u,h[7]=c,h[8]=f;let{unitary:d}=Yf(h,cR),x=e.halfAxes.copy(d),E=x.getColumn(0,oR),w=x.getColumn(1,aR),S=x.getColumn(2,uR),M=-Number.MAX_VALUE,D=-Number.MAX_VALUE,C=-Number.MAX_VALUE,L=Number.MAX_VALUE,B=Number.MAX_VALUE,j=Number.MAX_VALUE;for(let Z of n)ti.copy(Z),M=Math.max(ti.dot(E),M),D=Math.max(ti.dot(w),D),C=Math.max(ti.dot(S),C),L=Math.min(ti.dot(E),L),B=Math.min(ti.dot(w),B),j=Math.min(ti.dot(S),j);E=E.multiplyByScalar(.5*(L+M)),w=w.multiplyByScalar(.5*(B+D)),S=S.multiplyByScalar(.5*(j+C)),e.center.copy(E).add(w).add(S);let J=sR.set(M-L,D-B,C-j).multiplyByScalar(.5),te=new Se([J[0],0,0,0,J[1],0,0,0,J[2]]);return e.halfAxes.multiplyRight(te),e}var No=512,k2=3,G2=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],U2=G2.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),fR=U2.concat([[.25,.5],[.75,.5]]),ri=class{constructor(e,t,i){m(this,"x",void 0),m(this,"y",void 0),m(this,"z",void 0),m(this,"childVisible",void 0),m(this,"selected",void 0),m(this,"_children",void 0),this.x=e,this.y=t,this.z=i}get children(){if(!this._children){let e=this.x*2,t=this.y*2,i=this.z+1;this._children=[new ri(e,t,i),new ri(e,t+1,i),new ri(e+1,t,i),new ri(e+1,t+1,i)]}return this._children}update(e){let{viewport:t,cullingVolume:i,elevationBounds:s,minZ:o,maxZ:a,bounds:u,offset:l,project:c}=e,f=this.getBoundingVolume(s,l,c);if(u&&!this.insideBounds(u)||i.computeVisibility(f)<0)return!1;if(!this.childVisible){let{z:d}=this;if(d<a&&d>=o){let x=f.distanceTo(t.cameraPosition)*t.scale/t.height;d+=Math.floor(Math.log2(x))}if(d>=a)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let d of this.children)d.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,s]){let o=Math.pow(2,this.z),a=No/o;return this.x*a<i&&this.y*a<s&&(this.x+1)*a>e&&(this.y+1)*a>t}getBoundingVolume(e,t,i){if(i){let l=this.z<1?fR:this.z<2?U2:G2,c=[];for(let f of l){let h=Zf(this.x+f[0],this.y+f[1],this.z);h[2]=e[0],c.push(i(h)),e[0]!==e[1]&&(h[2]=e[1],c.push(i(h)))}return Bg(c)}let s=Math.pow(2,this.z),o=No/s,a=this.x*o+t*No,u=No-(this.y+1)*o;return new yn([a,u,e[0]],[a+o,u+o,e[1]])}};function z2(n,e,t,i){let s=n instanceof Mo&&n.resolution?n.projectPosition:null,o=Object.values(n.getFrustumPlanes()).map(({normal:x,distance:E})=>new Ut(x.clone().negate(),E)),a=new gt(o),u=n.distanceScales.unitsPerMeter[2],l=t&&t[0]*u||0,c=t&&t[1]*u||0,f=n instanceof Je&&n.pitch<=60?e:0;if(i){let[x,E,w,S]=i,M=Kt([x,S]),D=Kt([w,E]);i=[M[0],No-M[1],D[0],No-D[1]]}let h=new ri(0,0,0),d={viewport:n,project:s,cullingVolume:a,elevationBounds:[l,c],minZ:f,maxZ:e,bounds:i,offset:0};if(h.update(d),n instanceof Je&&n.subViewports&&n.subViewports.length>1){for(d.offset=-1;h.update(d)&&!(--d.offset<-k2););for(d.offset=1;h.update(d)&&!(++d.offset>k2););}return h.getSelected()}var bn=512,hR=[-1/0,-1/0,1/0,1/0],j2={type:"url",value:null,validate:(n,e)=>e.optional&&n===null||typeof n=="string"||Array.isArray(n)&&n.every(t=>typeof t=="string"),equals:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;let t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}};function W2(n,e){let t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(s=>s[0])),Math.min(...t.map(s=>s[1])),Math.max(...t.map(s=>s[0])),Math.max(...t.map(s=>s[1]))]}function dR(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function H2(n,e){if(!n||!n.length)return null;let{index:t,id:i}=e;if(Array.isArray(n)){let o=dR(i)%n.length;n=n[o]}let s=n;for(let o of Object.keys(t)){let a=new RegExp("{".concat(o,"}"),"g");s=s.replace(a,String(t[o]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),s}function pR(n,e,t){let i;if(e&&e.length===2){let[s,o]=e,a=n.getBounds({z:s}),u=n.getBounds({z:o});i=[Math.min(a[0],u[0]),Math.min(a[1],u[1]),Math.max(a[2],u[2]),Math.max(a[3],u[3])]}else i=n.getBounds();return n.isGeospatial?[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]:[Math.max(Math.min(i[0],t[2]),t[0]),Math.max(Math.min(i[1],t[3]),t[1]),Math.min(Math.max(i[2],t[0]),t[2]),Math.min(Math.max(i[3],t[1]),t[3])]}function cl({viewport:n,z:e,cullRect:t}){let i=t.x-n.x,s=t.y-n.y,{width:o,height:a}=t;if(!Array.isArray(e)){let c={targetZ:e||0},f=n.unproject([i,s],c),h=n.unproject([i+o,s],c),d=n.unproject([i,s+a],c),x=n.unproject([i+o,s+a],c);return[Math.min(f[0],h[0],d[0],x[0]),Math.min(f[1],h[1],d[1],x[1]),Math.max(f[0],h[0],d[0],x[0]),Math.max(f[1],h[1],d[1],x[1])]}let u=cl({viewport:n,z:e[0],cullRect:t}),l=cl({viewport:n,z:e[1],cullRect:t});return[Math.min(u[0],l[0]),Math.min(u[1],l[1]),Math.max(u[2],l[2]),Math.max(u[3],l[3])]}function gR(n,e,t){return t?W2(n,t).map(s=>s*e/bn):n.map(i=>i*e/bn)}function kg(n,e){return Math.pow(2,n)*bn/e}function Zf(n,e,t){let i=kg(t,bn),s=n/i*360-180,o=Math.PI-2*Math.PI*e/i,a=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[s,a]}function V2(n,e,t,i){let s=kg(t,i);return[n/s*bn,e/s*bn]}function X2(n,e,t,i,s=bn){if(n.isGeospatial){let[c,f]=Zf(e,t,i),[h,d]=Zf(e+1,t+1,i);return{west:c,north:f,east:h,south:d}}let[o,a]=V2(e,t,i,s),[u,l]=V2(e+1,t+1,i,s);return{left:o,top:a,right:u,bottom:l}}function mR(n,e,t,i,s){let o=pR(n,null,i),a=kg(e,t),[u,l,c,f]=gR(o,a,s),h=[];for(let d=Math.floor(u);d<c;d++)for(let x=Math.floor(l);x<f;x++)h.push({x:d,y:x,z:e});return h}function q2({viewport:n,maxZoom:e,minZoom:t,zRange:i,extent:s,tileSize:o=bn,modelMatrix:a,modelMatrixInverse:u,zoomOffset:l=0}){let c=n.isGeospatial?Math.round(n.zoom+Math.log2(bn/o))+l:Math.ceil(n.zoom)+l;if(typeof t=="number"&&Number.isFinite(t)&&c<t){if(!s)return[];c=t}typeof e=="number"&&Number.isFinite(e)&&c>e&&(c=e);let f=s;return a&&u&&s&&!n.isGeospatial&&(f=W2(s,a)),n.isGeospatial?z2(n,c,i,s):mR(n,c,o,f||hR,u)}var Y2=1,Kf=2,xR="never",yR="no-overlap",$f="best-available",ER=5,_R={[$f]:bR,[yR]:AR,[xR]:()=>{}},fl=class{constructor(e){m(this,"opts",void 0),m(this,"_requestScheduler",void 0),m(this,"_cache",void 0),m(this,"_dirty",void 0),m(this,"_tiles",void 0),m(this,"_cacheByteSize",void 0),m(this,"_viewport",void 0),m(this,"_zRange",void 0),m(this,"_selectedTiles",void 0),m(this,"_frameNumber",void 0),m(this,"_modelMatrix",void 0),m(this,"_modelMatrixInverse",void 0),m(this,"_maxZoom",void 0),m(this,"_minZoom",void 0),m(this,"onTileLoad",void 0),m(this,"_getCullBounds",pr(cl)),this.opts=e,this.onTileLoad=t=>{this.opts.onTileLoad(t),this.opts.maxCacheByteSize&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Ws({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new ge,this._modelMatrixInverse=new ge,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:i}={}){let s=new ge(i),o=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!rt(this._zRange,t)||o){o&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=t;let u=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=u.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(u=>this._getTile(u.index,!0)));let a=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),a&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){let[i,s,o,a]=cl({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:u}=e;if("west"in u)return u.west<o&&u.east>i&&u.south<a&&u.north>s;let l=Math.min(u.top,u.bottom),c=Math.max(u.top,u.bottom);return u.left<o&&u.right>i&&l<a&&c>s}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:s,modelMatrix:o,modelMatrixInverse:a}){let{tileSize:u,extent:l,zoomOffset:c}=this.opts;return q2({viewport:e,maxZoom:t,minZoom:i,zRange:s,tileSize:u,extent:l,modelMatrix:o,modelMatrixInverse:a,zoomOffset:c})}getTileId(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:t}=this.opts;return{bbox:X2(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){let t=Math.floor(e.x/2),i=Math.floor(e.y/2),s=e.z-1;return{x:t,y:i,z:s}}updateTileStates(){let e=this.opts.refinementStrategy||$f,t=new Array(this._cache.size),i=0;for(let s of this._cache.values())t[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(let s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:_R[e])(Array.from(this._cache.values())),i=0;for(let s of this._cache.values())if(t[i++]!==s.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e}=this.opts,t=[],i=0;for(let s of this._cache.values())s.isLoading&&(i++,!s.isSelected&&!s.isVisible&&t.push(s));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){let{_cache:e}=this;for(let t of e.values())t.parent=null,t.children&&(t.children.length=0);for(let t of e.values()){let i=this._getNearestAncestor(t);t.parent=i,i!=null&&i.children&&i.children.push(t)}}_resizeCache(){let{_cache:e,opts:t}=this,i=t.maxCacheSize||(t.maxCacheByteSize?1/0:ER*this.selectedTiles.length),s=t.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>s){for(let[a,u]of e)if(!u.isVisible&&!u.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize?u.byteLength:0,e.delete(a),this.opts.onTileUnload(u)),e.size<=i&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((a,u)=>a.zoom-u.zoom),this._dirty=!1)}_getTile(e,t){let i=this.getTileId(e),s=this._cache.get(i),o=!1;return!s&&t?(s=new ul(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:i,zoom:this.getTileZoom(s.index)}),o=!0,this._cache.set(i,s),this._dirty=!0):s&&s.needsReload&&(o=!0),s&&o&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){let{_minZoom:t=0}=this,i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);let s=this._getTile(i);if(s)return s}return null}};function bR(n){for(let e of n)e.state=0;for(let e of n)e.isSelected&&!Z2(e)&&Gg(e);for(let e of n)e.isVisible=Boolean(e.state&Kf)}function AR(n){for(let t of n)t.state=0;for(let t of n)t.isSelected&&Z2(t);let e=Array.from(n).sort((t,i)=>t.zoom-i.zoom);for(let t of e)if(t.isVisible=Boolean(t.state&Kf),t.children&&(t.isVisible||t.state&Y2))for(let i of t.children)i.state=Y2;else t.isSelected&&Gg(t)}function Z2(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=Kf,!0;e=e.parent}return!1}function Gg(n){for(let e of n.children)e.isLoaded||e.content?e.state|=Kf:Gg(e)}var vR={TilesetClass:fl,data:{type:"data",value:[]},dataComparator:j2.equals,renderSubLayers:{type:"function",value:n=>new Qn(n),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:n=>{},compare:!1},onTileUnload:{type:"function",value:n=>{},compare:!1},onTileError:{type:"function",value:n=>console.error(n),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:$f,zRange:null,maxRequests:6,zoomOffset:0},ni=class extends Gt{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(e=this.state)===null||e===void 0||(t=e.tileset)===null||t===void 0||t.finalize()}get isLoaded(){var e,t;return(e=this.state)===null||e===void 0||(t=e.tileset)===null||t===void 0?void 0:t.selectedTiles.every(i=>i.isLoaded&&i.layers&&i.layers.every(s=>s.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state,i=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),s?t.reloadAll():this.state.tileset.tiles.forEach(o=>{o.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:s,extent:o,maxZoom:a,minZoom:u,maxRequests:l,zoomOffset:c}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:a,minZoom:u,tileSize:e,refinementStrategy:s,extent:o,maxRequests:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let{tileset:e}=this.state,{zRange:t,modelMatrix:i}=this.props,s=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:o}=e,a=this.state.isLoaded!==o,u=this.state.frameNumber!==s;o&&(a||u)&&this._onViewportLoad(),u&&this.setState({frameNumber:s}),this.state.isLoaded=o}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:t,getTileData:i,fetch:s}=this.props,{signal:o}=e;return e.url=typeof t=="string"||Array.isArray(t)?H2(t,e):null,i?i(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:t}){return e.picked&&(e.tile=t.props.tile),e}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(i=>e.layers[0].props[i]!==t[i])&&(e.layers=e.layers.map(i=>i.clone(t)));else{let i=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.id),data:e.content,_offset:0,tile:e});e.layers=hn(i,Boolean).map(s=>s.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){let{tile:i}=e.props;return this.state.tileset.isTileVisible(i,t)}};m(ni,"defaultProps",vR);m(ni,"layerName","TileLayer");var K2={clipBounds:[0,0,1,1]},$2=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,TR={name:"clip-vs",vs:$2},wR={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},SR={name:"clip-fs",fs:$2},PR={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},ii=class extends xn{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(e=this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[TR],inject:wR}:{modules:[SR],inject:PR}}draw({uniforms:e}){let{clipBounds:t=K2.clipBounds}=this.props;if(this.state.clipByInstance)e.clip_bounds=t;else{let i=this.projectPosition([t[0],t[1],0]),s=this.projectPosition([t[2],t[3],0]);e.clip_bounds=[Math.min(i[0],s[0]),Math.min(i[1],s[1]),Math.max(i[0],s[0]),Math.max(i[1],s[1])]}}};m(ii,"defaultProps",K2);m(ii,"extensionName","ClipExtension");var ub=we(We(),1);var eb=we(We(),1);var oe={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795};var Qf=`
uniform sampler2D nodeDepth;
uniform vec2 textureDim;

vec2 getCoordinate(vec3 nodeIdx) {
  // index = r + g * 256 + b * 65536
  // textureDim.x is always power of 2 and <= 65536
  // avoid making big integers (float32 precision)
  float x = nodeIdx.r + nodeIdx.g * 256.0;
  float y = floor(x / textureDim.x);
  x -= y * textureDim.x;
  y += 65536.0 / textureDim.x * nodeIdx.b;
  return vec2(x + 0.5, y + 0.5) / textureDim;
}

bool getDepth(vec3 nodeIdx, out float depth) {
  vec2 coord = getCoordinate(nodeIdx);
  vec4 c = texture2D(nodeDepth, coord);
  depth = c.r * 255.0;
  return c.a == 0.0;
}
`,CR=new Uint8Array(4),hl=class{constructor(e){this._gl=e,this._nodeDepthTextures=[J2(e),J2(e)],this._nodeDepth=this._nodeDepthTextures[0],this._nodeDepthFB=new le(e,{id:"graph-highlighter-framebuffer",width:this._nodeDepthTextures[0].width,height:1,attachments:{[oe.COLOR_ATTACHMENT0]:this._nodeDepthTextures[0]}}),this._model=MR(e),this._transform=IR(e)}delete(){var e,t,i,s;(e=this._edgeSourceBuffer)==null||e.delete(),(t=this._edgeTargetBuffer)==null||t.delete(),(i=this._edgeDirectionBuffer)==null||i.delete(),(s=this._edgeDepthBuffer)==null||s.delete(),this._nodeDepthTextures.forEach(o=>o.delete()),this._nodeDepthFB.delete(),this._model.delete(),this._transform.delete()}get nodeDepth(){return this._nodeDepth}get edgeDepth(){return this._edgeDepthBuffer}encodeNodeIndex(e,t){return Ug(this._nodeMap.get(e.id),t)}getNode(e){return this._nodeList[e]}setGraph(e){if(this._graph===e.graph)return;this._graph=e.graph;let t=this._graph.deepEdgesCount;this._nodeMap=new Map,this._nodeList=[],this._hasBidirectionalEdge=!1,this._lastSourceId=void 0;let i=this._gl;this._edgeSourceBuffer=Jf(i,this._edgeSourceBuffer,{size:3,type:oe.UNSIGNED_BYTE},t),this._edgeTargetBuffer=Jf(i,this._edgeTargetBuffer,{size:3,type:oe.UNSIGNED_BYTE},t),this._edgeDirectionBuffer=Jf(i,this._edgeDirectionBuffer,{size:1,type:oe.UNSIGNED_BYTE},t),this._edgeDepthBuffer=Jf(i,this._edgeDepthBuffer,{size:1,type:oe.FLOAT},t);let s=0,o=0;for(let d of e.nodesBreadthFirst)this._nodeList[s]=d,this._nodeMap.set(d.id,s),s++;let a=new Uint8Array(t*3),u=new Uint8Array(t*3),l=new Uint8Array(t),c=[0,0,0];for(let d of e.deepEdges){let x=this._nodeMap.get(d.source.id);Ug(x,c),a.set(c,o*3);let E=this._nodeMap.get(d.target.id);Ug(E,c),u.set(c,o*3);let w=de.getDrawingObj(d.edge);this._hasBidirectionalEdge=this._hasBidirectionalEdge||!w.directed,l[o]=w.directed?1:0,o++}this._edgeSourceBuffer.subData(a),this._edgeTargetBuffer.subData(u),this._edgeDirectionBuffer.subData(l),this._nodeCount=this._nodeMap.size;let f=this._nodeDepthTextures[0].width,h=Math.ceil((this._nodeCount+1)/f);this._nodeDepthFB.resize({width:f,height:h}),this._transform.update({elementCount:t,sourceBuffers:{source:this._edgeSourceBuffer,target:this._edgeTargetBuffer,direction:this._edgeDirectionBuffer},feedbackBuffers:{nextDepth:this._edgeDepthBuffer}}),this._model.setAttributes({source:this._edgeSourceBuffer,target:this._edgeTargetBuffer,direction:this._edgeDirectionBuffer}),this._model.setVertexCount(t),this.update({sourceId:null})}update(e){let{sourceId:t,edgeDepth:i=!1,maxDepth:s=1}=e;if(t===this._lastSourceId)return;this._lastSourceId=t;let o=[this._nodeDepthFB.width,this._nodeDepthFB.height],a=this._nodeDepthTextures[1],u=this._nodeDepthTextures[0];if(t){let l=this._nodeMap.get(t);this._resetNodeDepth(a,l),this._resetNodeDepth(u,l);for(let c=0;c<s;c++){[a,u]=[u,a],this._nodeDepthFB.attach({[oe.COLOR_ATTACHMENT0]:u});let f={nodeDepth:a,textureDim:o,testForward:!0};this._updateNodeDepth(f),this._hasBidirectionalEdge&&(f.testForward=!1,this._updateNodeDepth(f))}}else this._resetNodeDepth(u),this._nodeDepthFB.attach({[oe.COLOR_ATTACHMENT0]:u});this._nodeDepth=u,i&&(this._nodeDepthFB.attach({[oe.COLOR_ATTACHMENT0]:a}),this._transform.run({framebuffer:this._nodeDepthFB,clearRenderTarget:!1,discard:!0,uniforms:{nodeDepth:u,textureDim:o}}))}_resetNodeDepth(e,t){this._nodeDepthFB.attach({[oe.COLOR_ATTACHMENT0]:e});let i=this._gl;if(be(i,{framebuffer:this._nodeDepthFB,viewport:[0,0,e.width,e.height],clearColor:[1,1,1,1]},()=>{i.clear(oe.COLOR_BUFFER_BIT)}),t!==void 0){let s=(t+1)%e.width,o=Math.floor((t+1)/e.width);e.setSubImageData({data:CR,x:s,y:o,width:1,height:1})}}_updateNodeDepth(e){this._model.draw({framebuffer:this._nodeDepthFB,uniforms:e,parameters:{depthTest:!1,blend:!0,viewport:[0,0,this._nodeDepthFB.width,this._nodeDepthFB.height],blendFunc:[oe.ONE,oe.ONE,oe.ONE,oe.ONE],blendEquation:[oe.MIN,oe.MIN]}})}};function Jf(n,e,t,i){e||(e=new re(n,{target:n.ARRAY_BUFFER,accessor:t}));let s=i*t.size*(t.type===oe.UNSIGNED_BYTE?1:4);return e.byteLength<s&&e.reallocate(s),e}function J2(n){let e=n.getParameter(n.MAX_TEXTURE_SIZE);return e=Math.min(1024,2**Math.floor(Math.log2(e))),new he(n,{format:oe.RGBA,type:oe.UNSIGNED_BYTE,border:0,mipmaps:!1,dataFormat:oe.RGBA,width:e,height:1,parameters:{[oe.TEXTURE_MIN_FILTER]:oe.NEAREST,[oe.TEXTURE_MAG_FILTER]:oe.NEAREST,[oe.TEXTURE_WRAP_S]:oe.CLAMP_TO_EDGE,[oe.TEXTURE_WRAP_T]:oe.CLAMP_TO_EDGE}})}function MR(n){return new Pe(n,{id:"graph-highlighter-nodes",vs:`
#define SHADER_NAME graph-highlighter-nodes-vertex-shader

uniform bool testForward;

attribute vec3 source;
attribute vec3 target;
attribute float direction;

varying float targetDepth;

${Qf}

void main(void) {
  vec3 sourceIdx = source;
  vec3 targetIdx = target;
  if (!testForward && direction == 0.0) {
    sourceIdx = target;
    targetIdx = source;
  }
  float sourceDepth;
  bool sourceDepthValid = getDepth(sourceIdx, sourceDepth);
  vec2 targetCoord = getCoordinate(targetIdx);

  gl_Position = vec4(targetCoord * 2.0 - 1.0, sourceDepthValid ? 0.0 : 2.0, 1.0);
  gl_PointSize = 1.0;

  targetDepth = sourceDepth + 1.0;
}
`,fs:`
#define SHADER_NAME graph-highlighter-nodes-fragment-shader
varying float targetDepth;

void main(void) {
  gl_FragColor = vec4(targetDepth / 255.0, 0.0, 0.0, 0.0);
}`,isInstanced:!1,drawMode:oe.POINTS})}function IR(n){return new Ot(n,{vs:`
#define SHADER_NAME graph-highlighter-edges-vertex-shader

attribute vec3 source;
attribute vec3 target;
attribute float direction;

varying float nextDepth;

${Qf}

float getDepth(vec3 sourceIdx) {
  float sourceDepth;
  if (getDepth(sourceIdx, sourceDepth)) {
    return sourceDepth + 1.0;
  }
  return 255.0;
}

void main(void) {
  nextDepth = getDepth(source);
  if (direction == 0.0) {
    nextDepth = min(nextDepth, getDepth(target));
  }

  gl_Position = vec4(0.0);
}
`,varyings:["nextDepth"]})}function Ug(n,e){return e[0]=n+1&255,e[1]=n+1>>8&255,e[2]=n+1>>8>>8&255,e}var LR={lineWidthUnits:"common",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},sizeScale:{type:"number",min:0,value:1},stroked:!0,filled:!0,cornerRadius:{type:"number",min:0,value:0},highlightColors:{type:"array",compare:!0,value:[[255,100,0],[255,200,80],[255,255,200]]},getPickingColor:{type:"accessor",value:[0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:n=>n.size},getFillColor:{type:"accessor",value:[255,255,255,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getShape:{type:"accessor",value:0}},RR=`#define SHADER_NAME geometry-layer-vertex-shader
attribute vec2 positions;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec2 instanceSizes;
attribute float instanceShapes;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform mat4 depthHighlightColors;
uniform float opacity;
uniform float sizeScale;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform bool stroked;
uniform bool filled;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 vPosition;
varying vec4 shape; // [width, height, lineWidth, SHAPE]

${Qf}

void applyHighlight(int i) {
  if (i >= 3) return;
  vFillColor.rgb = mix(vFillColor.rgb, depthHighlightColors[i].rgb, depthHighlightColors[i].a);
}

void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  float lineWidthCommon = project_pixel_size(lineWidthPixels);

  geometry.uv = positions.xy;

  vec3 offset = vec3((instanceSizes * sizeScale + 1.0) / 2.0 * positions.xy, 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  
  vPosition = offset.xy;
  shape = vec4(instanceSizes * sizeScale, lineWidthCommon, instanceShapes);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);

  picking_setPickingColor(instancePickingColors);

  float depth;
  if (getDepth(instancePickingColors, depth)) {
    applyHighlight(int(depth));
  }
}
`,DR=`#define SHADER_NAME geometry-layer-fragment-shader
#define RECTANGLE 0.0
#define OVAL      1.0
#define DIAMOND   2.0

#define SIN_60 0.8660254

precision highp float;

uniform bool filled;
uniform bool stroked;
uniform float cornerRadius;
uniform float project_uScale;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 vPosition;
varying vec4 shape; // [width, height, lineWidth, SHAPE]

float smoothedgeCommon(float edge, float x) {
  float radius = 0.5 / project_uScale;
  return smoothstep(edge - radius, edge + radius, x);
}

float smoothedgeCommon(float edge, float x, float maxRadius) {
  float radius = min(0.5 / project_uScale, maxRadius);
  return smoothstep(edge - radius, edge + radius, x);
}

float inRectangle(vec2 halfSize, float radius) {
  vec2 edgeVec = halfSize - abs(vPosition);
  float edgeDistance = min(edgeVec.x, edgeVec.y);
  float inside = smoothedgeCommon(0.0, edgeDistance);
  if (radius == 0.0) {
    return inside;
  }
  vec2 cornerVec = radius - edgeVec;
  cornerVec *= float(cornerVec.x > 0.0 && cornerVec.y > 0.0);
  float outCorner = smoothedgeCommon(radius, length(cornerVec), radius / 2.0);
  return inside * (1.0 - outCorner);
}

float inOval(vec2 halfSize) {
  float aspect = halfSize.x / halfSize.y;
  return smoothedgeCommon(length(vec2(vPosition.x, vPosition.y * aspect)), halfSize.x);
}

float inDiamond(vec2 halfSize) {
  float aspect = halfSize.x / halfSize.y;
  vec2 edgeVec = abs(vPosition);
  return smoothedgeCommon(edgeVec.x, halfSize.x - edgeVec.y * aspect);
}

void main(void) {
  float inShape;
  float inFill;
  float lineWidth = shape.z;
  float type = shape.w;
  vec2 halfSize = shape.xy / 2.0;

  if (type == RECTANGLE)
  {
    inShape = inRectangle(halfSize, cornerRadius);
    inFill = inRectangle(halfSize - lineWidth, max(cornerRadius - lineWidth, 0.0));
  }
  else if (type == OVAL)
  {
    inShape = inOval(halfSize);
    inFill = inOval(halfSize - lineWidth);
  }
  else if (type == DIAMOND)
  {
    inShape = inDiamond(halfSize);
    float c = length(halfSize);
    float cscA = c / halfSize.y;
    float secA = c / halfSize.x;
    inFill = inDiamond(halfSize - lineWidth * vec2(cscA, secA));
  }

  if (inShape == 0.0) {
    discard;
  }
  if (picking_uActive) {
    gl_FragColor = picking_filterPickingColor(vFillColor);
    return;
  }

  if (stroked) {
    if (filled) {
      gl_FragColor = mix(vLineColor, vFillColor, inFill);
    } else {
      if (inFill == 1.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * (1.0 - inFill));
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inShape;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ps=class extends Ne{getShaders(){return super.getShaders({vs:RR,fs:DR,modules:[ft,Wn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:oe.DOUBLE,fp64:!0,transition:!0,accessor:"getPosition"},instanceSizes:{size:2,transition:!0,accessor:"getSize"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:oe.UNSIGNED_BYTE,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:oe.UNSIGNED_BYTE,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1},instanceShapes:{size:1,type:oe.UNSIGNED_BYTE,accessor:"getShape"},instancePickingColors:{size:3,type:oe.UNSIGNED_BYTE,accessor:"getPickingColor"}})}updateState(t){var u;super.updateState(t);let{props:i,oldProps:s,changeFlags:o}=t,a=!1;if(o.extensionsChanged){let{gl:l}=this.context;(u=this.state.model)==null||u.delete(),this.state.model=this._getModel(l),this.getAttributeManager().invalidateAll(),a=!0}if(a||i.highlightColors!==s.highlightColors){let l=new Float32Array(16);for(let c=0;c<4;c++){let f=i.highlightColors[c];f&&(l[c*4]=f[0]/255,l[c*4+1]=f[1]/255,l[c*4+2]=f[2]/255,l[c*4+3]=Number.isFinite(f[3])?f[3]/255:1)}this.state.model.setUniforms({depthHighlightColors:l})}}draw({uniforms:t}){let{stroked:i,filled:s,cornerRadius:o,sizeScale:a,lineWidthUnits:u,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:f,nodeDepth:h}=this.props;this.state.model.setUniforms(t).setUniforms({stroked:i,filled:s,cornerRadius:o,sizeScale:a,lineWidthUnits:it[u],lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:f,nodeDepth:h,textureDim:[h.width,h.height]}).draw()}_getModel(t){let i=[-1,-1,1,-1,1,1,-1,1];return new Pe(t,{...this.getShaders(),id:this.props.id,geometry:new Ze({drawMode:oe.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(i)}}}),isInstanced:!0})}};ps.defaultProps=LR,ps.layerName="GeometryLayer";var zr=class extends xn{constructor(t){let i={},s=!1,o=!1;for(let a in t.overrideProps){let u=t.overrideProps[a];u!==null&&(i[a]=u,s=!0,typeof u=="function"&&(o=!0))}super({overrideProps:i});this.isEnabled=!1;this.isDynamic=!1;this.isEnabled=s,this.isDynamic=o}updateState(t,i){if(!i.isEnabled)return;let s=this.getAttributeManager();if(!!s&&Object.isFrozen(this.props)){let o=this.props,a={},u=Object.create(this.props),{overrideProps:l}=i.opts;for(let c in l)if(Object.defineProperty(u,c,{get:()=>OR(c,l[c],FR(this),o[c])}),typeof l[c]=="function"&&c.startsWith("get")){let f=s.updateTriggers[c][0];a[c]=s.attributes[f]}this.setState({modifiedProps:u,dynamicAttributes:a}),this.props=u}}draw(t,i){if(!i.isEnabled)return;let{modifiedProps:s,dynamicAttributes:o}=this.state;if(this.props=s,"opacity"in i.opts.overrideProps&&(t.uniforms.opacity=Math.pow(s.opacity,1/2.2)),!!i.isDynamic)for(let a in o)o[a].setConstantValue(s[a])}};function FR(n){return{zoom:n.context.viewport.zoom}}function OR(n,e,t,i){let s;return typeof e=="function"?s=e(t):s=e,typeof s=="number"&&n.endsWith("Scale")&&(s*=i),s}function tb(n,e){return[new ps(n,{id:`${n.id}-node-boundary`,lineWidthUnits:"pixels",getPosition:rb,getSize:t=>[t.boundingBox.width,t.boundingBox.height],getShape:t=>zR(t.node),cornerRadius:GR(n.data[0]),getLineColor:Q2,getFillColor:UR,extensions:[new zr({overrideProps:{opacity:e.opacity,sizeScale:e.size,getFillColor:e.fillColor,getLineWidth:e.strokeWidth,getLineColor:e.strokeColor}})]}),new At(n,{id:`${n.id}-node-label`,getPosition:NR,getText:BR,getSize:kR,getColor:Q2,billboard:!1,sizeUnits:"common",characterSet:"auto",extensions:[new zr({overrideProps:{opacity:e.opacity,getColor:e.labelColor,sizeScale:e.labelSize}})]})]}function rb(n,{index:e,data:t}){return[n.center.x,n.center.y,1-e/t.length]}function NR(n,e){if(n instanceof eb.GeomGraph){let t=n.boundingBox;return[t.center.x,t.bottom+n.labelSize.height/2+2]}return rb(n,e)}function BR(n){return Bo(n.node).labelText}function kR(n){return Bo(n.node).fontsize}function GR(n){return n?Bo(n.node).xRad:0}function Q2(n){let e=Bo(n.node);if(e){let t=e.pencolor;if(t)return[t.R,t.G,t.B,t.A]}return[0,0,0,255]}function UR(n){let e=Bo(n.node);if(e){let t=e.fillColor;if(t)return[t.R,t.G,t.B,t.A]}return[255,255,255,255]}function zR(n){let e=Bo(n);if(e==null)return 0;switch(e.shape){case 0:return 2;case 1:return 1;case 2:return 0;case 3:return 1;case 4:return 0;case 5:return 1;case 6:return 1;case 10:return 1;case 14:return 1;case 18:return 0;case 11:return 0;case 12:return 0;default:return 0}}function Bo(n){return de.getDrawingObj(n)}var ko=we(We(),1);var VR="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGJhc2VQcm9maWxlPSJ0aW55IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgNjQgMzIiIG92ZXJmbG93PSJ2aXNpYmxlIiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+IDxyZWN0IGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjE2Ii8+IDxwb2x5Z29uIHBvaW50cz0iMS42NSwxNC4zNSAwLjk0LDEzLjY1IDYuNTksOCAwLjk0LDIuMzUgMS42NSwxLjY1IDgsOCAJIi8+CjwvZz4KPGc+IDxyZWN0IHg9IjgiIGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiLz4gPHBvbHlnb24gcG9pbnRzPSIxMi42NSw3LjM1IDExLjk0LDYuNjUgMTQuNTksNCAxMS45NCwxLjM1IDEyLjY1LDAuNjUgMTYsNCAJIi8+CjwvZz4KPGc+IDxyZWN0IHg9IjgiIHk9IjgiIGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiLz4gPHBvbHlsaW5lIHBvaW50cz0iMTQuNTksMTIgMTEuOTQsOS4zNSAxMi42NSw4LjY1IDE2LDEyIAkiLz4KPC9nPgo8Zz4gPHJlY3QgeD0iMTYiIGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiLz4gPHBvbHlsaW5lIHBvaW50cz0iMjAsMSAyNCw0IDIwLDcgCSIvPgo8L2c+CjxnPiA8cmVjdCB4PSI0OCIgZmlsbD0ibm9uZSIgd2lkdGg9IjgiIGhlaWdodD0iOCIvPiA8cGF0aCBkPSJNNTAsM2MwLjU1LDAsMSwwLjQ1LDEsMXMtMC40NSwxLTEsMXMtMS0wLjQ1LTEtMVM0OS40NSwzLDUwLDMgTTUwLDJjLTEuMSwwLTIsMC45LTIsMnMwLjksMiwyLDJzMi0wLjksMi0yUzUxLjEsMiw1MCwyIEw1MCwyeiIvPgo8L2c+CjxnPiA8cmVjdCB4PSI0OCIgeT0iOCIgZmlsbD0ibm9uZSIgd2lkdGg9IjgiIGhlaWdodD0iOCIvPiA8cGF0aCBkPSJNNTEsMTBjMS4xLDAsMiwwLjksMiwycy0wLjksMi0yLDJzLTItMC45LTItMlM0OS45LDEwLDUxLDEwIE01MSw5Yy0xLjY2LDAtMywxLjM0LTMsM3MxLjM0LDMsMywzczMtMS4zNCwzLTNTNTIuNjYsOSw1MSw5IEw1MSw5eiIvPgo8L2c+CjxnPiA8cmVjdCB4PSIzMiIgZmlsbD0ibm9uZSIgd2lkdGg9IjgiIGhlaWdodD0iMTYiLz4gPHBvbHlsaW5lIHBvaW50cz0iMzYsMyA0MCw4IDM2LDEzIAkiLz4KPC9nPgo8Zz4gPHJlY3QgeD0iMjQiIGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiLz4gPHBvbHlsaW5lIHBvaW50cz0iMjYsMiAzMiw0IDI2LDYgCSIvPgo8L2c+CjxnPiA8cmVjdCB4PSIxNiIgeT0iOCIgZmlsbD0ibm9uZSIgd2lkdGg9IjgiIGhlaWdodD0iOCIvPiA8cG9seWxpbmUgcG9pbnRzPSIyMCw5IDI0LDEyIDIwLDEyIAkiLz4KPC9nPgo8Zz4gPHJlY3QgeD0iMjQiIHk9IjgiIGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiLz4gPHBvbHlsaW5lIHBvaW50cz0iMjYsMTAgMzIsMTIgMjYsMTIgCSIvPgo8L2c+CjxnPiA8cmVjdCB4PSI1NiIgZmlsbD0ibm9uZSIgd2lkdGg9IjgiIGhlaWdodD0iOCIvPiA8Y2lyY2xlIGN4PSI1OCIgY3k9IjQiIHI9IjIiLz4KPC9nPgo8Zz4gPHJlY3QgeD0iNTYiIHk9IjgiIGZpbGw9Im5vbmUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiLz4gPGNpcmNsZSBjeD0iNTkiIGN5PSIxMiIgcj0iMyIvPgo8L2c+Cjwvc3ZnPgo=",zg=4,eh;function nb(n){return eh||(eh=typeof Image!="undefined"&&Dr(VR,Ri,{imagebitmap:{resizeWidth:256*zg,resizeHeight:128*zg}}).then(e=>{let t=new he(n,{data:e,parameters:{[n.TEXTURE_MIN_FILTER]:n.LINEAR_MIPMAP_LINEAR,[n.TEXTURE_MAG_FILTER]:n.LINEAR,[n.TEXTURE_WRAP_S]:n.CLAMP_TO_EDGE,[n.TEXTURE_WRAP_T]:n.CLAMP_TO_EDGE}});return eh=t,t})),eh}var ib=jR({caret:{mask:!0,x:32,y:0,width:32,height:32,anchorX:32},"half-caret":{mask:!0,x:32,y:32,width:32,height:32,anchorX:32},"caret-lg":{mask:!0,x:0,y:0,width:32,height:64,anchorX:32},triangle:{mask:!0,x:64,y:0,width:32,height:32,anchorX:32},"triangle-ex":{mask:!0,x:64,y:0,width:32,height:32},"half-triangle":{mask:!0,x:64,y:32,width:32,height:32,anchorX:32},"half-triangle-ex":{mask:!0,x:64,y:32,width:32,height:32},"triangle-n":{mask:!0,x:104,y:4,width:24,height:24,anchorX:24},"triangle-n-ex":{mask:!0,x:96,y:0,width:32,height:32,anchorX:8},"half-triangle-n":{mask:!0,x:96,y:32,width:32,height:32,anchorX:32},"half-triangle-n-ex":{mask:!0,x:96,y:32,width:32,height:32,anchorX:8},"triangle-w":{mask:!0,x:128,y:0,width:32,height:64,anchorX:32},"triangle-w-ex":{mask:!0,x:128,y:0,width:32,height:64},"circle-ex":{mask:!0,x:192,y:0,width:32,height:32,anchorX:0},"circle-lg-ex":{mask:!0,x:192,y:32,width:32,height:32,anchorX:0},dot:{mask:!0,x:224,y:0,width:32,height:32,anchorX:8},"dot-ex":{mask:!0,x:224,y:0,width:32,height:32,anchorX:0},"dot-lg":{mask:!0,x:224,y:32,width:32,height:32,anchorX:12},"dot-lg-ex":{mask:!0,x:224,y:32,width:32,height:32,anchorX:0}},zg);function jR(n,e){for(let t in n){let i=n[t];i.x*=e,i.y*=e,i.width*=e,i.height*=e,i.anchorX&&(i.anchorX*=e),i.anchorY&&(i.anchorY*=e)}return n}var WR={widthUnits:"common",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getControlPoints:{type:"accessor",value:n=>n.points},getCurveType:{type:"accessor",value:0},getResolution:{type:"accessor",value:4},getRange:{type:"accessor",value:[0,1]},getWidth:{type:"accessor",value:1},getColor:{type:"accessor",value:[0,0,0,255]}},HR=`#define SHADER_NAME curve-layer-vertex-shader
#define LINE    0.0
#define BEZIER  1.0
#define ARC     2.0

attribute vec2 positions;
attribute vec2 instanceSegments;
attribute vec4 instancePositions1;
attribute vec4 instancePositions2;
attribute float instanceTypes;
attribute float instanceWidths;
attribute vec4 instanceColors;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;

void interpolateLine(float t, vec2 start, vec2 end, out vec2 point) {
  point = mix(start, end, t);
}

void interpolateBezierCurve(float t, vec2 start, vec2 c1, vec2 c2, vec2 end, out vec2 point) {
  vec2 c = (c1 - start) * 3.0;
  vec2 e = (c2 - c1) * 3.0 - c;
  vec2 l = end - start - c - e;

  float t2 = t * t;
  float t3 = t2 * t;
  
  point = l * t3 + e * t2 + c * t + start;
}

void interpolateArc(float t, vec2 center, vec2 aAxis, vec2 bAxis, out vec2 point) {
  point = center + cos(t) * aAxis + sin(t) * bAxis;
}

vec2 getExtrusionOffset(vec2 line, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir = normalize(line);
  // rotate by 90 degrees
  dir = vec2(-dir.y, dir.x);
  return dir * offset_direction * width / 2.0;
}

void main(void) {
  // Multiply out line width and clamp to limits
  float widthPixels = clamp(
    project_size_to_pixel(widthScale * instanceWidths, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  float widthCommon = project_pixel_size(widthPixels);

  geometry.uv = positions.xy;

  vec2 pointOnCurve;
  vec2 nextPointOnCurve;
  vec2 pointOnCurve64Low = vec2(0.0);
  float r = instanceSegments.x + positions.x * instanceSegments.y;
  float rNext = r + instanceSegments.y;

  if (instanceTypes == BEZIER) {
    interpolateBezierCurve(r, instancePositions1.xy, instancePositions1.zw, instancePositions2.xy, instancePositions2.zw, pointOnCurve);
    interpolateBezierCurve(rNext, instancePositions1.xy, instancePositions1.zw, instancePositions2.xy, instancePositions2.zw, nextPointOnCurve);
  }
  else if (instanceTypes == ARC) {
    interpolateArc(r, instancePositions1.xy, instancePositions1.zw, instancePositions2.xy, pointOnCurve);
    interpolateArc(rNext, instancePositions1.xy, instancePositions1.zw, instancePositions2.xy, nextPointOnCurve);
  }
  else {
    interpolateLine(r, instancePositions1.xy, instancePositions1.zw, pointOnCurve);
    interpolateLine(rNext, instancePositions1.xy, instancePositions1.zw, nextPointOnCurve);
  }
  
  vec3 offset = vec3(getExtrusionOffset(
    nextPointOnCurve - pointOnCurve,
    positions.y,
    widthCommon), 0.0);

  gl_Position = project_position_to_clipspace(
    vec3(pointOnCurve, 0.0),
    vec3(pointOnCurve64Low, 0.0),
    offset,
    geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XR=`#define SHADER_NAME curve-layer-fragment-shader
varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,gs=class extends Ne{getShaders(){return super.getShaders({vs:HR,fs:XR,modules:[ft,Wn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:8,transition:!0,accessor:"getControlPoints",shaderAttributes:{instancePositions1:{size:4},instancePositions2:{size:4,elementOffset:4}}},instanceSegments:{size:2,update:this._getSegments},instanceTypes:{size:1,type:oe.UNSIGNED_BYTE,accessor:"getCurveType"},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceColors:{size:4,transition:!0,normalized:!0,type:oe.UNSIGNED_BYTE,accessor:"getColor",defaultValue:[0,0,0,255]}})}updateState(t){var o;super.updateState(t);let{props:i,changeFlags:s}=t;if(s.dataChanged&&this.updateGeometry(),s.extensionsChanged){let{gl:a}=this.context;(o=this.state.model)==null||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}updateGeometry(){let{data:t,getResolution:i,getCurveType:s,getRange:o}=this.props,{iterable:a,objectInfo:u}=Ar(t),l=[0],c=0,f=[];for(let h of a){u.index++;let d=typeof s=="function"?s(h,u):s,x=typeof o=="function"?o(h,u):o,E=d===0?1:Math.ceil(typeof i=="function"?i(h,u):i);c+=E;let w=(x[1]-x[0])/E;l.push(c);for(let S=0;S<E;S++)f.push(x[0]+w*S,w)}this.setState({startIndices:l,numInstances:c,segments:new Float32Array(f)})}draw({uniforms:t}){let{widthUnits:i,widthScale:s,widthMinPixels:o,widthMaxPixels:a}=this.props;this.state.model.setUniforms(t).setUniforms({widthUnits:it[i],widthScale:s,widthMinPixels:o,widthMaxPixels:a}).draw()}_getModel(t){let i=[0,-1,1,-1,1,1,0,1];return new Pe(t,{...this.getShaders(),id:this.props.id,geometry:new Ze({drawMode:oe.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(i)}}}),isInstanced:!0})}_getSegments(t){t.value=this.state.segments}};gs.layerName="CurveLayer",gs.defaultProps=WR;function sb(n,e){return n.data._curves||(n.data._curves=Array.from(ZR(n.data,(t,i,s)=>(t.__source={parent:this,object:i,index:s},t)))),new gs(n,{id:`${n.id}-edge`,data:n.data._curves,getCurveType:qR,getControlPoints:YR,getRange:t=>[t.parStart,t.parEnd],widthUnits:"pixels",getResolution:t=>t.length*n.resolution,clipByInstance:!1,extensions:[new zr({overrideProps:{opacity:e.opacity,getWidth:e.strokeWidth,getColor:e.strokeColor}})]})}function ob(n,e){return new Qt(n,{id:`${n.id}-arrowhead`,iconAtlas:"deck://arrowAtlas",iconMapping:ib,getPosition:t=>[t.tip.x,t.tip.y],getColor:t=>KR(t.edge),getIcon:t=>$R(t.edge),getSize:t=>JR(t.tip,t.base),getAngle:t=>QR(t.tip,t.base),billboard:!1,sizeUnits:"common",extensions:[new zr({overrideProps:{opacity:e.opacity,sizeScale:e.arrowSize,getColor:e.arrowColor}})]})}function ab(n,e){return new At(n,{id:`${n.id}-edge-label`,getText:eD,getSize:tD,getColor:rD,getPosition:t=>[t.center.x,t.center.y],sizeUnits:"common",extensions:[new zr({overrideProps:{opacity:e.opacity,sizeScale:e.labelSize,getColor:e.labelColor}})]})}function qR(n){return n instanceof ko.Ellipse?2:n instanceof ko.BezierSeg?1:0}function YR(n){return n instanceof ko.Ellipse?[n.center,n.aAxis,n.bAxis].flatMap(Vg):n instanceof ko.BezierSeg?n.b.flatMap(Vg):[n.start,n.end].flatMap(Vg)}function*ZR(n,e){let t=0;for(let i of n){let{curve:s}=i;e(s,i,t),yield s,t++}}function Vg(n){return[n.x,n.y]}function KR(n){let e=th(n);if(e){let t=e.color;if(t)return[t.R,t.G,t.B]}return[0,0,0]}function $R(n){return"triangle-n"}function JR(n,e){let t=n.x-e.x,i=n.y-e.y;return Math.sqrt(t*t+i*i)}function QR(n,e){let t=n.x-e.x,i=n.y-e.y;return Math.atan2(i,t)/Math.PI*180}function eD(n){return th(n.parent.entity).labelText}function tD(n){return th(n.parent.entity).fontsize}function rD(n){let e=th(n.parent.entity).labelfontcolor;return e?[e.R,e.G,e.B]:[0,0,0]}function th(n){return de.getDrawingObj(n)}var ms=class extends Gt{updateState({props:t,oldProps:i,changeFlags:s}){let{graphStyle:o}=t;if(s.dataChanged||o!==i.graphStyle){let a=t.data,u={tileMap:t.tileMap},l={};for(let c of o.layers){let f=new ub.TileData(null);l[c.id]=f,c.type==="node"&&(f.nodes=c.filter?a.nodes.filter(h=>c.filter(h.node,u)):a.nodes),c.type==="edge"&&(f.curveClips=c.filter?a.curveClips.filter(h=>c.filter(h.edge,u)):a.curveClips,f.arrowheads=c.filter?a.arrowheads.filter(h=>c.filter(h.edge,u)):a.arrowheads,f.labels=c.filter?a.labels.filter(h=>c.filter(h.parent.entity,u)):a.labels)}this.setState({layerMap:l})}}getPickingInfo({sourceLayer:t,info:i}){return t.id.endsWith("node-boundary")&&i.picked&&(i.object=this.props.highlighter.getNode(i.index)),i}filterSubLayer({layer:t,viewport:i}){let s=t.props.layerStyle,{zoom:o}=i;return s.minZoom<=o&&s.maxZoom>=o}renderLayers(){let{layerMap:t}=this.state,{graphStyle:i,highlighter:s,resolution:o,fontFamily:a,fontWeight:u,lineHeight:l,tile:c,modelMatrix:f}=this.props,h=i.layers.length,d=c.bbox.right-c.bbox.left;return i.layers.map((x,E)=>{var D,C,L,B;let w=t[x.id],S=[],M=this.getSubLayerProps({id:x.id});return Object.assign(M,{layerStyle:x,modelMatrix:new ge(f).scale([1,1,-d/4]),parameters:{depthRange:[1-(E+1)/h,1-E/h]}}),((D=w.nodes)==null?void 0:D.length)>0&&S.push(tb({...M,data:w.nodes,getPickingColor:(j,{target:J})=>s.encodeNodeIndex(j,J),nodeDepth:s.nodeDepth,fontFamily:a,fontWeight:u,lineHeight:l},x)),((C=w.curveClips)==null?void 0:C.length)>0&&S.push(sb({...M,data:w.curveClips,getDepth:s.edgeDepth,resolution:o},x)),((L=w.arrowheads)==null?void 0:L.length)>0&&S.push(ob({...M,data:w.arrowheads},x)),((B=w.labels)==null?void 0:B.length)>0&&S.push(ab({...M,data:w.labels,fontFamily:a,fontWeight:u,lineHeight:l},x)),S})}};ms.defaultProps={...At.defaultProps,resolution:{type:"number",value:1},highlighter:{type:"object"},fontSize:{type:"number",value:16}},ms.layerName="Graphayer";var Wr=we(We(),1);function lb(n,e,t){t[n]=t[n]||[],t[n].indexOf(e)<0&&t[n].push(e)}function jg(n,e,t){if(t[n]){let i=t[n].indexOf(e);i>=0&&t[n].splice(i,1)}}var dl=class{constructor(){this._listeners={};this._onceListeners={}}on(e,t){lb(e,t,this._listeners)}once(e,t){lb(e,t,this._onceListeners)}off(e,t){jg(e,t,this._listeners),jg(e,t,this._onceListeners)}emit(e){var a,u;let t;typeof e=="string"?t={type:e}:t=e;let i=t.type;if(!this._listens(i))return;t.target=this;let s=((a=this._listeners[i])==null?void 0:a.slice())||[];for(let l of s)l.call(this,t);let o=((u=this._onceListeners[i])==null?void 0:u.slice())||[];for(let l of o)jg(i,l,this._onceListeners),l.call(this,t)}_listens(e){return this._listeners[e]&&this._listeners[e].length>0||this._onceListeners[e]&&this._onceListeners[e].length>0}};var cb={version:1,layers:[{type:"node"},{type:"edge"}]};function xs(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function Wg(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function rh(n){let e,t,i;n.length!==2?(e=xs,t=(u,l)=>xs(n(u),l),i=(u,l)=>n(u)-l):(e=n===xs||n===Wg?n:nD,t=n,i=n);function s(u,l,c=0,f=u.length){if(c<f){if(e(l,l)!==0)return f;do{let h=c+f>>>1;t(u[h],l)<0?c=h+1:f=h}while(c<f)}return c}function o(u,l,c=0,f=u.length){if(c<f){if(e(l,l)!==0)return f;do{let h=c+f>>>1;t(u[h],l)<=0?c=h+1:f=h}while(c<f)}return c}function a(u,l,c=0,f=u.length){let h=s(u,l,c,f-1);return h>c&&i(u[h-1],l)>-i(u[h],l)?h-1:h}return{left:s,center:a,right:o}}function nD(){return 0}function Hg(n){return n===null?NaN:+n}var fb=rh(xs),hb=fb.right,iD=fb.left,sD=rh(Hg).center,Xg=hb;var qg=Math.sqrt(50),Yg=Math.sqrt(10),Zg=Math.sqrt(2);function nh(n,e,t){var i,s=-1,o,a,u;if(e=+e,n=+n,t=+t,n===e&&t>0)return[n];if((i=e<n)&&(o=n,n=e,e=o),(u=ih(n,e,t))===0||!isFinite(u))return[];if(u>0){let l=Math.round(n/u),c=Math.round(e/u);for(l*u<n&&++l,c*u>e&&--c,a=new Array(o=c-l+1);++s<o;)a[s]=(l+s)*u}else{u=-u;let l=Math.round(n*u),c=Math.round(e*u);for(l/u<n&&++l,c/u>e&&--c,a=new Array(o=c-l+1);++s<o;)a[s]=(l+s)/u}return i&&a.reverse(),a}function ih(n,e,t){var i=(e-n)/Math.max(0,t),s=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,s);return s>=0?(o>=qg?10:o>=Yg?5:o>=Zg?2:1)*Math.pow(10,s):-Math.pow(10,-s)/(o>=qg?10:o>=Yg?5:o>=Zg?2:1)}function Kg(n,e,t){var i=Math.abs(e-n)/Math.max(0,t),s=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/s;return o>=qg?s*=10:o>=Yg?s*=5:o>=Zg&&(s*=2),e<n?-s:s}function db(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function sh(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function $g(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function ml(){}var pl=.7,uh=1/pl,Go="\\s*([+-]?\\d+)\\s*",gl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",oD=/^#([0-9a-f]{3,8})$/,aD=new RegExp(`^rgb\\(${Go},${Go},${Go}\\)$`),uD=new RegExp(`^rgb\\(${Vr},${Vr},${Vr}\\)$`),lD=new RegExp(`^rgba\\(${Go},${Go},${Go},${gl}\\)$`),cD=new RegExp(`^rgba\\(${Vr},${Vr},${Vr},${gl}\\)$`),fD=new RegExp(`^hsl\\(${gl},${Vr},${Vr}\\)$`),hD=new RegExp(`^hsla\\(${gl},${Vr},${Vr},${gl}\\)$`),pb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sh(ml,si,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:gb,formatHex:gb,formatHex8:dD,formatHsl:pD,formatRgb:mb,toString:mb});function gb(){return this.rgb().formatHex()}function dD(){return this.rgb().formatHex8()}function pD(){return Ab(this).formatHsl()}function mb(){return this.rgb().formatRgb()}function si(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=oD.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?xb(e):t===3?new vt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?oh(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?oh(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=aD.exec(n))?new vt(e[1],e[2],e[3],1):(e=uD.exec(n))?new vt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=lD.exec(n))?oh(e[1],e[2],e[3],e[4]):(e=cD.exec(n))?oh(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=fD.exec(n))?_b(e[1],e[2]/100,e[3]/100,1):(e=hD.exec(n))?_b(e[1],e[2]/100,e[3]/100,e[4]):pb.hasOwnProperty(n)?xb(pb[n]):n==="transparent"?new vt(NaN,NaN,NaN,0):null}function xb(n){return new vt(n>>16&255,n>>8&255,n&255,1)}function oh(n,e,t,i){return i<=0&&(n=e=t=NaN),new vt(n,e,t,i)}function gD(n){return n instanceof ml||(n=si(n)),n?(n=n.rgb(),new vt(n.r,n.g,n.b,n.opacity)):new vt}function oi(n,e,t,i){return arguments.length===1?gD(n):new vt(n,e,t,i??1)}function vt(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}sh(vt,oi,$g(ml,{brighter(n){return n=n==null?uh:Math.pow(uh,n),new vt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?pl:Math.pow(pl,n),new vt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new vt(Es(this.r),Es(this.g),Es(this.b),lh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yb,formatHex:yb,formatHex8:mD,formatRgb:Eb,toString:Eb}));function yb(){return`#${ys(this.r)}${ys(this.g)}${ys(this.b)}`}function mD(){return`#${ys(this.r)}${ys(this.g)}${ys(this.b)}${ys((isNaN(this.opacity)?1:this.opacity)*255)}`}function Eb(){let n=lh(this.opacity);return`${n===1?"rgb(":"rgba("}${Es(this.r)}, ${Es(this.g)}, ${Es(this.b)}${n===1?")":`, ${n})`}`}function lh(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Es(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function ys(n){return n=Es(n),(n<16?"0":"")+n.toString(16)}function _b(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new vr(n,e,t,i)}function Ab(n){if(n instanceof vr)return new vr(n.h,n.s,n.l,n.opacity);if(n instanceof ml||(n=si(n)),!n)return new vr;if(n instanceof vr)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,s=Math.min(e,t,i),o=Math.max(e,t,i),a=NaN,u=o-s,l=(o+s)/2;return u?(e===o?a=(t-i)/u+(t<i)*6:t===o?a=(i-e)/u+2:a=(e-t)/u+4,u/=l<.5?o+s:2-o-s,a*=60):u=l>0&&l<1?0:a,new vr(a,u,l,n.opacity)}function vb(n,e,t,i){return arguments.length===1?Ab(n):new vr(n,e,t,i??1)}function vr(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}sh(vr,vb,$g(ml,{brighter(n){return n=n==null?uh:Math.pow(uh,n),new vr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?pl:Math.pow(pl,n),new vr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,s=2*t-i;return new vt(Jg(n>=240?n-240:n+120,s,i),Jg(n,s,i),Jg(n<120?n+240:n-120,s,i),this.opacity)},clamp(){return new vr(bb(this.h),ah(this.s),ah(this.l),lh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let n=lh(this.opacity);return`${n===1?"hsl(":"hsla("}${bb(this.h)}, ${ah(this.s)*100}%, ${ah(this.l)*100}%${n===1?")":`, ${n})`}`}}));function bb(n){return n=(n||0)%360,n<0?n+360:n}function ah(n){return Math.max(0,Math.min(1,n||0))}function Jg(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}function Qg(n,e,t,i,s){var o=n*n,a=o*n;return((1-3*n+3*o-a)*e+(4-6*o+3*a)*t+(1+3*n+3*o-3*a)*i+a*s)/6}function Tb(n){var e=n.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),s=n[i],o=n[i+1],a=i>0?n[i-1]:2*s-o,u=i<e-1?n[i+2]:2*o-s;return Qg((t-i/e)*e,a,s,o,u)}}function wb(n){var e=n.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*e),s=n[(i+e-1)%e],o=n[i%e],a=n[(i+1)%e],u=n[(i+2)%e];return Qg((t-i/e)*e,s,o,a,u)}}var xl=n=>()=>n;function xD(n,e){return function(t){return n+t*e}}function yD(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function Sb(n){return(n=+n)==1?ch:function(e,t){return t-e?yD(e,t,n):xl(isNaN(e)?t:e)}}function ch(n,e){var t=e-n;return t?xD(n,t):xl(isNaN(n)?e:n)}var em=function n(e){var t=Sb(e);function i(s,o){var a=t((s=oi(s)).r,(o=oi(o)).r),u=t(s.g,o.g),l=t(s.b,o.b),c=ch(s.opacity,o.opacity);return function(f){return s.r=a(f),s.g=u(f),s.b=l(f),s.opacity=c(f),s+""}}return i.gamma=n,i}(1);function Pb(n){return function(e){var t=e.length,i=new Array(t),s=new Array(t),o=new Array(t),a,u;for(a=0;a<t;++a)u=oi(e[a]),i[a]=u.r||0,s[a]=u.g||0,o[a]=u.b||0;return i=n(i),s=n(s),o=n(o),u.opacity=1,function(l){return u.r=i(l),u.g=s(l),u.b=o(l),u+""}}}var Jne=Pb(Tb),Qne=Pb(wb);function Cb(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),s;return function(o){for(s=0;s<t;++s)i[s]=n[s]*(1-o)+e[s]*o;return i}}function Mb(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ib(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,s=new Array(i),o=new Array(t),a;for(a=0;a<i;++a)s[a]=_s(n[a],e[a]);for(;a<t;++a)o[a]=e[a];return function(u){for(a=0;a<i;++a)o[a]=s[a](u);return o}}function Lb(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function ai(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function Rb(n,e){var t={},i={},s;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in n?t[s]=_s(n[s],e[s]):i[s]=e[s];return function(o){for(s in t)i[s]=t[s](o);return i}}var rm=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tm=new RegExp(rm.source,"g");function ED(n){return function(){return n}}function _D(n){return function(e){return n(e)+""}}function Db(n,e){var t=rm.lastIndex=tm.lastIndex=0,i,s,o,a=-1,u=[],l=[];for(n=n+"",e=e+"";(i=rm.exec(n))&&(s=tm.exec(e));)(o=s.index)>t&&(o=e.slice(t,o),u[a]?u[a]+=o:u[++a]=o),(i=i[0])===(s=s[0])?u[a]?u[a]+=s:u[++a]=s:(u[++a]=null,l.push({i:a,x:ai(i,s)})),t=tm.lastIndex;return t<e.length&&(o=e.slice(t),u[a]?u[a]+=o:u[++a]=o),u.length<2?l[0]?_D(l[0].x):ED(e):(e=l.length,function(c){for(var f=0,h;f<e;++f)u[(h=l[f]).i]=h.x(c);return u.join("")})}function _s(n,e){var t=typeof e,i;return e==null||t==="boolean"?xl(e):(t==="number"?ai:t==="string"?(i=si(e))?(e=i,em):Db:e instanceof si?em:e instanceof Date?Lb:Mb(e)?Cb:Array.isArray(e)?Ib:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Rb:ai)(n,e)}function nm(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function im(n){return function(){return n}}function sm(n){return+n}var Fb=[0,1];function Uo(n){return n}function om(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:im(isNaN(e)?NaN:.5)}function bD(n,e){var t;return n>e&&(t=n,n=e,e=t),function(i){return Math.max(n,Math.min(e,i))}}function AD(n,e,t){var i=n[0],s=n[1],o=e[0],a=e[1];return s<i?(i=om(s,i),o=t(a,o)):(i=om(i,s),o=t(o,a)),function(u){return o(i(u))}}function vD(n,e,t){var i=Math.min(n.length,e.length)-1,s=new Array(i),o=new Array(i),a=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++a<i;)s[a]=om(n[a],n[a+1]),o[a]=t(e[a],e[a+1]);return function(u){var l=Xg(n,u,1,i)-1;return o[l](s[l](u))}}function Ob(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function TD(){var n=Fb,e=Fb,t=_s,i,s,o,a=Uo,u,l,c;function f(){var d=Math.min(n.length,e.length);return a!==Uo&&(a=bD(n[0],n[d-1])),u=d>2?vD:AD,l=c=null,h}function h(d){return d==null||isNaN(d=+d)?o:(l||(l=u(n.map(i),e,t)))(i(a(d)))}return h.invert=function(d){return a(s((c||(c=u(e,n.map(i),ai)))(d)))},h.domain=function(d){return arguments.length?(n=Array.from(d,sm),f()):n.slice()},h.range=function(d){return arguments.length?(e=Array.from(d),f()):e.slice()},h.rangeRound=function(d){return e=Array.from(d),t=nm,f()},h.clamp=function(d){return arguments.length?(a=d?!0:Uo,f()):a!==Uo},h.interpolate=function(d){return arguments.length?(t=d,f()):t},h.unknown=function(d){return arguments.length?(o=d,h):o},function(d,x){return i=d,s=x,f()}}function am(){return TD()(Uo,Uo)}function Nb(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function bs(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function jr(n){return n=bs(Math.abs(n)),n?n[1]:NaN}function Bb(n,e){return function(t,i){for(var s=t.length,o=[],a=0,u=n[0],l=0;s>0&&u>0&&(l+u+1>i&&(u=Math.max(1,i-l)),o.push(t.substring(s-=u,s+u)),!((l+=u+1)>i));)u=n[a=(a+1)%n.length];return o.reverse().join(e)}}function kb(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var wD=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ui(n){if(!(e=wD.exec(n)))throw new Error("invalid format: "+n);var e;return new fh({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ui.prototype=fh.prototype;function fh(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}fh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Gb(n){e:for(var e=n.length,t=1,i=-1,s;t<e;++t)switch(n[t]){case".":i=s=t;break;case"0":i===0&&(i=t),s=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(s+1):n}var um;function Ub(n,e){var t=bs(n,e);if(!t)return n+"";var i=t[0],s=t[1],o=s-(um=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+bs(n,Math.max(0,e+o-1))[0]}function lm(n,e){var t=bs(n,e);if(!t)return n+"";var i=t[0],s=t[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}var cm={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Nb,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>lm(n*100,e),r:lm,s:Ub,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function fm(n){return n}var zb=Array.prototype.map,Vb=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function jb(n){var e=n.grouping===void 0||n.thousands===void 0?fm:Bb(zb.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",s=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?fm:kb(zb.call(n.numerals,String)),a=n.percent===void 0?"%":n.percent+"",u=n.minus===void 0?"\u2212":n.minus+"",l=n.nan===void 0?"NaN":n.nan+"";function c(h){h=ui(h);var d=h.fill,x=h.align,E=h.sign,w=h.symbol,S=h.zero,M=h.width,D=h.comma,C=h.precision,L=h.trim,B=h.type;B==="n"?(D=!0,B="g"):cm[B]||(C===void 0&&(C=12),L=!0,B="g"),(S||d==="0"&&x==="=")&&(S=!0,d="0",x="=");var j=w==="$"?t:w==="#"&&/[boxX]/.test(B)?"0"+B.toLowerCase():"",J=w==="$"?i:/[%p]/.test(B)?a:"",te=cm[B],Z=/[defgprs%]/.test(B);C=C===void 0?6:/[gprs]/.test(B)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function q(H){var ie=j,ee=J,fe,mt,Hr;if(B==="c")ee=te(H)+ee,H="";else{H=+H;var An=H<0||1/H<0;if(H=isNaN(H)?l:te(Math.abs(H),C),L&&(H=Gb(H)),An&&+H==0&&E!=="+"&&(An=!1),ie=(An?E==="("?E:u:E==="-"||E==="("?"":E)+ie,ee=(B==="s"?Vb[8+um/3]:"")+ee+(An&&E==="("?")":""),Z){for(fe=-1,mt=H.length;++fe<mt;)if(Hr=H.charCodeAt(fe),48>Hr||Hr>57){ee=(Hr===46?s+H.slice(fe+1):H.slice(fe))+ee,H=H.slice(0,fe);break}}}D&&!S&&(H=e(H,1/0));var Xr=ie.length+H.length+ee.length,wt=Xr<M?new Array(M-Xr+1).join(d):"";switch(D&&S&&(H=e(wt+H,wt.length?M-ee.length:1/0),wt=""),x){case"<":H=ie+H+ee+wt;break;case"=":H=ie+wt+H+ee;break;case"^":H=wt.slice(0,Xr=wt.length>>1)+ie+H+ee+wt.slice(Xr);break;default:H=wt+ie+H+ee;break}return o(H)}return q.toString=function(){return h+""},q}function f(h,d){var x=c((h=ui(h),h.type="f",h)),E=Math.max(-8,Math.min(8,Math.floor(jr(d)/3)))*3,w=Math.pow(10,-E),S=Vb[8+E/3];return function(M){return x(w*M)+S}}return{format:c,formatPrefix:f}}var hh,dh,ph;hm({thousands:",",grouping:[3],currency:["$",""]});function hm(n){return hh=jb(n),dh=hh.format,ph=hh.formatPrefix,hh}function dm(n){return Math.max(0,-jr(Math.abs(n)))}function pm(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(jr(e)/3)))*3-jr(Math.abs(n)))}function gm(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,jr(e)-jr(n))+1}function mm(n,e,t,i){var s=Kg(n,e,t),o;switch(i=ui(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(o=pm(s,a))&&(i.precision=o),ph(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=gm(s,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=dm(s))&&(i.precision=o-(i.type==="%")*2);break}}return dh(i)}function SD(n){var e=n.domain;return n.ticks=function(t){var i=e();return nh(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var s=e();return mm(s[0],s[s.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),s=0,o=i.length-1,a=i[s],u=i[o],l,c,f=10;for(u<a&&(c=a,a=u,u=c,c=s,s=o,o=c);f-- >0;){if(c=ih(a,u,t),c===l)return i[s]=a,i[o]=u,e(i);if(c>0)a=Math.floor(a/c)*c,u=Math.ceil(u/c)*c;else if(c<0)a=Math.ceil(a*c)/c,u=Math.floor(u*c)/c;else break;l=c}return n},n}function zo(){var n=am();return n.copy=function(){return Ob(n,zo())},db.apply(n,arguments),SD(n)}function xm(n){let e=n.layers.map(PD),t=new Set;for(let i of e){if(t.has(i.id))throw new Error(`Duplicate layer id: ${i.id}`);t.add(i.id)}return{layers:e}}function PD(n,e){var c;let{type:t,id:i=`layer-${e}`,filter:s,visible:o=!0,minZoom:a=-1/0,maxZoom:u=1/0}=n,l;if(t==="node")l={opacity:Tt(n.opacity),size:Tt(n.size),fillColor:Tt(n.fillColor,Vo),strokeWidth:Tt(n.strokeWidth),strokeColor:Tt(n.strokeColor,Vo),labelSize:Tt((c=n.labelSize)!=null?c:n.size),labelColor:Tt(n.labelColor,Vo)};else if(n.type==="edge")l={opacity:Tt(n.opacity),strokeWidth:Tt(n.strokeWidth),strokeColor:Tt(n.strokeColor,Vo),arrowSize:Tt(n.arrowSize),arrowColor:Tt(n.arrowColor,Vo),labelSize:Tt(n.labelSize),labelColor:Tt(n.labelColor,Vo)};else throw new Error(`Unknown layer type: ${t}`);return{type:t,id:i,filter:Hb(s),visible:o,minZoom:a,maxZoom:u,...l}}function Tt(n,e){if(!n)return null;if(n.interpolation){let{interpolation:t,interpolationParameters:i=[],input:s,inputStops:o,outputStops:a}=n;switch(t){case"linear":{let u=zo(o,a);return u.clamp(!0),l=>{let c=l[s],f=u(c);return e?e(f):f}}case"power":{let u=i[0]||2,l=zo(o.map(c=>Math.pow(u,c)),a);return l.clamp(!0),c=>{let f=c[s],h=l(Math.pow(u,f));return e?e(h):h}}case"step":return u=>{let l=u[s],c=o.findIndex(h=>h>l),f;return c<0?f=a[a.length-1]:f=a[c],e?e(f):f};default:throw new Error(`Unknown interpolation ${t}`)}}return e?e(n):n}function Vo(n){let e=oi(n);return[e.r,e.g,e.b,e.opacity*255]}function Hb(n){if(!n)return null;if(Array.isArray(n)){let t=n.map(Hb);return(i,s)=>{for(let o of t)if(!o(i,s))return!1;return!0}}let e;switch(n.property){case"id":e=t=>t.id;break;case"source-id":e=t=>t.source.id;break;case"target-id":e=t=>t.target.id;break;case"shape":e=t=>Ir[Wb(t).shape];break;case"label":e=t=>Wb(t).labelText;break;case"rank":e=(t,i)=>{var s,o,a;return"source"in t?Math.min((s=i.tileMap)==null?void 0:s.nodeRank.get(t.source),(o=i.tileMap)==null?void 0:o.nodeRank.get(t.target)):(a=i.tileMap)==null?void 0:a.nodeRank.get(t)};break;default:throw new Error(`Unknown filter property ${n.property}`)}switch(n.operator){case"=":return(t,i)=>e(t,i)===n.value;case"<":return(t,i)=>e(t,i)<n.value;case">":return(t,i)=>e(t,i)>n.value;case"<=":return(t,i)=>e(t,i)<=n.value;case">=":return(t,i)=>e(t,i)>=n.value;case"!=":return(t,i)=>e(t,i)!=n.value;case"*=":return(t,i)=>String(e(t,i)).includes(String(n.value));case"^=":return(t,i)=>String(e(t,i)).startsWith(String(n.value));case"$=":return(t,i)=>String(e(t,i)).endsWith(String(n.value));default:throw new Error(`Unknown filter operator ${n.operator}`)}}function Wb(n){return de.getDrawingObj(n)}var yl=2,El=class extends dl{constructor(t=document.body,i){super();this._layoutOptions={};this._controls=[];this._style=xm(cb);this._layoutWorkerUrl=i,this._textMeasurer=new Vs,window.getComputedStyle(t).position==="static"&&(t.style.position="relative");let s=Array.from({length:2},()=>{let o=document.createElement("div");return Object.assign(o.style,{position:"absolute",top:0,bottom:0,left:0,right:0}),t.appendChild(o)});this._deck=new Zn({parent:s[0],views:[new gn({flipY:!1})],initialViewState:{target:[0,0,0],zoom:0,maxZoom:yl},controller:!0,onLoad:()=>{this.emit("load");let{gl:o}=this._deck.deckRenderer;this._deck._addResources({arrowAtlas:nb(o)}),this._update()},onClick:({object:o})=>{!o&&this._highlightedNodeId&&this.highlight(null)}}),s[1].style.pointerEvents="none",this._controlsContainer=s[1]}addControl(t){if(this._controls.indexOf(t)<0){this._controls.push(t),t.onAdd(this);let i=t.getElement();i&&this._controlsContainer.appendChild(i)}}removeControl(t){let i=this._controls.indexOf(t);if(i>=0){let s=t.getElement();s&&s.remove(),t.onRemove(this),this._controls.splice(i,1)}}get graph(){return this._graph}setStyle(t){this._style=xm(t);let i=this._deck.props.layers[0];if(i){let s=i.clone({graphStyle:this._style});this._deck.setProps({layers:[s]})}}async setGraph(t,i=this._layoutOptions){this._graph===t?i&&await this.setOptions(i):(this._graph=t,i&&!(0,Wr.geometryIsCreated)(t)?(this._layoutOptions=i,this._textMeasurer.setOptions(i.label||{}),this._highlightedNodeId=null,(Ie.getDrawingObj(t)||new Ie(t)).createGeometry(this._textMeasurer.measure),await this._layoutGraph(!0)):this._deck.layerManager&&this._update())}async setOptions(t){let i=this._layoutOptions.label,s=t.label,o=!ba(i,s);if(this._layoutOptions=t,!this._graph)return;let a=Ie.getDrawingObj(this._graph);o&&(this._textMeasurer.setOptions(t.label||{}),a.createGeometry(this._textMeasurer.measure));let u=o;await this._layoutGraph(u)}zoomTo(t){let i=Math.min(this._deck.width/t.width,this._deck.height/t.height),s=Math.min(Math.log2(i),yl);this._deck.setProps({initialViewState:{target:[t.center.x,t.center.y,0],zoom:s,transitionInterpolator:new Jt(["target","zoom"]),transitionDuration:1e3,maxZoom:yl}})}highlight(t){this._highlightedNodeId=t,this._highlight(t)}_highlight(t,i=2){this._graph&&this._deck.layerManager&&(this._graphHighlighter.update({sourceId:t,maxDepth:i,edgeDepth:!1}),this._deck.layerManager.setNeedsRedraw("hightlight changed"))}async _layoutGraph(t){this._layoutWorkerUrl?this._graph=await dd(this._layoutWorkerUrl,this._graph,this._layoutOptions,t):_a(this._graph,this._layoutOptions,t),this._deck.layerManager&&this._update()}_update(){if(!this._graph)return;let t=this._textMeasurer.opts,i=Wr.GeomGraph.getGeom(this._graph);if(!i)return;this._graphHighlighter=this._graphHighlighter||new hl(this._deck.deckRenderer.gl),this._graphHighlighter.setGraph(i);let s=i.boundingBox;console.time("Generate tiles");let o=2**Math.ceil(Math.log2(Math.max(s.width,s.height))),a=Math.min(yl,Math.round(9-Math.log2(o))),u=new Wr.Rectangle({left:s.left-(o-s.width)/2,bottom:s.bottom-(o-s.height)/2,right:s.right+(o-s.width)/2,top:s.top+(o-s.height)/2}),l=new Wr.TileMap(i,u),c=l.buildUpToLevel(20);console.timeEnd("Generate tiles"),console.time("initial render");let f=new ge().translate([o/2-u.center.x,o/2-u.center.y,0]),h=new ni({extent:[0,0,o,o],refinementStrategy:"no-overlap",minZoom:a,maxZoom:c-1+a,tileSize:512,getTileData:d=>{let{x,y:E,z:w}=d.index;return d.bbox,l.getTileData(x,E,w-a)},autoHighlight:!0,onHover:({object:d,sourceLayer:x})=>{this._highlightedNodeId||(d instanceof Wr.GeomNode?this._highlight(d.id):this._highlight(null))},graphStyle:this._style,renderSubLayers:({data:d,graphStyle:x,id:E,tile:w})=>{if(!d)return null;let S=d.rect;return[new ms({id:E,data:d,modelMatrix:f,highlighter:this._graphHighlighter,fontFamily:t.fontFamily,fontWeight:t.fontWeight,lineHeight:t.lineHeight,resolution:2**(w.index.z-2),pickable:!0,graphStyle:x,tileMap:l,clipBounds:[S.left,S.bottom,S.right,S.top],clipByInstance:!1,extensions:[new ii]})]},updateTriggers:{getTileData:Date.now()}});this._deck.setProps({layers:[h],initialViewState:{target:[o/2,o/2,0],zoom:a,minZoom:a,maxZoom:yl},onAfterRender:()=>{h.isLoaded&&(console.timeEnd("initial render"),this._deck.setProps({onAfterRender:CD}))}}),this.emit({type:"graphload",data:this._graph})}};function CD(){}var Xb=we(We(),1);var MD=`
  .search-control { pointer-events: all; font-family: "Segoe UI", Helvetica, Arial, sans-serif; font-size: 14px; position: absolute; top: 0; right: 0; margin: 20px; width: 200px; }
  .search-control-input { font-family: "Segoe UI", Helvetica, Arial, sans-serif; font-size: 14px; padding: 8px; width: 100%; }
  .search-control-options { background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.3); padding: 12px 0; margin-top: 4px; overflow-x: hidden; overflow-y: auto; }
  .search-control-option { padding: 0 12px; line-height: 32px; white-space: nowrap; color: #000; cursor: pointer; }
  .search-control-option:hover { background: #f8f8f8; }
  .search-control-option.focus { color: #08f; background: #f8f8f8; }
`,_l=class{constructor(){this._nodes=[];this._onGraphLoad=e=>{this._updateNodeList(e.data)}}onAdd(e){e.on("graphload",this._onGraphLoad),this._dropdown=new ym({getLabel:t=>He.getDrawingObj(t).labelText,onSelect:t=>{e.highlight(t.id);let i=Xb.GeomNode.getGeom(t);e.zoomTo(i.boundingBox)}}),this._updateNodeList(e.graph)}onRemove(e){e.off("graphload",this._onGraphLoad),this._dropdown.delete(),this._dropdown=null}getElement(){return this._dropdown.element}_updateNodeList(e){this._nodes=e?Array.from(e.nodesBreadthFirst):[],this._dropdown.update(this._nodes)}},ym=class{constructor(e){this.focus=-1;this.items=[];this.options={getLabel:e=>e.toString(),renderItem:(e,t)=>{if(!t)return e;let i=e.toLowerCase().indexOf(t);return`${e.slice(0,i)}<b>${e.slice(i,i+t.length)}</b>${e.slice(i+t.length)}`},filterItem:(e,t)=>{if(!t)return 1;let i=e.toLowerCase().indexOf(t);return i===0?2:i>0?1:0},onSelect:()=>{},buffer:2,itemHeight:32,maxHeight:240};this._active=!1;this._topOffset=0;this._keyword="";this._filteredItems=[];this._items=[];this._onScroll=()=>{let{itemHeight:e,buffer:t,getLabel:i,renderItem:s}=this.options,o=this._flyout.scrollTop;this._topOffset=Math.max(0,Math.floor(o/e)-t),this._scroller.style.paddingTop=this._topOffset*e+"px";for(let a=0;a<this._items.length;a++){let u=this._items[a],l=a+this._topOffset;l===this.focus?u.classList.add("focus"):u.classList.remove("focus");let c=this._filteredItems[l];if(c){let f=i(c);u.innerHTML=s(f,this._keyword,c)}}};let t=document.createElement("style");t.innerText=MD,document.head.appendChild(t),this._stylesheet=t;let i=document.createElement("div");i.className="search-control";let s=document.createElement("input");s.placeholder="Search...",s.className="search-control-input",i.appendChild(s),s.addEventListener("focus",()=>{s.value="",this._keyword="",this._active=!0,this._updateFilter()}),s.addEventListener("blur",()=>{setTimeout(()=>{this._active=!1,this._updateUI()},200)}),s.addEventListener("input",u=>{this._keyword=s.value.toLowerCase(),this._updateFilter()}),s.addEventListener("keydown",u=>{switch(u.key){case"ArrowDown":u.preventDefault(),this.focus=Math.min(this._filteredItems.length-1,this.focus+1),this._updateUI();break;case"ArrowUp":u.preventDefault(),this.focus=Math.max(0,this.focus-1),this._updateUI();break;case"Enter":this._select(this.focus);break}}),this._textbox=s;let o=document.createElement("div");o.className="search-control-options",o.addEventListener("scroll",this._onScroll),i.appendChild(o);let a=document.createElement("div");a.style.boxSizing="border-box",a.style.overflow="hidden",o.appendChild(a),this._flyout=o,this._scroller=a,this.element=i,this.setOptions(e)}delete(){this.items=null,this._stylesheet.remove(),this._stylesheet=null,this.element.remove(),this.element=null,this._scroller=null,this._flyout=null}setOptions(e){Object.assign(this.options,e);let t=Math.ceil(this.options.maxHeight/this.options.itemHeight)+this.options.buffer*2,i=this._items;if(i.length!==t){for(let s=i.length;s<t;s++){let o=this._makeItem(s);i.push(o)}for(let s=i.length;s>t;s--)i[s-1].remove()}this._updateFilter()}update(e){this.items=e,this._textbox.value="",this._keyword="",this._updateFilter()}_updateFilter(){let{getLabel:e,filterItem:t}=this.options,i=this.items.map(o=>{let a=e(o);return t(a,this._keyword,o)}),s=Array.from(i,(o,a)=>a).filter(o=>i[o]);s.sort((o,a)=>i[a]-i[o]),this._filteredItems=s.map(o=>this.items[o]),this.focus=0,this._updateUI()}_select(e){let t=this._filteredItems[e];t&&(this.options.onSelect(t),this._textbox.value=this.options.getLabel(t),this._textbox.blur())}_updateUI(){if(!this._active){this._flyout.style.display="none";return}this._flyout.style.display="block",this._flyout.style.maxHeight=this.options.maxHeight+"px";let{itemHeight:e,maxHeight:t}=this.options,i=this._filteredItems.length,s=Math.floor(t/e),o=Math.max(0,(this.focus+2-s)*e),a=Math.min(Math.max(0,i*e-t),Math.max(0,this.focus-1)*e),u=this._flyout.scrollTop;u<o&&(u=o),u>a&&(u=a),this._scroller.style.height=i*e+"px";for(let l=0;l<this._items.length;l++){let c=this._items[l];c.style.display=l<i?"block":"none"}this._flyout.scrollTo({left:0,top:u,behavior:"smooth"}),this._onScroll()}_makeItem(e){let t=document.createElement("div");return t.className="search-control-option",t.style.height=this.options.itemHeight+"px",this._scroller.appendChild(t),t.addEventListener("click",()=>{this._select(e+this._topOffset)}),t}};globalThis.msagl=globalThis.msagl||{};Object.assign(globalThis.msagl,Em);})();
/*!
   Copyright 2019 Ron Buckton

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*/
/*!
   Copyright 2021 Ron Buckton

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*/
/*!
   Copyright 2022 Ron Buckton

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

   THIRD PARTY LICENSE NOTICE:

   xxHash Library
   Copyright (c) 2012-2021 Yann Collet
   All rights reserved.

   BSD 2-Clause License (https://www.opensource.org/licenses/bsd-license.php)

   Redistribution and use in source and binary forms, with or without modification,
   are permitted provided that the following conditions are met:

   * Redistributions of source code must retain the above copyright notice, this
     list of conditions and the following disclaimer.

   * Redistributions in binary form must reproduce the above copyright notice, this
     list of conditions and the following disclaimer in the documentation and/or
     other materials provided with the distribution.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
/*!
   Copyright 2022 Ron Buckton

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*/
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! The following comments were added due to code inlined from "@esfx/internal-binarysearch": */
